(self.webpackChunkgpsurbano=self.webpackChunkgpsurbano||[]).push([[179],{255:ut=>{function rt(fe){return Promise.resolve().then(()=>{var Be=new Error("Cannot find module '"+fe+"'");throw Be.code="MODULE_NOT_FOUND",Be})}rt.keys=()=>[],rt.resolve=rt,rt.id=255,ut.exports=rt},650:(ut,rt,fe)=>{"use strict";var Be=fe(536),Ae=fe(166),d="\n  ",re={};function Ce(je){var Le=Array.isArray(je);return function(Oe){var ye=Te(re.plainArray,Oe);if(ye)return ye;if(Le&&Oe.length!==je.length)return"an array with "+je.length+" items";for(var ze=0;ze<Oe.length;ze++)if(ye=Te(Le?je[ze]:je,Oe[ze]))return[ze].concat(ye)}}function Te(je,Le){if(null!=Le||je.hasOwnProperty("__required")){var et=je(Le);if(et)return Array.isArray(et)?et:[et]}}function ne(je,Le){var et=je.length,wt=je[et-1],Oe=je.slice(0,et-1);return 0===Oe.length&&(Oe=["value"]),Le=Ae(Le,{path:Oe}),"function"==typeof wt?wt(Le):it(Le,function(je){return"must be "+function(je){return/^an? /.test(je)?je:/^[aeiou]/i.test(je)?"an "+je:/^[a-z]/i.test(je)?"a "+je:je}(je)+"."}(wt))}function ie(je){return je.length<2?je[0]:2===je.length?je.join(" or "):je.slice(0,-1).join(", ")+", or "+je.slice(-1)}function it(je,Le){return(me(je.path)?"Item at position ":"")+je.path.join(".")+" "+Le}function me(je){return"number"==typeof je[je.length-1]||"number"==typeof je[0]}re.assert=function(je,Le){return Le=Le||{},function(et){var wt=Te(je,et);if(wt){var Oe=ne(wt,Le);throw Le.apiName&&(Oe=Le.apiName+": "+Oe),new Error(Oe)}}},re.shape=function(Le){var je,et=(je=Le,Object.keys(je||{}).map(function(Le){return{key:Le,value:je[Le]}}));return function(Oe){var ye=Te(re.plainObject,Oe);if(ye)return ye;for(var ze,pt=[],Dt=0;Dt<et.length;Dt++)(ye=Te(et[Dt].value,Oe[ze=et[Dt].key]))&&pt.push([ze].concat(ye));return pt.length<2?pt[0]:function(jt){pt=pt.map(function(kr){return"- "+kr[0]+": "+ne(kr,jt).split("\n").join(d)});var Wn=jt.path.join(".");return"The following properties"+("value"===Wn?"":" of "+Wn)+" have invalid values:"+d+pt.join(d)}}},re.strictShape=function(Le){var et=re.shape(Le);return function(Oe){var ye=et(Oe);if(ye)return ye;var ze=Object.keys(Oe).reduce(function(ct,pt){return void 0===Le[pt]&&ct.push(pt),ct},[]);return 0!==ze.length?function(){return"The following keys are invalid: "+ze.join(", ")}:void 0}},re.arrayOf=function(Le){return Ce(Le)},re.tuple=function(){var Le=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return Ce(Le)},re.required=function(Le){function et(wt){return null==wt?function(Oe){return it(Oe,me(Oe.path)?"cannot be undefined/null.":"is required.")}:Le.apply(this,arguments)}return et.__required=!0,et},re.oneOfType=function(){var Le=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(wt){var Oe=Le.map(function(ye){return Te(ye,wt)}).filter(Boolean);if(Oe.length===Le.length)return Oe.every(function(ye){return 1===ye.length&&"string"==typeof ye[0]})?ie(Oe.map(function(ye){return ye[0]})):Oe.reduce(function(ye,ze){return ze.length>ye.length?ze:ye})}},re.equal=function(Le){return function(wt){if(wt!==Le)return JSON.stringify(Le)}},re.oneOf=function(){var Le=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),et=Le.map(function(wt){return re.equal(wt)});return re.oneOfType.apply(this,et)},re.range=function(Le){var et=Le[0],wt=Le[1];return function(ye){if(Te(re.number,ye)||ye<et||ye>wt)return"number between "+et+" & "+wt+" (inclusive)"}},re.any=function(){},re.boolean=function(Le){if("boolean"!=typeof Le)return"boolean"},re.number=function(Le){if("number"!=typeof Le)return"number"},re.plainArray=function(Le){if(!Array.isArray(Le))return"array"},re.plainObject=function(Le){if(!Be(Le))return"object"},re.string=function(Le){if("string"!=typeof Le)return"string"},re.func=function(Le){if("function"!=typeof Le)return"function"},re.validate=Te,re.processMessage=ne,ut.exports=re},239:(ut,rt,fe)=>{"use strict";var Be=fe(196);function Ae(pe){this.origin=pe.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=pe.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=pe,this.send=this.send.bind(this),this.countries=pe.countries?pe.countries.split(","):null,this.types=pe.types?pe.types.split(","):null,this.bbox=pe.bbox?pe.bbox:null,this.language=pe.language?pe.language.split(","):null,this.limit=pe.limit?+pe.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(pe),this.eventQueue=new Array,this.flushInterval=pe.flushInterval||1e3,this.maxQueueSize=pe.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}Ae.prototype={select:function(pe,d){var re=this.getSelectedIndex(pe,d),Ce=this.getEventPayload("search.select",d);if(Ce.resultIndex=re,Ce.resultPlaceName=pe.place_name,Ce.resultId=pe.id,(re!==this.lastSentIndex||Ce.queryString!==this.lastSentInput)&&-1!=re&&(this.lastSentIndex=re,this.lastSentInput=Ce.queryString,Ce.queryString))return this.push(Ce)},start:function(pe){var d=this.getEventPayload("search.start",pe);if(d.queryString)return this.push(d)},keyevent:function(pe,d){if(pe.key&&!pe.metaKey&&-1===[9,27,37,39,13,38,40].indexOf(pe.keyCode)){var re=this.getEventPayload("search.keystroke",d);if(re.lastAction=pe.key,re.queryString)return this.push(re)}},send:function(pe,d){if(!this.enableEventLogging)return d?d():void 0;var re=this.getRequestOptions(pe);this.request(re,function(Ce){return Ce?this.handleError(Ce,d):d?d():void 0}.bind(this))},getRequestOptions:function(pe){return Array.isArray(pe)||(pe=[pe]),{method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(pe)}},getEventPayload:function(pe,d){var re;re=d.options.proximity?[d.options.proximity.longitude,d.options.proximity.latitude]:null;var Ce=d._map?d._map.getZoom():void 0,Te={event:pe,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:d.options.autocomplete,fuzzyMatch:d.options.fuzzyMatch,proximity:re,limit:d.options.limit,routing:d.options.routing,worldview:d.options.worldview,mapZoom:Ce,keyboardLocale:this.locale};return Te.queryString="search.select"===pe?d.inputString:"search.select"!=pe&&d._inputEl?d._inputEl.value:d.inputString,Te},request:function(pe,d){var re=new XMLHttpRequest;for(var Ce in re.onreadystatechange=function(){if(4==this.readyState)return d(204==this.status?null:this.statusText)},re.open(pe.method,pe.host+"/"+pe.path,!0),pe.headers)re.setRequestHeader(Ce,pe.headers[Ce]);re.send(pe.body)},handleError:function(pe,d){if(d)return d(pe)},generateSessionID:function(){return Be()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(pe,d){if(d._typeahead){var Ce=pe.id;return d._typeahead.data.map(function(ie){return ie.id}).indexOf(Ce)}},shouldEnableLogging:function(pe){return!(!1===pe.enableEventLogging||pe.origin&&-1==pe.origin.indexOf("api.mapbox.com")||pe.localGeocoder||pe.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(pe,d){this.eventQueue.push(pe),(this.eventQueue.length>=this.maxQueueSize||d)&&this.flush()},remove:function(){this.flush()}},ut.exports=Ae},410:ut=>{ut.exports={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}}},763:(ut,rt,fe)=>{"use strict";var Be=fe(462),Ae=fe(906),pe=fe(166),d=fe(105).EventEmitter,re=fe(410),Ce=fe(642),Te=fe(274),ne=fe(239),ie=fe(364),Fe=fe(561);function it(me){this._eventEmitter=new d,this.options=pe({},this.options,me),this.inputString="",this.fresh=!0,this.lastSelected=null}it.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,getItemValue:function(me){return me.place_name},render:function(me){var Pe=me.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+Pe[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+Pe.splice(1,Pe.length).join(",")+"</div></div>"}},addTo:function(me){function Pe(je,Le){if(!document.body.contains(Le))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const et=je.onAdd();Le.appendChild(et)}if(me._controlContainer)me.addControl(this);else if(me instanceof HTMLElement)Pe(this,me);else{if("string"!=typeof me)throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element");{const je=document.querySelectorAll(me);if(0===je.length)throw new Error("Element ",me,"not found.");if(je.length>1)throw new Error("Geocoder can only be added to a single html element");Pe(this,je[0])}}},onAdd:function(me){if(me&&"string"!=typeof me&&(this._map=me),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=Te(Ce({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new ne(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this);var Pe=this.container=document.createElement("div");Pe.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var je=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",Ae(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(wt){this.eventManager.keyevent(wt,this)}.bind(this));var Le=document.createElement("div");Le.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var et=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');return this._clearEl.appendChild(et),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),Le.appendChild(this._clearEl),Le.appendChild(this._loadingEl),Pe.appendChild(je),Pe.appendChild(this._inputEl),Pe.appendChild(Le),this._typeahead=new Be(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit}),this.setRenderFunction(this.options.render),this._typeahead.getItemValue=this.options.getItemValue,this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),Pe},createIcon:function(me,Pe){var je=document.createElementNS("http://www.w3.org/2000/svg","svg");if(je.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+me),je.setAttribute("viewBox","0 0 18 18"),je.setAttribute("xml:space","preserve"),je.setAttribute("width",18),je.setAttribute("height",18),"innerHTML"in je)je.innerHTML=Pe;else{var Le=document.createElement("div");Le.innerHTML="<svg>"+Pe.valueOf().toString()+"</svg>",je.appendChild(Le.firstChild.firstChild)}return je},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_onPaste:function(me){var Pe=(me.clipboardData||window.clipboardData).getData("text");Pe.length>=this.options.minLength&&this._geocode(Pe)},_onKeyDown:function(me){var Pe=27,je=9;if(me.keyCode===Pe&&this.options.clearAndBlurOnEsc)return this._clear(me),this._inputEl.blur();var Le=me.target&&me.target.shadowRoot?me.target.shadowRoot.activeElement:me.target;if(!Le||!Le.value)return this.fresh=!0,me.keyCode!==je&&this.clear(me),this._clearEl.style.display="none";me.metaKey||-1!==[je,Pe,37,39,13,38,40].indexOf(me.keyCode)||Le.value.length>=this.options.minLength&&this._geocode(Le.value)},_showButton:function(){this._typeahead.selected&&(this._clearEl.style.display="block")},_hideButton:function(){this._typeahead.selected&&(this._clearEl.style.display="none")},_onBlur:function(me){this.options.clearOnBlur&&this._clearOnBlur(me),this.options.collapsed&&this._collapse()},_onChange:function(){var me=this._typeahead.selected;if(me&&JSON.stringify(me)!==this.lastSelected){var Pe;if(this._clearEl.style.display="none",this.options.flyTo)if(me.properties&&re[me.properties.short_code])Pe=pe({},this.options.flyTo),this._map&&this._map.fitBounds(re[me.properties.short_code].bbox,Pe);else if(me.bbox){var je=me.bbox;Pe=pe({},this.options.flyTo),this._map&&this._map.fitBounds([[je[0],je[1]],[je[2],je[3]]],Pe)}else Pe=pe({},{zoom:this.options.zoom},this.options.flyTo),me.center?Pe.center=me.center:me.geometry&&me.geometry.type&&"Point"===me.geometry.type&&me.geometry.coordinates&&(Pe.center=me.geometry.coordinates),this._map&&this._map.flyTo(Pe);this.options.marker&&this._mapboxgl&&this._handleMarker(me),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(me),this._eventEmitter.emit("result",{result:me}),this.eventManager.select(me,this)}},_requestType:function(me,Pe){return me.localGeocoderOnly?1:me.reverseGeocode&&/^[ ]*(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/.test(Pe)?2:0},_setupConfig:function(me,Pe){const Le=/[\s,]+/;var et=this,wt=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"].reduce(function(ye,ze){return null==et.options[ze]||(ye[ze]=["countries","types","language"].indexOf(ze)>-1?et.options[ze].split(Le):et.options[ze],"proximity"===ze&&"number"==typeof et.options[ze].longitude&&"number"==typeof et.options[ze].latitude&&(ye[ze]=[et.options[ze].longitude,et.options[ze].latitude])),ye},{});switch(me){case 2:var Oe=Pe.split(Le).map(function(ye){return parseFloat(ye,10)}).reverse();wt=pe(wt,{query:Oe,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(ye){ye in wt&&delete wt[ye]});break;case 0:/^[ ]*(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)*[ ]*$/.test(Pe)&&(Pe=Pe.replace(/,/g," ")),wt=pe(wt,{query:Pe})}return wt},_geocode:function(me){this.inputString=me,this._loadingEl.style.display="block",this._eventEmitter.emit("loading",{query:me});const Pe=this._requestType(this.options,me),je=this._setupConfig(Pe,me);var Le;switch(Pe){case 1:Le=Promise.resolve();break;case 0:Le=this.geocoderService.forwardGeocode(je).send();break;case 2:Le=this.geocoderService.reverseGeocode(je).send()}var et=this.options.localGeocoder&&this.options.localGeocoder(me)||[],wt=[],Oe=null;return Le.catch(function(ye){Oe=ye}.bind(this)).then(function(ye){this._loadingEl.style.display="none";var ze={};return ye?"200"==ye.statusCode&&((ze=ye.body).request=ye.request,ze.headers=ye.headers):ze={type:"FeatureCollection",features:[]},ze.config=je,this.fresh&&(this.eventManager.start(this),this.fresh=!1),ze.features=ze.features?et.concat(ze.features):et,this.options.externalGeocoder?(wt=this.options.externalGeocoder(me,ze.features)||[]).then(function(ct){return ze.features=ze.features?ct.concat(ze.features):ct,ze},function(){return ze}):ze}.bind(this)).then(function(ye){if(Oe)throw Oe;this.options.filter&&ye.features.length&&(ye.features=ye.features.filter(this.options.filter)),ye.features.length?(this._clearEl.style.display="block",this._eventEmitter.emit("results",ye),this._typeahead.update(ye.features)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",ye))}.bind(this)).catch(function(ye){this._loadingEl.style.display="none",et.length&&this.options.localGeocoder||wt.length&&this.options.externalGeocoder?(this._clearEl.style.display="block",this._typeahead.update(et)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:et}),this._eventEmitter.emit("error",{error:ye})}.bind(this)),Le},_clear:function(me){me&&me.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._clearEl.style.display="none",this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(me){this._clear(me),this._inputEl.focus()},_clearOnBlur:function(me){me.relatedTarget&&this._clear(me)},_onQueryResult:function(me){var Pe=me.body;if(Pe.features.length){var je=Pe.features[0];this._typeahead.selected=je,this._inputEl.value=je.place_name,this._onChange()}},_updateProximity:function(){if(this._map)if(this._map.getZoom()>9){var me=this._map.getCenter().wrap();this.setProximity({longitude:me.lng,latitude:me.lat})}else this.setProximity(null)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(me){return this._geocode(me).then(this._onQueryResult),this},_renderError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>")},_renderNoResults:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>")},_renderMessage:function(me){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(me)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var me=this.options.language.split(",")[0],Pe=Fe.language(me),je=ie.placeholder[Pe];if(je)return je}return"Search"},setInput:function(me){return this._inputEl.value=me,this._typeahead.selected=null,this._typeahead.clear(),me.length>=this.options.minLength&&this._geocode(me),this},setProximity:function(me){return this.options.proximity=me,this},getProximity:function(){return this.options.proximity},setRenderFunction:function(me){return me&&"function"==typeof me&&(this._typeahead.render=me),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(me){var Pe=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=me||this.options.language||Pe,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(me){return this.options.zoom=me,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(me){return this.options.flyTo=me,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(me){return this.placeholder=me||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(me){return this.options.bbox=me,this},getCountries:function(){return this.options.countries},setCountries:function(me){return this.options.countries=me,this},getTypes:function(){return this.options.types},setTypes:function(me){return this.options.types=me,this},getMinLength:function(){return this.options.minLength},setMinLength:function(me){return this.options.minLength=me,this._typeahead&&(this._typeahead.options.minLength=me),this},getLimit:function(){return this.options.limit},setLimit:function(me){return this.options.limit=me,this._typeahead&&(this._typeahead.options.limit=me),this},getFilter:function(){return this.options.filter},setFilter:function(me){return this.options.filter=me,this},setOrigin:function(me){return this.options.origin=me,this.geocoderService=Te(Ce({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAutocomplete:function(me){return this.options.autocomplete=me,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(me){return this.options.fuzzyMatch=me,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(me){return this.options.routing=me,this},getRouting:function(){return this.options.routing},setWorldview:function(me){return this.options.worldview=me,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(me){if(this._map){this._removeMarker();var je=pe({},{color:"#4668F2"},this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(je),me.center?this.mapMarker.setLngLat(me.center).addTo(this._map):me.geometry&&me.geometry.type&&"Point"===me.geometry.type&&me.geometry.coordinates&&this.mapMarker.setLngLat(me.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(me,Pe){return this._eventEmitter.on(me,Pe),this},off:function(me,Pe){return this._eventEmitter.removeListener(me,Pe),this.eventManager.remove(),this}},ut.exports=it},364:ut=>{"use strict";ut.exports={placeholder:{de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"\u05dc\u05d7\u05e4\u05e9",ja:"\u30b5\u30fc\u30c1",lv:"Mekl\u0113t",pt:"Procurar",sr:"\u041f\u0440\u0435\u0442\u0440\u0430\u0433\u0430",zh:"\u641c\u7d22",cs:"Vyhled\xe1v\xe1n\xed",hu:"Keres\xe9s",ka:"\u10eb\u10d8\u10d4\u10d1\u10d0",nb:"S\xf8ke",sk:"Vyh\u013ead\xe1vanie",th:"\u0e04\u0e49\u0e19\u0e2b\u0e32",fi:"Hae",is:"Leita",ko:"\uc218\uc0c9",pl:"Szukaj",sl:"Iskanje",fa:"\u062c\u0633\u062a\u062c\u0648",ru:"\u041f\u043e\u0438\u0441\u043a"}}},196:ut=>{for(var rt=self.crypto||self.msCrypto,fe="-_",Be=36;Be--;)fe+=Be.toString(36);for(Be=36;Be---10;)fe+=Be.toString(36).toUpperCase();ut.exports=function(Ae){var pe="",d=rt.getRandomValues(new Uint8Array(Ae||21));for(Be=Ae||21;Be--;)pe+=fe[63&d[Be]];return pe}},642:(ut,rt,fe)=>{"use strict";var Be=fe(418);ut.exports=Be},418:(ut,rt,fe)=>{"use strict";var Be=fe(55),Ae=fe(864);function pe(re){Ae.call(this,re)}(pe.prototype=Object.create(Ae.prototype)).constructor=pe,pe.prototype.sendRequest=Be.browserSend,pe.prototype.abortRequest=Be.browserAbort,ut.exports=function(re){return new pe(re)}},55:(ut,rt,fe)=>{"use strict";var Be=fe(223),Ae=fe(712),pe=fe(849),d=fe(32),re={};function ne(it){var me=it.total,Pe=it.loaded;return{total:me,transferred:Pe,percent:100*Pe/me}}function ie(it,me){return new Promise(function(Pe,je){me.onprogress=function(wt){it.emitter.emit(pe.EVENT_PROGRESS_DOWNLOAD,ne(wt))};var Le=it.file;Le&&(me.upload.onprogress=function(wt){it.emitter.emit(pe.EVENT_PROGRESS_UPLOAD,ne(wt))}),me.onerror=function(wt){je(wt)},me.onabort=function(){var wt=new Ae({request:it,type:pe.ERROR_REQUEST_ABORTED});je(wt)},me.onload=function(){if(delete re[it.id],me.status<200||me.status>=400){var wt=new Ae({request:it,body:me.response,statusCode:me.status});je(wt)}else Pe(me)};var et=it.body;"string"==typeof et?me.send(et):et?me.send(JSON.stringify(et)):Le?me.send(Le):me.send(),re[it.id]=me}).then(function(Pe){return function(it,me){return new Be(it,{body:me.response,headers:d(me.getAllResponseHeaders()),statusCode:me.status})}(it,Pe)})}function Fe(it,me){var Pe=it.url(me),je=new window.XMLHttpRequest;return je.open(it.method,Pe),Object.keys(it.headers).forEach(function(Le){je.setRequestHeader(Le,it.headers[Le])}),je}ut.exports={browserAbort:function(it){var me=re[it.id];!me||(me.abort(),delete re[it.id])},sendRequestXhr:ie,browserSend:function(it){return Promise.resolve().then(function(){var me=Fe(it,it.client.accessToken);return ie(it,me)})},createRequestXhr:Fe}},864:(ut,rt,fe)=>{"use strict";var Be=fe(218),Ae=fe(495),pe=fe(849);function d(re){if(!re||!re.accessToken)throw new Error("Cannot create a client without an access token");Be(re.accessToken),this.accessToken=re.accessToken,this.origin=re.origin||pe.API_ORIGIN}d.prototype.createRequest=function(Ce){return new Ae(this,Ce)},ut.exports=d},712:(ut,rt,fe)=>{"use strict";var Be=fe(849);ut.exports=function(pe){var re,d=pe.type||Be.ERROR_HTTP;if(pe.body)try{re=JSON.parse(pe.body)}catch(Te){re=pe.body}else re=null;var Ce=pe.message||null;Ce||("string"==typeof re?Ce=re:re&&"string"==typeof re.message?Ce=re.message:d===Be.ERROR_REQUEST_ABORTED&&(Ce="Request aborted")),this.message=Ce,this.type=d,this.statusCode=pe.statusCode||null,this.request=pe.request,this.body=re}},495:(ut,rt,fe)=>{"use strict";var Be=fe(218),Ae=fe(166),pe=fe(563),d=fe(824),re=fe(849),Ce=1;function Te(ne,ie){if(!ne)throw new Error("MapiRequest requires a client");if(!ie||!ie.path||!ie.method)throw new Error("MapiRequest requires an options object with path and method properties");var Fe={};ie.body&&(Fe["content-type"]="application/json");var Ct=Ae(Fe,ie.headers),it=Object.keys(Ct).reduce(function(me,Pe){return me[Pe.toLowerCase()]=Ct[Pe],me},{});this.id=Ce++,this._options=ie,this.emitter=new pe,this.client=ne,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=ie.path,this.method=ie.method,this.origin=ie.origin||ne.origin,this.query=ie.query||{},this.params=ie.params||{},this.body=ie.body||null,this.file=ie.file||null,this.encoding=ie.encoding||"utf8",this.sendFileAs=ie.sendFileAs||null,this.headers=it}Te.prototype.url=function(ie){var Fe=d.prependOrigin(this.path,this.origin);Fe=d.appendQueryObject(Fe,this.query);var Ct=this.params,it=null==ie?this.client.accessToken:ie;if(it){Fe=d.appendQueryParam(Fe,"access_token",it);var me=Be(it).user;Ct=Ae({ownerId:me},Ct)}return d.interpolateRouteParams(Fe,Ct)},Te.prototype.send=function(){var ie=this;if(ie.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return ie.sent=!0,ie.client.sendRequest(ie).then(function(Fe){return ie.response=Fe,ie.emitter.emit(re.EVENT_RESPONSE,Fe),Fe},function(Fe){throw ie.error=Fe,ie.emitter.emit(re.EVENT_ERROR,Fe),Fe})},Te.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))},Te.prototype.eachPage=function(ie){var Fe=this;function Ct(Pe){ie(null,Pe,function(){delete Fe._nextPageRequest;var Le=Pe.nextPage();Le&&(Fe._nextPageRequest=Le,me(Le))})}function it(Pe){ie(Pe,null,function(){})}function me(Pe){Pe.send().then(Ct,it)}me(this)},Te.prototype.clone=function(){return this._extend()},Te.prototype._extend=function(ie){var Fe=Ae(this._options,ie);return new Te(this.client,Fe)},ut.exports=Te},223:(ut,rt,fe)=>{"use strict";var Be=fe(986);function Ae(pe,d){this.request=pe,this.headers=d.headers,this.rawBody=d.body,this.statusCode=d.statusCode;try{this.body=JSON.parse(d.body||"{}")}catch(re){this.body=d.body}this.links=Be(this.headers.link)}Ae.prototype.hasNextPage=function(){return!!this.links.next},Ae.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null},ut.exports=Ae},849:ut=>{"use strict";ut.exports={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"}},32:ut=>{"use strict";ut.exports=function(Be){var Ae={};return Be&&Be.trim().split(/[\r|\n]+/).forEach(function(pe){var d=function(Be){var Ae=Be.indexOf(":");return{name:Be.substring(0,Ae).trim().toLowerCase(),value:Be.substring(Ae+1).trim()}}(pe);Ae[d.name]=d.value}),Ae}},986:ut=>{"use strict";ut.exports=function(Ae){return Ae?Ae.split(/,\s*</).reduce(function(pe,d){var re=function(Ae){var pe=Ae.match(/<?([^>]*)>(.*)/);if(!pe)return null;var d=pe[1],re=pe[2].split(";"),Ce=null,Te=re.reduce(function(ne,ie){var Fe=function(Ae){var pe=Ae.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return pe?{key:pe[1],value:pe[2]}:null}(ie);return Fe?"rel"===Fe.key?(Ce||(Ce=Fe.value),ne):(ne[Fe.key]=Fe.value,ne):ne},{});return Ce?{url:d,rel:Ce,params:Te}:null}(d);return re?(re.rel.split(/\s+/).forEach(function(Te){pe[Te]||(pe[Te]={url:re.url,params:re.params})}),pe):pe},{}):{}}},824:ut=>{"use strict";function fe(re){return Array.isArray(re)?function(re){return re.map(encodeURIComponent).join(",")}(re):encodeURIComponent(String(re))}function Be(re,Ce,Te){if(!1===Te||null===Te)return re;var ne=/\?/.test(re)?"&":"?",ie=encodeURIComponent(Ce);return void 0!==Te&&""!==Te&&!0!==Te&&(ie+="="+fe(Te)),""+re+ne+ie}ut.exports={appendQueryObject:function(re,Ce){if(!Ce)return re;var Te=re;return Object.keys(Ce).forEach(function(ne){var ie=Ce[ne];void 0!==ie&&(Array.isArray(ie)&&(ie=ie.filter(function(Fe){return null!=Fe}).join(",")),Te=Be(Te,ne,ie))}),Te},appendQueryParam:Be,prependOrigin:function(re,Ce){if(!Ce||"http"===re.slice(0,4))return re;var Te="/"===re[0]?"":"/";return""+Ce.replace(/\/$/,"")+Te+re},interpolateRouteParams:function(re,Ce){return Ce?re.replace(/\/:([a-zA-Z0-9]+)/g,function(Te,ne){var ie=Ce[ne];if(void 0===ie)throw new Error("Unspecified route parameter "+ne);return"/"+fe(ie)}):re}}},563:ut=>{"use strict";var rt=Object.prototype.hasOwnProperty,fe="~";function Be(){}function Ae(Ce,Te,ne){this.fn=Ce,this.context=Te,this.once=ne||!1}function pe(Ce,Te,ne,ie,Fe){if("function"!=typeof ne)throw new TypeError("The listener must be a function");var Ct=new Ae(ne,ie||Ce,Fe),it=fe?fe+Te:Te;return Ce._events[it]?Ce._events[it].fn?Ce._events[it]=[Ce._events[it],Ct]:Ce._events[it].push(Ct):(Ce._events[it]=Ct,Ce._eventsCount++),Ce}function d(Ce,Te){0==--Ce._eventsCount?Ce._events=new Be:delete Ce._events[Te]}function re(){this._events=new Be,this._eventsCount=0}Object.create&&(Be.prototype=Object.create(null),(new Be).__proto__||(fe=!1)),re.prototype.eventNames=function(){var ne,ie,Te=[];if(0===this._eventsCount)return Te;for(ie in ne=this._events)rt.call(ne,ie)&&Te.push(fe?ie.slice(1):ie);return Object.getOwnPropertySymbols?Te.concat(Object.getOwnPropertySymbols(ne)):Te},re.prototype.listeners=function(Te){var ie=this._events[fe?fe+Te:Te];if(!ie)return[];if(ie.fn)return[ie.fn];for(var Fe=0,Ct=ie.length,it=new Array(Ct);Fe<Ct;Fe++)it[Fe]=ie[Fe].fn;return it},re.prototype.listenerCount=function(Te){var ie=this._events[fe?fe+Te:Te];return ie?ie.fn?1:ie.length:0},re.prototype.emit=function(Te,ne,ie,Fe,Ct,it){var me=fe?fe+Te:Te;if(!this._events[me])return!1;var Le,et,Pe=this._events[me],je=arguments.length;if(Pe.fn){switch(Pe.once&&this.removeListener(Te,Pe.fn,void 0,!0),je){case 1:return Pe.fn.call(Pe.context),!0;case 2:return Pe.fn.call(Pe.context,ne),!0;case 3:return Pe.fn.call(Pe.context,ne,ie),!0;case 4:return Pe.fn.call(Pe.context,ne,ie,Fe),!0;case 5:return Pe.fn.call(Pe.context,ne,ie,Fe,Ct),!0;case 6:return Pe.fn.call(Pe.context,ne,ie,Fe,Ct,it),!0}for(et=1,Le=new Array(je-1);et<je;et++)Le[et-1]=arguments[et];Pe.fn.apply(Pe.context,Le)}else{var Oe,wt=Pe.length;for(et=0;et<wt;et++)switch(Pe[et].once&&this.removeListener(Te,Pe[et].fn,void 0,!0),je){case 1:Pe[et].fn.call(Pe[et].context);break;case 2:Pe[et].fn.call(Pe[et].context,ne);break;case 3:Pe[et].fn.call(Pe[et].context,ne,ie);break;case 4:Pe[et].fn.call(Pe[et].context,ne,ie,Fe);break;default:if(!Le)for(Oe=1,Le=new Array(je-1);Oe<je;Oe++)Le[Oe-1]=arguments[Oe];Pe[et].fn.apply(Pe[et].context,Le)}}return!0},re.prototype.on=function(Te,ne,ie){return pe(this,Te,ne,ie,!1)},re.prototype.once=function(Te,ne,ie){return pe(this,Te,ne,ie,!0)},re.prototype.removeListener=function(Te,ne,ie,Fe){var Ct=fe?fe+Te:Te;if(!this._events[Ct])return this;if(!ne)return d(this,Ct),this;var it=this._events[Ct];if(it.fn)it.fn===ne&&(!Fe||it.once)&&(!ie||it.context===ie)&&d(this,Ct);else{for(var me=0,Pe=[],je=it.length;me<je;me++)(it[me].fn!==ne||Fe&&!it[me].once||ie&&it[me].context!==ie)&&Pe.push(it[me]);Pe.length?this._events[Ct]=1===Pe.length?Pe[0]:Pe:d(this,Ct)}return this},re.prototype.removeAllListeners=function(Te){var ne;return Te?this._events[ne=fe?fe+Te:Te]&&d(this,ne):(this._events=new Be,this._eventsCount=0),this},re.prototype.off=re.prototype.removeListener,re.prototype.addListener=re.prototype.on,re.prefixed=fe,re.EventEmitter=re,ut.exports=re},274:(ut,rt,fe)=>{"use strict";var Be=fe(166),Ae=fe(748),pe=fe(851),d=fe(661),re=fe(81),Ce={},Te=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];Ce.forwardGeocode=function(ne){Ae.assertShape({query:Ae.required(Ae.string),mode:Ae.oneOf("mapbox.places","mapbox.places-permanent"),countries:Ae.arrayOf(Ae.string),proximity:Ae.coordinates,types:Ae.arrayOf(Ae.oneOf(Te)),autocomplete:Ae.boolean,bbox:Ae.arrayOf(Ae.number),limit:Ae.number,language:Ae.arrayOf(Ae.string),routing:Ae.boolean,fuzzyMatch:Ae.boolean,worldview:Ae.string})(ne),ne.mode=ne.mode||"mapbox.places";var ie=d(Be({country:ne.countries},pe(ne,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:pe(ne,["mode","query"]),query:ie})},Ce.reverseGeocode=function(ne){Ae.assertShape({query:Ae.required(Ae.coordinates),mode:Ae.oneOf("mapbox.places","mapbox.places-permanent"),countries:Ae.arrayOf(Ae.string),types:Ae.arrayOf(Ae.oneOf(Te)),bbox:Ae.arrayOf(Ae.number),limit:Ae.number,language:Ae.arrayOf(Ae.string),reverseMode:Ae.oneOf("distance","score"),routing:Ae.boolean,worldview:Ae.string})(ne),ne.mode=ne.mode||"mapbox.places";var ie=d(Be({country:ne.countries},pe(ne,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:pe(ne,["mode","query"]),query:ie})},ut.exports=re(Ce)},81:(ut,rt,fe)=>{"use strict";var Be=fe(864),Ae=fe(418);ut.exports=function(d){return function(re){var Ce;Ce=Be.prototype.isPrototypeOf(re)?re:Ae(re);var Te=Object.create(d);return Te.client=Ce,Te}}},145:ut=>{"use strict";ut.exports=function(fe,Be){return Object.keys(fe).reduce(function(Ae,pe){return Ae[pe]=Be(pe,fe[pe]),Ae},{})}},851:ut=>{"use strict";ut.exports=function(fe,Be){var Ae=function(pe,d){return-1!==Be.indexOf(pe)&&void 0!==d};return"function"==typeof Be&&(Ae=Be),Object.keys(fe).filter(function(pe){return Ae(pe,fe[pe])}).reduce(function(pe,d){return pe[d]=fe[d],pe},{})}},661:(ut,rt,fe)=>{"use strict";var Be=fe(145);ut.exports=function(pe){return Be(pe,function(d,re){return"boolean"==typeof re?JSON.stringify(re):re})}},748:(ut,rt,fe)=>{"use strict";var Be=fe(166),Ae=fe(650);ut.exports=Be(Ae,{file:function(Te){return"undefined"!=typeof window?Te instanceof global.Blob||Te instanceof global.ArrayBuffer?void 0:"Blob or ArrayBuffer":"string"!=typeof Te&&void 0===Te.pipe?"Filename or Readable stream":void 0},date:function(Te){var ne="date";if("boolean"==typeof Te)return ne;try{var ie=new Date(Te);if(ie.getTime&&isNaN(ie.getTime()))return ne}catch(Fe){return ne}},coordinates:function(Te){return Ae.tuple(Ae.number,Ae.number)(Te)},assertShape:function(Te,ne){return Ae.assert(Ae.strictShape(Te),ne)}})},218:(ut,rt,fe)=>{"use strict";var Be=fe(839),Ae={};function re(Ce,Te){return Object.prototype.hasOwnProperty.call(Ce,Te)}ut.exports=function(Ce){if(Ae[Ce])return Ae[Ce];var Te=Ce.split("."),ne=Te[0],ie=Te[1];if(!ie)throw new Error("Invalid token");var Fe=function(Ce){try{return JSON.parse(Be.decode(Ce))}catch(Te){throw new Error("Invalid token")}}(ie),Ct={usage:ne,user:Fe.u};return re(Fe,"a")&&(Ct.authorization=Fe.a),re(Fe,"exp")&&(Ct.expires=1e3*Fe.exp),re(Fe,"iat")&&(Ct.created=1e3*Fe.iat),re(Fe,"scopes")&&(Ct.scopes=Fe.scopes),re(Fe,"client")&&(Ct.client=Fe.client),re(Fe,"ll")&&(Ct.lastLogin=Fe.ll),re(Fe,"iu")&&(Ct.impersonator=Fe.iu),Ae[Ce]=Ct,Ct}},573:(ut,rt)=>{function fe(Ae){if(Ae)return function(Ae){for(var pe in fe.prototype)Ae[pe]=fe.prototype[pe];return Ae}(Ae)}rt.Q=fe,fe.prototype.on=fe.prototype.addEventListener=function(Ae,pe){return this._callbacks=this._callbacks||{},(this._callbacks["$"+Ae]=this._callbacks["$"+Ae]||[]).push(pe),this},fe.prototype.once=function(Ae,pe){function d(){this.off(Ae,d),pe.apply(this,arguments)}return d.fn=pe,this.on(Ae,d),this},fe.prototype.off=fe.prototype.removeListener=fe.prototype.removeAllListeners=fe.prototype.removeEventListener=function(Ae,pe){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var d=this._callbacks["$"+Ae];if(!d)return this;if(1==arguments.length)return delete this._callbacks["$"+Ae],this;for(var re,Ce=0;Ce<d.length;Ce++)if((re=d[Ce])===pe||re.fn===pe){d.splice(Ce,1);break}return 0===d.length&&delete this._callbacks["$"+Ae],this},fe.prototype.emitReserved=fe.prototype.emit=function(Ae){this._callbacks=this._callbacks||{};for(var pe=new Array(arguments.length-1),d=this._callbacks["$"+Ae],re=1;re<arguments.length;re++)pe[re-1]=arguments[re];if(d){re=0;for(var Ce=(d=d.slice(0)).length;re<Ce;++re)d[re].apply(this,pe)}return this},fe.prototype.listeners=function(Ae){return this._callbacks=this._callbacks||{},this._callbacks["$"+Ae]||[]},fe.prototype.hasListeners=function(Ae){return!!this.listeners(Ae).length}},591:ut=>{function rt(fe){this.ms=(fe=fe||{}).min||100,this.max=fe.max||1e4,this.factor=fe.factor||2,this.jitter=fe.jitter>0&&fe.jitter<=1?fe.jitter:0,this.attempts=0}ut.exports=rt,rt.prototype.duration=function(){var fe=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var Be=Math.random(),Ae=Math.floor(Be*this.jitter*fe);fe=0==(1&Math.floor(10*Be))?fe-Ae:fe+Ae}return 0|Math.min(fe,this.max)},rt.prototype.reset=function(){this.attempts=0},rt.prototype.setMin=function(fe){this.ms=fe},rt.prototype.setMax=function(fe){this.max=fe},rt.prototype.setJitter=function(fe){this.jitter=fe}},839:function(ut,rt,fe){var Be;ut=fe.nmd(ut),function(Ae){"object"==typeof global&&global;var Ce=function(Pe){this.message=Pe};(Ce.prototype=new Error).name="InvalidCharacterError";var Te=function(Pe){throw new Ce(Pe)},ne="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ie=/[\t\n\f\r ]/g,it={encode:function(Pe){Pe=String(Pe),/[^\0-\xFF]/.test(Pe)&&Te("The string to be encoded contains characters outside of the Latin1 range.");for(var wt,Oe,ye,ct,je=Pe.length%3,Le="",et=-1,pt=Pe.length-je;++et<pt;)wt=Pe.charCodeAt(et)<<16,Oe=Pe.charCodeAt(++et)<<8,ye=Pe.charCodeAt(++et),Le+=ne.charAt((ct=wt+Oe+ye)>>18&63)+ne.charAt(ct>>12&63)+ne.charAt(ct>>6&63)+ne.charAt(63&ct);return 2==je?(wt=Pe.charCodeAt(et)<<8,Oe=Pe.charCodeAt(++et),Le+=ne.charAt((ct=wt+Oe)>>10)+ne.charAt(ct>>4&63)+ne.charAt(ct<<2&63)+"="):1==je&&(ct=Pe.charCodeAt(et),Le+=ne.charAt(ct>>2)+ne.charAt(ct<<4&63)+"=="),Le},decode:function(Pe){var je=(Pe=String(Pe).replace(ie,"")).length;je%4==0&&(je=(Pe=Pe.replace(/==?$/,"")).length),(je%4==1||/[^+a-zA-Z0-9/]/.test(Pe))&&Te("Invalid character: the string to be decoded is not correctly encoded.");for(var et,wt,Le=0,Oe="",ye=-1;++ye<je;)wt=ne.indexOf(Pe.charAt(ye)),et=Le%4?64*et+wt:wt,Le++%4&&(Oe+=String.fromCharCode(255&et>>(-2*Le&6)));return Oe},version:"0.1.0"};void 0!==(Be=function(){return it}.call(rt,fe,rt,ut))&&(ut.exports=Be)}()},105:ut=>{"use strict";var Be,rt="object"==typeof Reflect?Reflect:null,fe=rt&&"function"==typeof rt.apply?rt.apply:function(ye,ze,ct){return Function.prototype.apply.call(ye,ze,ct)};Be=rt&&"function"==typeof rt.ownKeys?rt.ownKeys:Object.getOwnPropertySymbols?function(ye){return Object.getOwnPropertyNames(ye).concat(Object.getOwnPropertySymbols(ye))}:function(ye){return Object.getOwnPropertyNames(ye)};var pe=Number.isNaN||function(ye){return ye!=ye};function d(){d.init.call(this)}ut.exports=d,ut.exports.once=function(Oe,ye){return new Promise(function(ze,ct){function pt(jt){Oe.removeListener(ye,Dt),ct(jt)}function Dt(){"function"==typeof Oe.removeListener&&Oe.removeListener("error",pt),ze([].slice.call(arguments))}wt(Oe,ye,Dt,{once:!0}),"error"!==ye&&function(Oe,ye,ze){"function"==typeof Oe.on&&wt(Oe,"error",ye,{once:!0})}(Oe,pt)})},d.EventEmitter=d,d.prototype._events=void 0,d.prototype._eventsCount=0,d.prototype._maxListeners=void 0;var re=10;function Ce(Oe){if("function"!=typeof Oe)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof Oe)}function Te(Oe){return void 0===Oe._maxListeners?d.defaultMaxListeners:Oe._maxListeners}function ne(Oe,ye,ze,ct){var pt,Dt,jt;if(Ce(ze),void 0===(Dt=Oe._events)?(Dt=Oe._events=Object.create(null),Oe._eventsCount=0):(void 0!==Dt.newListener&&(Oe.emit("newListener",ye,ze.listener?ze.listener:ze),Dt=Oe._events),jt=Dt[ye]),void 0===jt)jt=Dt[ye]=ze,++Oe._eventsCount;else if("function"==typeof jt?jt=Dt[ye]=ct?[ze,jt]:[jt,ze]:ct?jt.unshift(ze):jt.push(ze),(pt=Te(Oe))>0&&jt.length>pt&&!jt.warned){jt.warned=!0;var Wn=new Error("Possible EventEmitter memory leak detected. "+jt.length+" "+String(ye)+" listeners added. Use emitter.setMaxListeners() to increase limit");Wn.name="MaxListenersExceededWarning",Wn.emitter=Oe,Wn.type=ye,Wn.count=jt.length,function(Oe){console&&console.warn&&console.warn(Oe)}(Wn)}return Oe}function ie(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Fe(Oe,ye,ze){var ct={fired:!1,wrapFn:void 0,target:Oe,type:ye,listener:ze},pt=ie.bind(ct);return pt.listener=ze,ct.wrapFn=pt,pt}function Ct(Oe,ye,ze){var ct=Oe._events;if(void 0===ct)return[];var pt=ct[ye];return void 0===pt?[]:"function"==typeof pt?ze?[pt.listener||pt]:[pt]:ze?function(Oe){for(var ye=new Array(Oe.length),ze=0;ze<ye.length;++ze)ye[ze]=Oe[ze].listener||Oe[ze];return ye}(pt):me(pt,pt.length)}function it(Oe){var ye=this._events;if(void 0!==ye){var ze=ye[Oe];if("function"==typeof ze)return 1;if(void 0!==ze)return ze.length}return 0}function me(Oe,ye){for(var ze=new Array(ye),ct=0;ct<ye;++ct)ze[ct]=Oe[ct];return ze}function wt(Oe,ye,ze,ct){if("function"==typeof Oe.on)ct.once?Oe.once(ye,ze):Oe.on(ye,ze);else{if("function"!=typeof Oe.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof Oe);Oe.addEventListener(ye,function pt(Dt){ct.once&&Oe.removeEventListener(ye,pt),ze(Dt)})}}Object.defineProperty(d,"defaultMaxListeners",{enumerable:!0,get:function(){return re},set:function(Oe){if("number"!=typeof Oe||Oe<0||pe(Oe))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+Oe+".");re=Oe}}),d.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},d.prototype.setMaxListeners=function(ye){if("number"!=typeof ye||ye<0||pe(ye))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+ye+".");return this._maxListeners=ye,this},d.prototype.getMaxListeners=function(){return Te(this)},d.prototype.emit=function(ye){for(var ze=[],ct=1;ct<arguments.length;ct++)ze.push(arguments[ct]);var pt="error"===ye,Dt=this._events;if(void 0!==Dt)pt=pt&&void 0===Dt.error;else if(!pt)return!1;if(pt){var jt;if(ze.length>0&&(jt=ze[0]),jt instanceof Error)throw jt;var Wn=new Error("Unhandled error."+(jt?" ("+jt.message+")":""));throw Wn.context=jt,Wn}var Fn=Dt[ye];if(void 0===Fn)return!1;if("function"==typeof Fn)fe(Fn,this,ze);else{var kr=Fn.length,di=me(Fn,kr);for(ct=0;ct<kr;++ct)fe(di[ct],this,ze)}return!0},d.prototype.on=d.prototype.addListener=function(ye,ze){return ne(this,ye,ze,!1)},d.prototype.prependListener=function(ye,ze){return ne(this,ye,ze,!0)},d.prototype.once=function(ye,ze){return Ce(ze),this.on(ye,Fe(this,ye,ze)),this},d.prototype.prependOnceListener=function(ye,ze){return Ce(ze),this.prependListener(ye,Fe(this,ye,ze)),this},d.prototype.off=d.prototype.removeListener=function(ye,ze){var ct,pt,Dt,jt,Wn;if(Ce(ze),void 0===(pt=this._events))return this;if(void 0===(ct=pt[ye]))return this;if(ct===ze||ct.listener===ze)0==--this._eventsCount?this._events=Object.create(null):(delete pt[ye],pt.removeListener&&this.emit("removeListener",ye,ct.listener||ze));else if("function"!=typeof ct){for(Dt=-1,jt=ct.length-1;jt>=0;jt--)if(ct[jt]===ze||ct[jt].listener===ze){Wn=ct[jt].listener,Dt=jt;break}if(Dt<0)return this;0===Dt?ct.shift():function(Oe,ye){for(;ye+1<Oe.length;ye++)Oe[ye]=Oe[ye+1];Oe.pop()}(ct,Dt),1===ct.length&&(pt[ye]=ct[0]),void 0!==pt.removeListener&&this.emit("removeListener",ye,Wn||ze)}return this},d.prototype.removeAllListeners=function(ye){var ze,ct,pt;if(void 0===(ct=this._events))return this;if(void 0===ct.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==ct[ye]&&(0==--this._eventsCount?this._events=Object.create(null):delete ct[ye]),this;if(0===arguments.length){var jt,Dt=Object.keys(ct);for(pt=0;pt<Dt.length;++pt)"removeListener"!==(jt=Dt[pt])&&this.removeAllListeners(jt);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(ze=ct[ye]))this.removeListener(ye,ze);else if(void 0!==ze)for(pt=ze.length-1;pt>=0;pt--)this.removeListener(ye,ze[pt]);return this},d.prototype.listeners=function(ye){return Ct(this,ye,!0)},d.prototype.rawListeners=function(ye){return Ct(this,ye,!1)},d.listenerCount=function(Oe,ye){return"function"==typeof Oe.listenerCount?Oe.listenerCount(ye):it.call(Oe,ye)},d.prototype.listenerCount=it,d.prototype.eventNames=function(){return this._eventsCount>0?Be(this._events):[]}},499:ut=>{var fe;ut.exports=fe={},fe.simpleFilter=function(Be,Ae){return Ae.filter(function(pe){return fe.test(Be,pe)})},fe.test=function(Be,Ae){return null!==fe.match(Be,Ae)},fe.match=function(Be,Ae,pe){var it,d=0,re=[],Ce=Ae.length,Te=0,ne=0,ie=(pe=pe||{}).pre||"",Fe=pe.post||"",Ct=pe.caseSensitive&&Ae||Ae.toLowerCase();Be=pe.caseSensitive&&Be||Be.toLowerCase();for(var me=0;me<Ce;me++)it=Ae[me],Ct[me]===Be[d]?(it=ie+it+Fe,d+=1,ne+=1+ne):ne=0,Te+=ne,re[re.length]=it;return d===Be.length?(Te=Ct===Be?1/0:Te,{rendered:re.join(""),score:Te}):null},fe.filter=function(Be,Ae,pe){return Ae&&0!==Ae.length?"string"!=typeof Be?Ae:(pe=pe||{},Ae.reduce(function(d,re,Ce,Te){var ne=re;pe.extract&&(ne=pe.extract(re));var ie=fe.match(Be,ne,pe);return null!=ie&&(d[d.length]={string:ie.rendered,score:ie.score,index:Ce,original:re}),d},[]).sort(function(d,re){return re.score-d.score||d.index-re.index})):[]}},966:ut=>{try{ut.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(rt){ut.exports=!1}},536:ut=>{"use strict";var rt=Object.prototype.toString;ut.exports=function(fe){var Be;return"[object Object]"===rt.call(fe)&&(null===(Be=Object.getPrototypeOf(fe))||Be===Object.getPrototypeOf({}))}},906:ut=>{var Ae=/^\s+|\s+$/g,pe=/^[-+]0x[0-9a-f]+$/i,d=/^0b[01]+$/i,re=/^0o[0-7]+$/i,Ce=parseInt,Te="object"==typeof global&&global&&global.Object===Object&&global,ne="object"==typeof self&&self&&self.Object===Object&&self,ie=Te||ne||Function("return this")(),Ct=Object.prototype.toString,it=Math.max,me=Math.min,Pe=function(){return ie.Date.now()};function Le(ye){var ze=typeof ye;return!!ye&&("object"==ze||"function"==ze)}function Oe(ye){if("number"==typeof ye)return ye;if(function(ye){return"symbol"==typeof ye||function(ye){return!!ye&&"object"==typeof ye}(ye)&&"[object Symbol]"==Ct.call(ye)}(ye))return NaN;if(Le(ye)){var ze="function"==typeof ye.valueOf?ye.valueOf():ye;ye=Le(ze)?ze+"":ze}if("string"!=typeof ye)return 0===ye?ye:+ye;ye=ye.replace(Ae,"");var ct=d.test(ye);return ct||re.test(ye)?Ce(ye.slice(2),ct?2:8):pe.test(ye)?NaN:+ye}ut.exports=function(ye,ze,ct){var pt,Dt,jt,Wn,Fn,kr,di=0,Cr=!1,Wi=!1,Pr=!0;if("function"!=typeof ye)throw new TypeError("Expected a function");function Pt(Jn){var Di=pt,ro=Dt;return pt=Dt=void 0,di=Jn,Wn=ye.apply(ro,Di)}function is(Jn){return di=Jn,Fn=setTimeout(zo,ze),Cr?Pt(Jn):Wn}function Ti(Jn){var Di=Jn-kr;return void 0===kr||Di>=ze||Di<0||Wi&&Jn-di>=jt}function zo(){var Jn=Pe();if(Ti(Jn))return _o(Jn);Fn=setTimeout(zo,function(Jn){var Vo=ze-(Jn-kr);return Wi?me(Vo,jt-(Jn-di)):Vo}(Jn))}function _o(Jn){return Fn=void 0,Pr&&pt?Pt(Jn):(pt=Dt=void 0,Wn)}function cn(){var Jn=Pe(),Di=Ti(Jn);if(pt=arguments,Dt=this,kr=Jn,Di){if(void 0===Fn)return is(kr);if(Wi)return Fn=setTimeout(zo,ze),Pt(kr)}return void 0===Fn&&(Fn=setTimeout(zo,ze)),Wn}return ze=Oe(ze)||0,Le(ct)&&(Cr=!!ct.leading,jt=(Wi="maxWait"in ct)?it(Oe(ct.maxWait)||0,ze):jt,Pr="trailing"in ct?!!ct.trailing:Pr),cn.cancel=function(){void 0!==Fn&&clearTimeout(Fn),di=0,pt=kr=Dt=Fn=void 0},cn.flush=function(){return void 0===Fn?Wn:_o(Pe())},cn}},958:function(ut){ut.exports=function(){"use strict";var rt,fe,Be;function Ae(d,re){if(rt)if(fe){var Ce="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/api/#transpiling-v2'); }; var sharedChunk = {}; ("+rt+")(sharedChunk); ("+fe+")(sharedChunk); self.onerror = null;",Te={};rt(Te),Be=re(Te),"undefined"!=typeof window&&(Be.workerUrl=window.URL.createObjectURL(new Blob([Ce],{type:"text/javascript"})))}else fe=re;else rt=re}return Ae(0,function(d){var Ce=Te;function Te(a,i,l,c){this.cx=3*a,this.bx=3*(l-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(c-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=c,this.p2x=l,this.p2y=c}Te.prototype.sampleCurveX=function(a){return((this.ax*a+this.bx)*a+this.cx)*a},Te.prototype.sampleCurveY=function(a){return((this.ay*a+this.by)*a+this.cy)*a},Te.prototype.sampleCurveDerivativeX=function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},Te.prototype.solveCurveX=function(a,i){var l,c,f,_,y;for(void 0===i&&(i=1e-6),f=a,y=0;y<8;y++){if(_=this.sampleCurveX(f)-a,Math.abs(_)<i)return f;var w=this.sampleCurveDerivativeX(f);if(Math.abs(w)<1e-6)break;f-=_/w}if((f=a)<(l=0))return l;if(f>(c=1))return c;for(;l<c;){if(_=this.sampleCurveX(f),Math.abs(_-a)<i)return f;a>_?l=f:c=f,f=.5*(c-l)+l}return f},Te.prototype.solve=function(a,i){return this.sampleCurveY(this.solveCurveX(a,i))};var ne=ie;function ie(a,i){this.x=a,this.y=i}ie.prototype={clone:function(){return new ie(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,i){return this.clone()._rotateAround(a,i)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var i=a.x-this.x,l=a.y-this.y;return i*i+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,i){return Math.atan2(this.x*i-this.y*a,this.x*a+this.y*i)},_matMult:function(a){var i=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=i,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var i=Math.cos(a),l=Math.sin(a),c=l*this.x+i*this.y;return this.x=i*this.x-l*this.y,this.y=c,this},_rotateAround:function(a,i){var l=Math.cos(a),c=Math.sin(a),f=i.y+c*(this.x-i.x)+l*(this.y-i.y);return this.x=i.x+l*(this.x-i.x)-c*(this.y-i.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ie.convert=function(a){return a instanceof ie?a:Array.isArray(a)?new ie(a[0],a[1]):a};var Fe="undefined"!=typeof self?self:{};const Ct=Math.pow(2,53)-1,it=Math.PI/180,me=180/Math.PI;function Pe(a){return a*it}const je=[[0,0],[1,0],[1,1],[0,1]];function Le(a){if(a<=0)return 0;if(a>=1)return 1;const i=a*a,l=i*a;return 4*(a<.5?l:3*(a-i)+l-.75)}function et(a,i,l,c){const f=new Ce(a,i,l,c);return function(_){return f.solve(_)}}const wt=et(.25,.1,.25,1);function Oe(a,i,l){return Math.min(l,Math.max(i,a))}function ye(a,i,l){const c=l-i,f=((a-i)%c+c)%c+i;return f===i?l:f}function ze(a,i,l){if(!a.length)return l(null,[]);let c=a.length;const f=new Array(a.length);let _=null;a.forEach((y,w)=>{i(y,(C,D)=>{C&&(_=C),f[w]=D,0==--c&&l(_,f)})})}function ct(a){const i=[];for(const l in a)i.push(a[l]);return i}function pt(a,...i){for(const l of i)for(const c in l)a[c]=l[c];return a}let Dt=1;function jt(){return Dt++}function Wn(){return function a(i){return i?(i^16*Math.random()>>i/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function Fn(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function kr(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function di(a,i){a.forEach(l=>{i[l]&&(i[l]=i[l].bind(i))})}function Cr(a,i){return-1!==a.indexOf(i,a.length-i.length)}function Wi(a,i,l){const c={};for(const f in a)c[f]=i.call(l||this,a[f],f,a);return c}function Pr(a,i,l){const c={};for(const f in a)i.call(l||this,a[f],f,a)&&(c[f]=a[f]);return c}function Pt(a){return Array.isArray(a)?a.map(Pt):"object"==typeof a&&a?Wi(a,Pt):a}const is={};function Qn(a){is[a]||("undefined"!=typeof console&&console.warn(a),is[a]=!0)}function Ti(a,i,l){return(l.y-a.y)*(i.x-a.x)>(i.y-a.y)*(l.x-a.x)}function zo(a){let i=0;for(let l,c,f=0,_=a.length,y=_-1;f<_;y=f++)l=a[f],c=a[y],i+=(c.x-l.x)*(l.y+c.y);return i}function _o(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function Xi(a){const i={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,c,f,_)=>{const y=f||_;return i[c]=!y||y.toLowerCase(),""}),i["max-age"]){const l=parseInt(i["max-age"],10);isNaN(l)?delete i["max-age"]:i["max-age"]=l}return i}let os,cn,Jn,Di=null;function ro(a){if(null==Di){const i=a.navigator?a.navigator.userAgent:null;Di=!!a.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return Di}function Vo(a){try{const i=Fe[a];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch(i){return!1}}const Ki={now:()=>void 0!==Jn?Jn:Fe.performance.now(),setNow(a){Jn=a},restoreNow(){Jn=void 0},frame(a){const i=Fe.requestAnimationFrame(a);return{cancel:()=>Fe.cancelAnimationFrame(i)}},getImageData(a,i=0){const l=Fe.document.createElement("canvas"),c=l.getContext("2d");if(!c)throw new Error("failed to create canvas 2d context");return l.width=a.width,l.height=a.height,c.drawImage(a,0,0,a.width,a.height),c.getImageData(-i,-i,a.width+2*i,a.height+2*i)},resolveURL:a=>(os||(os=Fe.document.createElement("a")),os.href=a,os.href),get devicePixelRatio(){return Fe.devicePixelRatio},get prefersReducedMotion(){return!!Fe.matchMedia&&(null==cn&&(cn=Fe.matchMedia("(prefers-reduced-motion: reduce)")),cn.matches)}};let ss;const vn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==ss){const a=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{ss=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):a}catch(i){ss=a}}return ss},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Bo={supported:!1,testSupport:function(a){!ia&&as&&(Ar?Uo(a):Ts=a)}};let Ts,as,ia=!1,Ar=!1;function Uo(a){const i=a.createTexture();a.bindTexture(a.TEXTURE_2D,i);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,as),a.isContextLost())return;Bo.supported=!0}catch(l){}a.deleteTexture(i),ia=!0}Fe.document&&(as=Fe.document.createElement("img"),as.onload=function(){Ts&&Uo(Ts),Ts=null,Ar=!0},as.onerror=function(){ia=!0,Ts=null},as.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Rl="01",ls="NO_ACCESS_TOKEN";function jo(a){return 0===a.indexOf("mapbox:")}function $o(a){return vn.API_URL_REGEX.test(a)}const Tr=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function io(a){const i=a.match(Tr);if(!i)throw new Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function Ds(a){const i=a.params.length?`?${a.params.join("&")}`:"";return`${a.protocol}://${a.authority}${a.path}${i}`}function yo(a){if(!a)return null;const i=a.split(".");if(!i||3!==i.length)return null;try{return JSON.parse(decodeURIComponent(Fe.atob(i[1]).split("").map(l=>"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(l){return null}}class cs{constructor(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){const l=yo(vn.ACCESS_TOKEN);let c="";return c=l&&l.u?Fe.btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,(f,_)=>String.fromCharCode(Number("0x"+_)))):vn.ACCESS_TOKEN||"",i?`mapbox.eventData.${i}:${c}`:`mapbox.eventData:${c}`}fetchEventData(){const i=Vo("localStorage"),l=this.getStorageKey(),c=this.getStorageKey("uuid");if(i)try{const f=Fe.localStorage.getItem(l);f&&(this.eventData=JSON.parse(f));const _=Fe.localStorage.getItem(c);_&&(this.anonId=_)}catch(f){Qn("Unable to read from LocalStorage")}}saveEventData(){const i=Vo("localStorage"),l=this.getStorageKey(),c=this.getStorageKey("uuid");if(i)try{Fe.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&Fe.localStorage.setItem(l,JSON.stringify(this.eventData))}catch(f){Qn("Unable to write to LocalStorage")}}processRequests(i){}postEvent(i,l,c,f){if(!vn.EVENTS_URL)return;const _=io(vn.EVENTS_URL);_.params.push(`access_token=${f||vn.ACCESS_TOKEN||""}`);const y={event:this.type,created:new Date(i).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.5.1",skuId:Rl,userId:this.anonId},w=l?pt(y,l):y,C={url:Ds(_),headers:{"Content-Type":"text/plain"},body:JSON.stringify([w])};this.pendingRequest=z(C,D=>{this.pendingRequest=null,c(D),this.saveEventData(),this.processRequests(f)})}queueRequest(i,l){this.queue.push(i),this.processRequests(l)}}const oa=new class extends cs{constructor(a){super("appUserTurnstile"),this._customAccessToken=a}postTurnstileEvent(a,i){vn.EVENTS_URL&&vn.ACCESS_TOKEN&&Array.isArray(a)&&a.some(l=>jo(l)||$o(l))&&this.queueRequest(Date.now(),i)}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=yo(vn.ACCESS_TOKEN),l=i?i.u:vn.ACCESS_TOKEN;let c=l!==this.eventData.tokenU;kr(this.anonId)||(this.anonId=Wn(),c=!0);const f=this.queue.shift();if(this.eventData.lastSuccess){const _=new Date(this.eventData.lastSuccess),y=new Date(f),w=(f-this.eventData.lastSuccess)/864e5;c=c||w>=1||w<-1||_.getDate()!==y.getDate()}else c=!0;if(!c)return this.processRequests();this.postEvent(f,{"enabled.telemetry":!1},_=>{_||(this.eventData.lastSuccess=f,this.eventData.tokenU=l)},a)}},Mc=oa.postTurnstileEvent.bind(oa),Ss=new class extends cs{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(a,i,l,c){this.skuToken=i,this.errorCb=c,vn.EVENTS_URL&&(l||vn.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(ls)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:l}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),kr(this.anonId)||(this.anonId=Wn()),this.postEvent(l,{skuToken:this.skuToken},c=>{c?this.errorCb(c):i&&(this.success[i]=!0)},a))}},kl=Ss.postMapLoadEvent.bind(Ss),Rc=new class extends cs{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(a,i,l,c){if(!vn.API_URL||!vn.SESSION_PATH)return;const f=io(vn.API_URL+vn.SESSION_PATH);f.params.push(`sku=${i||""}`),f.params.push(`access_token=${c||vn.ACCESS_TOKEN||""}`);const _={url:Ds(f),headers:{"Content-Type":"text/plain"}};this.pendingRequest=W(_,y=>{this.pendingRequest=null,l(y),this.saveEventData(),this.processRequests(c)})}getSessionAPI(a,i,l,c){this.skuToken=i,this.errorCb=c,vn.SESSION_PATH&&vn.API_URL&&(l||vn.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(ls)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:l}=this.queue.shift();i&&this.success[i]||this.getSession(l,this.skuToken,c=>{c?this.errorCb(c):i&&(this.success[i]=!0)},a)}},kc=Rc.getSessionAPI.bind(Rc),sa=new Set,Ha="mapbox-tiles";let vo,As,Pc=500,Pl=50;function Is(){Fe.caches&&!vo&&(vo=Fe.caches.open(Ha))}function Ms(a){const i=a.indexOf("?");return i<0?a:a.slice(0,i)}let mn=1/0;const us={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(us);class Wt extends Error{constructor(i,l,c){401===l&&$o(c)&&(i+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(i),this.status=l,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const oo=_o()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Fe.location.protocol?Fe.parent:Fe).location.href,X=function(a,i){if(!(/^file:/.test(l=a.url)||/^file:/.test(oo())&&!/^\w+:/.test(l))){if(Fe.fetch&&Fe.Request&&Fe.AbortController&&Fe.Request.prototype.hasOwnProperty("signal"))return function(c,f){const _=new Fe.AbortController,y=new Fe.Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:oo(),signal:_.signal});let w=!1,C=!1;const D=(I=y.url).indexOf("sku=")>0&&$o(I);var I;"json"===c.type&&y.headers.set("Accept","application/json");const R=(N,H,q)=>{if(C)return;if(N&&"SecurityError"!==N.message&&Qn(N),H&&q)return k(H);const te=Date.now();Fe.fetch(y).then(de=>{if(de.ok){const _e=D?de.clone():null;return k(de,_e,te)}return f(new Wt(de.statusText,de.status,c.url))}).catch(de=>{20!==de.code&&f(new Error(de.message))})},k=(N,H,q)=>{("arrayBuffer"===c.type?N.arrayBuffer():"json"===c.type?N.json():N.text()).then(te=>{C||(H&&q&&function(de,_e,Se){if(Is(),!vo)return;const Ie={status:_e.status,statusText:_e.statusText,headers:new Fe.Headers};_e.headers.forEach((ke,He)=>Ie.headers.set(He,ke));const Me=Xi(_e.headers.get("Cache-Control")||"");Me["no-store"]||(Me["max-age"]&&Ie.headers.set("Expires",new Date(Se+1e3*Me["max-age"]).toUTCString()),new Date(Ie.headers.get("Expires")).getTime()-Se<42e4||function(ke,He){if(void 0===As)try{new Response(new ReadableStream),As=!0}catch(Je){As=!1}As?He(ke.body):ke.blob().then(He)}(_e,ke=>{const He=new Fe.Response(ke,Ie);Is(),vo&&vo.then(Je=>Je.put(Ms(de.url),He)).catch(Je=>Qn(Je.message))}))}(y,H,q),w=!0,f(null,te,N.headers.get("Cache-Control"),N.headers.get("Expires")))}).catch(te=>{C||f(new Error(te.message))})};return D?function(N,H){if(Is(),!vo)return H(null);const q=Ms(N.url);vo.then(te=>{te.match(q).then(de=>{const _e=function(Se){if(!Se)return!1;const Ie=new Date(Se.headers.get("Expires")||0),Me=Xi(Se.headers.get("Cache-Control")||"");return Ie>Date.now()&&!Me["no-cache"]}(de);te.delete(q),_e&&te.put(q,de.clone()),H(null,de,_e)}).catch(H)}).catch(H)}(y,R):R(null,null),{cancel:()=>{C=!0,w||_.abort()}}}(a,i);if(_o()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,i,void 0,!0)}var l;return function(c,f){const _=new Fe.XMLHttpRequest;_.open(c.method||"GET",c.url,!0),"arrayBuffer"===c.type&&(_.responseType="arraybuffer");for(const y in c.headers)_.setRequestHeader(y,c.headers[y]);return"json"===c.type&&(_.responseType="text",_.setRequestHeader("Accept","application/json")),_.withCredentials="include"===c.credentials,_.onerror=()=>{f(new Error(_.statusText))},_.onload=()=>{if((_.status>=200&&_.status<300||0===_.status)&&null!==_.response){let y=_.response;if("json"===c.type)try{y=JSON.parse(_.response)}catch(w){return f(w)}f(null,y,_.getResponseHeader("Cache-Control"),_.getResponseHeader("Expires"))}else f(new Wt(_.statusText,_.status,c.url))},_.send(c.body),{cancel:()=>_.abort()}}(a,i)},O=function(a,i){return X(pt(a,{type:"arrayBuffer"}),i)},z=function(a,i){return X(pt(a,{method:"POST"}),i)},W=function(a,i){return X(pt(a,{method:"GET"}),i)};function ee(a){const i=Fe.document.createElement("a");return i.href=a,i.protocol===Fe.document.location.protocol&&i.host===Fe.document.location.host}const ce="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let De,Ee;De=[],Ee=0;const oe=function(a,i){if(Bo.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),Ee>=vn.MAX_PARALLEL_IMAGE_REQUESTS){const _={requestParameters:a,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return De.push(_),_}Ee++;let l=!1;const c=()=>{if(!l)for(l=!0,Ee--;De.length&&Ee<vn.MAX_PARALLEL_IMAGE_REQUESTS;){const _=De.shift(),{requestParameters:y,callback:w,cancelled:C}=_;C||(_.cancel=oe(y,w).cancel)}},f=O(a,(_,y,w,C)=>{c(),_?i(_):y&&(Fe.createImageBitmap?function(D,I){const R=new Fe.Blob([new Uint8Array(D)],{type:"image/png"});Fe.createImageBitmap(R).then(k=>{I(null,k)}).catch(k=>{I(new Error(`Could not load image because of ${k.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(D,I)=>i(D,I,w,C)):function(D,I){const R=new Fe.Image,k=Fe.URL;R.onload=()=>{I(null,R),k.revokeObjectURL(R.src),R.onload=null,Fe.requestAnimationFrame(()=>{R.src=ce})},R.onerror=()=>I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const N=new Fe.Blob([new Uint8Array(D)],{type:"image/png"});R.src=D.byteLength?k.createObjectURL(N):ce}(y,(D,I)=>i(D,I,w,C)))});return{cancel:()=>{f.cancel(),c()}}};function xe(a,i,l){l[a]&&-1!==l[a].indexOf(i)||(l[a]=l[a]||[],l[a].push(i))}function Ge(a,i,l){if(l&&l[a]){const c=l[a].indexOf(i);-1!==c&&l[a].splice(c,1)}}class ht{constructor(i,l={}){pt(this,l),this.type=i}}class Ke extends ht{constructor(i,l={}){super("error",pt({error:i},l))}}class It{on(i,l){return this._listeners=this._listeners||{},xe(i,l,this._listeners),this}off(i,l){return Ge(i,l,this._listeners),Ge(i,l,this._oneTimeListeners),this}once(i,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},xe(i,l,this._oneTimeListeners),this):new Promise(c=>this.once(i,c))}fire(i,l){"string"==typeof i&&(i=new ht(i,l||{}));const c=i.type;if(this.listens(c)){i.target=this;const f=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const w of f)w.call(this,i);const _=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const w of _)Ge(c,w,this._oneTimeListeners),w.call(this,i);const y=this._eventedParent;y&&(pt(i,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),y.fire(i))}else i instanceof Ke&&console.error(i.error);return this}listens(i){return!!(this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i))}setEventedParent(i,l){return this._eventedParent=i,this._eventedParentData=l,this}}var ue={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},fog:{type:"fog"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{},sky:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},fog:{range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.1,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{},atmosphere:{}},default:"atmosphere",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],transition:!1,requires:[{"sky-type":"gradient"}],expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Ve{constructor(i,l,c,f){this.message=(i?`${i}: `:"")+c,f&&(this.identifier=f),null!=l&&l.__line__&&(this.line=l.__line__)}}function Bt(a){const i=a.value;return i?[new Ve(a.key,i,"constants have been deprecated as of v8")]:[]}function tn(a,...i){for(const l of i)for(const c in l)a[c]=l[c];return a}function Ft(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Tn(a){if(Array.isArray(a))return a.map(Tn);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const i={};for(const l in a)i[l]=Tn(a[l]);return i}return Ft(a)}class gn extends Error{constructor(i,l){super(l),this.message=l,this.key=i}}class Xn{constructor(i,l=[]){this.parent=i,this.bindings={};for(const[c,f]of l)this.bindings[c]=f}concat(i){return new Xn(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const Rs={kind:"null"},ft={kind:"number"},rn={kind:"string"},Qt={kind:"boolean"},Ho={kind:"color"},$n={kind:"object"},At={kind:"value"},Bu={kind:"collator"},Fc={kind:"formatted"},Fl={kind:"resolvedImage"};function kt(a,i){return{kind:"array",itemType:a,N:i}}function ur(a){if("array"===a.kind){const i=ur(a.itemType);return"number"==typeof a.N?`array<${i}, ${a.N}>`:"value"===a.itemType.kind?"array":`array<${i}>`}return a.kind}const Qr=[Rs,ft,rn,Qt,Ho,Fc,$n,kt(At),Fl];function Oi(a,i){if("error"===i.kind)return null;if("array"===a.kind){if("array"===i.kind&&(0===i.N&&"value"===i.itemType.kind||!Oi(a.itemType,i.itemType))&&("number"!=typeof a.N||a.N===i.N))return null}else{if(a.kind===i.kind)return null;if("value"===a.kind)for(const l of Qr)if(!Oi(l,i))return null}return`Expected ${ur(a)} but found ${ur(i)} instead.`}function aa(a,i){return i.some(l=>l.kind===a.kind)}function Ol(a,i){return i.some(l=>"null"===l?null===a:"array"===l?Array.isArray(a):"object"===l?a&&!Array.isArray(a)&&"object"==typeof a:l===typeof a)}function hs(a){var i={exports:{}};return a(i,i.exports),i.exports}var Oc=hs(function(a,i){var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function c(w){return(w=Math.round(w))<0?0:w>255?255:w}function f(w){return c("%"===w[w.length-1]?parseFloat(w)/100*255:parseInt(w))}function _(w){return(C="%"===w[w.length-1]?parseFloat(w)/100:parseFloat(w))<0?0:C>1?1:C;var C}function y(w,C,D){return D<0?D+=1:D>1&&(D-=1),6*D<1?w+(C-w)*D*6:2*D<1?C:3*D<2?w+(C-w)*(2/3-D)*6:w}try{i.parseCSSColor=function(w){var C,D=w.replace(/ /g,"").toLowerCase();if(D in l)return l[D].slice();if("#"===D[0])return 4===D.length?(C=parseInt(D.substr(1),16))>=0&&C<=4095?[(3840&C)>>4|(3840&C)>>8,240&C|(240&C)>>4,15&C|(15&C)<<4,1]:null:7===D.length&&(C=parseInt(D.substr(1),16))>=0&&C<=16777215?[(16711680&C)>>16,(65280&C)>>8,255&C,1]:null;var I=D.indexOf("("),R=D.indexOf(")");if(-1!==I&&R+1===D.length){var k=D.substr(0,I),N=D.substr(I+1,R-(I+1)).split(","),H=1;switch(k){case"rgba":if(4!==N.length)return null;H=_(N.pop());case"rgb":return 3!==N.length?null:[f(N[0]),f(N[1]),f(N[2]),H];case"hsla":if(4!==N.length)return null;H=_(N.pop());case"hsl":if(3!==N.length)return null;var q=(parseFloat(N[0])%360+360)%360/360,te=_(N[1]),de=_(N[2]),_e=de<=.5?de*(te+1):de+te-de*te,Se=2*de-_e;return[c(255*y(Se,_e,q+1/3)),c(255*y(Se,_e,q)),c(255*y(Se,_e,q-1/3)),H];default:return null}}return null}}catch(w){}});class Gt{constructor(i,l,c,f=1){this.r=i,this.g=l,this.b=c,this.a=f}static parse(i){if(!i)return;if(i instanceof Gt)return i;if("string"!=typeof i)return;const l=Oc.parseCSSColor(i);return l?new Gt(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){const[i,l,c,f]=this.toArray();return`rgba(${Math.round(i)},${Math.round(l)},${Math.round(c)},${f})`}toArray(){const{r:i,g:l,b:c,a:f}=this;return 0===f?[0,0,0,0]:[255*i/f,255*l/f,255*c/f,f]}}Gt.black=new Gt(0,0,0,1),Gt.white=new Gt(1,1,1,1),Gt.transparent=new Gt(0,0,0,0),Gt.red=new Gt(1,0,0,1),Gt.blue=new Gt(0,0,1,1);class Ll{constructor(i,l,c){this.sensitivity=i?l?"variant":"case":l?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,l){return this.collator.compare(i,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Nl{constructor(i,l,c,f,_){this.text=i,this.image=l,this.scale=c,this.fontStack=f,this.textColor=_}}class Hr{constructor(i){this.sections=i}static fromString(i){return new Hr([new Nl(i,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(i=>0!==i.text.length||i.image&&0!==i.image.name.length)}static factory(i){return i instanceof Hr?i:Hr.fromString(i)}toString(){return 0===this.sections.length?"":this.sections.map(i=>i.text).join("")}serialize(){const i=["format"];for(const l of this.sections){if(l.image){i.push(["image",l.image.name]);continue}i.push(l.text);const c={};l.fontStack&&(c["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(c["font-scale"]=l.scale),l.textColor&&(c["text-color"]=["rgba"].concat(l.textColor.toArray())),i.push(c)}return i}}class Mt{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new Mt({name:i,available:!1}):null}serialize(){return["image",this.name]}}function Lc(a,i,l,c){return"number"==typeof a&&a>=0&&a<=255&&"number"==typeof i&&i>=0&&i<=255&&"number"==typeof l&&l>=0&&l<=255?void 0===c||"number"==typeof c&&c>=0&&c<=1?null:`Invalid rgba value [${[a,i,l,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof c?[a,i,l,c]:[a,i,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Nc(a){if(null===a||"string"==typeof a||"boolean"==typeof a||"number"==typeof a||a instanceof Gt||a instanceof Ll||a instanceof Hr||a instanceof Mt)return!0;if(Array.isArray(a)){for(const i of a)if(!Nc(i))return!1;return!0}if("object"==typeof a){for(const i in a)if(!Nc(a[i]))return!1;return!0}return!1}function Kn(a){if(null===a)return Rs;if("string"==typeof a)return rn;if("boolean"==typeof a)return Qt;if("number"==typeof a)return ft;if(a instanceof Gt)return Ho;if(a instanceof Ll)return Bu;if(a instanceof Hr)return Fc;if(a instanceof Mt)return Fl;if(Array.isArray(a)){const i=a.length;let l;for(const c of a){const f=Kn(c);if(l){if(l===f)continue;l=At;break}l=f}return kt(l||At,i)}return $n}function la(a){const i=typeof a;return null===a?"":"string"===i||"number"===i||"boolean"===i?String(a):a instanceof Gt||a instanceof Hr||a instanceof Mt?a.toString():JSON.stringify(a)}class ks{constructor(i,l){this.type=i,this.value=l}static parse(i,l){if(2!==i.length)return l.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!Nc(i[1]))return l.error("invalid value");const c=i[1];let f=Kn(c);const _=l.expectedType;return"array"!==f.kind||0!==f.N||!_||"array"!==_.kind||"number"==typeof _.N&&0!==_.N||(f=_),new ks(f,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Gt?["rgba"].concat(this.value.toArray()):this.value instanceof Hr?this.value.serialize():this.value}}class hr{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const Jr={string:rn,number:ft,boolean:Qt,object:$n};class Go{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");let c,f=1;const _=i[0];if("array"===_){let w,C;if(i.length>2){const D=i[1];if("string"!=typeof D||!(D in Jr)||"object"===D)return l.error('The item type argument of "array" must be one of string, number, boolean',1);w=Jr[D],f++}else w=At;if(i.length>3){if(null!==i[2]&&("number"!=typeof i[2]||i[2]<0||i[2]!==Math.floor(i[2])))return l.error('The length argument to "array" must be a positive integer literal',2);C=i[2],f++}c=kt(w,C)}else c=Jr[_];const y=[];for(;f<i.length;f++){const w=l.parse(i[f],f,At);if(!w)return null;y.push(w)}return new Go(c,y)}evaluate(i){for(let l=0;l<this.args.length;l++){const c=this.args[l].evaluate(i);if(!Oi(this.type,Kn(c)))return c;if(l===this.args.length-1)throw new hr(`Expected value to be of type ${ur(this.type)}, but found ${ur(Kn(c))} instead.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=this.type,l=[i.kind];if("array"===i.kind){const c=i.itemType;if("string"===c.kind||"number"===c.kind||"boolean"===c.kind){l.push(c.kind);const f=i.N;("number"==typeof f||this.args.length>1)&&l.push(f)}}return l.concat(this.args.map(c=>c.serialize()))}}class zc{constructor(i){this.type=Fc,this.sections=i}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const c=i[1];if(!Array.isArray(c)&&"object"==typeof c)return l.error("First argument must be an image or text section.");const f=[];let _=!1;for(let y=1;y<=i.length-1;++y){const w=i[y];if(_&&"object"==typeof w&&!Array.isArray(w)){_=!1;let C=null;if(w["font-scale"]&&(C=l.parse(w["font-scale"],1,ft),!C))return null;let D=null;if(w["text-font"]&&(D=l.parse(w["text-font"],1,kt(rn)),!D))return null;let I=null;if(w["text-color"]&&(I=l.parse(w["text-color"],1,Ho),!I))return null;const R=f[f.length-1];R.scale=C,R.font=D,R.textColor=I}else{const C=l.parse(i[y],1,At);if(!C)return null;const D=C.type.kind;if("string"!==D&&"value"!==D&&"null"!==D&&"resolvedImage"!==D)return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,f.push({content:C,scale:null,font:null,textColor:null})}}return new zc(f)}evaluate(i){return new Hr(this.sections.map(l=>{const c=l.content.evaluate(i);return Kn(c)===Fl?new Nl("",c,null,null,null):new Nl(la(c),null,l.scale?l.scale.evaluate(i):null,l.font?l.font.evaluate(i).join(","):null,l.textColor?l.textColor.evaluate(i):null)}))}eachChild(i){for(const l of this.sections)i(l.content),l.scale&&i(l.scale),l.font&&i(l.font),l.textColor&&i(l.textColor)}outputDefined(){return!1}serialize(){const i=["format"];for(const l of this.sections){i.push(l.content.serialize());const c={};l.scale&&(c["font-scale"]=l.scale.serialize()),l.font&&(c["text-font"]=l.font.serialize()),l.textColor&&(c["text-color"]=l.textColor.serialize()),i.push(c)}return i}}class yr{constructor(i){this.type=Fl,this.input=i}static parse(i,l){if(2!==i.length)return l.error("Expected two arguments.");const c=l.parse(i[1],1,rn);return c?new yr(c):l.error("No image name provided.")}evaluate(i){const l=this.input.evaluate(i),c=Mt.fromString(l);return c&&i.availableImages&&(c.available=i.availableImages.indexOf(l)>-1),c}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Bf={"to-boolean":Qt,"to-color":Ho,"to-number":ft,"to-string":rn};class Ps{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const c=i[0];if(("to-boolean"===c||"to-string"===c)&&2!==i.length)return l.error("Expected one argument.");const f=Bf[c],_=[];for(let y=1;y<i.length;y++){const w=l.parse(i[y],y,At);if(!w)return null;_.push(w)}return new Ps(f,_)}evaluate(i){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(i));if("color"===this.type.kind){let l,c;for(const f of this.args){if(l=f.evaluate(i),c=null,l instanceof Gt)return l;if("string"==typeof l){const _=i.parseColor(l);if(_)return _}else if(Array.isArray(l)&&(c=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:Lc(l[0],l[1],l[2],l[3]),!c))return new Gt(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new hr(c||`Could not parse color from value '${"string"==typeof l?l:String(JSON.stringify(l))}'`)}if("number"===this.type.kind){let l=null;for(const c of this.args){if(l=c.evaluate(i),null===l)return 0;const f=Number(l);if(!isNaN(f))return f}throw new hr(`Could not convert ${JSON.stringify(l)} to number.`)}return"formatted"===this.type.kind?Hr.fromString(la(this.args[0].evaluate(i))):"resolvedImage"===this.type.kind?Mt.fromString(la(this.args[0].evaluate(i))):la(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){if("formatted"===this.type.kind)return new zc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new yr(this.args[0]).serialize();const i=[`to-${this.type.kind}`];return this.eachChild(l=>{i.push(l.serialize())}),i}}const Uf=["Unknown","Point","LineString","Polygon"];class jf{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Uf[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(i){let l=this._parseColorCache[i];return l||(l=this._parseColorCache[i]=Gt.parse(i)),l}}class on{constructor(i,l,c,f){this.name=i,this.type=l,this._evaluate=c,this.args=f}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(i=>i.serialize()))}static parse(i,l){const c=i[0],f=on.definitions[c];if(!f)return l.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(f)?f[0]:f.type,y=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,w=y.filter(([D])=>!Array.isArray(D)||D.length===i.length-1);let C=null;for(const[D,I]of w){C=new Gr(l.registry,l.path,null,l.scope);const R=[];let k=!1;for(let N=1;N<i.length;N++){const H=i[N],q=Array.isArray(D)?D[N-1]:D.type,te=C.parse(H,1+R.length,q);if(!te){k=!0;break}R.push(te)}if(!k)if(Array.isArray(D)&&D.length!==R.length)C.error(`Expected ${D.length} arguments, but found ${R.length} instead.`);else{for(let N=0;N<R.length;N++){const H=Array.isArray(D)?D[N]:D.type,q=R[N];C.concat(N+1).checkSubtype(H,q.type)}if(0===C.errors.length)return new on(c,_,I,R)}}if(1===w.length)l.errors.push(...C.errors);else{const D=(w.length?w:y).map(([R])=>{return k=R,Array.isArray(k)?`(${k.map(ur).join(", ")})`:`(${ur(k.type)}...)`;var k}).join(" | "),I=[];for(let R=1;R<i.length;R++){const k=l.parse(i[R],1+I.length);if(!k)return null;I.push(ur(k.type))}l.error(`Expected arguments of type ${D}, but found (${I.join(", ")}) instead.`)}return null}static register(i,l){on.definitions=l;for(const c in l)i[c]=on}}class Ga{constructor(i,l,c){this.type=Bu,this.locale=c,this.caseSensitive=i,this.diacriticSensitive=l}static parse(i,l){if(2!==i.length)return l.error("Expected one argument.");const c=i[1];if("object"!=typeof c||Array.isArray(c))return l.error("Collator options argument must be an object.");const f=l.parse(void 0!==c["case-sensitive"]&&c["case-sensitive"],1,Qt);if(!f)return null;const _=l.parse(void 0!==c["diacritic-sensitive"]&&c["diacritic-sensitive"],1,Qt);if(!_)return null;let y=null;return c.locale&&(y=l.parse(c.locale,1,rn),!y)?null:new Ga(f,_,y)}evaluate(i){return new Ll(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){const i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}const ca=8192;function Fs(a,i){a[0]=Math.min(a[0],i[0]),a[1]=Math.min(a[1],i[1]),a[2]=Math.max(a[2],i[0]),a[3]=Math.max(a[3],i[1])}function On(a,i){return!(a[0]<=i[0]||a[2]>=i[2]||a[1]<=i[1]||a[3]>=i[3])}function Vc(a,i){const l=(180+a[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,f=Math.pow(2,i.z);return[Math.round(l*f*ca),Math.round(c*f*ca)]}function Uu(a,i,l){const c=a[0]-i[0],f=a[1]-i[1],_=a[0]-l[0],y=a[1]-l[1];return c*y-_*f==0&&c*_<=0&&f*y<=0}function zl(a,i){let l=!1;for(let y=0,w=i.length;y<w;y++){const C=i[y];for(let D=0,I=C.length;D<I-1;D++){if(Uu(a,C[D],C[D+1]))return!1;(f=C[D])[1]>(c=a)[1]!=(_=C[D+1])[1]>c[1]&&c[0]<(_[0]-f[0])*(c[1]-f[1])/(_[1]-f[1])+f[0]&&(l=!l)}}var c,f,_;return l}function ju(a,i){for(let l=0;l<i.length;l++)if(zl(a,i[l]))return!0;return!1}function Vl(a,i,l,c){const f=c[0]-l[0],_=c[1]-l[1],y=(a[0]-l[0])*_-f*(a[1]-l[1]),w=(i[0]-l[0])*_-f*(i[1]-l[1]);return y>0&&w<0||y<0&&w>0}function ds(a,i,l){for(const D of l)for(let I=0;I<D.length-1;++I)if((w=[(y=D[I+1])[0]-(_=D[I])[0],y[1]-_[1]])[0]*(C=[(f=i)[0]-(c=a)[0],f[1]-c[1]])[1]-w[1]*C[0]!=0&&Vl(c,f,_,y)&&Vl(_,y,c,f))return!0;var c,f,_,y,w,C;return!1}function qa(a,i){for(let l=0;l<a.length;++l)if(!zl(a[l],i))return!1;for(let l=0;l<a.length-1;++l)if(ds(a[l],a[l+1],i))return!1;return!0}function $f(a,i){for(let l=0;l<i.length;l++)if(qa(a,i[l]))return!0;return!1}function fs(a,i,l){const c=[];for(let f=0;f<a.length;f++){const _=[];for(let y=0;y<a[f].length;y++){const w=Vc(a[f][y],l);Fs(i,w),_.push(w)}c.push(_)}return c}function xo(a,i,l){const c=[];for(let f=0;f<a.length;f++){const _=fs(a[f],i,l);c.push(_)}return c}function Bc(a,i,l,c){if(a[0]<l[0]||a[0]>l[2]){const f=.5*c;let _=a[0]-l[0]>f?-c:l[0]-a[0]>f?c:0;0===_&&(_=a[0]-l[2]>f?-c:l[2]-a[0]>f?c:0),a[0]+=_}Fs(i,a)}function Uc(a,i,l,c){const f=Math.pow(2,c.z)*ca,_=[c.x*ca,c.y*ca],y=[];for(const w of a)for(const C of w){const D=[C.x+_[0],C.y+_[1]];Bc(D,i,l,f),y.push(D)}return y}function Za(a,i,l,c){const f=Math.pow(2,c.z)*ca,_=[c.x*ca,c.y*ca],y=[];for(const C of a){const D=[];for(const I of C){const R=[I.x+_[0],I.y+_[1]];Fs(i,R),D.push(R)}y.push(D)}if(i[2]-i[0]<=f/2){(w=i)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const C of y)for(const D of C)Bc(D,i,l,f)}var w;return y}class dr{constructor(i,l){this.type=Qt,this.geojson=i,this.geometries=l}static parse(i,l){if(2!==i.length)return l.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Nc(i[1])){const c=i[1];if("FeatureCollection"===c.type)for(let f=0;f<c.features.length;++f){const _=c.features[f].geometry.type;if("Polygon"===_||"MultiPolygon"===_)return new dr(c,c.features[f].geometry)}else if("Feature"===c.type){const f=c.geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new dr(c,c.geometry)}else if("Polygon"===c.type||"MultiPolygon"===c.type)return new dr(c,c)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(null!=i.geometry()&&null!=i.canonicalID()){if("Point"===i.geometryType())return function(l,c){const f=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],y=l.canonicalID();if("Polygon"===c.type){const w=fs(c.coordinates,_,y),C=Uc(l.geometry(),f,_,y);if(!On(f,_))return!1;for(const D of C)if(!zl(D,w))return!1}if("MultiPolygon"===c.type){const w=xo(c.coordinates,_,y),C=Uc(l.geometry(),f,_,y);if(!On(f,_))return!1;for(const D of C)if(!ju(D,w))return!1}return!0}(i,this.geometries);if("LineString"===i.geometryType())return function(l,c){const f=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],y=l.canonicalID();if("Polygon"===c.type){const w=fs(c.coordinates,_,y),C=Za(l.geometry(),f,_,y);if(!On(f,_))return!1;for(const D of C)if(!qa(D,w))return!1}if("MultiPolygon"===c.type){const w=xo(c.coordinates,_,y),C=Za(l.geometry(),f,_,y);if(!On(f,_))return!1;for(const D of C)if(!$f(D,w))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Bl(a){if(a instanceof on&&("get"===a.name&&1===a.args.length||"feature-state"===a.name||"has"===a.name&&1===a.args.length||"properties"===a.name||"geometry-type"===a.name||"id"===a.name||/^filter-/.test(a.name))||a instanceof dr)return!1;let i=!0;return a.eachChild(l=>{i&&!Bl(l)&&(i=!1)}),i}function ua(a){if(a instanceof on&&"feature-state"===a.name)return!1;let i=!0;return a.eachChild(l=>{i&&!ua(l)&&(i=!1)}),i}function Ut(a,i){if(a instanceof on&&i.indexOf(a.name)>=0)return!1;let l=!0;return a.eachChild(c=>{l&&!Ut(c,i)&&(l=!1)}),l}class $t{constructor(i,l){this.type=l.type,this.name=i,this.boundExpression=l}static parse(i,l){if(2!==i.length||"string"!=typeof i[1])return l.error("'var' expression requires exactly one string literal argument.");const c=i[1];return l.scope.has(c)?new $t(c,l.scope.get(c)):l.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Gr{constructor(i,l=[],c,f=new Xn,_=[]){this.registry=i,this.path=l,this.key=l.map(y=>`[${y}]`).join(""),this.scope=f,this.errors=_,this.expectedType=c}parse(i,l,c,f,_={}){return l?this.concat(l,c,f)._parse(i,_):this._parse(i,_)}_parse(i,l){function c(f,_,y){return"assert"===y?new Go(_,[f]):"coerce"===y?new Ps(_,[f]):f}if(null!==i&&"string"!=typeof i&&"boolean"!=typeof i&&"number"!=typeof i||(i=["literal",i]),Array.isArray(i)){if(0===i.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=i[0];if("string"!=typeof f)return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const _=this.registry[f];if(_){let y=_.parse(i,this);if(!y)return null;if(this.expectedType){const w=this.expectedType,C=y.type;if("string"!==w.kind&&"number"!==w.kind&&"boolean"!==w.kind&&"object"!==w.kind&&"array"!==w.kind||"value"!==C.kind)if("color"!==w.kind&&"formatted"!==w.kind&&"resolvedImage"!==w.kind||"value"!==C.kind&&"string"!==C.kind){if(this.checkSubtype(w,C))return null}else y=c(y,w,l.typeAnnotation||"coerce");else y=c(y,w,l.typeAnnotation||"assert")}if(!(y instanceof ks)&&"resolvedImage"!==y.type.kind&&qo(y)){const w=new jf;try{y=new ks(y.type,y.evaluate(w))}catch(C){return this.error(C.message),null}}return y}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===i?"'undefined' value invalid. Use null instead.":"object"==typeof i?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,l,c){const f="number"==typeof i?this.path.concat(i):this.path,_=c?this.scope.concat(c):this.scope;return new Gr(this.registry,f,l||null,_,this.errors)}error(i,...l){const c=`${this.key}${l.map(f=>`[${f}]`).join("")}`;this.errors.push(new gn(c,i))}checkSubtype(i,l){const c=Oi(i,l);return c&&this.error(c),c}}function qo(a){if(a instanceof $t)return qo(a.boundExpression);if(a instanceof on&&"error"===a.name||a instanceof Ga||a instanceof dr)return!1;const i=a instanceof Ps||a instanceof Go;let l=!0;return a.eachChild(c=>{l=i?l&&qo(c):l&&c instanceof ks}),!!l&&Bl(a)&&Ut(a,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script"])}function Zo(a,i){const l=a.length-1;let c,f,_=0,y=l,w=0;for(;_<=y;)if(w=Math.floor((_+y)/2),c=a[w],f=a[w+1],c<=i){if(w===l||i<f)return w;_=w+1}else{if(!(c>i))throw new hr("Input is not a number.");y=w-1}return 0}class ei{constructor(i,l,c){this.type=i,this.input=l,this.labels=[],this.outputs=[];for(const[f,_]of c)this.labels.push(f),this.outputs.push(_)}static parse(i,l){if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");const c=l.parse(i[1],1,ft);if(!c)return null;const f=[];let _=null;l.expectedType&&"value"!==l.expectedType.kind&&(_=l.expectedType);for(let y=1;y<i.length;y+=2){const w=1===y?-1/0:i[y],C=i[y+1],D=y,I=y+1;if("number"!=typeof w)return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(f.length&&f[f.length-1][0]>=w)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);const R=l.parse(C,I,_);if(!R)return null;_=_||R.type,f.push([w,R])}return new ei(_,c,f)}evaluate(i){const l=this.labels,c=this.outputs;if(1===l.length)return c[0].evaluate(i);const f=this.input.evaluate(i);if(f<=l[0])return c[0].evaluate(i);const _=l.length;return f>=l[_-1]?c[_-1].evaluate(i):c[Zo(l,f)].evaluate(i)}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){const i=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&i.push(this.labels[l]),i.push(this.outputs[l].serialize());return i}}function Dn(a,i,l){return a*(1-l)+i*l}var fi=Object.freeze({__proto__:null,number:Dn,color:function(a,i,l){return new Gt(Dn(a.r,i.r,l),Dn(a.g,i.g,l),Dn(a.b,i.b,l),Dn(a.a,i.a,l))},array:function(a,i,l){return a.map((c,f)=>Dn(c,i[f],l))}});const er=4/29,Si=6/29,Wo=3*Si*Si,Fr=Math.PI/180,ha=180/Math.PI;function fr(a){return a>.008856451679035631?Math.pow(a,1/3):a/Wo+er}function da(a){return a>Si?a*a*a:Wo*(a-er)}function ps(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function Jt(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Wa(a){const i=Jt(a.r),l=Jt(a.g),c=Jt(a.b),f=fr((.4124564*i+.3575761*l+.1804375*c)/.95047),_=fr((.2126729*i+.7151522*l+.072175*c)/1);return{l:116*_-16,a:500*(f-_),b:200*(_-fr((.0193339*i+.119192*l+.9503041*c)/1.08883)),alpha:a.a}}function Os(a){let i=(a.l+16)/116,l=isNaN(a.a)?i:i+a.a/500,c=isNaN(a.b)?i:i-a.b/200;return i=1*da(i),l=.95047*da(l),c=1.08883*da(c),new Gt(ps(3.2404542*l-1.5371385*i-.4985314*c),ps(-.969266*l+1.8760108*i+.041556*c),ps(.0556434*l-.2040259*i+1.0572252*c),a.alpha)}function $u(a,i,l){const c=i-a;return a+l*(c>180||c<-180?c-360*Math.round(c/360):c)}const bo={forward:Wa,reverse:Os,interpolate:function(a,i,l){return{l:Dn(a.l,i.l,l),a:Dn(a.a,i.a,l),b:Dn(a.b,i.b,l),alpha:Dn(a.alpha,i.alpha,l)}}},Or={forward:function(a){const{l:i,a:l,b:c}=Wa(a),f=Math.atan2(c,l)*ha;return{h:f<0?f+360:f,c:Math.sqrt(l*l+c*c),l:i,alpha:a.a}},reverse:function(a){const i=a.h*Fr,l=a.c;return Os({l:a.l,a:Math.cos(i)*l,b:Math.sin(i)*l,alpha:a.alpha})},interpolate:function(a,i,l){return{h:$u(a.h,i.h,l),c:Dn(a.c,i.c,l),l:Dn(a.l,i.l,l),alpha:Dn(a.alpha,i.alpha,l)}}};var Xa=Object.freeze({__proto__:null,lab:bo,hcl:Or});class qr{constructor(i,l,c,f,_){this.type=i,this.operator=l,this.interpolation=c,this.input=f,this.labels=[],this.outputs=[];for(const[y,w]of _)this.labels.push(y),this.outputs.push(w)}static interpolationFactor(i,l,c,f){let _=0;if("exponential"===i.name)_=Yi(l,i.base,c,f);else if("linear"===i.name)_=Yi(l,1,c,f);else if("cubic-bezier"===i.name){const y=i.controlPoints;_=new Ce(y[0],y[1],y[2],y[3]).solve(Yi(l,1,c,f))}return _}static parse(i,l){let[c,f,_,...y]=i;if(!Array.isArray(f)||0===f.length)return l.error("Expected an interpolation type expression.",1);if("linear"===f[0])f={name:"linear"};else if("exponential"===f[0]){const D=f[1];if("number"!=typeof D)return l.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:D}}else{if("cubic-bezier"!==f[0])return l.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const D=f.slice(1);if(4!==D.length||D.some(I=>"number"!=typeof I||I<0||I>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:D}}}if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(_=l.parse(_,2,ft),!_)return null;const w=[];let C=null;"interpolate-hcl"===c||"interpolate-lab"===c?C=Ho:l.expectedType&&"value"!==l.expectedType.kind&&(C=l.expectedType);for(let D=0;D<y.length;D+=2){const I=y[D],R=y[D+1],k=D+3,N=D+4;if("number"!=typeof I)return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(w.length&&w[w.length-1][0]>=I)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);const H=l.parse(R,N,C);if(!H)return null;C=C||H.type,w.push([I,H])}return"number"===C.kind||"color"===C.kind||"array"===C.kind&&"number"===C.itemType.kind&&"number"==typeof C.N?new qr(C,c,f,_,w):l.error(`Type ${ur(C)} is not interpolatable.`)}evaluate(i){const l=this.labels,c=this.outputs;if(1===l.length)return c[0].evaluate(i);const f=this.input.evaluate(i);if(f<=l[0])return c[0].evaluate(i);const _=l.length;if(f>=l[_-1])return c[_-1].evaluate(i);const y=Zo(l,f),w=qr.interpolationFactor(this.interpolation,f,l[y],l[y+1]),C=c[y].evaluate(i),D=c[y+1].evaluate(i);return"interpolate"===this.operator?fi[this.type.kind.toLowerCase()](C,D,w):"interpolate-hcl"===this.operator?Or.reverse(Or.interpolate(Or.forward(C),Or.forward(D),w)):bo.reverse(bo.interpolate(bo.forward(C),bo.forward(D),w))}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i;i="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const l=[this.operator,i,this.input.serialize()];for(let c=0;c<this.labels.length;c++)l.push(this.labels[c],this.outputs[c].serialize());return l}}function Yi(a,i,l,c){const f=c-l,_=a-l;return 0===f?0:1===i?_/f:(Math.pow(i,_)-1)/(Math.pow(i,f)-1)}class Hn{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expectected at least one argument.");let c=null;const f=l.expectedType;f&&"value"!==f.kind&&(c=f);const _=[];for(const w of i.slice(1)){const C=l.parse(w,1+_.length,c,void 0,{typeAnnotation:"omit"});if(!C)return null;c=c||C.type,_.push(C)}const y=f&&_.some(w=>Oi(f,w.type));return new Hn(y?At:c,_)}evaluate(i){let l,c=null,f=0;for(const _ of this.args)if(f++,c=_.evaluate(i),c&&c instanceof Mt&&!c.available&&(l||(l=c.name),c=null,f===this.args.length&&(c=l)),null!==c)break;return c}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=["coalesce"];return this.eachChild(l=>{i.push(l.serialize())}),i}}class jc{constructor(i,l){this.type=l.type,this.bindings=[].concat(i),this.result=l}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const l of this.bindings)i(l[1]);i(this.result)}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const c=[];for(let _=1;_<i.length-1;_+=2){const y=i[_];if("string"!=typeof y)return l.error(`Expected string, but found ${typeof y} instead.`,_);if(/[^a-zA-Z0-9_]/.test(y))return l.error("Variable names must contain only alphanumeric characters or '_'.",_);const w=l.parse(i[_+1],_+1);if(!w)return null;c.push([y,w])}const f=l.parse(i[i.length-1],i.length-1,l.expectedType,c);return f?new jc(c,f):null}outputDefined(){return this.result.outputDefined()}serialize(){const i=["let"];for(const[l,c]of this.bindings)i.push(l,c.serialize());return i.push(this.result.serialize()),i}}class $c{constructor(i,l,c){this.type=i,this.index=l,this.input=c}static parse(i,l){if(3!==i.length)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const c=l.parse(i[1],1,ft),f=l.parse(i[2],2,kt(l.expectedType||At));return c&&f?new $c(f.type.itemType,c,f):null}evaluate(i){const l=this.index.evaluate(i),c=this.input.evaluate(i);if(l<0)throw new hr(`Array index out of bounds: ${l} < 0.`);if(l>=c.length)throw new hr(`Array index out of bounds: ${l} > ${c.length-1}.`);if(l!==Math.floor(l))throw new hr(`Array index must be an integer, but found ${l} instead.`);return c[l]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Ka{constructor(i,l){this.type=Qt,this.needle=i,this.haystack=l}static parse(i,l){if(3!==i.length)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const c=l.parse(i[1],1,At),f=l.parse(i[2],2,At);return c&&f?aa(c.type,[Qt,rn,ft,Rs,At])?new Ka(c,f):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${ur(c.type)} instead`):null}evaluate(i){const l=this.needle.evaluate(i),c=this.haystack.evaluate(i);if(!c)return!1;if(!Ol(l,["boolean","string","number","null"]))throw new hr(`Expected first argument to be of type boolean, string, number or null, but found ${ur(Kn(l))} instead.`);if(!Ol(c,["string","array"]))throw new hr(`Expected second argument to be of type array or string, but found ${ur(Kn(c))} instead.`);return c.indexOf(l)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Ya{constructor(i,l,c){this.type=ft,this.needle=i,this.haystack=l,this.fromIndex=c}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const c=l.parse(i[1],1,At),f=l.parse(i[2],2,At);if(!c||!f)return null;if(!aa(c.type,[Qt,rn,ft,Rs,At]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${ur(c.type)} instead`);if(4===i.length){const _=l.parse(i[3],3,ft);return _?new Ya(c,f,_):null}return new Ya(c,f)}evaluate(i){const l=this.needle.evaluate(i),c=this.haystack.evaluate(i);if(!Ol(l,["boolean","string","number","null"]))throw new hr(`Expected first argument to be of type boolean, string, number or null, but found ${ur(Kn(l))} instead.`);if(!Ol(c,["string","array"]))throw new hr(`Expected second argument to be of type array or string, but found ${ur(Kn(c))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(i);return c.indexOf(l,f)}return c.indexOf(l)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class fa{constructor(i,l,c,f,_,y){this.inputType=i,this.type=l,this.input=c,this.cases=f,this.outputs=_,this.otherwise=y}static parse(i,l){if(i.length<5)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return l.error("Expected an even number of arguments.");let c,f;l.expectedType&&"value"!==l.expectedType.kind&&(f=l.expectedType);const _={},y=[];for(let D=2;D<i.length-1;D+=2){let I=i[D];const R=i[D+1];Array.isArray(I)||(I=[I]);const k=l.concat(D);if(0===I.length)return k.error("Expected at least one branch label.");for(const H of I){if("number"!=typeof H&&"string"!=typeof H)return k.error("Branch labels must be numbers or strings.");if("number"==typeof H&&Math.abs(H)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof H&&Math.floor(H)!==H)return k.error("Numeric branch labels must be integer values.");if(c){if(k.checkSubtype(c,Kn(H)))return null}else c=Kn(H);if(void 0!==_[String(H)])return k.error("Branch labels must be unique.");_[String(H)]=y.length}const N=l.parse(R,D,f);if(!N)return null;f=f||N.type,y.push(N)}const w=l.parse(i[1],1,At);if(!w)return null;const C=l.parse(i[i.length-1],i.length-1,f);return C?"value"!==w.type.kind&&l.concat(1).checkSubtype(c,w.type)?null:new fa(c,f,w,_,y,C):null}evaluate(i){const l=this.input.evaluate(i);return(Kn(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),c=[],f={};for(const y of l){const w=f[this.cases[y]];void 0===w?(f[this.cases[y]]=c.length,c.push([this.cases[y],[y]])):c[w][1].push(y)}const _=y=>"number"===this.inputType.kind?Number(y):y;for(const[y,w]of c)i.push(1===w.length?_(w[0]):w.map(_)),i.push(this.outputs[y].serialize());return i.push(this.otherwise.serialize()),i}}class pa{constructor(i,l,c){this.type=i,this.branches=l,this.otherwise=c}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return l.error("Expected an odd number of arguments.");let c;l.expectedType&&"value"!==l.expectedType.kind&&(c=l.expectedType);const f=[];for(let y=1;y<i.length-1;y+=2){const w=l.parse(i[y],y,Qt);if(!w)return null;const C=l.parse(i[y+1],y+1,c);if(!C)return null;f.push([w,C]),c=c||C.type}const _=l.parse(i[i.length-1],i.length-1,c);return _?new pa(c,f,_):null}evaluate(i){for(const[l,c]of this.branches)if(l.evaluate(i))return c.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[l,c]of this.branches)i(l),i(c);i(this.otherwise)}outputDefined(){return this.branches.every(([i,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["case"];return this.eachChild(l=>{i.push(l.serialize())}),i}}class wo{constructor(i,l,c,f){this.type=i,this.input=l,this.beginIndex=c,this.endIndex=f}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const c=l.parse(i[1],1,At),f=l.parse(i[2],2,ft);if(!c||!f)return null;if(!aa(c.type,[kt(At),rn,At]))return l.error(`Expected first argument to be of type array or string, but found ${ur(c.type)} instead`);if(4===i.length){const _=l.parse(i[3],3,ft);return _?new wo(c.type,c,f,_):null}return new wo(c.type,c,f)}evaluate(i){const l=this.input.evaluate(i),c=this.beginIndex.evaluate(i);if(!Ol(l,["string","array"]))throw new hr(`Expected first argument to be of type array or string, but found ${ur(Kn(l))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(i);return l.slice(c,f)}return l.slice(c)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function ti(a,i){return"=="===a||"!="===a?"boolean"===i.kind||"string"===i.kind||"number"===i.kind||"null"===i.kind||"value"===i.kind:"string"===i.kind||"number"===i.kind||"value"===i.kind}function Hu(a,i,l,c){return 0===c.compare(i,l)}function Ai(a,i,l){const c="=="!==a&&"!="!==a;return class qS{constructor(_,y,w){this.type=Qt,this.lhs=_,this.rhs=y,this.collator=w,this.hasUntypedArgument="value"===_.type.kind||"value"===y.type.kind}static parse(_,y){if(3!==_.length&&4!==_.length)return y.error("Expected two or three arguments.");const w=_[0];let C=y.parse(_[1],1,At);if(!C)return null;if(!ti(w,C.type))return y.concat(1).error(`"${w}" comparisons are not supported for type '${ur(C.type)}'.`);let D=y.parse(_[2],2,At);if(!D)return null;if(!ti(w,D.type))return y.concat(2).error(`"${w}" comparisons are not supported for type '${ur(D.type)}'.`);if(C.type.kind!==D.type.kind&&"value"!==C.type.kind&&"value"!==D.type.kind)return y.error(`Cannot compare types '${ur(C.type)}' and '${ur(D.type)}'.`);c&&("value"===C.type.kind&&"value"!==D.type.kind?C=new Go(D.type,[C]):"value"!==C.type.kind&&"value"===D.type.kind&&(D=new Go(C.type,[D])));let I=null;if(4===_.length){if("string"!==C.type.kind&&"string"!==D.type.kind&&"value"!==C.type.kind&&"value"!==D.type.kind)return y.error("Cannot use collator to compare non-string types.");if(I=y.parse(_[3],3,Bu),!I)return null}return new qS(C,D,I)}evaluate(_){const y=this.lhs.evaluate(_),w=this.rhs.evaluate(_);if(c&&this.hasUntypedArgument){const C=Kn(y),D=Kn(w);if(C.kind!==D.kind||"string"!==C.kind&&"number"!==C.kind)throw new hr(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${C.kind}, ${D.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const C=Kn(y),D=Kn(w);if("string"!==C.kind||"string"!==D.kind)return i(_,y,w)}return this.collator?l(_,y,w,this.collator.evaluate(_)):i(_,y,w)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}serialize(){const _=[a];return this.eachChild(y=>{_.push(y.serialize())}),_}}}const Eo=Ai("==",function(a,i,l){return i===l},Hu),Hc=Ai("!=",function(a,i,l){return i!==l},function(a,i,l,c){return!Hu(0,i,l,c)}),Ul=Ai("<",function(a,i,l){return i<l},function(a,i,l,c){return c.compare(i,l)<0}),Gc=Ai(">",function(a,i,l){return i>l},function(a,i,l,c){return c.compare(i,l)>0}),Co=Ai("<=",function(a,i,l){return i<=l},function(a,i,l,c){return c.compare(i,l)<=0}),Hf=Ai(">=",function(a,i,l){return i>=l},function(a,i,l,c){return c.compare(i,l)>=0});class ed{constructor(i,l,c,f,_){this.type=rn,this.number=i,this.locale=l,this.currency=c,this.minFractionDigits=f,this.maxFractionDigits=_}static parse(i,l){if(3!==i.length)return l.error("Expected two arguments.");const c=l.parse(i[1],1,ft);if(!c)return null;const f=i[2];if("object"!=typeof f||Array.isArray(f))return l.error("NumberFormat options argument must be an object.");let _=null;if(f.locale&&(_=l.parse(f.locale,1,rn),!_))return null;let y=null;if(f.currency&&(y=l.parse(f.currency,1,rn),!y))return null;let w=null;if(f["min-fraction-digits"]&&(w=l.parse(f["min-fraction-digits"],1,ft),!w))return null;let C=null;return f["max-fraction-digits"]&&(C=l.parse(f["max-fraction-digits"],1,ft),!C)?null:new ed(c,_,y,w,C)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class Qa{constructor(i){this.type=ft,this.input=i}static parse(i,l){if(2!==i.length)return l.error(`Expected 1 argument, but found ${i.length-1} instead.`);const c=l.parse(i[1],1);return c?"array"!==c.type.kind&&"string"!==c.type.kind&&"value"!==c.type.kind?l.error(`Expected argument of type string or array, but found ${ur(c.type)} instead.`):new Qa(c):null}evaluate(i){const l=this.input.evaluate(i);if("string"==typeof l||Array.isArray(l))return l.length;throw new hr(`Expected value to be of type string or array, but found ${ur(Kn(l))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){const i=["length"];return this.eachChild(l=>{i.push(l.serialize())}),i}}const ma={"==":Eo,"!=":Hc,">":Gc,"<":Ul,">=":Hf,"<=":Co,array:Go,at:$c,boolean:Go,case:pa,coalesce:Hn,collator:Ga,format:zc,image:yr,in:Ka,"index-of":Ya,interpolate:qr,"interpolate-hcl":qr,"interpolate-lab":qr,length:Qa,let:jc,literal:ks,match:fa,number:Go,"number-format":ed,object:Go,slice:wo,step:ei,string:Go,"to-boolean":Ps,"to-color":Ps,"to-number":Ps,"to-string":Ps,var:$t,within:dr};function td(a,[i,l,c,f]){i=i.evaluate(a),l=l.evaluate(a),c=c.evaluate(a);const _=f?f.evaluate(a):1,y=Lc(i,l,c,_);if(y)throw new hr(y);return new Gt(i/255*_,l/255*_,c/255*_,_)}function Gf(a,i){return a in i}function nd(a,i){const l=i[a];return void 0===l?null:l}function Ja(a){return{type:a}}function rd(a){return{result:"success",value:a}}function el(a){return{result:"error",value:a}}function tl(a){return"data-driven"===a["property-type"]||"cross-faded-data-driven"===a["property-type"]}function Gu(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function id(a){return!!a.expression&&a.expression.interpolated}function Mn(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":null===a?"null":typeof a}function qu(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)}function Wm(a){return a}function qf(a,i){const l="color"===i.type,c=a.stops&&"object"==typeof a.stops[0][0],f=c||!(c||void 0!==a.property),_=a.type||(id(i)?"exponential":"interval");if(l&&((a=tn({},a)).stops&&(a.stops=a.stops.map(D=>[D[0],Gt.parse(D[1])])),a.default=Gt.parse(a.default?a.default:i.default)),a.colorSpace&&"rgb"!==a.colorSpace&&!Xa[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let y,w,C;if("exponential"===_)y=Wc;else if("interval"===_)y=Zc;else if("categorical"===_){y=Zu,w=Object.create(null);for(const D of a.stops)w[D[0]]=D[1];C=typeof a.stops[0][0]}else{if("identity"!==_)throw new Error(`Unknown function type "${_}"`);y=Xm}if(c){const D={},I=[];for(let N=0;N<a.stops.length;N++){const H=a.stops[N],q=H[0].zoom;void 0===D[q]&&(D[q]={zoom:q,type:a.type,property:a.property,default:a.default,stops:[]},I.push(q)),D[q].stops.push([H[0].value,H[1]])}const R=[];for(const N of I)R.push([D[N].zoom,qf(D[N],i)]);const k={name:"linear"};return{kind:"composite",interpolationType:k,interpolationFactor:qr.interpolationFactor.bind(void 0,k),zoomStops:R.map(N=>N[0]),evaluate:({zoom:N},H)=>Wc({stops:R,base:a.base},i,N).evaluate(N,H)}}if(f){const D="exponential"===_?{name:"exponential",base:void 0!==a.base?a.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:qr.interpolationFactor.bind(void 0,D),zoomStops:a.stops.map(I=>I[0]),evaluate:({zoom:I})=>y(a,i,I,w,C)}}return{kind:"source",evaluate(D,I){const R=I&&I.properties?I.properties[a.property]:void 0;return void 0===R?qc(a.default,i.default):y(a,i,R,w,C)}}}function qc(a,i,l){return void 0!==a?a:void 0!==i?i:void 0!==l?l:void 0}function Zu(a,i,l,c,f){return qc(typeof l===f?c[l]:void 0,a.default,i.default)}function Zc(a,i,l){if("number"!==Mn(l))return qc(a.default,i.default);const c=a.stops.length;if(1===c||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[c-1][0])return a.stops[c-1][1];const f=Zo(a.stops.map(_=>_[0]),l);return a.stops[f][1]}function Wc(a,i,l){const c=void 0!==a.base?a.base:1;if("number"!==Mn(l))return qc(a.default,i.default);const f=a.stops.length;if(1===f||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[f-1][0])return a.stops[f-1][1];const _=Zo(a.stops.map(I=>I[0]),l),y=function(I,R,k,N){const H=N-k,q=I-k;return 0===H?0:1===R?q/H:(Math.pow(R,q)-1)/(Math.pow(R,H)-1)}(l,c,a.stops[_][0],a.stops[_+1][0]),w=a.stops[_][1],C=a.stops[_+1][1];let D=fi[i.type]||Wm;if(a.colorSpace&&"rgb"!==a.colorSpace){const I=Xa[a.colorSpace];D=(R,k)=>I.reverse(I.interpolate(I.forward(R),I.forward(k),y))}return"function"==typeof w.evaluate?{evaluate(...I){const R=w.evaluate.apply(void 0,I),k=C.evaluate.apply(void 0,I);if(void 0!==R&&void 0!==k)return D(R,k,y)}}:D(w,C,y)}function Xm(a,i,l){return"color"===i.type?l=Gt.parse(l):"formatted"===i.type?l=Hr.fromString(l.toString()):"resolvedImage"===i.type?l=Mt.fromString(l.toString()):Mn(l)===i.type||"enum"===i.type&&i.values[l]||(l=void 0),qc(l,a.default,i.default)}on.register(ma,{error:[{kind:"error"},[rn],(a,[i])=>{throw new hr(i.evaluate(a))}],typeof:[rn,[At],(a,[i])=>ur(Kn(i.evaluate(a)))],"to-rgba":[kt(ft,4),[Ho],(a,[i])=>i.evaluate(a).toArray()],rgb:[Ho,[ft,ft,ft],td],rgba:[Ho,[ft,ft,ft,ft],td],has:{type:Qt,overloads:[[[rn],(a,[i])=>Gf(i.evaluate(a),a.properties())],[[rn,$n],(a,[i,l])=>Gf(i.evaluate(a),l.evaluate(a))]]},get:{type:At,overloads:[[[rn],(a,[i])=>nd(i.evaluate(a),a.properties())],[[rn,$n],(a,[i,l])=>nd(i.evaluate(a),l.evaluate(a))]]},"feature-state":[At,[rn],(a,[i])=>nd(i.evaluate(a),a.featureState||{})],properties:[$n,[],a=>a.properties()],"geometry-type":[rn,[],a=>a.geometryType()],id:[At,[],a=>a.id()],zoom:[ft,[],a=>a.globals.zoom],"heatmap-density":[ft,[],a=>a.globals.heatmapDensity||0],"line-progress":[ft,[],a=>a.globals.lineProgress||0],"sky-radial-progress":[ft,[],a=>a.globals.skyRadialProgress||0],accumulated:[At,[],a=>void 0===a.globals.accumulated?null:a.globals.accumulated],"+":[ft,Ja(ft),(a,i)=>{let l=0;for(const c of i)l+=c.evaluate(a);return l}],"*":[ft,Ja(ft),(a,i)=>{let l=1;for(const c of i)l*=c.evaluate(a);return l}],"-":{type:ft,overloads:[[[ft,ft],(a,[i,l])=>i.evaluate(a)-l.evaluate(a)],[[ft],(a,[i])=>-i.evaluate(a)]]},"/":[ft,[ft,ft],(a,[i,l])=>i.evaluate(a)/l.evaluate(a)],"%":[ft,[ft,ft],(a,[i,l])=>i.evaluate(a)%l.evaluate(a)],ln2:[ft,[],()=>Math.LN2],pi:[ft,[],()=>Math.PI],e:[ft,[],()=>Math.E],"^":[ft,[ft,ft],(a,[i,l])=>Math.pow(i.evaluate(a),l.evaluate(a))],sqrt:[ft,[ft],(a,[i])=>Math.sqrt(i.evaluate(a))],log10:[ft,[ft],(a,[i])=>Math.log(i.evaluate(a))/Math.LN10],ln:[ft,[ft],(a,[i])=>Math.log(i.evaluate(a))],log2:[ft,[ft],(a,[i])=>Math.log(i.evaluate(a))/Math.LN2],sin:[ft,[ft],(a,[i])=>Math.sin(i.evaluate(a))],cos:[ft,[ft],(a,[i])=>Math.cos(i.evaluate(a))],tan:[ft,[ft],(a,[i])=>Math.tan(i.evaluate(a))],asin:[ft,[ft],(a,[i])=>Math.asin(i.evaluate(a))],acos:[ft,[ft],(a,[i])=>Math.acos(i.evaluate(a))],atan:[ft,[ft],(a,[i])=>Math.atan(i.evaluate(a))],min:[ft,Ja(ft),(a,i)=>Math.min(...i.map(l=>l.evaluate(a)))],max:[ft,Ja(ft),(a,i)=>Math.max(...i.map(l=>l.evaluate(a)))],abs:[ft,[ft],(a,[i])=>Math.abs(i.evaluate(a))],round:[ft,[ft],(a,[i])=>{const l=i.evaluate(a);return l<0?-Math.round(-l):Math.round(l)}],floor:[ft,[ft],(a,[i])=>Math.floor(i.evaluate(a))],ceil:[ft,[ft],(a,[i])=>Math.ceil(i.evaluate(a))],"filter-==":[Qt,[rn,At],(a,[i,l])=>a.properties()[i.value]===l.value],"filter-id-==":[Qt,[At],(a,[i])=>a.id()===i.value],"filter-type-==":[Qt,[rn],(a,[i])=>a.geometryType()===i.value],"filter-<":[Qt,[rn,At],(a,[i,l])=>{const c=a.properties()[i.value],f=l.value;return typeof c==typeof f&&c<f}],"filter-id-<":[Qt,[At],(a,[i])=>{const l=a.id(),c=i.value;return typeof l==typeof c&&l<c}],"filter->":[Qt,[rn,At],(a,[i,l])=>{const c=a.properties()[i.value],f=l.value;return typeof c==typeof f&&c>f}],"filter-id->":[Qt,[At],(a,[i])=>{const l=a.id(),c=i.value;return typeof l==typeof c&&l>c}],"filter-<=":[Qt,[rn,At],(a,[i,l])=>{const c=a.properties()[i.value],f=l.value;return typeof c==typeof f&&c<=f}],"filter-id-<=":[Qt,[At],(a,[i])=>{const l=a.id(),c=i.value;return typeof l==typeof c&&l<=c}],"filter->=":[Qt,[rn,At],(a,[i,l])=>{const c=a.properties()[i.value],f=l.value;return typeof c==typeof f&&c>=f}],"filter-id->=":[Qt,[At],(a,[i])=>{const l=a.id(),c=i.value;return typeof l==typeof c&&l>=c}],"filter-has":[Qt,[At],(a,[i])=>i.value in a.properties()],"filter-has-id":[Qt,[],a=>null!==a.id()&&void 0!==a.id()],"filter-type-in":[Qt,[kt(rn)],(a,[i])=>i.value.indexOf(a.geometryType())>=0],"filter-id-in":[Qt,[kt(At)],(a,[i])=>i.value.indexOf(a.id())>=0],"filter-in-small":[Qt,[rn,kt(At)],(a,[i,l])=>l.value.indexOf(a.properties()[i.value])>=0],"filter-in-large":[Qt,[rn,kt(At)],(a,[i,l])=>function(c,f,_,y){for(;_<=y;){const w=_+y>>1;if(f[w]===c)return!0;f[w]>c?y=w-1:_=w+1}return!1}(a.properties()[i.value],l.value,0,l.value.length-1)],all:{type:Qt,overloads:[[[Qt,Qt],(a,[i,l])=>i.evaluate(a)&&l.evaluate(a)],[Ja(Qt),(a,i)=>{for(const l of i)if(!l.evaluate(a))return!1;return!0}]]},any:{type:Qt,overloads:[[[Qt,Qt],(a,[i,l])=>i.evaluate(a)||l.evaluate(a)],[Ja(Qt),(a,i)=>{for(const l of i)if(l.evaluate(a))return!0;return!1}]]},"!":[Qt,[Qt],(a,[i])=>!i.evaluate(a)],"is-supported-script":[Qt,[rn],(a,[i])=>{const l=a.globals&&a.globals.isSupportedScript;return!l||l(i.evaluate(a))}],upcase:[rn,[rn],(a,[i])=>i.evaluate(a).toUpperCase()],downcase:[rn,[rn],(a,[i])=>i.evaluate(a).toLowerCase()],concat:[rn,Ja(At),(a,i)=>i.map(l=>la(l.evaluate(a))).join("")],"resolved-locale":[rn,[Bu],(a,[i])=>i.evaluate(a).resolvedLocale()]});class od{constructor(i,l){var c;this.expression=i,this._warningHistory={},this._evaluator=new jf,this._defaultValue=l?"color"===(c=l).type&&qu(c.default)?new Gt(0,0,0,0):"color"===c.type?Gt.parse(c.default)||null:void 0===c.default?null:c.default:null,this._enumValues=l&&"enum"===l.type?l.values:null}evaluateWithoutErrorHandling(i,l,c,f,_,y){return this._evaluator.globals=i,this._evaluator.feature=l,this._evaluator.featureState=c,this._evaluator.canonical=f,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)}evaluate(i,l,c,f,_,y){this._evaluator.globals=i,this._evaluator.feature=l||null,this._evaluator.featureState=c||null,this._evaluator.canonical=f,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=y||null;try{const w=this.expression.evaluate(this._evaluator);if(null==w||"number"==typeof w&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new hr(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,"undefined"!=typeof console&&console.warn(w.message)),this._defaultValue}}}function Xo(a){return Array.isArray(a)&&a.length>0&&"string"==typeof a[0]&&a[0]in ma}function so(a,i){const l=new Gr(ma,[],i?function(f){const _={color:Ho,string:rn,number:ft,enum:rn,boolean:Qt,formatted:Fc,resolvedImage:Fl};return"array"===f.type?kt(_[f.value]||At,f.length):_[f.type]}(i):void 0),c=l.parse(a,void 0,void 0,void 0,i&&"string"===i.type?{typeAnnotation:"coerce"}:void 0);return c?rd(new od(c,i)):el(l.errors)}class Lr{constructor(i,l){this.kind=i,this._styleExpression=l,this.isStateDependent="constant"!==i&&!ua(l.expression)}evaluateWithoutErrorHandling(i,l,c,f,_,y){return this._styleExpression.evaluateWithoutErrorHandling(i,l,c,f,_,y)}evaluate(i,l,c,f,_,y){return this._styleExpression.evaluate(i,l,c,f,_,y)}}class ms{constructor(i,l,c,f){this.kind=i,this.zoomStops=c,this._styleExpression=l,this.isStateDependent="camera"!==i&&!ua(l.expression),this.interpolationType=f}evaluateWithoutErrorHandling(i,l,c,f,_,y){return this._styleExpression.evaluateWithoutErrorHandling(i,l,c,f,_,y)}evaluate(i,l,c,f,_,y){return this._styleExpression.evaluate(i,l,c,f,_,y)}interpolationFactor(i,l,c){return this.interpolationType?qr.interpolationFactor(this.interpolationType,i,l,c):0}}function Wu(a,i){if("error"===(a=so(a,i)).result)return a;const l=a.value.expression,c=Bl(l);if(!c&&!tl(i))return el([new gn("","data expressions not supported")]);const f=Ut(l,["zoom"]);if(!f&&!Gu(i))return el([new gn("","zoom expressions not supported")]);const _=ga(l);return _||f?_ instanceof gn?el([_]):_ instanceof qr&&!id(i)?el([new gn("",'"interpolate" expressions cannot be used with this property')]):rd(_?new ms(c?"camera":"composite",a.value,_.labels,_ instanceof qr?_.interpolation:void 0):new Lr(c?"constant":"source",a.value)):el([new gn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Xc{constructor(i,l){this._parameters=i,this._specification=l,tn(this,qf(this._parameters,this._specification))}static deserialize(i){return new Xc(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function ga(a){let i=null;if(a instanceof jc)i=ga(a.result);else if(a instanceof Hn){for(const l of a.args)if(i=ga(l),i)break}else(a instanceof ei||a instanceof qr)&&a.input instanceof on&&"zoom"===a.input.name&&(i=a);return i instanceof gn||a.eachChild(l=>{const c=ga(l);c instanceof gn?i=c:!i&&c?i=new gn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&c&&i!==c&&(i=new gn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}function pi(a){const i=a.key,l=a.value,c=a.valueSpec||{},f=a.objectElementValidators||{},_=a.style,y=a.styleSpec;let w=[];const C=Mn(l);if("object"!==C)return[new Ve(i,l,`object expected, ${C} found`)];for(const D in l){const I=D.split(".")[0],R=c[I]||c["*"];let k;if(f[I])k=f[I];else if(c[I])k=ni;else if(f["*"])k=f["*"];else{if(!c["*"]){w.push(new Ve(i,l[D],`unknown property "${D}"`));continue}k=ni}w=w.concat(k({key:(i&&`${i}.`)+D,value:l[D],valueSpec:R,style:_,styleSpec:y,object:l,objectKey:D},l))}for(const D in c)f[D]||c[D].required&&void 0===c[D].default&&void 0===l[D]&&w.push(new Ve(i,l,`missing required property "${D}"`));return w}function Xu(a){const i=a.value,l=a.valueSpec,c=a.style,f=a.styleSpec,_=a.key,y=a.arrayElementValidator||ni;if("array"!==Mn(i))return[new Ve(_,i,`array expected, ${Mn(i)} found`)];if(l.length&&i.length!==l.length)return[new Ve(_,i,`array length ${l.length} expected, length ${i.length} found`)];if(l["min-length"]&&i.length<l["min-length"])return[new Ve(_,i,`array length at least ${l["min-length"]} expected, length ${i.length} found`)];let w={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum};f.$version<7&&(w.function=l.function),"object"===Mn(l.value)&&(w=l.value);let C=[];for(let D=0;D<i.length;D++)C=C.concat(y({array:i,arrayIndex:D,value:i[D],valueSpec:w,style:c,styleSpec:f,key:`${_}[${D}]`}));return C}function nl(a){const i=a.key,l=a.value,c=a.valueSpec;let f=Mn(l);if("number"===f&&l!=l&&(f="NaN"),"number"!==f)return[new Ve(i,l,`number expected, ${f} found`)];if("minimum"in c){let _=c.minimum;if("array"===Mn(c.minimum)&&(_=c.minimum[a.arrayIndex]),l<_)return[new Ve(i,l,`${l} is less than the minimum value ${_}`)]}if("maximum"in c){let _=c.maximum;if("array"===Mn(c.maximum)&&(_=c.maximum[a.arrayIndex]),l>_)return[new Ve(i,l,`${l} is greater than the maximum value ${_}`)]}return[]}function Ku(a){const i=a.valueSpec,l=Ft(a.value.type);let c,f,_,y={};const w="categorical"!==l&&void 0===a.value.property,C=!w,D="array"===Mn(a.value.stops)&&"array"===Mn(a.value.stops[0])&&"object"===Mn(a.value.stops[0][0]),I=pi({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(N){if("identity"===l)return[new Ve(N.key,N.value,'identity function may not have a "stops" property')];let H=[];const q=N.value;return H=H.concat(Xu({key:N.key,value:q,valueSpec:N.valueSpec,style:N.style,styleSpec:N.styleSpec,arrayElementValidator:R})),"array"===Mn(q)&&0===q.length&&H.push(new Ve(N.key,q,"array must have at least one stop")),H},default:function(N){return ni({key:N.key,value:N.value,valueSpec:i,style:N.style,styleSpec:N.styleSpec})}}});return"identity"===l&&w&&I.push(new Ve(a.key,a.value,'missing required property "property"')),"identity"===l||a.value.stops||I.push(new Ve(a.key,a.value,'missing required property "stops"')),"exponential"===l&&a.valueSpec.expression&&!id(a.valueSpec)&&I.push(new Ve(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(C&&!tl(a.valueSpec)?I.push(new Ve(a.key,a.value,"property functions not supported")):w&&!Gu(a.valueSpec)&&I.push(new Ve(a.key,a.value,"zoom functions not supported"))),"categorical"!==l&&!D||void 0!==a.value.property||I.push(new Ve(a.key,a.value,'"property" property is required')),I;function R(N){let H=[];const q=N.value,te=N.key;if("array"!==Mn(q))return[new Ve(te,q,`array expected, ${Mn(q)} found`)];if(2!==q.length)return[new Ve(te,q,`array length 2 expected, length ${q.length} found`)];if(D){if("object"!==Mn(q[0]))return[new Ve(te,q,`object expected, ${Mn(q[0])} found`)];if(void 0===q[0].zoom)return[new Ve(te,q,"object stop key must have zoom")];if(void 0===q[0].value)return[new Ve(te,q,"object stop key must have value")];if(_&&_>Ft(q[0].zoom))return[new Ve(te,q[0].zoom,"stop zoom values must appear in ascending order")];Ft(q[0].zoom)!==_&&(_=Ft(q[0].zoom),f=void 0,y={}),H=H.concat(pi({key:`${te}[0]`,value:q[0],valueSpec:{zoom:{}},style:N.style,styleSpec:N.styleSpec,objectElementValidators:{zoom:nl,value:k}}))}else H=H.concat(k({key:`${te}[0]`,value:q[0],valueSpec:{},style:N.style,styleSpec:N.styleSpec},q));return Xo(Tn(q[1]))?H.concat([new Ve(`${te}[1]`,q[1],"expressions are not allowed in function stops.")]):H.concat(ni({key:`${te}[1]`,value:q[1],valueSpec:i,style:N.style,styleSpec:N.styleSpec}))}function k(N,H){const q=Mn(N.value),te=Ft(N.value),de=null!==N.value?N.value:H;if(c){if(q!==c)return[new Ve(N.key,de,`${q} stop domain type must match previous stop domain type ${c}`)]}else c=q;if("number"!==q&&"string"!==q&&"boolean"!==q)return[new Ve(N.key,de,"stop domain value must be a number, string, or boolean")];if("number"!==q&&"categorical"!==l){let _e=`number expected, ${q} found`;return tl(i)&&void 0===l&&(_e+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ve(N.key,de,_e)]}return"categorical"!==l||"number"!==q||isFinite(te)&&Math.floor(te)===te?"categorical"!==l&&"number"===q&&void 0!==f&&te<f?[new Ve(N.key,de,"stop domain values must appear in ascending order")]:(f=te,"categorical"===l&&te in y?[new Ve(N.key,de,"stop domain values must be unique")]:(y[te]=!0,[])):[new Ve(N.key,de,`integer expected, found ${te}`)]}}function Nr(a){const i=("property"===a.expressionContext?Wu:so)(Tn(a.value),a.valueSpec);if("error"===i.result)return i.value.map(c=>new Ve(`${a.key}${c.key}`,a.value,c.message));const l=i.value.expression||i.value._styleExpression.expression;if("property"===a.expressionContext&&"text-font"===a.propertyKey&&!l.outputDefined())return[new Ve(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===a.expressionContext&&"layout"===a.propertyType&&!ua(l))return[new Ve(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===a.expressionContext&&!ua(l))return[new Ve(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&0===a.expressionContext.indexOf("cluster")){if(!Ut(l,["zoom","feature-state"]))return[new Ve(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===a.expressionContext&&!Bl(l))return[new Ve(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function _a(a){const i=a.key,l=a.value,c=a.valueSpec,f=[];return Array.isArray(c.values)?-1===c.values.indexOf(Ft(l))&&f.push(new Ve(i,l,`expected one of [${c.values.join(", ")}], ${JSON.stringify(l)} found`)):-1===Object.keys(c.values).indexOf(Ft(l))&&f.push(new Ve(i,l,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(l)} found`)),f}function jl(a){if(!0===a||!1===a)return!0;if(!Array.isArray(a)||0===a.length)return!1;switch(a[0]){case"has":return a.length>=2&&"$id"!==a[1]&&"$type"!==a[1];case"in":return a.length>=3&&("string"!=typeof a[1]||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==a.length||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const i of a.slice(1))if(!jl(i)&&"boolean"!=typeof i)return!1;return!0;default:return!0}}const $l={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function rl(a){if(null==a)return{filter:()=>!0,needGeometry:!1};jl(a)||(a=Zn(a));const i=so(a,$l);if("error"===i.result)throw new Error(i.value.map(l=>`${l.key}: ${l.message}`).join(", "));return{filter:(l,c,f)=>i.value.evaluate(l,c,{},f),needGeometry:Zf(a)}}function Kc(a,i){return a<i?-1:a>i?1:0}function Zf(a){if(!Array.isArray(a))return!1;if("within"===a[0])return!0;for(let i=1;i<a.length;i++)if(Zf(a[i]))return!0;return!1}function Zn(a){if(!a)return!0;const i=a[0];return a.length<=1?"any"!==i:"=="===i?sd(a[1],a[2],"=="):"!="===i?mr(sd(a[1],a[2],"==")):"<"===i||">"===i||"<="===i||">="===i?sd(a[1],a[2],i):"any"===i?(l=a.slice(1),["any"].concat(l.map(Zn))):"all"===i?["all"].concat(a.slice(1).map(Zn)):"none"===i?["all"].concat(a.slice(1).map(Zn).map(mr)):"in"===i?Yu(a[1],a.slice(2)):"!in"===i?mr(Yu(a[1],a.slice(2))):"has"===i?ad(a[1]):"!has"===i?mr(ad(a[1])):"within"!==i||a;var l}function sd(a,i,l){switch(a){case"$type":return[`filter-type-${l}`,i];case"$id":return[`filter-id-${l}`,i];default:return[`filter-${l}`,a,i]}}function Yu(a,i){if(0===i.length)return!1;switch(a){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(l=>typeof l!=typeof i[0])?["filter-in-large",a,["literal",i.sort(Kc)]]:["filter-in-small",a,["literal",i]]}}function ad(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function mr(a){return["!",a]}function Qu(a){return jl(Tn(a.value))?Nr(tn({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Yc(a)}function Yc(a){const i=a.value,l=a.key;if("array"!==Mn(i))return[new Ve(l,i,`array expected, ${Mn(i)} found`)];const c=a.styleSpec;let f,_=[];if(i.length<1)return[new Ve(l,i,"filter array must have at least 1 element")];switch(_=_.concat(_a({key:`${l}[0]`,value:i[0],valueSpec:c.filter_operator,style:a.style,styleSpec:a.styleSpec})),Ft(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&"$type"===Ft(i[1])&&_.push(new Ve(l,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":3!==i.length&&_.push(new Ve(l,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(f=Mn(i[1]),"string"!==f&&_.push(new Ve(`${l}[1]`,i[1],`string expected, ${f} found`)));for(let y=2;y<i.length;y++)f=Mn(i[y]),"$type"===Ft(i[1])?_=_.concat(_a({key:`${l}[${y}]`,value:i[y],valueSpec:c.geometry_type,style:a.style,styleSpec:a.styleSpec})):"string"!==f&&"number"!==f&&"boolean"!==f&&_.push(new Ve(`${l}[${y}]`,i[y],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let y=1;y<i.length;y++)_=_.concat(Yc({key:`${l}[${y}]`,value:i[y],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":f=Mn(i[1]),2!==i.length?_.push(new Ve(l,i,`filter array for "${i[0]}" operator must have 2 elements`)):"string"!==f&&_.push(new Ve(`${l}[1]`,i[1],`string expected, ${f} found`));break;case"within":f=Mn(i[1]),2!==i.length?_.push(new Ve(l,i,`filter array for "${i[0]}" operator must have 2 elements`)):"object"!==f&&_.push(new Ve(`${l}[1]`,i[1],`object expected, ${f} found`))}return _}function Ls(a,i){const l=a.key,c=a.style,f=a.styleSpec,_=a.value,y=a.objectKey,w=f[`${i}_${a.layerType}`];if(!w)return[];const C=y.match(/^(.*)-transition$/);if("paint"===i&&C&&w[C[1]]&&w[C[1]].transition)return ni({key:l,value:_,valueSpec:f.transition,style:c,styleSpec:f});const D=a.valueSpec||w[y];if(!D)return[new Ve(l,_,`unknown property "${y}"`)];let I;if("string"===Mn(_)&&tl(D)&&!D.tokens&&(I=/^{([^}]+)}$/.exec(_)))return[new Ve(l,_,`"${y}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(I[1])} }\`.`)];const R=[];return"symbol"===a.layerType&&("text-field"===y&&c&&!c.glyphs&&R.push(new Ve(l,_,'use of "text-field" requires a style "glyphs" property')),"text-font"===y&&qu(Tn(_))&&"identity"===Ft(_.type)&&R.push(new Ve(l,_,'"text-font" does not support identity functions'))),R.concat(ni({key:a.key,value:_,valueSpec:D,style:c,styleSpec:f,expressionContext:"property",propertyType:i,propertyKey:y}))}function ir(a){return Ls(a,"paint")}function Hl(a){return Ls(a,"layout")}function Qc(a){let i=[];const l=a.value,c=a.key,f=a.style,_=a.styleSpec;l.type||l.ref||i.push(new Ve(c,l,'either "type" or "ref" is required'));let y=Ft(l.type);const w=Ft(l.ref);if(l.id){const C=Ft(l.id);for(let D=0;D<a.arrayIndex;D++){const I=f.layers[D];Ft(I.id)===C&&i.push(new Ve(c,l.id,`duplicate layer id "${l.id}", previously used at line ${I.id.__line__}`))}}if("ref"in l){let C;["type","source","source-layer","filter","layout"].forEach(D=>{D in l&&i.push(new Ve(c,l[D],`"${D}" is prohibited for ref layers`))}),f.layers.forEach(D=>{Ft(D.id)===w&&(C=D)}),C?C.ref?i.push(new Ve(c,l.ref,"ref cannot reference another ref layer")):y=Ft(C.type):i.push(new Ve(c,l.ref,`ref layer "${w}" not found`))}else if("background"!==y&&"sky"!==y)if(l.source){const C=f.sources&&f.sources[l.source],D=C&&Ft(C.type);C?"vector"===D&&"raster"===y?i.push(new Ve(c,l.source,`layer "${l.id}" requires a raster source`)):"raster"===D&&"raster"!==y?i.push(new Ve(c,l.source,`layer "${l.id}" requires a vector source`)):"vector"!==D||l["source-layer"]?"raster-dem"===D&&"hillshade"!==y?i.push(new Ve(c,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==y||!l.paint||!l.paint["line-gradient"]||"geojson"===D&&C.lineMetrics||i.push(new Ve(c,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new Ve(c,l,`layer "${l.id}" must specify a "source-layer"`)):i.push(new Ve(c,l.source,`source "${l.source}" not found`))}else i.push(new Ve(c,l,'missing required property "source"'));return i=i.concat(pi({key:c,value:l,valueSpec:_.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ni({key:`${c}.type`,value:l.type,valueSpec:_.layer.type,style:a.style,styleSpec:a.styleSpec,object:l,objectKey:"type"}),filter:Qu,layout:C=>pi({layer:l,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":D=>Hl(tn({layerType:y},D))}}),paint:C=>pi({layer:l,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":D=>ir(tn({layerType:y},D))}})}})),i}function To(a){const i=a.value,l=a.key,c=Mn(i);return"string"!==c?[new Ve(l,i,`string expected, ${c} found`)]:[]}const Li={promoteId:function({key:a,value:i}){if("string"===Mn(i))return To({key:a,value:i});{const l=[];for(const c in i)l.push(...To({key:`${a}.${c}`,value:i[c]}));return l}}};function Ju(a){const i=a.value,l=a.key,c=a.styleSpec,f=a.style;if(!i.type)return[new Ve(l,i,'"type" is required')];const _=Ft(i.type);let y;switch(_){case"vector":case"raster":case"raster-dem":return y=pi({key:l,value:i,valueSpec:c[`source_${_.replace("-","_")}`],style:a.style,styleSpec:c,objectElementValidators:Li}),y;case"geojson":if(y=pi({key:l,value:i,valueSpec:c.source_geojson,style:f,styleSpec:c,objectElementValidators:Li}),i.cluster)for(const w in i.clusterProperties){const[C,D]=i.clusterProperties[w],I="string"==typeof C?[C,["accumulated"],["get",w]]:C;y.push(...Nr({key:`${l}.${w}.map`,value:D,expressionContext:"cluster-map"})),y.push(...Nr({key:`${l}.${w}.reduce`,value:I,expressionContext:"cluster-reduce"}))}return y;case"video":return pi({key:l,value:i,valueSpec:c.source_video,style:f,styleSpec:c});case"image":return pi({key:l,value:i,valueSpec:c.source_image,style:f,styleSpec:c});case"canvas":return[new Ve(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return _a({key:`${l}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:f,styleSpec:c})}}function il(a){const i=a.value,l=a.styleSpec,c=l.light,f=a.style;let _=[];const y=Mn(i);if(void 0===i)return _;if("object"!==y)return _=_.concat([new Ve("light",i,`object expected, ${y} found`)]),_;for(const w in i){const C=w.match(/^(.*)-transition$/);_=_.concat(C&&c[C[1]]&&c[C[1]].transition?ni({key:w,value:i[w],valueSpec:l.transition,style:f,styleSpec:l}):c[w]?ni({key:w,value:i[w],valueSpec:c[w],style:f,styleSpec:l}):[new Ve(w,i[w],`unknown property "${w}"`)])}return _}function ld(a){const i=a.value,l=a.key,c=a.style,f=a.styleSpec,_=f.terrain;let y=[];const w=Mn(i);if(void 0===i)return y;if("object"!==w)return y=y.concat([new Ve("terrain",i,`object expected, ${w} found`)]),y;for(const C in i){const D=C.match(/^(.*)-transition$/);y=y.concat(D&&_[D[1]]&&_[D[1]].transition?ni({key:C,value:i[C],valueSpec:f.transition,style:c,styleSpec:f}):_[C]?ni({key:C,value:i[C],valueSpec:_[C],style:c,styleSpec:f}):[new Ve(C,i[C],`unknown property "${C}"`)])}if(i.source){const C=c.sources&&c.sources[i.source],D=C&&Ft(C.type);C?"raster-dem"!==D&&y.push(new Ve(l,i.source,`terrain cannot be used with a source of type ${D}, it only be used with a "raster-dem" source type`)):y.push(new Ve(l,i.source,`source "${i.source}" not found`))}else y.push(new Ve(l,i,'terrain is missing required property "source"'));return y}function Do(a){const i=a.value,l=a.style,c=a.styleSpec,f=c.fog;let _=[];const y=Mn(i);if(void 0===i)return _;if("object"!==y)return _=_.concat([new Ve("fog",i,`object expected, ${y} found`)]),_;for(const w in i){const C=w.match(/^(.*)-transition$/);_=_.concat(C&&f[C[1]]&&f[C[1]].transition?ni({key:w,value:i[w],valueSpec:c.transition,style:l,styleSpec:c}):f[w]?ni({key:w,value:i[w],valueSpec:f[w],style:l,styleSpec:c}):[new Ve(w,i[w],`unknown property "${w}"`)])}return _}const eh={"*":()=>[],array:Xu,boolean:function(a){const i=a.value,l=a.key,c=Mn(i);return"boolean"!==c?[new Ve(l,i,`boolean expected, ${c} found`)]:[]},number:nl,color:function(a){const i=a.key,l=a.value,c=Mn(l);return"string"!==c?[new Ve(i,l,`color expected, ${c} found`)]:null===Oc.parseCSSColor(l)?[new Ve(i,l,`color expected, "${l}" found`)]:[]},constants:Bt,enum:_a,filter:Qu,function:Ku,layer:Qc,object:pi,source:Ju,light:il,terrain:ld,fog:Do,string:To,formatted:function(a){return 0===To(a).length?[]:Nr(a)},resolvedImage:function(a){return 0===To(a).length?[]:Nr(a)}};function ni(a){const i=a.value,l=a.valueSpec,c=a.styleSpec;return l.expression&&qu(Ft(i))?Ku(a):l.expression&&Xo(Tn(i))?Nr(a):l.type&&eh[l.type]?eh[l.type](a):pi(tn({},a,{valueSpec:l.type?c[l.type]:l}))}function Ht(a){const i=a.value,l=a.key,c=To(a);return c.length||(-1===i.indexOf("{fontstack}")&&c.push(new Ve(l,i,'"glyphs" url must include a "{fontstack}" token')),-1===i.indexOf("{range}")&&c.push(new Ve(l,i,'"glyphs" url must include a "{range}" token'))),c}function Ns(a,i=ue){let l=[];return l=l.concat(ni({key:"",value:a,valueSpec:i.$root,styleSpec:i,style:a,objectElementValidators:{glyphs:Ht,"*":()=>[]}})),a.constants&&(l=l.concat(Bt({key:"constants",value:a.constants,style:a,styleSpec:i}))),th(l)}function th(a){return[].concat(a).sort((i,l)=>i.line-l.line)}function gs(a){return function(...i){return th(a.apply(this,i))}}Ns.source=gs(Ju),Ns.light=gs(il),Ns.terrain=gs(ld),Ns.fog=gs(Do),Ns.layer=gs(Qc),Ns.filter=gs(Qu),Ns.paintProperty=gs(ir),Ns.layoutProperty=gs(Hl);const ol=Ns,Jc=ol.light,eu=ol.fog,cd=ol.paintProperty,tt=ol.layoutProperty;function xn(a,i){let l=!1;if(i&&i.length)for(const c of i)a.fire(new Ke(new Error(c.message))),l=!0;return l}var sl=zn;function zn(a,i,l){var c=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var f=new Int32Array(this.arrayBuffer);a=f[0],this.d=(i=f[1])+2*(l=f[2]);for(var _=0;_<this.d*this.d;_++){var y=f[3+_],w=f[3+_+1];c.push(y===w?null:f.subarray(y,w))}var C=f[3+c.length+1];this.keys=f.subarray(f[3+c.length],C),this.bboxes=f.subarray(C),this.insert=this._insertReadonly}else{this.d=i+2*l;for(var D=0;D<this.d*this.d;D++)c.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=a,this.padding=l,this.scale=i/a,this.uid=0;var I=l/i*a;this.min=-I,this.max=a+I}zn.prototype.insert=function(a,i,l,c,f){this._forEachCell(i,l,c,f,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(i),this.bboxes.push(l),this.bboxes.push(c),this.bboxes.push(f)},zn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},zn.prototype._insertCell=function(a,i,l,c,f,_){this.cells[f].push(_)},zn.prototype.query=function(a,i,l,c,f){var _=this.min,y=this.max;if(a<=_&&i<=_&&y<=l&&y<=c&&!f)return Array.prototype.slice.call(this.keys);var w=[];return this._forEachCell(a,i,l,c,this._queryCell,w,{},f),w},zn.prototype._queryCell=function(a,i,l,c,f,_,y,w){var C=this.cells[f];if(null!==C)for(var D=this.keys,I=this.bboxes,R=0;R<C.length;R++){var k=C[R];if(void 0===y[k]){var N=4*k;(w?w(I[N+0],I[N+1],I[N+2],I[N+3]):a<=I[N+2]&&i<=I[N+3]&&l>=I[N+0]&&c>=I[N+1])?(y[k]=!0,_.push(D[k])):y[k]=!1}}},zn.prototype._forEachCell=function(a,i,l,c,f,_,y,w){for(var C=this._convertToCellCoord(a),D=this._convertToCellCoord(i),I=this._convertToCellCoord(l),R=this._convertToCellCoord(c),k=C;k<=I;k++)for(var N=D;N<=R;N++){var H=this.d*N+k;if((!w||w(this._convertFromCellCoord(k),this._convertFromCellCoord(N),this._convertFromCellCoord(k+1),this._convertFromCellCoord(N+1)))&&f.call(this,a,i,l,c,H,_,y,w))return}},zn.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},zn.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},zn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,i=3+this.cells.length+1+1,l=0,c=0;c<this.cells.length;c++)l+=this.cells[c].length;var f=new Int32Array(i+l+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var _=i,y=0;y<a.length;y++){var w=a[y];f[3+y]=_,f.set(w,_),_+=w.length}return f[3+a.length]=_,f.set(this.keys,_),f[3+a.length+1]=_+=this.keys.length,f.set(this.bboxes,_),_+=this.bboxes.length,f.buffer};const{ImageData:nh,ImageBitmap:al}=Fe,Ni={};function yt(a,i,l={}){Object.defineProperty(i,"_classRegistryKey",{value:a,writeable:!1}),Ni[a]={klass:i,omit:l.omit||[],shallow:l.shallow||[]}}yt("Object",Object),sl.serialize=function(a,i){const l=a.toArrayBuffer();return i&&i.push(l),{buffer:l}},sl.deserialize=function(a){return new sl(a.buffer)},yt("Grid",sl),yt("Color",Gt),yt("Error",Error),yt("ResolvedImage",Mt),yt("StylePropertyFunction",Xc),yt("StyleExpression",od,{omit:["_evaluator"]}),yt("ZoomDependentExpression",ms),yt("ZoomConstantExpression",Lr),yt("CompoundExpression",on,{omit:["_evaluate"]});for(const a in ma)ma[a]._classRegistryKey||yt(`Expression_${a}`,ma[a]);function Gl(a){return a&&"undefined"!=typeof ArrayBuffer&&(a instanceof ArrayBuffer||a.constructor&&"ArrayBuffer"===a.constructor.name)}function Wf(a){return al&&a instanceof al}function ql(a,i){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(Gl(a)||Wf(a))return i&&i.push(a),a;if(ArrayBuffer.isView(a)){const l=a;return i&&i.push(l.buffer),l}if(a instanceof nh)return i&&i.push(a.data.buffer),a;if(Array.isArray(a)){const l=[];for(const c of a)l.push(ql(c,i));return l}if("object"==typeof a){const l=a.constructor,c=l._classRegistryKey;if(!c)throw new Error("can't serialize object of unregistered class");const f=l.serialize?l.serialize(a,i):{};if(!l.serialize){for(const _ in a){if(!a.hasOwnProperty(_)||Ni[c].omit.indexOf(_)>=0)continue;const y=a[_];f[_]=Ni[c].shallow.indexOf(_)>=0?y:ql(y,i)}a instanceof Error&&(f.message=a.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==c&&(f.$name=c),f}throw new Error("can't serialize object of type "+typeof a)}function zs(a){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||Gl(a)||Wf(a)||ArrayBuffer.isView(a)||a instanceof nh)return a;if(Array.isArray(a))return a.map(zs);if("object"==typeof a){const i=a.$name||"Object",{klass:l}=Ni[i];if(!l)throw new Error(`can't deserialize unregistered class ${i}`);if(l.deserialize)return l.deserialize(a);const c=Object.create(l.prototype);for(const f of Object.keys(a)){if("$name"===f)continue;const _=a[f];c[f]=Ni[i].shallow.indexOf(f)>=0?_:zs(_)}return c}throw new Error("can't deserialize object of type "+typeof a)}class Zl{constructor(){this.first=!0}update(i,l){const c=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=l),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=c,!0))}}const mi=a=>a>=1536&&a<=1791,So=a=>a>=1872&&a<=1919,rh=a=>a>=2208&&a<=2303,Ko=a=>a>=11904&&a<=12031,Yo=a=>a>=12032&&a<=12255,ud=a=>a>=12272&&a<=12287,Vs=a=>a>=12288&&a<=12351,ih=a=>a>=12352&&a<=12447,tu=a=>a>=12448&&a<=12543,Wl=a=>a>=12544&&a<=12591,Xl=a=>a>=12704&&a<=12735,nu=a=>a>=12736&&a<=12783,Kl=a=>a>=12784&&a<=12799,ru=a=>a>=12800&&a<=13055,Yl=a=>a>=13056&&a<=13311,Ql=a=>a>=13312&&a<=19903,iu=a=>a>=19968&&a<=40959,ll=a=>a>=40960&&a<=42127,oh=a=>a>=42128&&a<=42191,Bs=a=>a>=44032&&a<=55215,Jl=a=>a>=63744&&a<=64255,ec=a=>a>=64336&&a<=65023,hd=a=>a>=65040&&a<=65055,ri=a=>a>=65072&&a<=65103,_s=a=>a>=65104&&a<=65135,Gn=a=>a>=65136&&a<=65279,cl=a=>a>=65280&&a<=65519;function ya(a){for(const i of a)if(va(i.charCodeAt(0)))return!0;return!1}function Xf(a){for(const i of a)if(!dd(i.charCodeAt(0)))return!1;return!0}function dd(a){return!(mi(a)||So(a)||rh(a)||ec(a)||Gn(a))}function va(a){return!(746!==a&&747!==a&&(a<4352||!(Xl(a)||Wl(a)||ri(a)&&!(a>=65097&&a<=65103)||Jl(a)||Yl(a)||Ko(a)||nu(a)||!(!Vs(a)||a>=12296&&a<=12305||a>=12308&&a<=12319||12336===a)||Ql(a)||iu(a)||ru(a)||(i=a,i>=12592&&i<=12687)||(i=>i>=43360&&i<=43391)(a)||(i=>i>=55216&&i<=55295)(a)||(i=>i>=4352&&i<=4607)(a)||Bs(a)||ih(a)||ud(a)||(i=>i>=12688&&i<=12703)(a)||Yo(a)||Kl(a)||tu(a)&&12540!==a||!(!cl(a)||65288===a||65289===a||65293===a||a>=65306&&a<=65310||65339===a||65341===a||65343===a||a>=65371&&a<=65503||65507===a||a>=65512&&a<=65519)||!(!_s(a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||(i=>i>=5120&&i<=5759)(a)||(i=>i>=6320&&i<=6399)(a)||hd(a)||(i=>i>=19904&&i<=19967)(a)||ll(a)||oh(a))));var i}function fd(a){return!(va(a)||(i=a,(l=i)>=128&&l<=255&&(167===i||169===i||174===i||177===i||188===i||189===i||190===i||215===i||247===i)||(l=>l>=8192&&l<=8303)(i)&&(8214===i||8224===i||8225===i||8240===i||8241===i||8251===i||8252===i||8258===i||8263===i||8264===i||8265===i||8273===i)||(l=>l>=8448&&l<=8527)(i)||(l=>l>=8528&&l<=8591)(i)||(l=>l>=8960&&l<=9215)(i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||9003===i||i>=9085&&i<=9114||i>=9150&&i<=9165||9167===i||i>=9169&&i<=9179||i>=9186&&i<=9215)||(l=>l>=9216&&l<=9279)(i)&&9251!==i||(l=>l>=9280&&l<=9311)(i)||(l=>l>=9312&&l<=9471)(i)||(l=>l>=9632&&l<=9727)(i)||(l=>l>=9728&&l<=9983)(i)&&!(i>=9754&&i<=9759)||(l=>l>=11008&&l<=11263)(i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||Vs(i)||tu(i)||(l=>l>=57344&&l<=63743)(i)||ri(i)||_s(i)||cl(i)||8734===i||8756===i||8757===i||i>=9984&&i<=10087||i>=10102&&i<=10131||65532===i||65533===i));var i,l}function tc(a){return a>=1424&&a<=2303||ec(a)||Gn(a)}function xa(a,i){return!(!i&&tc(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||(l=a,l>=6016&&l<=6143));var l}function p(a){for(const i of a)if(tc(i.charCodeAt(0)))return!0;return!1}const o="deferred",h="loading",g="loaded";let x=null,b="unavailable",T=null;const A=function(a){a&&"string"==typeof a&&a.indexOf("NetworkError")>-1&&(b="error"),x&&x(a)};function M(){F.fire(new ht("pluginStateChange",{pluginStatus:b,pluginURL:T}))}const F=new It,L=function(){return b},B=function(){if(b!==o||!T)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");b=h,M(),T&&O({url:T},a=>{a?A(a):(b=g,M())})},U={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>b===g||null!=U.applyArabicShaping,isLoading:()=>b===h,setState(a){b=a.pluginStatus,T=a.pluginURL},isParsed:()=>null!=U.applyArabicShaping&&null!=U.processBidirectionalText&&null!=U.processStyledBidirectionalText,getPluginURL:()=>T};class ${constructor(i,l){this.zoom=i,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.zoomHistory=l.zoomHistory,this.transition=l.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Zl,this.transition={})}isSupportedScript(i){return function(l,c){for(const f of l)if(!xa(f.charCodeAt(0),c))return!1;return!0}(i,U.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const i=this.zoom,l=i-Math.floor(i),c=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*l}}}class K{constructor(i,l){this.property=i,this.value=l,this.expression=function(c,f){if(qu(c))return new Xc(c,f);if(Xo(c)){const _=Wu(c,f);if("error"===_.result)throw new Error(_.value.map(y=>`${y.key}: ${y.message}`).join(", "));return _.value}{let _=c;return"string"==typeof c&&"color"===f.type&&(_=Gt.parse(c)),{kind:"constant",evaluate:()=>_}}}(void 0===l?i.specification.default:l,i.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(i,l,c){return this.property.possiblyEvaluate(this,i,l,c)}}class Y{constructor(i){this.property=i,this.value=new K(i,void 0)}transitioned(i,l){return new Z(this.property,this.value,l,pt({},i.transition,this.transition),i.now)}untransitioned(){return new Z(this.property,this.value,null,{},0)}}class le{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return Pt(this._values[i].value.value)}setValue(i,l){this._values.hasOwnProperty(i)||(this._values[i]=new Y(this._values[i].property)),this._values[i].value=new K(this._values[i].property,null===l?void 0:Pt(l))}getTransition(i){return Pt(this._values[i].transition)}setTransition(i,l){this._values.hasOwnProperty(i)||(this._values[i]=new Y(this._values[i].property)),this._values[i].transition=Pt(l)||void 0}serialize(){const i={};for(const l of Object.keys(this._values)){const c=this.getValue(l);void 0!==c&&(i[l]=c);const f=this.getTransition(l);void 0!==f&&(i[`${l}-transition`]=f)}return i}transitioned(i,l){const c=new Q(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].transitioned(i,l._values[f]);return c}untransitioned(){const i=new Q(this._properties);for(const l of Object.keys(this._values))i._values[l]=this._values[l].untransitioned();return i}}class Z{constructor(i,l,c,f,_){const y=f.delay||0,w=f.duration||0;_=_||0,this.property=i,this.value=l,this.begin=_+y,this.end=this.begin+w,i.specification.transition&&(f.delay||f.duration)&&(this.prior=c)}possiblyEvaluate(i,l,c){const f=i.now||0,_=this.value.possiblyEvaluate(i,l,c),y=this.prior;if(y){if(f>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(f<this.begin)return y.possiblyEvaluate(i,l,c);{const w=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(i,l,c),_,Le(w))}}return _}}class Q{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,l,c){const f=new ge(this._properties);for(const _ of Object.keys(this._values))f._values[_]=this._values[_].possiblyEvaluate(i,l,c);return f}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class ae{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}getValue(i){return Pt(this._values[i].value)}setValue(i,l){this._values[i]=new K(this._values[i].property,null===l?void 0:Pt(l))}serialize(){const i={};for(const l of Object.keys(this._values)){const c=this.getValue(l);void 0!==c&&(i[l]=c)}return i}possiblyEvaluate(i,l,c){const f=new ge(this._properties);for(const _ of Object.keys(this._values))f._values[_]=this._values[_].possiblyEvaluate(i,l,c);return f}}class he{constructor(i,l,c){this.property=i,this.value=l,this.parameters=c}isConstant(){return"constant"===this.value.kind}constantOr(i){return"constant"===this.value.kind?this.value.value:i}evaluate(i,l,c,f){return this.property.evaluate(this.value,this.parameters,i,l,c,f)}}class ge{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class J{constructor(i){this.specification=i}possiblyEvaluate(i,l){return i.expression.evaluate(l)}interpolate(i,l,c){const f=fi[this.specification.type];return f?f(i,l,c):i}}class we{constructor(i,l){this.specification=i,this.overrides=l}possiblyEvaluate(i,l,c,f){return new he(this,"constant"===i.expression.kind||"camera"===i.expression.kind?{kind:"constant",value:i.expression.evaluate(l,null,{},c,f)}:i.expression,l)}interpolate(i,l,c){if("constant"!==i.value.kind||"constant"!==l.value.kind)return i;if(void 0===i.value.value||void 0===l.value.value)return new he(this,{kind:"constant",value:void 0},i.parameters);const f=fi[this.specification.type];return f?new he(this,{kind:"constant",value:f(i.value.value,l.value.value,c)},i.parameters):i}evaluate(i,l,c,f,_,y){return"constant"===i.kind?i.value:i.evaluate(l,c,f,_,y)}}class $e extends we{possiblyEvaluate(i,l,c,f){if(void 0===i.value)return new he(this,{kind:"constant",value:void 0},l);if("constant"===i.expression.kind){const _=i.expression.evaluate(l,null,{},c,f),y="resolvedImage"===i.property.specification.type&&"string"!=typeof _?_.name:_,w=this._calculate(y,y,y,l);return new he(this,{kind:"constant",value:w},l)}if("camera"===i.expression.kind){const _=this._calculate(i.expression.evaluate({zoom:l.zoom-1}),i.expression.evaluate({zoom:l.zoom}),i.expression.evaluate({zoom:l.zoom+1}),l);return new he(this,{kind:"constant",value:_},l)}return new he(this,i.expression,l)}evaluate(i,l,c,f,_,y){if("source"===i.kind){const w=i.evaluate(l,c,f,_,y);return this._calculate(w,w,w,l)}return"composite"===i.kind?this._calculate(i.evaluate({zoom:Math.floor(l.zoom)-1},c,f),i.evaluate({zoom:Math.floor(l.zoom)},c,f),i.evaluate({zoom:Math.floor(l.zoom)+1},c,f),l):i.value}_calculate(i,l,c,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:i,to:l,other:c}:{from:c,to:l,other:i}}interpolate(i){return i}}class Xe{constructor(i){this.specification=i}possiblyEvaluate(i,l,c,f){if(void 0!==i.value){if("constant"===i.expression.kind){const _=i.expression.evaluate(l,null,{},c,f);return this._calculate(_,_,_,l)}return this._calculate(i.expression.evaluate(new $(Math.floor(l.zoom-1),l)),i.expression.evaluate(new $(Math.floor(l.zoom),l)),i.expression.evaluate(new $(Math.floor(l.zoom+1),l)),l)}}_calculate(i,l,c,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:i,to:l}:{from:c,to:l}}interpolate(i){return i}}class ve{constructor(i){this.specification=i}possiblyEvaluate(i,l,c,f){return!!i.expression.evaluate(l,null,{},c,f)}interpolate(){return!1}}class Ne{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const l in i){const c=i[l];c.specification.overridable&&this.overridableProperties.push(l);const f=this.defaultPropertyValues[l]=new K(c,void 0),_=this.defaultTransitionablePropertyValues[l]=new Y(c);this.defaultTransitioningPropertyValues[l]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=f.possiblyEvaluate({})}}}function mt(a,i){return 256*(a=Oe(Math.floor(a),0,255))+Oe(Math.floor(i),0,255)}yt("DataDrivenProperty",we),yt("DataConstantProperty",J),yt("CrossFadedDataDrivenProperty",$e),yt("CrossFadedProperty",Xe),yt("ColorRampProperty",ve);const vt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class gt{constructor(i,l){this._structArray=i,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class nt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,l){return i._trim(),l&&(i.isTransferred=!0,l.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const l=Object.create(this.prototype);return l.arrayBuffer=i.arrayBuffer,l.length=i.length,l.capacity=i.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function bt(a,i=1){let l=0,c=0;return{members:a.map(f=>{const _=vt[f.type].BYTES_PER_ELEMENT,y=l=Xt(l,Math.max(i,_)),w=f.components||1;return c=Math.max(c,_),l+=_*w,{name:f.name,type:f.type,components:w,offset:y}}),size:Xt(l,Math.max(c,i)),alignment:i}}function Xt(a,i){return Math.ceil(a/i)*i}class zt extends nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l){const c=this.length;return this.resize(c+1),this.emplace(c,i,l)}emplace(i,l,c){const f=2*i;return this.int16[f+0]=l,this.int16[f+1]=c,i}}zt.prototype.bytesPerElement=4,yt("StructArrayLayout2i4",zt);class gr extends nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,c,f){const _=this.length;return this.resize(_+1),this.emplace(_,i,l,c,f)}emplace(i,l,c,f,_){const y=4*i;return this.int16[y+0]=l,this.int16[y+1]=c,this.int16[y+2]=f,this.int16[y+3]=_,i}}gr.prototype.bytesPerElement=8,yt("StructArrayLayout4i8",gr);class Yn extends nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,c,f,_,y,w){const C=this.length;return this.resize(C+1),this.emplace(C,i,l,c,f,_,y,w)}emplace(i,l,c,f,_,y,w,C){const D=6*i,I=12*i,R=3*i;return this.int16[D+0]=l,this.int16[D+1]=c,this.uint8[I+4]=f,this.uint8[I+5]=_,this.uint8[I+6]=y,this.uint8[I+7]=w,this.float32[R+2]=C,i}}Yn.prototype.bytesPerElement=12,yt("StructArrayLayout2i4ub1f12",Yn);class Zt extends nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,c){const f=this.length;return this.resize(f+1),this.emplace(f,i,l,c)}emplace(i,l,c,f){const _=3*i;return this.float32[_+0]=l,this.float32[_+1]=c,this.float32[_+2]=f,i}}Zt.prototype.bytesPerElement=12,yt("StructArrayLayout3f12",Zt);class nn extends nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,c,f,_,y,w,C,D,I){const R=this.length;return this.resize(R+1),this.emplace(R,i,l,c,f,_,y,w,C,D,I)}emplace(i,l,c,f,_,y,w,C,D,I,R){const k=10*i;return this.uint16[k+0]=l,this.uint16[k+1]=c,this.uint16[k+2]=f,this.uint16[k+3]=_,this.uint16[k+4]=y,this.uint16[k+5]=w,this.uint16[k+6]=C,this.uint16[k+7]=D,this.uint16[k+8]=I,this.uint16[k+9]=R,i}}nn.prototype.bytesPerElement=20,yt("StructArrayLayout10ui20",nn);class tr extends nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,c,f,_,y,w,C){const D=this.length;return this.resize(D+1),this.emplace(D,i,l,c,f,_,y,w,C)}emplace(i,l,c,f,_,y,w,C,D){const I=8*i;return this.uint16[I+0]=l,this.uint16[I+1]=c,this.uint16[I+2]=f,this.uint16[I+3]=_,this.uint16[I+4]=y,this.uint16[I+5]=w,this.uint16[I+6]=C,this.uint16[I+7]=D,i}}tr.prototype.bytesPerElement=16,yt("StructArrayLayout8ui16",tr);class ao extends nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,c,f,_,y,w,C,D,I,R,k,N,H,q,te){const de=this.length;return this.resize(de+1),this.emplace(de,i,l,c,f,_,y,w,C,D,I,R,k,N,H,q,te)}emplace(i,l,c,f,_,y,w,C,D,I,R,k,N,H,q,te,de){const _e=16*i;return this.int16[_e+0]=l,this.int16[_e+1]=c,this.int16[_e+2]=f,this.int16[_e+3]=_,this.uint16[_e+4]=y,this.uint16[_e+5]=w,this.uint16[_e+6]=C,this.uint16[_e+7]=D,this.int16[_e+8]=I,this.int16[_e+9]=R,this.int16[_e+10]=k,this.int16[_e+11]=N,this.int16[_e+12]=H,this.int16[_e+13]=q,this.int16[_e+14]=te,this.int16[_e+15]=de,i}}ao.prototype.bytesPerElement=32,yt("StructArrayLayout4i4ui4i4i32",ao);class Qo extends nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint32[1*i+0]=l,i}}Qo.prototype.bytesPerElement=4,yt("StructArrayLayout1ul4",Qo);class zr extends nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,c,f,_,y,w,C,D,I,R,k,N){const H=this.length;return this.resize(H+1),this.emplace(H,i,l,c,f,_,y,w,C,D,I,R,k,N)}emplace(i,l,c,f,_,y,w,C,D,I,R,k,N,H){const q=20*i,te=10*i;return this.int16[q+0]=l,this.int16[q+1]=c,this.int16[q+2]=f,this.int16[q+3]=_,this.int16[q+4]=y,this.float32[te+3]=w,this.float32[te+4]=C,this.float32[te+5]=D,this.float32[te+6]=I,this.int16[q+14]=R,this.uint32[te+8]=k,this.uint16[q+18]=N,this.uint16[q+19]=H,i}}zr.prototype.bytesPerElement=40,yt("StructArrayLayout5i4f1i1ul2ui40",zr);class Zr extends nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,c,f,_,y,w){const C=this.length;return this.resize(C+1),this.emplace(C,i,l,c,f,_,y,w)}emplace(i,l,c,f,_,y,w,C){const D=8*i;return this.int16[D+0]=l,this.int16[D+1]=c,this.int16[D+2]=f,this.int16[D+4]=_,this.int16[D+5]=y,this.int16[D+6]=w,this.int16[D+7]=C,i}}Zr.prototype.bytesPerElement=16,yt("StructArrayLayout3i2i2i16",Zr);class Jo extends nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,c,f,_){const y=this.length;return this.resize(y+1),this.emplace(y,i,l,c,f,_)}emplace(i,l,c,f,_,y){const w=4*i,C=8*i;return this.float32[w+0]=l,this.float32[w+1]=c,this.float32[w+2]=f,this.int16[C+6]=_,this.int16[C+7]=y,i}}Jo.prototype.bytesPerElement=16,yt("StructArrayLayout2f1f2i16",Jo);class es extends nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,c,f){const _=this.length;return this.resize(_+1),this.emplace(_,i,l,c,f)}emplace(i,l,c,f,_){const y=12*i,w=3*i;return this.uint8[y+0]=l,this.uint8[y+1]=c,this.float32[w+1]=f,this.float32[w+2]=_,i}}es.prototype.bytesPerElement=12,yt("StructArrayLayout2ub2f12",es);class Vn extends nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,c){const f=this.length;return this.resize(f+1),this.emplace(f,i,l,c)}emplace(i,l,c,f){const _=3*i;return this.uint16[_+0]=l,this.uint16[_+1]=c,this.uint16[_+2]=f,i}}Vn.prototype.bytesPerElement=6,yt("StructArrayLayout3ui6",Vn);class qn extends nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,l,c,f,_,y,w,C,D,I,R,k,N,H,q,te,de,_e,Se,Ie,Me){const ke=this.length;return this.resize(ke+1),this.emplace(ke,i,l,c,f,_,y,w,C,D,I,R,k,N,H,q,te,de,_e,Se,Ie,Me)}emplace(i,l,c,f,_,y,w,C,D,I,R,k,N,H,q,te,de,_e,Se,Ie,Me,ke){const He=30*i,Je=15*i,Qe=60*i;return this.int16[He+0]=l,this.int16[He+1]=c,this.int16[He+2]=f,this.float32[Je+2]=_,this.float32[Je+3]=y,this.uint16[He+8]=w,this.uint16[He+9]=C,this.uint32[Je+5]=D,this.uint32[Je+6]=I,this.uint32[Je+7]=R,this.uint16[He+16]=k,this.uint16[He+17]=N,this.uint16[He+18]=H,this.float32[Je+10]=q,this.float32[Je+11]=te,this.uint8[Qe+48]=de,this.uint8[Qe+49]=_e,this.uint8[Qe+50]=Se,this.uint32[Je+13]=Ie,this.int16[He+28]=Me,this.uint8[Qe+58]=ke,i}}qn.prototype.bytesPerElement=60,yt("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",qn);class en extends nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,l,c,f,_,y,w,C,D,I,R,k,N,H,q,te,de,_e,Se,Ie,Me,ke,He,Je,Qe,st,Ze,Ye,dt,We){const Vt=this.length;return this.resize(Vt+1),this.emplace(Vt,i,l,c,f,_,y,w,C,D,I,R,k,N,H,q,te,de,_e,Se,Ie,Me,ke,He,Je,Qe,st,Ze,Ye,dt,We)}emplace(i,l,c,f,_,y,w,C,D,I,R,k,N,H,q,te,de,_e,Se,Ie,Me,ke,He,Je,Qe,st,Ze,Ye,dt,We,Vt){const xt=38*i,An=19*i;return this.int16[xt+0]=l,this.int16[xt+1]=c,this.int16[xt+2]=f,this.float32[An+2]=_,this.float32[An+3]=y,this.int16[xt+8]=w,this.int16[xt+9]=C,this.int16[xt+10]=D,this.int16[xt+11]=I,this.int16[xt+12]=R,this.int16[xt+13]=k,this.uint16[xt+14]=N,this.uint16[xt+15]=H,this.uint16[xt+16]=q,this.uint16[xt+17]=te,this.uint16[xt+18]=de,this.uint16[xt+19]=_e,this.uint16[xt+20]=Se,this.uint16[xt+21]=Ie,this.uint16[xt+22]=Me,this.uint16[xt+23]=ke,this.uint16[xt+24]=He,this.uint16[xt+25]=Je,this.uint16[xt+26]=Qe,this.uint16[xt+27]=st,this.uint16[xt+28]=Ze,this.uint32[An+15]=Ye,this.float32[An+16]=dt,this.float32[An+17]=We,this.float32[An+18]=Vt,i}}en.prototype.bytesPerElement=76,yt("StructArrayLayout3i2f6i15ui1ul3f76",en);class or extends nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.float32[1*i+0]=l,i}}or.prototype.bytesPerElement=4,yt("StructArrayLayout1f4",or);class Wr extends nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,c){const f=this.length;return this.resize(f+1),this.emplace(f,i,l,c)}emplace(i,l,c,f){const _=3*i;return this.int16[_+0]=l,this.int16[_+1]=c,this.int16[_+2]=f,i}}Wr.prototype.bytesPerElement=6,yt("StructArrayLayout3i6",Wr);class Rn extends nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,c,f){const _=this.length;return this.resize(_+1),this.emplace(_,i,l,c,f)}emplace(i,l,c,f,_){const y=6*i;return this.uint32[3*i+0]=l,this.uint16[y+2]=c,this.uint16[y+3]=f,this.uint16[y+4]=_,i}}Rn.prototype.bytesPerElement=12,yt("StructArrayLayout1ul3ui12",Rn);class vr extends nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l){const c=this.length;return this.resize(c+1),this.emplace(c,i,l)}emplace(i,l,c){const f=2*i;return this.uint16[f+0]=l,this.uint16[f+1]=c,i}}vr.prototype.bytesPerElement=4,yt("StructArrayLayout2ui4",vr);class ii extends nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint16[1*i+0]=l,i}}ii.prototype.bytesPerElement=2,yt("StructArrayLayout1ui2",ii);class zi extends nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,c,f,_){const y=this.length;return this.resize(y+1),this.emplace(y,i,l,c,f,_)}emplace(i,l,c,f,_,y){const w=5*i;return this.float32[w+0]=l,this.float32[w+1]=c,this.float32[w+2]=f,this.float32[w+3]=_,this.float32[w+4]=y,i}}zi.prototype.bytesPerElement=20,yt("StructArrayLayout5f20",zi);class ul extends nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l){const c=this.length;return this.resize(c+1),this.emplace(c,i,l)}emplace(i,l,c){const f=2*i;return this.float32[f+0]=l,this.float32[f+1]=c,i}}ul.prototype.bytesPerElement=8,yt("StructArrayLayout2f8",ul);class ys extends nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,c,f){const _=this.length;return this.resize(_+1),this.emplace(_,i,l,c,f)}emplace(i,l,c,f,_){const y=4*i;return this.float32[y+0]=l,this.float32[y+1]=c,this.float32[y+2]=f,this.float32[y+3]=_,i}}ys.prototype.bytesPerElement=16,yt("StructArrayLayout4f16",ys);class sh extends gt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}sh.prototype.size=40;class hl extends zr{get(i){return new sh(this,i)}}yt("CollisionBoxArray",hl);class pd extends gt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(i){this._structArray.uint8[this._pos1+49]=i}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(i){this._structArray.uint8[this._pos1+50]=i}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(i){this._structArray.uint32[this._pos4+13]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(i){this._structArray.uint8[this._pos1+58]=i}}pd.prototype.size=60;class ou extends qn{get(i){return new pd(this,i)}}yt("PlacedSymbolArray",ou);class su extends gt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(i){this._structArray.uint32[this._pos4+15]=i}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}su.prototype.size=76;class un extends en{get(i){return new su(this,i)}}yt("SymbolInstanceArray",un);class Km extends or{getoffsetX(i){return this.float32[1*i+0]}}yt("GlyphOffsetArray",Km);class Kf extends Wr{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}yt("SymbolLineVertexArray",Kf);class jy extends gt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}jy.prototype.size=12;class $y extends Rn{get(i){return new jy(this,i)}}yt("FeatureIndexArray",$y);class Hy extends gt{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Hy.prototype.size=4;class Gy extends vr{get(i){return new Hy(this,i)}}yt("FillExtrusionCentroidArray",Gy);const nb=bt([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),rb=bt([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var qy=hs(function(a){a.exports=function(i,l){var c,f,_,y,w,C,D,I;for(f=i.length-(c=3&i.length),_=l,w=3432918353,C=461845907,I=0;I<f;)D=255&i.charCodeAt(I)|(255&i.charCodeAt(++I))<<8|(255&i.charCodeAt(++I))<<16|(255&i.charCodeAt(++I))<<24,++I,_=27492+(65535&(y=5*(65535&(_=(_^=D=(65535&(D=(D=(65535&D)*w+(((D>>>16)*w&65535)<<16)&4294967295)<<15|D>>>17))*C+(((D>>>16)*C&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(D=0,c){case 3:D^=(255&i.charCodeAt(I+2))<<16;case 2:D^=(255&i.charCodeAt(I+1))<<8;case 1:_^=D=(65535&(D=(D=(65535&(D^=255&i.charCodeAt(I)))*w+(((D>>>16)*w&65535)<<16)&4294967295)<<15|D>>>17))*C+(((D>>>16)*C&65535)<<16)&4294967295}return _^=i.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}}),ib=hs(function(a){a.exports=function(i,l){for(var c,f=i.length,_=l^f,y=0;f>=4;)c=1540483477*(65535&(c=255&i.charCodeAt(y)|(255&i.charCodeAt(++y))<<8|(255&i.charCodeAt(++y))<<16|(255&i.charCodeAt(++y))<<24))+((1540483477*(c>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),f-=4,++y;switch(f){case 3:_^=(255&i.charCodeAt(y+2))<<16;case 2:_^=(255&i.charCodeAt(y+1))<<8;case 1:_=1540483477*(65535&(_^=255&i.charCodeAt(y)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}}),md=qy,ah=ib;md.murmur3=qy,md.murmur2=ah;class Yf{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,l,c,f){this.ids.push(Xr(i)),this.positions.push(l,c,f)}getPositions(i){const l=Xr(i);let c=0,f=this.ids.length-1;for(;c<f;){const y=c+f>>1;this.ids[y]>=l?f=y:c=y+1}const _=[];for(;this.ids[c]===l;)_.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return _}static serialize(i,l){const c=new Float64Array(i.ids),f=new Uint32Array(i.positions);return au(c,f,0,c.length-1),l&&l.push(c.buffer,f.buffer),{ids:c,positions:f}}static deserialize(i){const l=new Yf;return l.ids=i.ids,l.positions=i.positions,l.indexed=!0,l}}function Xr(a){const i=+a;return!isNaN(i)&&i<=Ct?i:md(String(a))}function au(a,i,l,c){for(;l<c;){const f=a[l+c>>1];let _=l-1,y=c+1;for(;;){do{_++}while(a[_]<f);do{y--}while(a[y]>f);if(_>=y)break;nc(a,_,y),nc(i,3*_,3*y),nc(i,3*_+1,3*y+1),nc(i,3*_+2,3*y+2)}y-l<c-y?(au(a,i,l,y),l=y+1):(au(a,i,y+1,c),c=y)}}function nc(a,i,l){const c=a[i];a[i]=a[l],a[l]=c}yt("FeaturePositionMap",Yf);class rc{constructor(i,l){this.gl=i.gl,this.location=l}}class gd extends rc{constructor(i,l){super(i,l),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class Ao extends rc{constructor(i,l){super(i,l),this.current=[0,0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class vs extends rc{constructor(i,l){super(i,l),this.current=Gt.transparent}set(i){i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}const _d=new Float32Array(16),ic=new Float32Array(9);function Us(a){return[mt(255*a.r,255*a.g),mt(255*a.b,255*a.a)]}class lu{constructor(i,l,c){this.value=i,this.uniformNames=l.map(f=>`u_${f}`),this.type=c}setUniform(i,l,c){i.set(c.constantOr(this.value))}getBinding(i,l,c){return"color"===this.type?new vs(i,l):new gd(i,l)}}class cu{constructor(i,l){this.uniformNames=l.map(c=>`u_${c}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,l){this.pixelRatioFrom=l.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=l.tl.concat(l.br),this.patternTo=i.tl.concat(i.br)}setUniform(i,l,c,f){const _="u_pattern_to"===f||"u_dash_to"===f?this.patternTo:"u_pattern_from"===f||"u_dash_from"===f?this.patternFrom:"u_pixel_ratio_to"===f?this.pixelRatioTo:"u_pixel_ratio_from"===f?this.pixelRatioFrom:null;_&&i.set(_)}getBinding(i,l,c){return"u_pattern_from"===c||"u_pattern_to"===c||"u_dash_from"===c||"u_dash_to"===c?new Ao(i,l):new gd(i,l)}}class ba{constructor(i,l,c,f){this.expression=i,this.type=c,this.maxValue=0,this.paintVertexAttributes=l.map(_=>({name:`a_${_}`,type:"Float32",components:"color"===c?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(i,l,c,f,_){const y=this.paintVertexArray.length,w=this.expression.evaluate(new $(0),l,{},f,[],_);this.paintVertexArray.resize(i),this._setPaintValue(y,i,w)}updatePaintArray(i,l,c,f){const _=this.expression.evaluate({zoom:0},c,f);this._setPaintValue(i,l,_)}_setPaintValue(i,l,c){if("color"===this.type){const f=Us(c);for(let _=i;_<l;_++)this.paintVertexArray.emplace(_,f[0],f[1])}else{for(let f=i;f<l;f++)this.paintVertexArray.emplace(f,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class js{constructor(i,l,c,f,_,y){this.expression=i,this.uniformNames=l.map(w=>`u_${w}_t`),this.type=c,this.useIntegerZoom=f,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=l.map(w=>({name:`a_${w}`,type:"Float32",components:"color"===c?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(i,l,c,f,_){const y=this.expression.evaluate(new $(this.zoom),l,{},f,[],_),w=this.expression.evaluate(new $(this.zoom+1),l,{},f,[],_),C=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(C,i,y,w)}updatePaintArray(i,l,c,f){const _=this.expression.evaluate({zoom:this.zoom},c,f),y=this.expression.evaluate({zoom:this.zoom+1},c,f);this._setPaintValue(i,l,_,y)}_setPaintValue(i,l,c,f){if("color"===this.type){const _=Us(c),y=Us(f);for(let w=i;w<l;w++)this.paintVertexArray.emplace(w,_[0],_[1],y[0],y[1])}else{for(let _=i;_<l;_++)this.paintVertexArray.emplace(_,c,f);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(f))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,l){const c=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,f=Oe(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);i.set(f)}getBinding(i,l,c){return new gd(i,l)}}class oc{constructor(i,l,c,f,_,y,w){this.expression=i,this.type=c,this.useIntegerZoom=f,this.zoom=_,this.layerId=w,this.paintVertexAttributes=("array"===c?rb:nb).members;for(let C=0;C<l.length;++C);this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(i,l,c){const f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(f,i,l.patterns&&l.patterns[this.layerId],c)}updatePaintArray(i,l,c,f,_){this._setPaintValues(i,l,c.patterns&&c.patterns[this.layerId],_)}_setPaintValues(i,l,c,f){if(!f||!c)return;const{min:_,mid:y,max:w}=c,C=f[_],D=f[y],I=f[w];if(C&&D&&I)for(let R=i;R<l;R++)this._setPaintValue(this.zoomInPaintVertexArray,R,D,C),this._setPaintValue(this.zoomOutPaintVertexArray,R,D,I)}_setPaintValue(i,l,c,f){i.emplace(l,c.tl[0],c.tl[1],c.br[0],c.br[1],f.tl[0],f.tl[1],f.br[0],f.br[1],c.pixelRatio,f.pixelRatio)}upload(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class $s{constructor(i,l,c=(()=>!0)){this.binders={},this._buffers=[];const f=[];for(const _ in i.paint._values){if(!c(_))continue;const y=i.paint.get(_);if(!(y instanceof he&&tl(y.property.specification)))continue;const w=uu(_,i.type),C=y.value,D=y.property.specification.type,I=y.property.useIntegerZoom,R=y.property.specification["property-type"],k="cross-faded"===R||"cross-faded-data-driven"===R,N="line-dasharray"===String(_)&&"constant"!==i.layout.get("line-cap").value.kind;if("constant"!==C.kind||N)if("source"===C.kind||N||k){const H=Qm(_,D,"source");this.binders[_]=k?new oc(C,w,D,I,l,H,i.id):new ba(C,w,D,H),f.push(`/a_${_}`)}else{const H=Qm(_,D,"composite");this.binders[_]=new js(C,w,D,I,l,H),f.push(`/z_${_}`)}else this.binders[_]=k?new cu(C.value,w):new lu(C.value,w,D),f.push(`/u_${_}`)}this.cacheKey=f.sort().join("")}getMaxValue(i){const l=this.binders[i];return l instanceof ba||l instanceof js?l.maxValue:0}populatePaintArrays(i,l,c,f,_){for(const y in this.binders){const w=this.binders[y];(w instanceof ba||w instanceof js||w instanceof oc)&&w.populatePaintArray(i,l,c,f,_)}}setConstantPatternPositions(i,l){for(const c in this.binders){const f=this.binders[c];f instanceof cu&&f.setConstantPatternPositions(i,l)}}updatePaintArrays(i,l,c,f,_){let y=!1;for(const w in i){const C=l.getPositions(w);for(const D of C){const I=c.feature(D.index);for(const R in this.binders){const k=this.binders[R];if((k instanceof ba||k instanceof js||k instanceof oc)&&!0===k.expression.isStateDependent){const N=f.paint.get(R);k.expression=N.value,k.updatePaintArray(D.start,D.end,I,i[w],_),y=!0}}}}return y}defines(){const i=[];for(const l in this.binders){const c=this.binders[l];(c instanceof lu||c instanceof cu)&&i.push(...c.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return i}getBinderAttributes(){const i=[];for(const l in this.binders){const c=this.binders[l];if(c instanceof ba||c instanceof js||c instanceof oc)for(let f=0;f<c.paintVertexAttributes.length;f++)i.push(c.paintVertexAttributes[f].name)}return i}getBinderUniforms(){const i=[];for(const l in this.binders){const c=this.binders[l];if(c instanceof lu||c instanceof cu||c instanceof js)for(const f of c.uniformNames)i.push(f)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i,l){const c=[];for(const f in this.binders){const _=this.binders[f];if(_ instanceof lu||_ instanceof cu||_ instanceof js)for(const y of _.uniformNames)if(l[y]){const w=_.getBinding(i,l[y],y);c.push({name:y,property:f,binding:w})}}return c}setUniforms(i,l,c,f){for(const{name:_,property:y,binding:w}of l)this.binders[y].setUniform(w,f,c.get(y),_)}updatePaintBuffers(i){this._buffers=[];for(const l in this.binders){const c=this.binders[l];if(i&&c instanceof oc){const f=2===i.fromScale?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(c instanceof ba||c instanceof js)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}}upload(i){for(const l in this.binders){const c=this.binders[l];(c instanceof ba||c instanceof js||c instanceof oc)&&c.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const l=this.binders[i];(l instanceof ba||l instanceof js||l instanceof oc)&&l.destroy()}}}class oi{constructor(i,l,c=(()=>!0)){this.programConfigurations={};for(const f of i)this.programConfigurations[f.id]=new $s(f,l,c);this.needsUpload=!1,this._featureMap=new Yf,this._bufferOffset=0}populatePaintArrays(i,l,c,f,_,y){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(i,l,f,_,y);void 0!==l.id&&this._featureMap.add(l.id,c,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,l,c,f){for(const _ of c)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(i,this._featureMap,l,_,f)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}const Qf={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function uu(a,i){return Qf[a]||[a.replace(`${i}-`,"").replace(/-/g,"_")]}const ob={"line-pattern":{source:nn,composite:nn},"fill-pattern":{source:nn,composite:nn},"fill-extrusion-pattern":{source:nn,composite:nn},"line-dasharray":{source:tr,composite:tr}},Ym={color:{source:ul,composite:ys},number:{source:or,composite:ul}};function Qm(a,i,l){const c=ob[a];return c&&c[l]||Ym[i][l]}yt("ConstantBinder",lu),yt("CrossFadedConstantBinder",cu),yt("SourceExpressionBinder",ba),yt("CrossFadedCompositeBinder",oc),yt("CompositeExpressionBinder",js),yt("ProgramConfiguration",$s,{omit:["_buffers"]}),yt("ProgramConfigurationSet",oi);const yd="-transition";class xs extends It{constructor(i,l){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==i.type&&(this.metadata=(i=i).metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,"background"!==i.type&&"sky"!==i.type&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),l.layout&&(this._unevaluatedLayout=new ae(l.layout)),l.paint)){this._transitionablePaint=new le(l.paint);for(const c in i.paint)this.setPaintProperty(c,i.paint[c],{validate:!1});for(const c in i.layout)this.setLayoutProperty(c,i.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ge(l.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return"visibility"===i?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,l,c={}){null!=l&&this._validate(tt,`layers.${this.id}.layout.${i}`,i,l,c)||("visibility"!==i?this._unevaluatedLayout.setValue(i,l):this.visibility=l)}getPaintProperty(i){return Cr(i,yd)?this._transitionablePaint.getTransition(i.slice(0,-yd.length)):this._transitionablePaint.getValue(i)}setPaintProperty(i,l,c={}){if(null!=l&&this._validate(cd,`layers.${this.id}.paint.${i}`,i,l,c))return!1;if(Cr(i,yd))return this._transitionablePaint.setTransition(i.slice(0,-yd.length),l||void 0),!1;{const f=this._transitionablePaint._values[i],_="cross-faded-data-driven"===f.property.specification["property-type"],y=f.value.isDataDriven(),w=f.value;this._transitionablePaint.setValue(i,l),this._handleSpecialPaintPropertyUpdate(i);const C=this._transitionablePaint._values[i].value;return C.isDataDriven()||y||_||this._handleOverridablePaintPropertyUpdate(i,w,C)}}_handleSpecialPaintPropertyUpdate(i){}getProgramIds(){return null}getProgramConfiguration(i){return null}_handleOverridablePaintPropertyUpdate(i,l,c){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||"none"===this.visibility}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,l){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,l)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),Pr(i,(l,c)=>!(void 0===l||"layout"===c&&!Object.keys(l).length||"paint"===c&&!Object.keys(l).length))}_validate(i,l,c,f,_={}){return(!_||!1!==_.validate)&&xn(this,i.call(ol,{key:l,layerType:this.type,objectKey:c,value:f,styleSpec:ue,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const l=this.paint.get(i);if(l instanceof he&&tl(l.property.specification)&&("source"===l.value.kind||"composite"===l.value.kind)&&l.value.isStateDependent)return!0}return!1}}const Zy=bt([{name:"a_pos",components:2,type:"Int16"}],4),{members:Wy}=Zy;class Vr{constructor(i=[]){this.segments=i}prepareSegment(i,l,c,f){let _=this.segments[this.segments.length-1];return i>Vr.MAX_VERTEX_ARRAY_LENGTH&&Qn(`Max vertices per segment is ${Vr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!_||_.vertexLength+i>Vr.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==f)&&(_={vertexOffset:l.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},void 0!==f&&(_.sortKey=f),this.segments.push(_)),_}get(){return this.segments}destroy(){for(const i of this.segments)for(const l in i.vaos)i.vaos[l].destroy()}static simpleSegment(i,l,c,f){return new Vr([{vertexOffset:i,primitiveOffset:l,vertexLength:c,primitiveLength:f,vaos:{},sortKey:0}])}}Vr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,yt("SegmentVector",Vr);var Sn=8192;const hu=Math.pow(2,14)-1,Xy=-hu-1;function bs(a){const i=Sn/a.extent,l=a.loadGeometry();for(let c=0;c<l.length;c++){const f=l[c];for(let _=0;_<f.length;_++){const y=f[_],w=Math.round(y.x*i),C=Math.round(y.y*i);y.x=Oe(w,Xy,hu),y.y=Oe(C,Xy,hu),(w<y.x||w>y.x+1||C<y.y||C>y.y+1)&&Qn("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return l}function wa(a,i){return{type:a.type,id:a.id,properties:a.properties,geometry:i?bs(a):[]}}function Ea(a,i,l,c,f){a.emplaceBack(2*i+(c+1)/2,2*l+(f+1)/2)}class Jf{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new zt,this.indexArray=new Vn,this.segments=new Vr,this.programConfigurations=new oi(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,c){const f=this.layers[0],_=[];let y=null;"circle"===f.type&&(y=f.layout.get("circle-sort-key"));for(const{feature:w,id:C,index:D,sourceLayerIndex:I}of i){const R=this.layers[0]._featureFilter.needGeometry,k=wa(w,R);if(!this.layers[0]._featureFilter.filter(new $(this.zoom),k,c))continue;const N=y?y.evaluate(k,{},c):void 0,H={id:C,properties:w.properties,type:w.type,sourceLayerIndex:I,index:D,geometry:R?k.geometry:bs(w),patterns:{},sortKey:N};_.push(H)}y&&_.sort((w,C)=>w.sortKey-C.sortKey);for(const w of _){const{geometry:C,index:D,sourceLayerIndex:I}=w,R=i[D].feature;this.addFeature(w,C,D,c),l.featureIndex.insert(R,C,D,I,this.index)}}update(i,l,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,c)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Wy),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,l,c,f){for(const _ of l)for(const y of _){const w=y.x,C=y.y;if(w<0||w>=Sn||C<0||C>=Sn)continue;const D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),I=D.vertexLength;Ea(this.layoutVertexArray,w,C,-1,-1),Ea(this.layoutVertexArray,w,C,1,-1),Ea(this.layoutVertexArray,w,C,1,1),Ea(this.layoutVertexArray,w,C,-1,1),this.indexArray.emplaceBack(I,I+1,I+2),this.indexArray.emplaceBack(I,I+3,I+2),D.vertexLength+=4,D.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,{},f)}}function Jm(a,i){for(let l=0;l<a.length;l++)if(sc(i,a[l]))return!0;for(let l=0;l<i.length;l++)if(sc(a,i[l]))return!0;return!!lh(a,i)}function Ky(a,i,l){return!!sc(a,i)||!!dl(i,a,l)}function vd(a,i){if(1===a.length)return _t(i,a[0]);for(let l=0;l<i.length;l++){const c=i[l];for(let f=0;f<c.length;f++)if(sc(a,c[f]))return!0}for(let l=0;l<a.length;l++)if(_t(i,a[l]))return!0;for(let l=0;l<i.length;l++)if(lh(a,i[l]))return!0;return!1}function sb(a,i,l){if(a.length>1){if(lh(a,i))return!0;for(let c=0;c<i.length;c++)if(dl(i[c],a,l))return!0}for(let c=0;c<a.length;c++)if(dl(a[c],i,l))return!0;return!1}function lh(a,i){if(0===a.length||0===i.length)return!1;for(let l=0;l<a.length-1;l++){const c=a[l],f=a[l+1];for(let _=0;_<i.length-1;_++)if(ch(c,f,i[_],i[_+1]))return!0}return!1}function ch(a,i,l,c){return Ti(a,l,c)!==Ti(i,l,c)&&Ti(a,i,l)!==Ti(a,i,c)}function dl(a,i,l){const c=l*l;if(1===i.length)return a.distSqr(i[0])<c;for(let f=1;f<i.length;f++)if(eg(a,i[f-1],i[f])<c)return!0;return!1}function eg(a,i,l){const c=i.distSqr(l);if(0===c)return a.distSqr(i);const f=((a.x-i.x)*(l.x-i.x)+(a.y-i.y)*(l.y-i.y))/c;return a.distSqr(f<0?i:f>1?l:l.sub(i)._mult(f)._add(i))}function _t(a,i){let l,c,f,_=!1;for(let y=0;y<a.length;y++){l=a[y];for(let w=0,C=l.length-1;w<l.length;C=w++)c=l[w],f=l[C],c.y>i.y!=f.y>i.y&&i.x<(f.x-c.x)*(i.y-c.y)/(f.y-c.y)+c.x&&(_=!_)}return _}function sc(a,i){let l=!1;for(let c=0,f=a.length-1;c<a.length;f=c++){const _=a[c],y=a[f];_.y>i.y!=y.y>i.y&&i.x<(y.x-_.x)*(i.y-_.y)/(y.y-_.y)+_.x&&(l=!l)}return l}function Yy(a,i,l,c,f){for(const y of a)if(i<=y.x&&l<=y.y&&c>=y.x&&f>=y.y)return!0;const _=[new ne(i,l),new ne(i,f),new ne(c,f),new ne(c,l)];if(a.length>2)for(const y of _)if(sc(a,y))return!0;for(let y=0;y<a.length-1;y++)if(ac(a[y],a[y+1],_))return!0;return!1}function ac(a,i,l){const c=l[0],f=l[2];if(a.x<c.x&&i.x<c.x||a.x>f.x&&i.x>f.x||a.y<c.y&&i.y<c.y||a.y>f.y&&i.y>f.y)return!1;const _=Ti(a,i,l[0]);return _!==Ti(a,i,l[1])||_!==Ti(a,i,l[2])||_!==Ti(a,i,l[3])}function Hs(a,i,l){const c=i.paint.get(a).value;return"constant"===c.kind?c.value:l.programConfigurations.get(i.id).getMaxValue(a)}function xd(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function ep(a,i,l,c,f){if(!i[0]&&!i[1])return a;const _=ne.convert(i)._mult(f);"viewport"===l&&_._rotate(-c);const y=[];for(let w=0;w<a.length;w++)y.push(a[w].sub(_));return y}function tp(a,i,l,c){const f=ne.convert(a)._mult(c);return"viewport"===i&&f._rotate(-l),f}yt("CircleBucket",Jf,{omit:["layers"]});const ab=new Ne({"circle-sort-key":new we(ue.layout_circle["circle-sort-key"])});var du={paint:new Ne({"circle-radius":new we(ue.paint_circle["circle-radius"]),"circle-color":new we(ue.paint_circle["circle-color"]),"circle-blur":new we(ue.paint_circle["circle-blur"]),"circle-opacity":new we(ue.paint_circle["circle-opacity"]),"circle-translate":new J(ue.paint_circle["circle-translate"]),"circle-translate-anchor":new J(ue.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new J(ue.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new J(ue.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new we(ue.paint_circle["circle-stroke-width"]),"circle-stroke-color":new we(ue.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new we(ue.paint_circle["circle-stroke-opacity"])}),layout:ab},sr="undefined"!=typeof Float32Array?Float32Array:Array;function uh(){var a=new sr(9);return sr!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function Gs(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function tg(a,i,l){var c=i[0],f=i[1],_=i[2],y=i[3],w=i[4],C=i[5],D=i[6],I=i[7],R=i[8],k=i[9],N=i[10],H=i[11],q=i[12],te=i[13],de=i[14],_e=i[15],Se=l[0],Ie=l[1],Me=l[2],ke=l[3];return a[0]=Se*c+Ie*w+Me*R+ke*q,a[1]=Se*f+Ie*C+Me*k+ke*te,a[2]=Se*_+Ie*D+Me*N+ke*de,a[3]=Se*y+Ie*I+Me*H+ke*_e,a[4]=(Se=l[4])*c+(Ie=l[5])*w+(Me=l[6])*R+(ke=l[7])*q,a[5]=Se*f+Ie*C+Me*k+ke*te,a[6]=Se*_+Ie*D+Me*N+ke*de,a[7]=Se*y+Ie*I+Me*H+ke*_e,a[8]=(Se=l[8])*c+(Ie=l[9])*w+(Me=l[10])*R+(ke=l[11])*q,a[9]=Se*f+Ie*C+Me*k+ke*te,a[10]=Se*_+Ie*D+Me*N+ke*de,a[11]=Se*y+Ie*I+Me*H+ke*_e,a[12]=(Se=l[12])*c+(Ie=l[13])*w+(Me=l[14])*R+(ke=l[15])*q,a[13]=Se*f+Ie*C+Me*k+ke*te,a[14]=Se*_+Ie*D+Me*N+ke*de,a[15]=Se*y+Ie*I+Me*H+ke*_e,a}Math.hypot||(Math.hypot=function(){for(var a=0,i=arguments.length;i--;)a+=arguments[i]*arguments[i];return Math.sqrt(a)});var ng=tg;function fu(){var a=new sr(3);return sr!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function hh(a){return Math.hypot(a[0],a[1],a[2])}function lc(a,i,l){var c=new sr(3);return c[0]=a,c[1]=i,c[2]=l,c}function rg(a,i,l){return a[0]=i[0]-l[0],a[1]=i[1]-l[1],a[2]=i[2]-l[2],a}function ig(a,i,l){return a[0]=i[0]*l[0],a[1]=i[1]*l[1],a[2]=i[2]*l[2],a}function cc(a,i,l,c){return a[0]=i[0]+l[0]*c,a[1]=i[1]+l[1]*c,a[2]=i[2]+l[2]*c,a}function pu(a,i){var l=i[0],c=i[1],f=i[2],_=l*l+c*c+f*f;return _>0&&(_=1/Math.sqrt(_)),a[0]=i[0]*_,a[1]=i[1]*_,a[2]=i[2]*_,a}function og(a,i,l){var c=l[0],f=l[1],_=l[2],y=i[0],w=i[1],C=i[2],D=f*C-_*w,I=_*y-c*C,R=c*w-f*y,k=f*R-_*I,N=_*D-c*R,H=c*I-f*D,q=2*l[3];return I*=q,R*=q,N*=2,H*=2,a[0]=y+(D*=q)+(k*=2),a[1]=w+I+N,a[2]=C+R+H,a}var bd,sg=rg,Qy=ig,lb=hh;function dh(a,i,l){var c=i[0],f=i[1],_=i[2],y=i[3];return a[0]=l[0]*c+l[4]*f+l[8]*_+l[12]*y,a[1]=l[1]*c+l[5]*f+l[9]*_+l[13]*y,a[2]=l[2]*c+l[6]*f+l[10]*_+l[14]*y,a[3]=l[3]*c+l[7]*f+l[11]*_+l[15]*y,a}function np(){var a=new sr(4);return sr!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function ag(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function fh(a,i,l){l*=.5;var c=i[0],f=i[1],_=i[2],y=i[3],w=Math.sin(l),C=Math.cos(l);return a[0]=c*C+y*w,a[1]=f*C+_*w,a[2]=_*C-f*w,a[3]=y*C-c*w,a}function wd(a,i,l,c,f,_,y,w,C){if(_&&a.queryGeometry.isAboveHorizon)return!1;_&&(C*=a.pixelToTileUnitsFactor);for(const D of i)for(const I of D){const R=I.add(w),k=f&&l.elevation?l.elevation.exaggeration()*f.getElevationAt(R.x,R.y,!0):0,N=_?R:mu(R,k,c),H=_?a.tilespaceRays.map(te=>cb(te,k)):a.queryGeometry.screenGeometry,q=dh([],[I.x,I.y,k,1],c);if(!y&&_?C*=q[3]/l.cameraToCenterDistance:y&&!_&&(C*=l.cameraToCenterDistance/q[3]),Ky(H,N,C))return!0}return!1}function mu(a,i,l){const c=dh([],[a.x,a.y,i,1],l);return new ne(c[0]/c[3],c[1]/c[3])}fu(),bd=new sr(4),sr!=Float32Array&&(bd[0]=0,bd[1]=0,bd[2]=0,bd[3]=0),fu(),lc(1,0,0),lc(0,1,0),np(),np(),uh();const lg=lc(0,0,0),Jy=lc(0,0,1);function cb(a,i){const l=fu();return lg[2]=i,a.intersectsPlane(lg,Jy,l),new ne(l[0],l[1])}class ph extends Jf{}function mh(a,{width:i,height:l},c,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==i*l*c)throw new RangeError("mismatched image size")}else f=new Uint8Array(i*l*c);return a.width=i,a.height=l,a.data=f,a}function rp(a,{width:i,height:l},c){if(i===a.width&&l===a.height)return;const f=mh({},{width:i,height:l},c);Ed(a,f,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,i),height:Math.min(a.height,l)},c),a.width=i,a.height=l,a.data=f.data}function Ed(a,i,l,c,f,_){if(0===f.width||0===f.height)return i;if(f.width>a.width||f.height>a.height||l.x>a.width-f.width||l.y>a.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>i.width||f.height>i.height||c.x>i.width-f.width||c.y>i.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const y=a.data,w=i.data;for(let C=0;C<f.height;C++){const D=((l.y+C)*a.width+l.x)*_,I=((c.y+C)*i.width+c.x)*_;for(let R=0;R<f.width*_;R++)w[I+R]=y[D+R]}return i}yt("HeatmapBucket",ph,{omit:["layers"]});class Ca{constructor(i,l){mh(this,i,1,l)}resize(i){rp(this,i,1)}clone(){return new Ca({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,c,f,_){Ed(i,l,c,f,_,1)}}class si{constructor(i,l){mh(this,i,4,l)}resize(i){rp(this,i,4)}replace(i,l){l?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new si({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,c,f,_){Ed(i,l,c,f,_,4)}}yt("AlphaImage",Ca),yt("RGBAImage",si);var ev={paint:new Ne({"heatmap-radius":new we(ue.paint_heatmap["heatmap-radius"]),"heatmap-weight":new we(ue.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new J(ue.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ve(ue.paint_heatmap["heatmap-color"]),"heatmap-opacity":new J(ue.paint_heatmap["heatmap-opacity"])})};function ip(a){const i={},l=a.resolution||256,c=a.clips?a.clips.length:1,f=a.image||new si({width:l,height:c}),_=(y,w,C)=>{i[a.evaluationKey]=C;const D=a.expression.evaluate(i);f.data[y+w+0]=Math.floor(255*D.r/D.a),f.data[y+w+1]=Math.floor(255*D.g/D.a),f.data[y+w+2]=Math.floor(255*D.b/D.a),f.data[y+w+3]=Math.floor(255*D.a)};if(a.clips)for(let y=0,w=0;y<c;++y,w+=4*l)for(let C=0,D=0;C<l;C++,D+=4){const I=C/(l-1),{start:R,end:k}=a.clips[y];_(w,D,R*(1-I)+k*I)}else for(let y=0,w=0;y<l;y++,w+=4)_(0,w,y/(l-1));return f}var tv={paint:new Ne({"hillshade-illumination-direction":new J(ue.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new J(ue.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new J(ue.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new J(ue.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new J(ue.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new J(ue.paint_hillshade["hillshade-accent-color"])})};const nv=bt([{name:"a_pos",components:2,type:"Int16"}],4),{members:rv}=nv;var Qi=gh,qs=gh;function gh(a,i,l){l=l||2;var c,f,_,y,w,C,D,I=i&&i.length,R=I?i[0]*l:a.length,k=cg(a,0,R,l,!0),N=[];if(!k||k.next===k.prev)return N;if(I&&(k=function(q,te,de,_e){var Se,Ie,Me,ke=[];for(Se=0,Ie=te.length;Se<Ie;Se++)(Me=cg(q,te[Se]*_e,Se<Ie-1?te[Se+1]*_e:q.length,_e,!1))===Me.next&&(Me.steiner=!0),ke.push(uv(Me));for(ke.sort(av),Se=0;Se<ke.length;Se++)lv(ke[Se],de),de=fl(de,de.next);return de}(a,i,k,l)),a.length>80*l){c=_=a[0],f=y=a[1];for(var H=l;H<R;H+=l)(w=a[H])<c&&(c=w),(C=a[H+1])<f&&(f=C),w>_&&(_=w),C>y&&(y=C);D=0!==(D=Math.max(_-c,y-f))?1/D:0}return _h(k,N,l,c,f,D),N}function cg(a,i,l,c,f){var _,y;if(f===bh(a,i,l,c)>0)for(_=i;_<l;_+=c)y=dv(_,a[_],a[_+1],y);else for(_=l-c;_>=i;_-=c)y=dv(_,a[_],a[_+1],y);return y&&pl(y,y.next)&&(uc(y),y=y.next),y}function fl(a,i){if(!a)return a;i||(i=a);var l,c=a;do{if(l=!1,c.steiner||!pl(c,c.next)&&0!==Bn(c.prev,c,c.next))c=c.next;else{if(uc(c),(c=i=c.prev)===c.next)break;l=!0}}while(l||c!==i);return i}function _h(a,i,l,c,f,_,y){if(a){!y&&_&&function(I,R,k,N){var H=I;do{null===H.z&&(H.z=hg(H.x,H.y,R,k,N)),H.prevZ=H.prev,H.nextZ=H.next,H=H.next}while(H!==I);H.prevZ.nextZ=null,H.prevZ=null,function(q){var te,de,_e,Se,Ie,Me,ke,He,Je=1;do{for(de=q,q=null,Ie=null,Me=0;de;){for(Me++,_e=de,ke=0,te=0;te<Je&&(ke++,_e=_e.nextZ);te++);for(He=Je;ke>0||He>0&&_e;)0!==ke&&(0===He||!_e||de.z<=_e.z)?(Se=de,de=de.nextZ,ke--):(Se=_e,_e=_e.nextZ,He--),Ie?Ie.nextZ=Se:q=Se,Se.prevZ=Ie,Ie=Se;de=_e}Ie.nextZ=null,Je*=2}while(Me>1)}(H)}(a,c,f,_);for(var w,C,D=a;a.prev!==a.next;)if(w=a.prev,C=a.next,_?ov(a,c,f,_):iv(a))i.push(w.i/l),i.push(a.i/l),i.push(C.i/l),uc(a),a=C.next,D=C.next;else if((a=C)===D){y?1===y?_h(a=ug(fl(a),i,l),i,l,c,f,_,2):2===y&&sv(a,i,l,c,f,_):_h(fl(a),i,l,c,f,_,1);break}}}function iv(a){var i=a.prev,l=a,c=a.next;if(Bn(i,l,c)>=0)return!1;for(var f=a.next.next;f!==a.prev;){if(Zs(i.x,i.y,l.x,l.y,c.x,c.y,f.x,f.y)&&Bn(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function ov(a,i,l,c){var f=a.prev,_=a,y=a.next;if(Bn(f,_,y)>=0)return!1;for(var w=f.x>_.x?f.x>y.x?f.x:y.x:_.x>y.x?_.x:y.x,C=f.y>_.y?f.y>y.y?f.y:y.y:_.y>y.y?_.y:y.y,D=hg(f.x<_.x?f.x<y.x?f.x:y.x:_.x<y.x?_.x:y.x,f.y<_.y?f.y<y.y?f.y:y.y:_.y<y.y?_.y:y.y,i,l,c),I=hg(w,C,i,l,c),R=a.prevZ,k=a.nextZ;R&&R.z>=D&&k&&k.z<=I;){if(R!==a.prev&&R!==a.next&&Zs(f.x,f.y,_.x,_.y,y.x,y.y,R.x,R.y)&&Bn(R.prev,R,R.next)>=0||(R=R.prevZ,k!==a.prev&&k!==a.next&&Zs(f.x,f.y,_.x,_.y,y.x,y.y,k.x,k.y)&&Bn(k.prev,k,k.next)>=0))return!1;k=k.nextZ}for(;R&&R.z>=D;){if(R!==a.prev&&R!==a.next&&Zs(f.x,f.y,_.x,_.y,y.x,y.y,R.x,R.y)&&Bn(R.prev,R,R.next)>=0)return!1;R=R.prevZ}for(;k&&k.z<=I;){if(k!==a.prev&&k!==a.next&&Zs(f.x,f.y,_.x,_.y,y.x,y.y,k.x,k.y)&&Bn(k.prev,k,k.next)>=0)return!1;k=k.nextZ}return!0}function ug(a,i,l){var c=a;do{var f=c.prev,_=c.next.next;!pl(f,_)&&op(f,c,c.next,_)&&Cd(f,_)&&Cd(_,f)&&(i.push(f.i/l),i.push(c.i/l),i.push(_.i/l),uc(c),uc(c.next),c=a=_),c=c.next}while(c!==a);return fl(c)}function sv(a,i,l,c,f,_){var y=a;do{for(var w=y.next.next;w!==y.prev;){if(y.i!==w.i&&dg(y,w)){var C=hv(y,w);return y=fl(y,y.next),C=fl(C,C.next),_h(y,i,l,c,f,_),void _h(C,i,l,c,f,_)}w=w.next}y=y.next}while(y!==a)}function av(a,i){return a.x-i.x}function lv(a,i){if(i=function(c,f){var _,y=f,w=c.x,C=c.y,D=-1/0;do{if(C<=y.y&&C>=y.next.y&&y.next.y!==y.y){var I=y.x+(C-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(I<=w&&I>D){if(D=I,I===w){if(C===y.y)return y;if(C===y.next.y)return y.next}_=y.x<y.next.x?y:y.next}}y=y.next}while(y!==f);if(!_)return null;if(w===D)return _;var R,k=_,N=_.x,H=_.y,q=1/0;y=_;do{w>=y.x&&y.x>=N&&w!==y.x&&Zs(C<H?w:D,C,N,H,C<H?D:w,C,y.x,y.y)&&(R=Math.abs(C-y.y)/(w-y.x),Cd(y,c)&&(R<q||R===q&&(y.x>_.x||y.x===_.x&&cv(_,y)))&&(_=y,q=R)),y=y.next}while(y!==k);return _}(a,i)){var l=hv(i,a);fl(i,i.next),fl(l,l.next)}}function cv(a,i){return Bn(a.prev,a,i.prev)<0&&Bn(i.next,a,a.next)<0}function hg(a,i,l,c,f){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-l)*f)|a<<8))|a<<4))|a<<2))|a<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-c)*f)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function uv(a){var i=a,l=a;do{(i.x<l.x||i.x===l.x&&i.y<l.y)&&(l=i),i=i.next}while(i!==a);return l}function Zs(a,i,l,c,f,_,y,w){return(f-y)*(i-w)-(a-y)*(_-w)>=0&&(a-y)*(c-w)-(l-y)*(i-w)>=0&&(l-y)*(_-w)-(f-y)*(c-w)>=0}function dg(a,i){return a.next.i!==i.i&&a.prev.i!==i.i&&!function(l,c){var f=l;do{if(f.i!==l.i&&f.next.i!==l.i&&f.i!==c.i&&f.next.i!==c.i&&op(f,f.next,l,c))return!0;f=f.next}while(f!==l);return!1}(a,i)&&(Cd(a,i)&&Cd(i,a)&&function(l,c){var f=l,_=!1,y=(l.x+c.x)/2,w=(l.y+c.y)/2;do{f.y>w!=f.next.y>w&&f.next.y!==f.y&&y<(f.next.x-f.x)*(w-f.y)/(f.next.y-f.y)+f.x&&(_=!_),f=f.next}while(f!==l);return _}(a,i)&&(Bn(a.prev,a,i.prev)||Bn(a,i.prev,i))||pl(a,i)&&Bn(a.prev,a,a.next)>0&&Bn(i.prev,i,i.next)>0)}function Bn(a,i,l){return(i.y-a.y)*(l.x-i.x)-(i.x-a.x)*(l.y-i.y)}function pl(a,i){return a.x===i.x&&a.y===i.y}function op(a,i,l,c){var f=vh(Bn(a,i,l)),_=vh(Bn(a,i,c)),y=vh(Bn(l,c,a)),w=vh(Bn(l,c,i));return f!==_&&y!==w||!(0!==f||!yh(a,l,i))||!(0!==_||!yh(a,c,i))||!(0!==y||!yh(l,a,c))||!(0!==w||!yh(l,i,c))}function yh(a,i,l){return i.x<=Math.max(a.x,l.x)&&i.x>=Math.min(a.x,l.x)&&i.y<=Math.max(a.y,l.y)&&i.y>=Math.min(a.y,l.y)}function vh(a){return a>0?1:a<0?-1:0}function Cd(a,i){return Bn(a.prev,a,a.next)<0?Bn(a,i,a.next)>=0&&Bn(a,a.prev,i)>=0:Bn(a,i,a.prev)<0||Bn(a,a.next,i)<0}function hv(a,i){var l=new xh(a.i,a.x,a.y),c=new xh(i.i,i.x,i.y),f=a.next,_=i.prev;return a.next=i,i.prev=a,l.next=f,f.prev=l,c.next=l,l.prev=c,_.next=c,c.prev=_,c}function dv(a,i,l,c){var f=new xh(a,i,l);return c?(f.next=c.next,f.prev=c,c.next.prev=f,c.next=f):(f.prev=f,f.next=f),f}function uc(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function xh(a,i,l){this.i=a,this.x=i,this.y=l,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function bh(a,i,l,c){for(var f=0,_=i,y=l-c;_<l;_+=c)f+=(a[y]-a[_])*(a[_+1]+a[y+1]),y=_;return f}function ub(a,i,l,c,f){fv(a,i,l||0,c||a.length-1,f||pv)}function fv(a,i,l,c,f){for(;c>l;){if(c-l>600){var _=c-l+1,y=i-l+1,w=Math.log(_),C=.5*Math.exp(2*w/3),D=.5*Math.sqrt(w*C*(_-C)/_)*(y-_/2<0?-1:1);fv(a,i,Math.max(l,Math.floor(i-y*C/_+D)),Math.min(c,Math.floor(i+(_-y)*C/_+D)),f)}var I=a[i],R=l,k=c;for(gu(a,l,i),f(a[c],I)>0&&gu(a,l,c);R<k;){for(gu(a,R,k),R++,k--;f(a[R],I)<0;)R++;for(;f(a[k],I)>0;)k--}0===f(a[l],I)?gu(a,l,k):gu(a,++k,c),k<=i&&(l=k+1),i<=k&&(c=k-1)}}function gu(a,i,l){var c=a[i];a[i]=a[l],a[l]=c}function pv(a,i){return a<i?-1:a>i?1:0}function sp(a,i){const l=a.length;if(l<=1)return[a];const c=[];let f,_;for(let y=0;y<l;y++){const w=zo(a[y]);0!==w&&(a[y].area=Math.abs(w),void 0===_&&(_=w<0),_===w<0?(f&&c.push(f),f=[a[y]]):f.push(a[y]))}if(f&&c.push(f),i>1)for(let y=0;y<c.length;y++)c[y].length<=i||(ub(c[y],i,1,c[y].length-1,mv),c[y]=c[y].slice(0,i));return c}function mv(a,i){return i.area-a.area}function ap(a,i,l){const c=l.patternDependencies;let f=!1;for(const _ of i){const y=_.paint.get(`${a}-pattern`);y.isConstant()||(f=!0);const w=y.constantOr(null);w&&(f=!0,c[w.to]=!0,c[w.from]=!0)}return f}function Td(a,i,l,c,f){const _=f.patternDependencies;for(const y of i){const w=y.paint.get(`${a}-pattern`).value;if("constant"!==w.kind){let C=w.evaluate({zoom:c-1},l,{},f.availableImages),D=w.evaluate({zoom:c},l,{},f.availableImages),I=w.evaluate({zoom:c+1},l,{},f.availableImages);C=C&&C.name?C.name:C,D=D&&D.name?D.name:D,I=I&&I.name?I.name:I,_[C]=!0,_[D]=!0,_[I]=!0,l.patterns[y.id]={min:C,mid:D,max:I}}}return l}gh.deviation=function(a,i,l,c){var f=i&&i.length,_=Math.abs(bh(a,0,f?i[0]*l:a.length,l));if(f)for(var y=0,w=i.length;y<w;y++)_-=Math.abs(bh(a,i[y]*l,y<w-1?i[y+1]*l:a.length,l));var C=0;for(y=0;y<c.length;y+=3){var D=c[y]*l,I=c[y+1]*l,R=c[y+2]*l;C+=Math.abs((a[D]-a[R])*(a[I+1]-a[D+1])-(a[D]-a[I])*(a[R+1]-a[D+1]))}return 0===_&&0===C?0:Math.abs((C-_)/_)},gh.flatten=function(a){for(var i=a[0][0].length,l={vertices:[],holes:[],dimensions:i},c=0,f=0;f<a.length;f++){for(var _=0;_<a[f].length;_++)for(var y=0;y<i;y++)l.vertices.push(a[f][_][y]);f>0&&l.holes.push(c+=a[f-1].length)}return l},Qi.default=qs;class _u{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new zt,this.indexArray=new Vn,this.indexArray2=new vr,this.programConfigurations=new oi(i.layers,i.zoom),this.segments=new Vr,this.segments2=new Vr,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,c){this.hasPattern=ap("fill",this.layers,l);const f=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:y,id:w,index:C,sourceLayerIndex:D}of i){const I=this.layers[0]._featureFilter.needGeometry,R=wa(y,I);if(!this.layers[0]._featureFilter.filter(new $(this.zoom),R,c))continue;const k=f?f.evaluate(R,{},c,l.availableImages):void 0,N={id:w,properties:y.properties,type:y.type,sourceLayerIndex:D,index:C,geometry:I?R.geometry:bs(y),patterns:{},sortKey:k};_.push(N)}f&&_.sort((y,w)=>y.sortKey-w.sortKey);for(const y of _){const{geometry:w,index:C,sourceLayerIndex:D}=y;if(this.hasPattern){const I=Td("fill",this.layers,y,this.zoom,l);this.patternFeatures.push(I)}else this.addFeature(y,w,C,c,{});l.featureIndex.insert(i[C].feature,w,C,D,this.index)}}update(i,l,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,c)}addFeatures(i,l,c){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,l,c)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,rv),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,l,c,f,_){for(const y of sp(l,500)){let w=0;for(const N of y)w+=N.length;const C=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),D=C.vertexLength,I=[],R=[];for(const N of y){if(0===N.length)continue;N!==y[0]&&R.push(I.length/2);const H=this.segments2.prepareSegment(N.length,this.layoutVertexArray,this.indexArray2),q=H.vertexLength;this.layoutVertexArray.emplaceBack(N[0].x,N[0].y),this.indexArray2.emplaceBack(q+N.length-1,q),I.push(N[0].x),I.push(N[0].y);for(let te=1;te<N.length;te++)this.layoutVertexArray.emplaceBack(N[te].x,N[te].y),this.indexArray2.emplaceBack(q+te-1,q+te),I.push(N[te].x),I.push(N[te].y);H.vertexLength+=N.length,H.primitiveLength+=N.length}const k=Qi(I,R);for(let N=0;N<k.length;N+=3)this.indexArray.emplaceBack(D+k[N],D+k[N+1],D+k[N+2]);C.vertexLength+=w,C.primitiveLength+=k.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,_,f)}}yt("FillBucket",_u,{omit:["layers","patternFeatures"]});const fg=new Ne({"fill-sort-key":new we(ue.layout_fill["fill-sort-key"])});var lp={paint:new Ne({"fill-antialias":new J(ue.paint_fill["fill-antialias"]),"fill-opacity":new we(ue.paint_fill["fill-opacity"]),"fill-color":new we(ue.paint_fill["fill-color"]),"fill-outline-color":new we(ue.paint_fill["fill-outline-color"]),"fill-translate":new J(ue.paint_fill["fill-translate"]),"fill-translate-anchor":new J(ue.paint_fill["fill-translate-anchor"]),"fill-pattern":new $e(ue.paint_fill["fill-pattern"])}),layout:fg};const gv=bt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),ar=bt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:_v}=gv;var pg=ml;function ml(a,i,l,c,f){this.properties={},this.extent=l,this.type=0,this._pbf=a,this._geometry=-1,this._keys=c,this._values=f,a.readFields(mg,this,i)}function mg(a,i,l){1==a?i.id=l.readVarint():2==a?function(c,f){for(var _=c.readVarint()+c.pos;c.pos<_;){var y=f._keys[c.readVarint()],w=f._values[c.readVarint()];f.properties[y]=w}}(l,i):3==a?i.type=l.readVarint():4==a&&(i._geometry=l.pos)}function yv(a){for(var i,l,c=0,f=0,_=a.length,y=_-1;f<_;y=f++)c+=((l=a[y]).x-(i=a[f]).x)*(i.y+l.y);return c}ml.types=["Unknown","Point","LineString","Polygon"],ml.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var i,l=a.readVarint()+a.pos,c=1,f=0,_=0,y=0,w=[];a.pos<l;){if(f<=0){var C=a.readVarint();c=7&C,f=C>>3}if(f--,1===c||2===c)_+=a.readSVarint(),y+=a.readSVarint(),1===c&&(i&&w.push(i),i=[]),i.push(new ne(_,y));else{if(7!==c)throw new Error("unknown command "+c);i&&i.push(i[0].clone())}}return i&&w.push(i),w},ml.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var i=a.readVarint()+a.pos,l=1,c=0,f=0,_=0,y=1/0,w=-1/0,C=1/0,D=-1/0;a.pos<i;){if(c<=0){var I=a.readVarint();l=7&I,c=I>>3}if(c--,1===l||2===l)(f+=a.readSVarint())<y&&(y=f),f>w&&(w=f),(_+=a.readSVarint())<C&&(C=_),_>D&&(D=_);else if(7!==l)throw new Error("unknown command "+l)}return[y,C,w,D]},ml.prototype.toGeoJSON=function(a,i,l){var c,f,_=this.extent*Math.pow(2,l),y=this.extent*a,w=this.extent*i,C=this.loadGeometry(),D=ml.types[this.type];function I(N){for(var H=0;H<N.length;H++){var q=N[H];N[H]=[360*(q.x+y)/_-180,360/Math.PI*Math.atan(Math.exp((180-360*(q.y+w)/_)*Math.PI/180))-90]}}switch(this.type){case 1:var R=[];for(c=0;c<C.length;c++)R[c]=C[c][0];I(C=R);break;case 2:for(c=0;c<C.length;c++)I(C[c]);break;case 3:for(C=function(N){var H=N.length;if(H<=1)return[N];for(var q,te,de=[],_e=0;_e<H;_e++){var Se=yv(N[_e]);0!==Se&&(void 0===te&&(te=Se<0),te===Se<0?(q&&de.push(q),q=[N[_e]]):q.push(N[_e]))}return q&&de.push(q),de}(C),c=0;c<C.length;c++)for(f=0;f<C[c].length;f++)I(C[c][f])}1===C.length?C=C[0]:D="Multi"+D;var k={type:"Feature",geometry:{type:D,coordinates:C},properties:this.properties};return"id"in this&&(k.id=this.id),k};var gg=_g;function _g(a,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(vv,this,i),this.length=this._features.length}function vv(a,i,l){15===a?i.version=l.readVarint():1===a?i.name=l.readString():5===a?i.extent=l.readVarint():2===a?i._features.push(l.pos):3===a?i._keys.push(l.readString()):4===a&&i._values.push(function(c){for(var f=null,_=c.readVarint()+c.pos;c.pos<_;){var y=c.readVarint()>>3;f=1===y?c.readString():2===y?c.readFloat():3===y?c.readDouble():4===y?c.readVarint64():5===y?c.readVarint():6===y?c.readSVarint():7===y?c.readBoolean():null}return f}(l))}function xv(a,i,l){if(3===a){var c=new gg(l,l.readVarint()+l.pos);c.length&&(i[c.name]=c)}}_g.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var i=this._pbf.readVarint()+this._pbf.pos;return new pg(this._pbf,i,this.extent,this._keys,this._values)};var yu={VectorTile:function(a,i){this.layers=a.readFields(xv,{},i)},VectorTileFeature:pg,VectorTileLayer:gg};const hb=yu.VectorTileFeature.types,wh=Math.pow(2,13);function ai(a,i,l,c,f,_,y,w){a.emplaceBack((i<<1)+y,(l<<1)+_,(Math.floor(c*wh)<<1)+f,Math.round(w))}class Dd{constructor(){this.acc=new ne(0,0),this.polyCount=[]}startRing(i){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new ne(i.x,i.y),this.max=new ne(i.x,i.y))}append(i,l){this.currentPolyCount.edges++,this.acc._add(i);let c=!!this.borders;const f=this.min,_=this.max;i.x<f.x?(f.x=i.x,c=!0):i.x>_.x&&(_.x=i.x,c=!0),i.y<f.y?(f.y=i.y,c=!0):i.y>_.y&&(_.y=i.y,c=!0),((0===i.x||i.x===Sn)&&i.x===l.x)!=((0===i.y||i.y===Sn)&&i.y===l.y)&&this.processBorderOverlap(i,l),c&&this.checkBorderIntersection(i,l)}checkBorderIntersection(i,l){l.x<0!=i.x<0&&this.addBorderIntersection(0,Dn(l.y,i.y,(0-l.x)/(i.x-l.x))),l.x>Sn!=i.x>Sn&&this.addBorderIntersection(1,Dn(l.y,i.y,(Sn-l.x)/(i.x-l.x))),l.y<0!=i.y<0&&this.addBorderIntersection(2,Dn(l.x,i.x,(0-l.y)/(i.y-l.y))),l.y>Sn!=i.y>Sn&&this.addBorderIntersection(3,Dn(l.x,i.x,(Sn-l.y)/(i.y-l.y)))}addBorderIntersection(i,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[i];l<c[0]&&(c[0]=l),l>c[1]&&(c[1]=l)}processBorderOverlap(i,l){if(i.x===l.x){if(i.y===l.y)return;const c=0===i.x?0:1;this.addBorderIntersection(c,l.y),this.addBorderIntersection(c,i.y)}else{const c=0===i.y?2:3;this.addBorderIntersection(c,l.x),this.addBorderIntersection(c,i.x)}}centroid(){const i=this.polyCount.reduce((l,c)=>l+c.edges,0);return 0!==i?this.acc.div(i)._round():new ne(0,0)}span(){return new ne(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((i,l)=>i+ +(l[0]!==Number.MAX_VALUE),0)}}class Sd{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new gr,this.centroidVertexArray=new Gy,this.indexArray=new Vn,this.programConfigurations=new oi(i.layers,i.zoom),this.segments=new Vr,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.enableTerrain=i.enableTerrain}populate(i,l,c){this.features=[],this.hasPattern=ap("fill-extrusion",this.layers,l),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(f){const _=Math.exp(Math.PI*(1-f.y/(1<<f.z)*2));return 80150034*_/(_*_+1)/Sn/(1<<f.z)}(c);for(const{feature:f,id:_,index:y,sourceLayerIndex:w}of i){const C=this.layers[0]._featureFilter.needGeometry,D=wa(f,C);if(!this.layers[0]._featureFilter.filter(new $(this.zoom),D,c))continue;const I={id:_,sourceLayerIndex:w,index:y,geometry:C?D.geometry:bs(f),properties:f.properties,type:f.type,patterns:{}},R=this.layoutVertexArray.length;this.hasPattern?this.features.push(Td("fill-extrusion",this.layers,I,this.zoom,l)):this.addFeature(I,I.geometry,y,c,{}),l.featureIndex.insert(f,I.geometry,y,w,this.index,R)}this.sortBorders()}addFeatures(i,l,c){for(const f of this.features){const{geometry:_}=f;this.addFeature(f,_,f.index,l,c)}this.sortBorders()}update(i,l,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,c)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,_v),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}uploadCentroid(i){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,ar.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,l,c,f,_){const y=this.enableTerrain?new Dd:null;for(const C of sp(l,500)){let D=0,I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(0===C.length||(w=C[0]).every(q=>q.x<=0)||w.every(q=>q.x>=Sn)||w.every(q=>q.y<=0)||w.every(q=>q.y>=Sn))continue;for(let q=0;q<C.length;q++){const te=C[q];if(0===te.length)continue;D+=te.length;let de=0;y&&y.startRing(te[0]);for(let _e=0;_e<te.length;_e++){const Se=te[_e];if(_e>=1){const Ie=te[_e-1];if(!yg(Se,Ie)){y&&y.append(Se,Ie),I.vertexLength+4>Vr.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Me=Se.sub(Ie)._perp(),ke=Me.x/(Math.abs(Me.x)+Math.abs(Me.y)),He=Me.y>0?1:0,Je=Ie.dist(Se);de+Je>32768&&(de=0),ai(this.layoutVertexArray,Se.x,Se.y,ke,He,0,0,de),ai(this.layoutVertexArray,Se.x,Se.y,ke,He,0,1,de),de+=Je,ai(this.layoutVertexArray,Ie.x,Ie.y,ke,He,0,0,de),ai(this.layoutVertexArray,Ie.x,Ie.y,ke,He,0,1,de);const Qe=I.vertexLength;this.indexArray.emplaceBack(Qe,Qe+2,Qe+1),this.indexArray.emplaceBack(Qe+1,Qe+2,Qe+3),I.vertexLength+=4,I.primitiveLength+=2}}}}if(I.vertexLength+D>Vr.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray)),"Polygon"!==hb[i.type])continue;const R=[],k=[],N=I.vertexLength;for(let q=0;q<C.length;q++){const te=C[q];if(0!==te.length){te!==C[0]&&k.push(R.length/2);for(let de=0;de<te.length;de++){const _e=te[de];ai(this.layoutVertexArray,_e.x,_e.y,0,0,1,1,0),R.push(_e.x),R.push(_e.y),y&&y.currentPolyCount.top++}}}const H=Qi(R,k);for(let q=0;q<H.length;q+=3)this.indexArray.emplaceBack(N+H[q],N+H[q+2],N+H[q+1]);I.primitiveLength+=H.length/3,I.vertexLength+=D}var w;if(y&&y.polyCount.length>0){if(y.borders){y.vertexArrayOffset=this.centroidVertexArray.length;const C=y.borders,D=this.featuresOnBorder.push(y)-1;for(let I=0;I<4;I++)C[I][0]!==Number.MAX_VALUE&&this.borders[I].push(D)}this.encodeCentroid(y.borders?void 0:y.centroid(),y)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,_,f)}sortBorders(){for(let i=0;i<4;i++)this.borders[i].sort((l,c)=>this.featuresOnBorder[l].borders[i][0]-this.featuresOnBorder[c].borders[i][0])}encodeCentroid(i,l,c=!0){let f,_;if(i)if(0!==i.y){const w=l.span()._mult(this.tileToMeter);f=(Math.max(i.x,1)<<3)+Math.min(7,Math.round(w.x/10)),_=(Math.max(i.y,1)<<3)+Math.min(7,Math.round(w.y/10))}else f=Math.ceil(7*(i.x+450)),_=0;else f=0,_=+c;let y=c?this.centroidVertexArray.length:l.vertexArrayOffset;for(const w of l.polyCount){c&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*w.edges+w.top);for(let C=0;C<2*w.edges;C++)this.centroidVertexArray.emplace(y++,0,_),this.centroidVertexArray.emplace(y++,f,_);for(let C=0;C<w.top;C++)this.centroidVertexArray.emplace(y++,f,_)}}}function yg(a,i){return a.x===i.x&&(a.x<0||a.x>Sn)||a.y===i.y&&(a.y<0||a.y>Sn)}yt("FillExtrusionBucket",Sd,{omit:["layers","features"]}),yt("PartMetadata",Dd);var Vi={paint:new Ne({"fill-extrusion-opacity":new J(ue["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new we(ue["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new J(ue["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new J(ue["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new $e(ue["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new we(ue["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new we(ue["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new J(ue["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Ta(a,i){return a.x*i.x+a.y*i.y}function Ad(a,i){if(1===a.length){let l=0;const c=i[l++];let f;for(;!f||c.equals(f);)if(f=i[l++],!f)return 1/0;for(;l<i.length;l++){const _=i[l],y=a[0],w=f.sub(c),C=_.sub(c),D=y.sub(c),I=Ta(w,w),R=Ta(w,C),k=Ta(C,C),N=Ta(D,w),H=Ta(D,C),q=I*k-R*R,te=(k*N-R*H)/q,de=(I*H-R*N)/q,_e=c.z*(1-te-de)+f.z*te+_.z*de;if(isFinite(_e))return _e}return 1/0}{let l=1/0;for(const c of i)l=Math.min(l,c.z);return l}}function vg(a){const i=new ne(a[0],a[1]);return i.z=a[2],i}function bv(a,i,l,c,f,_,y,w){const C=y*f.getElevationAt(a,i,!0,!0),D=0!==_[0],I=D?0===_[1]?y*(_[0]/7-450):y*function(R,k,N){const H=Math.floor(k[0]/8),q=Math.floor(k[1]/8),te=10*(k[0]-8*H),de=10*(k[1]-8*q),_e=R.getElevationAt(H,q,!0,!0),Se=R.getMeterToDEM(N),Ie=Math.floor(.5*(te*Se-1)),Me=Math.floor(.5*(de*Se-1)),ke=R.tileCoordToPixel(H,q),He=2*Ie+1,Je=2*Me+1,Qe=(Ot=He,dn=Je,[(Vt=R).getElevationAtPixel(xt=ke.x-Ie,An=ke.y-Me,!0),Vt.getElevationAtPixel(xt+dn,An,!0),Vt.getElevationAtPixel(xt,An+dn,!0),Vt.getElevationAtPixel(xt+Ot,An+dn,!0)]),st=Math.abs(Qe[0]-Qe[1]),Ze=Math.abs(Qe[2]-Qe[3]),Ye=Math.abs(Qe[0]-Qe[2])+Math.abs(Qe[1]-Qe[3]),dt=Math.min(.25,.5*Se*(st+Ze)/He),We=Math.min(.25,.5*Se*Ye/Je);var Vt,xt,An,Ot,dn;return _e+Math.max(dt*te,We*de)}(f,_,w):C;return{base:C+(0===l)?-1:l,top:D?Math.max(I+c,C+l+2):C+c}}const xg=bt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:wv}=xg,bg=bt([{name:"a_packed",components:3,type:"Float32"}]),{members:Ev}=bg,wg=yu.VectorTileFeature.types,Cv=Math.cos(Math.PI/180*37.5);class cp{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new Yn,this.layoutVertexArray2=new Zt,this.indexArray=new Vn,this.programConfigurations=new oi(i.layers,i.zoom),this.segments=new Vr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,c){this.hasPattern=ap("line",this.layers,l);const f=this.layers[0].layout.get("line-sort-key"),_=[];for(const{feature:D,id:I,index:R,sourceLayerIndex:k}of i){const N=this.layers[0]._featureFilter.needGeometry,H=wa(D,N);if(!this.layers[0]._featureFilter.filter(new $(this.zoom),H,c))continue;const q=f?f.evaluate(H,{},c):void 0,te={id:I,properties:D.properties,type:D.type,sourceLayerIndex:k,index:R,geometry:N?H.geometry:bs(D),patterns:{},sortKey:q};_.push(te)}f&&_.sort((D,I)=>D.sortKey-I.sortKey);const{lineAtlas:y,featureIndex:w}=l,C=this.addConstantDashes(y);for(const D of _){const{geometry:I,index:R,sourceLayerIndex:k}=D;if(C&&this.addFeatureDashes(D,y),this.hasPattern){const N=Td("line",this.layers,D,this.zoom,l);this.patternFeatures.push(N)}else this.addFeature(D,I,R,c,y.positions);w.insert(i[R].feature,I,R,k,this.index)}}addConstantDashes(i){let l=!1;for(const c of this.layers){const f=c.paint.get("line-dasharray").value,_=c.layout.get("line-cap").value;if("constant"!==f.kind||"constant"!==_.kind)l=!0;else{const y=_.value,w=f.value;if(!w)continue;i.addDash(w.from,y),i.addDash(w.to,y),w.other&&i.addDash(w.other,y)}}return l}addFeatureDashes(i,l){const c=this.zoom;for(const f of this.layers){const _=f.paint.get("line-dasharray").value,y=f.layout.get("line-cap").value;if("constant"===_.kind&&"constant"===y.kind)continue;let w,C,D,I,R,k;if("constant"===_.kind){const te=_.value;if(!te)continue;w=te.other||te.to,C=te.to,D=te.from}else w=_.evaluate({zoom:c-1},i),C=_.evaluate({zoom:c},i),D=_.evaluate({zoom:c+1},i);"constant"===y.kind?I=R=k=y.value:(I=y.evaluate({zoom:c-1},i),R=y.evaluate({zoom:c},i),k=y.evaluate({zoom:c+1},i)),l.addDash(w,I),l.addDash(C,R),l.addDash(D,k);const N=l.getKey(w,I),H=l.getKey(C,R),q=l.getKey(D,k);i.patterns[f.id]={min:N,mid:H,max:q}}}update(i,l,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,c)}addFeatures(i,l,c){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,l,c)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,Ev)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,wv),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&i.properties.hasOwnProperty("mapbox_clip_start")&&i.properties.hasOwnProperty("mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,l,c,f,_){const y=this.layers[0].layout,w=y.get("line-join").evaluate(i,{}),C=y.get("line-cap").evaluate(i,{}),D=y.get("line-miter-limit"),I=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const R of l)this.addLine(R,i,w,C,D,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,_,f)}addLine(i,l,c,f,_,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let de=0;de<i.length-1;de++)this.totalDistance+=i[de].dist(i[de+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const w="Polygon"===wg[l.type];let C=i.length;for(;C>=2&&i[C-1].equals(i[C-2]);)C--;let D=0;for(;D<C-1&&i[D].equals(i[D+1]);)D++;if(C<(w?3:2))return;"bevel"===c&&(_=1.05);const I=this.overscaling<=16?122880/(512*this.overscaling):0,R=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray);let k,N,H,q,te;this.e1=this.e2=-1,w&&(k=i[C-2],te=i[D].sub(k)._unit()._perp());for(let de=D;de<C;de++){if(H=de===C-1?w?i[D+1]:void 0:i[de+1],H&&i[de].equals(H))continue;te&&(q=te),k&&(N=k),k=i[de],te=H?H.sub(k)._unit()._perp():q,q=q||te;let _e=q.add(te);0===_e.x&&0===_e.y||_e._unit();const Se=q.x*te.x+q.y*te.y,Ie=_e.x*te.x+_e.y*te.y,Me=0!==Ie?1/Ie:1/0,ke=2*Math.sqrt(2-2*Ie),He=Ie<Cv&&N&&H,Je=q.x*te.y-q.y*te.x>0;if(He&&de>D){const Ze=k.dist(N);if(Ze>2*I){const Ye=k.sub(k.sub(N)._mult(I/Ze)._round());this.updateDistance(N,Ye),this.addCurrentVertex(Ye,q,0,0,R),N=Ye}}const Qe=N&&H;let st=Qe?c:w?"butt":f;if(Qe&&"round"===st&&(Me<y?st="miter":Me<=2&&(st="fakeround")),"miter"===st&&Me>_&&(st="bevel"),"bevel"===st&&(Me>2&&(st="flipbevel"),Me<_&&(st="miter")),N&&this.updateDistance(N,k),"miter"===st)_e._mult(Me),this.addCurrentVertex(k,_e,0,0,R);else if("flipbevel"===st){if(Me>100)_e=te.mult(-1);else{const Ze=Me*q.add(te).mag()/q.sub(te).mag();_e._perp()._mult(Ze*(Je?-1:1))}this.addCurrentVertex(k,_e,0,0,R),this.addCurrentVertex(k,_e.mult(-1),0,0,R)}else if("bevel"===st||"fakeround"===st){const Ze=-Math.sqrt(Me*Me-1),Ye=Je?Ze:0,dt=Je?0:Ze;if(N&&this.addCurrentVertex(k,q,Ye,dt,R),"fakeround"===st){const We=Math.round(180*ke/Math.PI/20);for(let Vt=1;Vt<We;Vt++){let xt=Vt/We;if(.5!==xt){const Ot=xt-.5;xt+=xt*Ot*(xt-1)*((1.0904+Se*(Se*(3.55645-1.43519*Se)-3.2452))*Ot*Ot+(.848013+Se*(.215638*Se-1.06021)))}const An=te.sub(q)._mult(xt)._add(q)._unit()._mult(Je?-1:1);this.addHalfVertex(k,An.x,An.y,!1,Je,0,R)}}H&&this.addCurrentVertex(k,te,-Ye,-dt,R)}else if("butt"===st)this.addCurrentVertex(k,_e,0,0,R);else if("square"===st){const Ze=N?1:-1;N||this.addCurrentVertex(k,_e,Ze,Ze,R),this.addCurrentVertex(k,_e,0,0,R),N&&this.addCurrentVertex(k,_e,Ze,Ze,R)}else"round"===st&&(N&&(this.addCurrentVertex(k,q,0,0,R),this.addCurrentVertex(k,q,1,1,R,!0)),H&&(this.addCurrentVertex(k,te,-1,-1,R,!0),this.addCurrentVertex(k,te,0,0,R)));if(He&&de<C-1){const Ze=k.dist(H);if(Ze>2*I){const Ye=k.add(H.sub(k)._mult(I/Ze)._round());this.updateDistance(k,Ye),this.addCurrentVertex(Ye,te,0,0,R),k=Ye}}}}addCurrentVertex(i,l,c,f,_,y=!1){const w=l.y*f-l.x,C=-l.y-l.x*f;this.addHalfVertex(i,l.x+l.y*c,l.y-l.x*c,y,!1,c,_),this.addHalfVertex(i,w,C,y,!0,-f,_)}addHalfVertex({x:i,y:l},c,f,_,y,w,C){this.layoutVertexArray.emplaceBack((i<<1)+(_?1:0),(l<<1)+(y?1:0),Math.round(63*c)+128,Math.round(63*f)+128,1+(0===w?0:w<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const D=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),C.primitiveLength++),y?this.e2=D:this.e1=D}updateScaledDistance(){if(this.lineClips){const i=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=i*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(i,l){this.distance+=i.dist(l),this.updateScaledDistance()}}yt("LineBucket",cp,{omit:["layers","patternFeatures"]});const Tv=new Ne({"line-cap":new we(ue.layout_line["line-cap"]),"line-join":new we(ue.layout_line["line-join"]),"line-miter-limit":new J(ue.layout_line["line-miter-limit"]),"line-round-limit":new J(ue.layout_line["line-round-limit"]),"line-sort-key":new we(ue.layout_line["line-sort-key"])});var up={paint:new Ne({"line-opacity":new we(ue.paint_line["line-opacity"]),"line-color":new we(ue.paint_line["line-color"]),"line-translate":new J(ue.paint_line["line-translate"]),"line-translate-anchor":new J(ue.paint_line["line-translate-anchor"]),"line-width":new we(ue.paint_line["line-width"]),"line-gap-width":new we(ue.paint_line["line-gap-width"]),"line-offset":new we(ue.paint_line["line-offset"]),"line-blur":new we(ue.paint_line["line-blur"]),"line-dasharray":new $e(ue.paint_line["line-dasharray"]),"line-pattern":new $e(ue.paint_line["line-pattern"]),"line-gradient":new ve(ue.paint_line["line-gradient"])}),layout:Tv};const Id=new class extends we{possiblyEvaluate(a,i){return i=new $(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),super.possiblyEvaluate(a,i)}evaluate(a,i,l,c){return i=pt({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(a,i,l,c)}}(up.paint.properties["line-width"].specification);function hp(a,i){return i>0?i+2*a:a}Id.useIntegerZoom=!0;const Dv=bt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),db=bt([{name:"a_projected_pos",components:3,type:"Float32"}],4);bt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Eg=bt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Md=bt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);bt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Cg=bt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Sv=bt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);bt([{name:"triangle",components:3,type:"Uint16"}]),bt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),bt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),bt([{type:"Float32",name:"offsetX"}]),bt([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Ws=128;function dp(a,i){const{expression:l}=i;if("constant"===l.kind)return{kind:"constant",layoutSize:l.evaluate(new $(a+1))};if("source"===l.kind)return{kind:"source"};{const{zoomStops:c,interpolationType:f}=l;let _=0;for(;_<c.length&&c[_]<=a;)_++;_=Math.max(0,_-1);let y=_;for(;y<c.length&&c[y]<a+1;)y++;y=Math.min(c.length-1,y);const w=c[_],C=c[y];return"composite"===l.kind?{kind:"composite",minZoom:w,maxZoom:C,interpolationType:f}:{kind:"camera",minZoom:w,maxZoom:C,minSize:l.evaluate(new $(w)),maxSize:l.evaluate(new $(C)),interpolationType:f}}}function Rd(a,{uSize:i,uSizeT:l},{lowerSize:c,upperSize:f}){return"source"===a.kind?c/Ws:"composite"===a.kind?Dn(c/Ws,f/Ws,l):i}function vu(a,i){let l=0,c=0;if("constant"===a.kind)c=a.layoutSize;else if("source"!==a.kind){const{interpolationType:f,minZoom:_,maxZoom:y}=a,w=f?Oe(qr.interpolationFactor(f,i,_,y),0,1):0;"camera"===a.kind?c=Dn(a.minSize,a.maxSize,w):l=w}return{uSizeT:l,uSize:c}}var Av=Object.freeze({__proto__:null,getSizeData:dp,evaluateSizeForFeature:Rd,evaluateSizeForZoom:vu,SIZE_PACK_FACTOR:Ws});function kd(a,i,l){return a.sections.forEach(c=>{c.text=function(f,_,y){const w=_.layout.get("text-transform").evaluate(y,{});return"uppercase"===w?f=f.toLocaleUpperCase():"lowercase"===w&&(f=f.toLocaleLowerCase()),U.applyArabicShaping&&(f=U.applyArabicShaping(f)),f}(c.text,i,l)}),a}const Bi={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function Tg(a){return"\ufe36"===a||"\ufe48"===a||"\ufe38"===a||"\ufe44"===a||"\ufe42"===a||"\ufe3e"===a||"\ufe3c"===a||"\ufe3a"===a||"\ufe18"===a||"\ufe40"===a||"\ufe10"===a||"\ufe13"===a||"\ufe14"===a||"\uff40"===a||"\uffe3"===a||"\ufe11"===a||"\ufe12"===a}function Iv(a){return"\ufe35"===a||"\ufe47"===a||"\ufe37"===a||"\ufe43"===a||"\ufe41"===a||"\ufe3d"===a||"\ufe3b"===a||"\ufe39"===a||"\ufe17"===a||"\ufe3f"===a}var Dg=function(a,i,l,c,f){var _,y,w=8*f-c-1,C=(1<<w)-1,D=C>>1,I=-7,R=l?f-1:0,k=l?-1:1,N=a[i+R];for(R+=k,_=N&(1<<-I)-1,N>>=-I,I+=w;I>0;_=256*_+a[i+R],R+=k,I-=8);for(y=_&(1<<-I)-1,_>>=-I,I+=c;I>0;y=256*y+a[i+R],R+=k,I-=8);if(0===_)_=1-D;else{if(_===C)return y?NaN:1/0*(N?-1:1);y+=Math.pow(2,c),_-=D}return(N?-1:1)*y*Math.pow(2,_-c)},fp=function(a,i,l,c,f,_){var y,w,C,D=8*_-f-1,I=(1<<D)-1,R=I>>1,k=23===f?Math.pow(2,-24)-Math.pow(2,-77):0,N=c?0:_-1,H=c?1:-1,q=i<0||0===i&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(w=isNaN(i)?1:0,y=I):(y=Math.floor(Math.log(i)/Math.LN2),i*(C=Math.pow(2,-y))<1&&(y--,C*=2),(i+=y+R>=1?k/C:k*Math.pow(2,1-R))*C>=2&&(y++,C/=2),y+R>=I?(w=0,y=I):y+R>=1?(w=(i*C-1)*Math.pow(2,f),y+=R):(w=i*Math.pow(2,R-1)*Math.pow(2,f),y=0));f>=8;a[l+N]=255&w,N+=H,w/=256,f-=8);for(y=y<<f|w,D+=f;D>0;a[l+N]=255&y,N+=H,y/=256,D-=8);a[l+N-H]|=128*q},Pd=Un;function Un(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}Un.Varint=0,Un.Fixed64=1,Un.Bytes=2,Un.Fixed32=5;var pp=4294967296,Sg=1/pp,Ag="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function lo(a){return a.type===Un.Bytes?a.readVarint()+a.pos:a.pos+1}function Mv(a,i,l){var c=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));l.realloc(c);for(var f=l.pos-1;f>=a;f--)l.buf[f+c]=l.buf[f]}function fb(a,i){for(var l=0;l<a.length;l++)i.writeVarint(a[l])}function Ig(a,i){for(var l=0;l<a.length;l++)i.writeSVarint(a[l])}function pb(a,i){for(var l=0;l<a.length;l++)i.writeFloat(a[l])}function Io(a,i){for(var l=0;l<a.length;l++)i.writeDouble(a[l])}function mp(a,i){for(var l=0;l<a.length;l++)i.writeBoolean(a[l])}function gp(a,i){for(var l=0;l<a.length;l++)i.writeFixed32(a[l])}function Rv(a,i){for(var l=0;l<a.length;l++)i.writeSFixed32(a[l])}function Mg(a,i){for(var l=0;l<a.length;l++)i.writeFixed64(a[l])}function Eh(a,i){for(var l=0;l<a.length;l++)i.writeSFixed64(a[l])}function Ch(a,i){return(a[i]|a[i+1]<<8|a[i+2]<<16)+16777216*a[i+3]}function hc(a,i,l){a[l]=i,a[l+1]=i>>>8,a[l+2]=i>>>16,a[l+3]=i>>>24}function Fd(a,i){return(a[i]|a[i+1]<<8|a[i+2]<<16)+(a[i+3]<<24)}function _p(a,i,l){i.glyphs=[],1===a&&l.readMessage(Rg,i)}function Rg(a,i,l){if(3===a){const{id:c,bitmap:f,width:_,height:y,left:w,top:C,advance:D}=l.readMessage(mb,{});i.glyphs.push({id:c,bitmap:new Ca({width:_+6,height:y+6},f),metrics:{width:_,height:y,left:w,top:C,advance:D}})}else 4===a?i.ascender=l.readSVarint():5===a&&(i.descender=l.readSVarint())}function mb(a,i,l){1===a?i.id=l.readVarint():2===a?i.bitmap=l.readBytes():3===a?i.width=l.readVarint():4===a?i.height=l.readVarint():5===a?i.left=l.readSVarint():6===a?i.top=l.readSVarint():7===a&&(i.advance=l.readVarint())}function gl(a){let i=0,l=0;for(const y of a)i+=y.w*y.h,l=Math.max(l,y.w);a.sort((y,w)=>w.h-y.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),l),h:1/0}];let f=0,_=0;for(const y of a)for(let w=c.length-1;w>=0;w--){const C=c[w];if(!(y.w>C.w||y.h>C.h)){if(y.x=C.x,y.y=C.y,_=Math.max(_,y.y+y.h),f=Math.max(f,y.x+y.w),y.w===C.w&&y.h===C.h){const D=c.pop();w<c.length&&(c[w]=D)}else y.h===C.h?(C.x+=y.w,C.w-=y.w):y.w===C.w?(C.y+=y.h,C.h-=y.h):(c.push({x:C.x+y.w,y:C.y,w:C.w-y.w,h:y.h}),C.y+=y.h,C.h-=y.h);break}}return{w:f,h:_,fill:i/(f*_)||0}}Un.prototype={destroy:function(){this.buf=null},readFields:function(a,i,l){for(l=l||this.length;this.pos<l;){var c=this.readVarint(),f=c>>3,_=this.pos;this.type=7&c,a(f,i,this),this.pos===_&&this.skip(c)}return i},readMessage:function(a,i){return this.readFields(a,i,this.readVarint()+this.pos)},readFixed32:function(){var a=Ch(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=Fd(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=Ch(this.buf,this.pos)+Ch(this.buf,this.pos+4)*pp;return this.pos+=8,a},readSFixed64:function(){var a=Ch(this.buf,this.pos)+Fd(this.buf,this.pos+4)*pp;return this.pos+=8,a},readFloat:function(){var a=Dg(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=Dg(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var i,l,c=this.buf;return i=127&(l=c[this.pos++]),l<128?i:(i|=(127&(l=c[this.pos++]))<<7,l<128?i:(i|=(127&(l=c[this.pos++]))<<14,l<128?i:(i|=(127&(l=c[this.pos++]))<<21,l<128?i:function(f,_,y){var w,C,D=y.buf;if(w=(112&(C=D[y.pos++]))>>4,C<128||(w|=(127&(C=D[y.pos++]))<<3,C<128)||(w|=(127&(C=D[y.pos++]))<<10,C<128)||(w|=(127&(C=D[y.pos++]))<<17,C<128)||(w|=(127&(C=D[y.pos++]))<<24,C<128)||(w|=(1&(C=D[y.pos++]))<<31,C<128))return function(a,i,l){return l?4294967296*i+(a>>>0):4294967296*(i>>>0)+(a>>>0)}(f,w,_);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(l=c[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var a=this.readVarint()+this.pos,i=this.pos;return this.pos=a,a-i>=12&&Ag?Ag.decode(this.buf.subarray(i,a)):function(l,c,f){for(var _="",y=c;y<f;){var w,C,D,I=l[y],R=null,k=I>239?4:I>223?3:I>191?2:1;if(y+k>f)break;1===k?I<128&&(R=I):2===k?128==(192&(w=l[y+1]))&&(R=(31&I)<<6|63&w)<=127&&(R=null):3===k?(C=l[y+2],128==(192&(w=l[y+1]))&&128==(192&C)&&((R=(15&I)<<12|(63&w)<<6|63&C)<=2047||R>=55296&&R<=57343)&&(R=null)):4===k&&(C=l[y+2],D=l[y+3],128==(192&(w=l[y+1]))&&128==(192&C)&&128==(192&D)&&((R=(15&I)<<18|(63&w)<<12|(63&C)<<6|63&D)<=65535||R>=1114112)&&(R=null)),null===R?(R=65533,k=1):R>65535&&(R-=65536,_+=String.fromCharCode(R>>>10&1023|55296),R=56320|1023&R),_+=String.fromCharCode(R),y+=k}return _}(this.buf,i,a)},readBytes:function(){var a=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,a);return this.pos=a,i},readPackedVarint:function(a,i){if(this.type!==Un.Bytes)return a.push(this.readVarint(i));var l=lo(this);for(a=a||[];this.pos<l;)a.push(this.readVarint(i));return a},readPackedSVarint:function(a){if(this.type!==Un.Bytes)return a.push(this.readSVarint());var i=lo(this);for(a=a||[];this.pos<i;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==Un.Bytes)return a.push(this.readBoolean());var i=lo(this);for(a=a||[];this.pos<i;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==Un.Bytes)return a.push(this.readFloat());var i=lo(this);for(a=a||[];this.pos<i;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==Un.Bytes)return a.push(this.readDouble());var i=lo(this);for(a=a||[];this.pos<i;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==Un.Bytes)return a.push(this.readFixed32());var i=lo(this);for(a=a||[];this.pos<i;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==Un.Bytes)return a.push(this.readSFixed32());var i=lo(this);for(a=a||[];this.pos<i;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==Un.Bytes)return a.push(this.readFixed64());var i=lo(this);for(a=a||[];this.pos<i;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==Un.Bytes)return a.push(this.readSFixed64());var i=lo(this);for(a=a||[];this.pos<i;)a.push(this.readSFixed64());return a},skip:function(a){var i=7&a;if(i===Un.Varint)for(;this.buf[this.pos++]>127;);else if(i===Un.Bytes)this.pos=this.readVarint()+this.pos;else if(i===Un.Fixed32)this.pos+=4;else{if(i!==Un.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(a,i){this.writeVarint(a<<3|i)},realloc:function(a){for(var i=this.length||16;i<this.pos+a;)i*=2;if(i!==this.length){var l=new Uint8Array(i);l.set(this.buf),this.buf=l,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),hc(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),hc(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),hc(this.buf,-1&a,this.pos),hc(this.buf,Math.floor(a*Sg),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),hc(this.buf,-1&a,this.pos),hc(this.buf,Math.floor(a*Sg),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(i,l){var c,f,_,w;if(i>=0?(c=i%4294967296|0,f=i/4294967296|0):(f=~(-i/4294967296),4294967295^(c=~(-i%4294967296))?c=c+1|0:(c=0,f=f+1|0)),i>=0x10000000000000000||i<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),_=c,(w=l).buf[w.pos++]=127&_|128,_>>>=7,w.buf[w.pos++]=127&_|128,_>>>=7,w.buf[w.pos++]=127&_|128,_>>>=7,w.buf[w.pos++]=127&_|128,w.buf[w.pos]=127&(_>>>=7),function(_,y){var w=(7&_)<<4;y.buf[y.pos++]|=w|((_>>>=3)?128:0),_&&(y.buf[y.pos++]=127&_|((_>>>=7)?128:0),_&&(y.buf[y.pos++]=127&_|((_>>>=7)?128:0),_&&(y.buf[y.pos++]=127&_|((_>>>=7)?128:0),_&&(y.buf[y.pos++]=127&_|((_>>>=7)?128:0),_&&(y.buf[y.pos++]=127&_)))))}(f,l)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(Boolean(a))},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var i=this.pos;this.pos=function(c,f,_){for(var y,w,C=0;C<f.length;C++){if((y=f.charCodeAt(C))>55295&&y<57344){if(!w){y>56319||C+1===f.length?(c[_++]=239,c[_++]=191,c[_++]=189):w=y;continue}if(y<56320){c[_++]=239,c[_++]=191,c[_++]=189,w=y;continue}y=w-55296<<10|y-56320|65536,w=null}else w&&(c[_++]=239,c[_++]=191,c[_++]=189,w=null);y<128?c[_++]=y:(y<2048?c[_++]=y>>6|192:(y<65536?c[_++]=y>>12|224:(c[_++]=y>>18|240,c[_++]=y>>12&63|128),c[_++]=y>>6&63|128),c[_++]=63&y|128)}return _}(this.buf,a,this.pos);var l=this.pos-i;l>=128&&Mv(i,l,this),this.pos=i-1,this.writeVarint(l),this.pos+=l},writeFloat:function(a){this.realloc(4),fp(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),fp(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var i=a.length;this.writeVarint(i),this.realloc(i);for(var l=0;l<i;l++)this.buf[this.pos++]=a[l]},writeRawMessage:function(a,i){this.pos++;var l=this.pos;a(i,this);var c=this.pos-l;c>=128&&Mv(l,c,this),this.pos=l-1,this.writeVarint(c),this.pos+=c},writeMessage:function(a,i,l){this.writeTag(a,Un.Bytes),this.writeRawMessage(i,l)},writePackedVarint:function(a,i){i.length&&this.writeMessage(a,fb,i)},writePackedSVarint:function(a,i){i.length&&this.writeMessage(a,Ig,i)},writePackedBoolean:function(a,i){i.length&&this.writeMessage(a,mp,i)},writePackedFloat:function(a,i){i.length&&this.writeMessage(a,pb,i)},writePackedDouble:function(a,i){i.length&&this.writeMessage(a,Io,i)},writePackedFixed32:function(a,i){i.length&&this.writeMessage(a,gp,i)},writePackedSFixed32:function(a,i){i.length&&this.writeMessage(a,Rv,i)},writePackedFixed64:function(a,i){i.length&&this.writeMessage(a,Mg,i)},writePackedSFixed64:function(a,i){i.length&&this.writeMessage(a,Eh,i)},writeBytesField:function(a,i){this.writeTag(a,Un.Bytes),this.writeBytes(i)},writeFixed32Field:function(a,i){this.writeTag(a,Un.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(a,i){this.writeTag(a,Un.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(a,i){this.writeTag(a,Un.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(a,i){this.writeTag(a,Un.Fixed64),this.writeSFixed64(i)},writeVarintField:function(a,i){this.writeTag(a,Un.Varint),this.writeVarint(i)},writeSVarintField:function(a,i){this.writeTag(a,Un.Varint),this.writeSVarint(i)},writeStringField:function(a,i){this.writeTag(a,Un.Bytes),this.writeString(i)},writeFloatField:function(a,i){this.writeTag(a,Un.Fixed32),this.writeFloat(i)},writeDoubleField:function(a,i){this.writeTag(a,Un.Fixed64),this.writeDouble(i)},writeBooleanField:function(a,i){this.writeVarintField(a,Boolean(i))}};class Th{constructor(i,{pixelRatio:l,version:c,stretchX:f,stretchY:_,content:y}){this.paddedRect=i,this.pixelRatio=l,this.stretchX=f,this.stretchY=_,this.content=y,this.version=c}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class yp{constructor(i,l){const c={},f={};this.haveRenderCallbacks=[];const _=[];this.addImages(i,c,_),this.addImages(l,f,_);const{w:y,h:w}=gl(_),C=new si({width:y||1,height:w||1});for(const D in i){const I=i[D],R=c[D].paddedRect;si.copy(I.data,C,{x:0,y:0},{x:R.x+1,y:R.y+1},I.data)}for(const D in l){const I=l[D],R=f[D].paddedRect,k=R.x+1,N=R.y+1,H=I.data.width,q=I.data.height;si.copy(I.data,C,{x:0,y:0},{x:k,y:N},I.data),si.copy(I.data,C,{x:0,y:q-1},{x:k,y:N-1},{width:H,height:1}),si.copy(I.data,C,{x:0,y:0},{x:k,y:N+q},{width:H,height:1}),si.copy(I.data,C,{x:H-1,y:0},{x:k-1,y:N},{width:1,height:q}),si.copy(I.data,C,{x:0,y:0},{x:k+H,y:N},{width:1,height:q})}this.image=C,this.iconPositions=c,this.patternPositions=f}addImages(i,l,c){for(const f in i){const _=i[f],y={x:0,y:0,w:_.data.width+2,h:_.data.height+2};c.push(y),l[f]=new Th(y,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(i,l){i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in i.updatedImages)this.patchUpdatedImage(this.iconPositions[c],i.getImage(c),l),this.patchUpdatedImage(this.patternPositions[c],i.getImage(c),l)}patchUpdatedImage(i,l,c){if(!i||!l||i.version===l.version)return;i.version=l.version;const[f,_]=i.tl;c.update(l.data,void 0,{x:f,y:_})}}yt("ImagePosition",Th),yt("ImageAtlas",yp);const Mo={horizontal:1,vertical:2,horizontalOnly:3};class dc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,l){const c=new dc;return c.scale=i||1,c.fontStack=l,c}static forImage(i){const l=new dc;return l.imageName=i,l}}class xu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,l){const c=new xu;for(let f=0;f<i.sections.length;f++){const _=i.sections[f];_.image?c.addImageSection(_):c.addTextSection(_,l)}return c}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSections(){return this.sections}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(i){this.text=function(l,c){let f="";for(let _=0;_<l.length;_++){const y=l.charCodeAt(_+1)||null,w=l.charCodeAt(_-1)||null;f+=!c&&(y&&fd(y)&&!Bi[l[_+1]]||w&&fd(w)&&!Bi[l[_-1]])||!Bi[l[_]]?l[_]:Bi[l[_]]}return f}(this.text,i)}trim(){let i=0;for(let c=0;c<this.text.length&&Od[this.text.charCodeAt(c)];c++)i++;let l=this.text.length;for(let c=this.text.length-1;c>=0&&c>=i&&Od[this.text.charCodeAt(c)];c--)l--;this.text=this.text.substring(i,l),this.sectionIndex=this.sectionIndex.slice(i,l)}substring(i,l){const c=new xu;return c.text=this.text.substring(i,l),c.sectionIndex=this.sectionIndex.slice(i,l),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,l)=>Math.max(i,this.sections[l].scale),0)}addTextSection(i,l){this.text+=i.text,this.sections.push(dc.forText(i.scale,i.fontStack||l));const c=this.sections.length-1;for(let f=0;f<i.text.length;++f)this.sectionIndex.push(c)}addImageSection(i){const l=i.image?i.image.name:"";if(0===l.length)return void Qn("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(dc.forImage(l)),this.sectionIndex.push(this.sections.length-1)):Qn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function vp(a,i,l,c,f,_,y,w,C,D,I,R,k,N,H,q){const te=xu.fromFeature(a,f);let de;R===Mo.vertical&&te.verticalizePunctuation(k);const{processBidirectionalText:_e,processStyledBidirectionalText:Se}=U;if(_e&&1===te.sections.length){de=[];const ke=_e(te.toString(),Dh(te,D,_,i,c,N,H));for(const He of ke){const Je=new xu;Je.text=He,Je.sections=te.sections;for(let Qe=0;Qe<He.length;Qe++)Je.sectionIndex.push(0);de.push(Je)}}else if(Se){de=[];const ke=Se(te.text,te.sectionIndex,Dh(te,D,_,i,c,N,H));for(const He of ke){const Je=new xu;Je.text=He[0],Je.sectionIndex=He[1],Je.sections=te.sections,de.push(Je)}}else de=function(ke,He){const Je=[],Qe=ke.text;let st=0;for(const Ze of He)Je.push(ke.substring(st,Ze)),st=Ze;return st<Qe.length&&Je.push(ke.substring(st,Qe.length)),Je}(te,Dh(te,D,_,i,c,N,H));const Ie=[],Me={positionedLines:Ie,text:te.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:R,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ke,He,Je,Qe,st,Ze,Ye,dt,We,Vt,xt,An){let Ot=0,dn=0,Rt=0;const Lt="right"===dt?1:"left"===dt?0:.5;let fn=!1;for(const Ln of st){const kn=Ln.getSections();for(const _i of kn){if(_i.imageName)continue;const wr=He[_i.fontStack];if(wr&&(fn=void 0!==wr.ascender&&void 0!==wr.descender,!fn))break}if(!fn)break}let li=0;for(const Ln of st){Ln.trim();const kn=Ln.getMaxScale(),_i=24*(kn-1),wr={positionedGlyphs:[],lineOffset:0};ke.positionedLines[li]=wr;const Kr=wr.positionedGlyphs;let Ur=0;if(!Ln.length()){dn+=Ze,++li;continue}let jn=0,Ii=0;for(let En=0;En<Ln.length();En++){const cr=Ln.getSection(En),ji=Ln.getSectionIndex(En),ci=Ln.getCharCode(En);let Mr=cr.scale,pn=null,Mi=null,yi=null,eo=24,ns=0;const ko=!(We===Mo.horizontal||!xt&&!va(ci)||xt&&(Od[ci]||(lr=ci,mi(lr)||So(lr)||rh(lr)||ec(lr)||Gn(lr))));if(cr.imageName){const ws=Qe[cr.imageName];if(!ws)continue;yi=cr.imageName,ke.iconsInText=ke.iconsInText||!0,Mi=ws.paddedRect;const Ri=ws.displaySize;Mr=24*Mr/An,pn={width:Ri[0],height:Ri[1],left:1,top:-3,advance:ko?Ri[1]:Ri[0],localGlyph:!1},ns=fn?-pn.height*Mr:24*kn-17-Ri[1]*Mr,eo=pn.advance;const Es=(ko?Ri[0]:Ri[1])*Mr-24*kn;Es>0&&Es>Ur&&(Ur=Es)}else{const ws=Je[cr.fontStack];if(!ws)continue;ws[ci]&&(Mi=ws[ci]);const Ri=He[cr.fontStack];if(!Ri)continue;const Es=Ri.glyphs[ci];if(!Es)continue;if(pn=Es.metrics,eo=8203!==ci?24:0,fn){const xc=void 0!==Ri.ascender?Math.abs(Ri.ascender):0,to=void 0!==Ri.descender?Math.abs(Ri.descender):0,Oh=(xc+to)*Mr;jn<Oh&&(jn=Oh,Ii=(xc-to)/2*Mr),ns=-xc*Mr}else ns=24*(kn-Mr)-17}ko?(ke.verticalizable=!0,Kr.push({glyph:ci,imageName:yi,x:Ot,y:dn+ns,vertical:ko,scale:Mr,localGlyph:pn.localGlyph,fontStack:cr.fontStack,sectionIndex:ji,metrics:pn,rect:Mi}),Ot+=eo*Mr+Vt):(Kr.push({glyph:ci,imageName:yi,x:Ot,y:dn+ns,vertical:ko,scale:Mr,localGlyph:pn.localGlyph,fontStack:cr.fontStack,sectionIndex:ji,metrics:pn,rect:Mi}),Ot+=pn.advance*Mr+Vt)}0!==Kr.length&&(Rt=Math.max(Ot-Vt,Rt),fn?Og(Kr,Lt,Ur,Ii,Ze*kn/2):Og(Kr,Lt,Ur,0,Ze/2)),Ot=0;const pr=Ze*kn+Ur;wr.lineOffset=Math.max(Ur,_i),dn+=pr,++li}var lr;const Ir=dn,{horizontalAlign:Br,verticalAlign:br}=bp(Ye);(function(Ln,kn,_i,wr,Kr,Ur){const jn=(kn-_i)*Kr,Ii=-Ur*wr;for(const pr of Ln)for(const En of pr.positionedGlyphs)En.x+=jn,En.y+=Ii})(ke.positionedLines,Lt,Br,br,Rt,Ir),ke.top+=-br*Ir,ke.bottom=ke.top+Ir,ke.left+=-Br*Rt,ke.right=ke.left+Rt,ke.hasBaseline=fn}(Me,i,l,c,de,y,w,C,R,D,k,q),!function(ke){for(const He of ke)if(0!==He.positionedGlyphs.length)return!1;return!0}(Ie)&&Me}const Od={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},kv={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function kg(a,i,l,c,f,_){if(i.imageName){const y=c[i.imageName];return y?y.displaySize[0]*i.scale*24/_+f:0}{const y=l[i.fontStack],w=y&&y.glyphs[a];return w?w.metrics.advance*i.scale+f:0}}function Pg(a,i,l,c){const f=Math.pow(a-i,2);return c?a<i?f/2:2*f:f+Math.abs(l)*l}function Fg(a,i,l){let c=0;return 10===a&&(c-=1e4),l&&(c+=150),40!==a&&65288!==a||(c+=50),41!==i&&65289!==i||(c+=50),c}function Ld(a,i,l,c,f,_){let y=null,w=Pg(i,l,f,_);for(const C of c){const D=Pg(i-C.x,l,f,_)+C.badness;D<=w&&(y=C,w=D)}return{index:a,x:i,priorBreak:y,badness:w}}function xp(a){return a?xp(a.priorBreak).concat(a.index):[]}function Dh(a,i,l,c,f,_,y){if("point"!==_)return[];if(!a)return[];const w=[],C=function(k,N,H,q,te,de){let _e=0;for(let Se=0;Se<k.length();Se++){const Ie=k.getSection(Se);_e+=kg(k.getCharCode(Se),Ie,q,te,N,de)}return _e/Math.max(1,Math.ceil(_e/H))}(a,i,l,c,f,y),D=a.text.indexOf("\u200b")>=0;let I=0;for(let k=0;k<a.length();k++){const N=a.getSection(k),H=a.getCharCode(k);if(Od[H]||(I+=kg(H,N,c,f,i,y)),k<a.length()-1){const q=!((R=H)<11904||!(Xl(R)||Wl(R)||ri(R)||Jl(R)||Yl(R)||Ko(R)||nu(R)||Vs(R)||Ql(R)||iu(R)||ru(R)||cl(R)||ih(R)||ud(R)||Yo(R)||Kl(R)||tu(R)||hd(R)||oh(R)||ll(R)));(kv[H]||q||N.imageName)&&w.push(Ld(k+1,I,C,w,Fg(H,a.getCharCode(k+1),q&&D),!1))}}var R;return xp(Ld(a.length(),I,C,w,0,!0))}function bp(a){let i=.5,l=.5;switch(a){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:i,verticalAlign:l}}function Og(a,i,l,c,f){if(!(i||l||c||f))return;const _=a.length-1,y=a[_],w=(y.x+y.metrics.advance*y.scale)*i;for(let C=0;C<=_;C++)a[C].x-=w,a[C].y+=l+c+f}function Lg(a,i,l){const{horizontalAlign:c,verticalAlign:f}=bp(l),_=i[0]-a.displaySize[0]*c,y=i[1]-a.displaySize[1]*f;return{image:a,top:y,bottom:y+a.displaySize[1],left:_,right:_+a.displaySize[0]}}function wp(a,i,l,c,f,_){const y=a.image;let w;if(y.content){const te=y.content,de=y.pixelRatio||1;w=[te[0]/de,te[1]/de,y.displaySize[0]-te[2]/de,y.displaySize[1]-te[3]/de]}const C=i.left*_,D=i.right*_;let I,R,k,N;"width"===l||"both"===l?(N=f[0]+C-c[3],R=f[0]+D+c[1]):(N=f[0]+(C+D-y.displaySize[0])/2,R=N+y.displaySize[0]);const H=i.top*_,q=i.bottom*_;return"height"===l||"both"===l?(I=f[1]+H-c[0],k=f[1]+q+c[2]):(I=f[1]+(H+q-y.displaySize[1])/2,k=I+y.displaySize[1]),{image:y,top:I,right:R,bottom:k,left:N,collisionPadding:w}}class co extends ne{constructor(i,l,c,f,_){super(i,l),this.angle=f,this.z=c,void 0!==_&&(this.segment=_)}clone(){return new co(this.x,this.y,this.z,this.angle,this.segment)}}function Ep(a,i,l,c,f){if(void 0===i.segment)return!0;let _=i,y=i.segment+1,w=0;for(;w>-l/2;){if(y--,y<0)return!1;w-=a[y].dist(_),_=a[y]}w+=a[y].dist(a[y+1]),y++;const C=[];let D=0;for(;w<l/2;){const I=a[y],R=a[y+1];if(!R)return!1;let k=a[y-1].angleTo(I)-I.angleTo(R);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:w,angleDelta:k}),D+=k;w-C[0].distance>c;)D-=C.shift().angleDelta;if(D>f)return!1;y++,w+=I.dist(R)}return!0}function Cp(a){let i=0;for(let l=0;l<a.length-1;l++)i+=a[l].dist(a[l+1]);return i}function Ng(a,i,l){return a?.6*i*l:0}function Sh(a,i){return Math.max(a?a.right-a.left:0,i?i.right-i.left:0)}function Pv(a,i,l,c,f,_){const y=Ng(l,f,_),w=Sh(l,c)*_;let C=0;const D=Cp(a)/2;for(let I=0;I<a.length-1;I++){const R=a[I],k=a[I+1],N=R.dist(k);if(C+N>D){const H=(D-C)/N,q=Dn(R.x,k.x,H),te=Dn(R.y,k.y,H),de=new co(q,te,0,k.angleTo(R),I);return!y||Ep(a,de,w,y,i)?de:void 0}C+=N}}function zg(a,i,l,c,f,_,y,w,C){const D=Ng(c,_,y),I=Sh(c,f),R=I*y,k=0===a[0].x||a[0].x===C||0===a[0].y||a[0].y===C;return i-R<i/4&&(i=R+i/4),Tp(a,k?i/2*w%i:(I/2+2*_)*y*w%i,i,D,l,R,k,!1,C)}function Tp(a,i,l,c,f,_,y,w,C){const D=_/2,I=Cp(a);let R=0,k=i-l,N=[];for(let H=0;H<a.length-1;H++){const q=a[H],te=a[H+1],de=q.dist(te),_e=te.angleTo(q);for(;k+l<R+de;){k+=l;const Se=(k-R)/de,Ie=Dn(q.x,te.x,Se),Me=Dn(q.y,te.y,Se);if(Ie>=0&&Ie<C&&Me>=0&&Me<C&&k-D>=0&&k+D<=I){const ke=new co(Ie,Me,0,_e,H);ke._round(),c&&!Ep(a,ke,_,c,f)||N.push(ke)}}R+=de}return w||N.length||y||(N=Tp(a,R/2,l,c,f,_,y,!0,C)),N}function Dp(a,i,l,c,f){const _=[];for(let y=0;y<a.length;y++){const w=a[y];let C;for(let D=0;D<w.length-1;D++){let I=w[D],R=w[D+1];I.x<i&&R.x<i||(I.x<i?I=new ne(i,I.y+(i-I.x)/(R.x-I.x)*(R.y-I.y))._round():R.x<i&&(R=new ne(i,I.y+(i-I.x)/(R.x-I.x)*(R.y-I.y))._round()),I.y<l&&R.y<l||(I.y<l?I=new ne(I.x+(l-I.y)/(R.y-I.y)*(R.x-I.x),l)._round():R.y<l&&(R=new ne(I.x+(l-I.y)/(R.y-I.y)*(R.x-I.x),l)._round()),I.x>=c&&R.x>=c||(I.x>=c?I=new ne(c,I.y+(c-I.x)/(R.x-I.x)*(R.y-I.y))._round():R.x>=c&&(R=new ne(c,I.y+(c-I.x)/(R.x-I.x)*(R.y-I.y))._round()),I.y>=f&&R.y>=f||(I.y>=f?I=new ne(I.x+(f-I.y)/(R.y-I.y)*(R.x-I.x),f)._round():R.y>=f&&(R=new ne(I.x+(f-I.y)/(R.y-I.y)*(R.x-I.x),f)._round()),C&&I.equals(C[C.length-1])||(C=[I],_.push(C)),C.push(R)))))}}return _}yt("Anchor",co);const fc=1e20;function Sp(a,i,l,c,f,_,y,w,C){for(let D=i;D<i+c;D++)Ah(a,l*_+D,_,f,y,w,C);for(let D=l;D<l+f;D++)Ah(a,D*_+i,1,c,y,w,C)}function Ah(a,i,l,c,f,_,y){_[0]=0,y[0]=-fc,y[1]=fc,f[0]=a[i];for(let w=1,C=0,D=0;w<c;w++){f[w]=a[i+w*l];const I=w*w;do{const R=_[C];D=(f[w]-f[R]+I-R*R)/(w-R)/2}while(D<=y[C]&&--C>-1);C++,_[C]=w,y[C]=D,y[C+1]=fc}for(let w=0,C=0;w<c;w++){for(;y[C+1]<w;)C++;const D=_[C],I=w-D;a[i+w*l]=f[D]+I*I}}const bu={none:0,ideographs:1,all:2};class pc{constructor(i,l,c){this.requestManager=i,this.localGlyphMode=l,this.localFontFamily=c,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(i){this.url=i}getGlyphs(i,l){const c=[];for(const f in i)for(const _ of i[f])c.push({stack:f,id:_});ze(c,({stack:f,id:_},y)=>{let w=this.entries[f];w||(w=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let C=w.glyphs[_];if(void 0!==C)return void y(null,{stack:f,id:_,glyph:C});if(C=this._tinySDF(w,f,_),C)return w.glyphs[_]=C,void y(null,{stack:f,id:_,glyph:C});const D=Math.floor(_/256);if(256*D>65535)return void y(new Error("glyphs > 65535 not supported"));if(w.ranges[D])return void y(null,{stack:f,id:_,glyph:C});let I=w.requests[D];I||(I=w.requests[D]=[],pc.loadGlyphRange(f,D,this.url,this.requestManager,(R,k)=>{if(k){w.ascender=k.ascender,w.descender=k.descender;for(const N in k.glyphs)this._doesCharSupportLocalGlyph(+N)||(w.glyphs[+N]=k.glyphs[+N]);w.ranges[D]=!0}for(const N of I)N(R,k);delete w.requests[D]})),I.push((R,k)=>{R?y(R):k&&y(null,{stack:f,id:_,glyph:k.glyphs[_]||null})})},(f,_)=>{if(f)l(f);else if(_){const y={};for(const{stack:w,id:C,glyph:D}of _)void 0===y[w]&&(y[w]={}),void 0===y[w].glyphs&&(y[w].glyphs={}),y[w].glyphs[C]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics},y[w].ascender=this.entries[w].ascender,y[w].descender=this.entries[w].descender;l(null,y)}})}_doesCharSupportLocalGlyph(i){return this.localGlyphMode!==bu.none&&(this.localGlyphMode===bu.all?!!this.localFontFamily:!!this.localFontFamily&&(iu(i)||Bs(i)||ih(i)||tu(i))||Vs(i))}_tinySDF(i,l,c){const f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(c))return;let _=i.tinySDF;if(!_){let q="400";/bold/i.test(l)?q="900":/medium/i.test(l)?q="500":/light/i.test(l)&&(q="200"),_=i.tinySDF=new pc.TinySDF({fontFamily:f,fontWeight:q,fontSize:48,buffer:6,radius:16}),_.fontWeight=q}if(this.localGlyphs[_.fontWeight][c])return this.localGlyphs[_.fontWeight][c];const y=String.fromCharCode(c),{data:w,width:C,height:D,glyphWidth:I,glyphHeight:R,glyphLeft:k,glyphTop:N,glyphAdvance:H}=_.draw(y);return this.localGlyphs[_.fontWeight][c]={id:c,bitmap:new Ca({width:C,height:D},w),metrics:{width:I/2,height:R/2,left:k/2,top:N/2-27,advance:H/2,localGlyph:!0}}}}function Nd(a,i,l,c){const f=[],_=a.image,y=_.pixelRatio,w=_.paddedRect.w-2,C=_.paddedRect.h-2,D=a.right-a.left,I=a.bottom-a.top,R=_.stretchX||[[0,w]],k=_.stretchY||[[0,C]],N=(Ze,Ye)=>Ze+Ye[1]-Ye[0],H=R.reduce(N,0),q=k.reduce(N,0),te=w-H,de=C-q;let _e=0,Se=H,Ie=0,Me=q,ke=0,He=te,Je=0,Qe=de;if(_.content&&c){const Ze=_.content;_e=Ih(R,0,Ze[0]),Ie=Ih(k,0,Ze[1]),Se=Ih(R,Ze[0],Ze[2]),Me=Ih(k,Ze[1],Ze[3]),ke=Ze[0]-_e,Je=Ze[1]-Ie,He=Ze[2]-Ze[0]-Se,Qe=Ze[3]-Ze[1]-Me}const st=(Ze,Ye,dt,We)=>{const Vt=_l(Ze.stretch-_e,Se,D,a.left),xt=Vd(Ze.fixed-ke,He,Ze.stretch,H),An=_l(Ye.stretch-Ie,Me,I,a.top),Ot=Vd(Ye.fixed-Je,Qe,Ye.stretch,q),dn=_l(dt.stretch-_e,Se,D,a.left),Rt=Vd(dt.fixed-ke,He,dt.stretch,H),Lt=_l(We.stretch-Ie,Me,I,a.top),fn=Vd(We.fixed-Je,Qe,We.stretch,q),li=new ne(Vt,An),lr=new ne(dn,An),Ir=new ne(dn,Lt),Br=new ne(Vt,Lt),br=new ne(xt/y,Ot/y),Ln=new ne(Rt/y,fn/y),kn=i*Math.PI/180;if(kn){const Kr=Math.sin(kn),Ur=Math.cos(kn),jn=[Ur,-Kr,Kr,Ur];li._matMult(jn),lr._matMult(jn),Br._matMult(jn),Ir._matMult(jn)}const _i=Ze.stretch+Ze.fixed,wr=Ye.stretch+Ye.fixed;return{tl:li,tr:lr,bl:Br,br:Ir,tex:{x:_.paddedRect.x+1+_i,y:_.paddedRect.y+1+wr,w:dt.stretch+dt.fixed-_i,h:We.stretch+We.fixed-wr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:br,pixelOffsetBR:Ln,minFontScaleX:He/y/D,minFontScaleY:Qe/y/I,isSDF:l}};if(c&&(_.stretchX||_.stretchY)){const Ze=zd(R,te,H),Ye=zd(k,de,q);for(let dt=0;dt<Ze.length-1;dt++){const We=Ze[dt],Vt=Ze[dt+1];for(let xt=0;xt<Ye.length-1;xt++)f.push(st(We,Ye[xt],Vt,Ye[xt+1]))}}else f.push(st({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:C+1}));return f}function Ih(a,i,l){let c=0;for(const f of a)c+=Math.max(i,Math.min(l,f[1]))-Math.max(i,Math.min(l,f[0]));return c}function zd(a,i,l){const c=[{fixed:-1,stretch:0}];for(const[f,_]of a){const y=c[c.length-1];c.push({fixed:f-y.stretch,stretch:y.stretch}),c.push({fixed:f-y.stretch,stretch:y.stretch+(_-f)})}return c.push({fixed:i+1,stretch:l}),c}function _l(a,i,l,c){return a/i*l+c}function Vd(a,i,l,c){return a-i*l/c}function Vg(a,i,l,c){const f=i+a.positionedLines[c].lineOffset;return 0===c?l+f/2:l+(f+(i+a.positionedLines[c-1].lineOffset))/2}pc.loadGlyphRange=function(a,i,l,c,f){const _=256*i,y=_+255,w=c.transformRequest(c.normalizeGlyphsURL(l).replace("{fontstack}",a).replace("{range}",`${_}-${y}`),us.Glyphs);O(w,(C,D)=>{if(C)f(C);else if(D){const I={},R=new Pd(D).readFields(_p,{});for(const k of R.glyphs)I[k.id]=k;f(null,{glyphs:I,ascender:R.ascender,descender:R.descender})}})},pc.TinySDF=class{constructor({fontSize:a=24,buffer:i=3,radius:l=8,cutoff:c=.25,fontFamily:f="sans-serif",fontWeight:_="normal",fontStyle:y="normal"}){this.buffer=i,this.cutoff=c,this.radius=l;const w=this.size=a+4*i,C=this._createCanvas(w),D=this.ctx=C.getContext("2d",{willReadFrequently:!0});D.font=`${y} ${_} ${a}px ${f}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(a){const i=document.createElement("canvas");return i.width=i.height=a,i}draw(a){const{width:i,actualBoundingBoxAscent:l,actualBoundingBoxDescent:c,actualBoundingBoxLeft:f,actualBoundingBoxRight:_}=this.ctx.measureText(a),y=Math.floor(l),w=Math.min(this.size-this.buffer,Math.ceil(_-f)),C=Math.min(this.size-this.buffer,Math.ceil(l)+Math.ceil(c)),D=w+2*this.buffer,I=C+2*this.buffer,R=D*I,k=new Uint8ClampedArray(R),N={data:k,width:D,height:I,glyphWidth:w,glyphHeight:C,glyphTop:y,glyphLeft:0,glyphAdvance:i};if(0===w||0===C)return N;const{ctx:H,buffer:q,gridInner:te,gridOuter:de}=this;H.clearRect(q,q,w,C),H.fillText(a,q,q+y+1);const _e=H.getImageData(q,q,w,C);de.fill(fc,0,R),te.fill(0,0,R);for(let Se=0;Se<C;Se++)for(let Ie=0;Ie<w;Ie++){const Me=_e.data[4*(Se*w+Ie)+3]/255;if(0===Me)continue;const ke=(Se+q)*D+Ie+q;if(1===Me)de[ke]=0,te[ke]=fc;else{const He=.5-Me;de[ke]=He>0?He*He:0,te[ke]=He<0?He*He:0}}Sp(de,0,0,D,I,D,this.f,this.v,this.z),Sp(te,q,q,w,C,D,this.f,this.v,this.z);for(let Se=0;Se<R;Se++){const Ie=Math.sqrt(de[Se])-Math.sqrt(te[Se]);k[Se]=Math.round(255-255*(Ie/this.radius+this.cutoff))}return N}};class Fv{constructor(i=[],l=Ov){if(this.data=i,this.length=this.data.length,this.compare=l,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(i){this.data.push(i),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const i=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:l,compare:c}=this,f=l[i];for(;i>0;){const _=i-1>>1,y=l[_];if(c(f,y)>=0)break;l[i]=y,i=_}l[i]=f}_down(i){const{data:l,compare:c}=this,f=this.length>>1,_=l[i];for(;i<f;){let y=1+(i<<1),w=l[y];const C=y+1;if(C<this.length&&c(l[C],w)<0&&(y=C,w=l[C]),c(w,_)>=0)break;l[i]=w,i=y}l[i]=_}}function Ov(a,i){return a<i?-1:a>i?1:0}function Bg(a,i=1,l=!1){let c=1/0,f=1/0,_=-1/0,y=-1/0;const w=a[0];for(let N=0;N<w.length;N++){const H=w[N];(!N||H.x<c)&&(c=H.x),(!N||H.y<f)&&(f=H.y),(!N||H.x>_)&&(_=H.x),(!N||H.y>y)&&(y=H.y)}const C=Math.min(_-c,y-f);let D=C/2;const I=new Fv([],Ap);if(0===C)return new ne(c,f);for(let N=c;N<_;N+=C)for(let H=f;H<y;H+=C)I.push(new mc(N+D,H+D,D,a));let R=function(N){let H=0,q=0,te=0;const de=N[0];for(let _e=0,Se=de.length,Ie=Se-1;_e<Se;Ie=_e++){const Me=de[_e],ke=de[Ie],He=Me.x*ke.y-ke.x*Me.y;q+=(Me.x+ke.x)*He,te+=(Me.y+ke.y)*He,H+=3*He}return new mc(q/H,te/H,0,N)}(a),k=I.length;for(;I.length;){const N=I.pop();(N.d>R.d||!R.d)&&(R=N,l&&console.log("found best %d after %d probes",Math.round(1e4*N.d)/1e4,k)),N.max-R.d<=i||(D=N.h/2,I.push(new mc(N.p.x-D,N.p.y-D,D,a)),I.push(new mc(N.p.x+D,N.p.y-D,D,a)),I.push(new mc(N.p.x-D,N.p.y+D,D,a)),I.push(new mc(N.p.x+D,N.p.y+D,D,a)),k+=4)}return l&&(console.log(`num probes: ${k}`),console.log(`best distance: ${R.d}`)),R.p}function Ap(a,i){return i.max-a.max}function mc(a,i,l,c){this.p=new ne(a,i),this.h=l,this.d=function(f,_){let y=!1,w=1/0;for(let C=0;C<_.length;C++){const D=_[C];for(let I=0,R=D.length,k=R-1;I<R;k=I++){const N=D[I],H=D[k];N.y>f.y!=H.y>f.y&&f.x<(H.x-N.x)*(f.y-N.y)/(H.y-N.y)+N.x&&(y=!y),w=Math.min(w,eg(f,N,H))}}return(y?1:-1)*Math.sqrt(w)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}const Ug=Number.POSITIVE_INFINITY,jg=Math.sqrt(2);function $g(a,i){return i[1]!==Ug?function(l,c,f){let _=0,y=0;switch(c=Math.abs(c),f=Math.abs(f),l){case"top-right":case"top-left":case"top":y=f-7;break;case"bottom-right":case"bottom-left":case"bottom":y=7-f}switch(l){case"top-right":case"bottom-right":case"right":_=-c;break;case"top-left":case"bottom-left":case"left":_=c}return[_,y]}(a,i[0],i[1]):function(l,c){let f=0,_=0;c<0&&(c=0);const y=c/jg;switch(l){case"top-right":case"top-left":_=y-7;break;case"bottom-right":case"bottom-left":_=7-y;break;case"bottom":_=7-c;break;case"top":_=c-7}switch(l){case"top-right":case"bottom-right":f=-y;break;case"top-left":case"bottom-left":f=y;break;case"left":f=c;break;case"right":f=-c}return[f,_]}(a,i[0])}function Hg(a,i,l,c,f,_,y,w){a.createArrays(),a.tilePixelRatio=Sn/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const C=a.layers[0].layout,D=a.layers[0]._unevaluatedLayout._values,I={};if("composite"===a.textSizeData.kind){const{minZoom:N,maxZoom:H}=a.textSizeData;I.compositeTextSizes=[D["text-size"].possiblyEvaluate(new $(N),y),D["text-size"].possiblyEvaluate(new $(H),y)]}if("composite"===a.iconSizeData.kind){const{minZoom:N,maxZoom:H}=a.iconSizeData;I.compositeIconSizes=[D["icon-size"].possiblyEvaluate(new $(N),y),D["icon-size"].possiblyEvaluate(new $(H),y)]}I.layoutTextSize=D["text-size"].possiblyEvaluate(new $(w+1),y),I.layoutIconSize=D["icon-size"].possiblyEvaluate(new $(w+1),y),I.textMaxSize=D["text-size"].possiblyEvaluate(new $(18),y);const R="map"===C.get("text-rotation-alignment")&&"point"!==C.get("symbol-placement"),k=C.get("text-size");for(const N of a.features){const H=C.get("text-font").evaluate(N,{},y).join(","),q=k.evaluate(N,{},y),te=I.layoutTextSize.evaluate(N,{},y),de=(I.layoutIconSize.evaluate(N,{},y),{horizontal:{},vertical:void 0}),_e=N.text;let Se,Ie=[0,0];if(_e){const He=_e.toString(),Je=24*C.get("text-letter-spacing").evaluate(N,{},y),Qe=24*C.get("text-line-height").evaluate(N,{},y),st=Xf(He)?Je:0,Ze=C.get("text-anchor").evaluate(N,{},y),Ye=C.get("text-variable-anchor");if(!Ye){const Ot=C.get("text-radial-offset").evaluate(N,{},y);Ie=Ot?$g(Ze,[24*Ot,Ug]):C.get("text-offset").evaluate(N,{},y).map(dn=>24*dn)}let dt=R?"center":C.get("text-justify").evaluate(N,{},y);const We=C.get("symbol-placement"),Vt="point"===We,xt="point"===We?24*C.get("text-max-width").evaluate(N,{},y):0,An=Ot=>{a.allowVerticalPlacement&&ya(He)&&(de.vertical=vp(_e,i,l,f,H,xt,Qe,Ze,Ot,st,Ie,Mo.vertical,!0,We,te,q))};if(!R&&Ye){const Ot="auto"===dt?Ye.map(Rt=>Ip(Rt)):[dt];let dn=!1;for(let Rt=0;Rt<Ot.length;Rt++){const Lt=Ot[Rt];if(!de.horizontal[Lt])if(dn)de.horizontal[Lt]=de.horizontal[0];else{const fn=vp(_e,i,l,f,H,xt,Qe,"center",Lt,st,Ie,Mo.horizontal,!1,We,te,q);fn&&(de.horizontal[Lt]=fn,dn=1===fn.positionedLines.length)}}An("left")}else{if("auto"===dt&&(dt=Ip(Ze)),Vt||C.get("text-writing-mode").indexOf("horizontal")>=0||!ya(He)){const Ot=vp(_e,i,l,f,H,xt,Qe,Ze,dt,st,Ie,Mo.horizontal,!1,We,te,q);Ot&&(de.horizontal[dt]=Ot)}An("point"===We?"left":dt)}}let Me=!1;if(N.icon&&N.icon.name){const He=c[N.icon.name];He&&(Se=Lg(f[N.icon.name],C.get("icon-offset").evaluate(N,{},y),C.get("icon-anchor").evaluate(N,{},y)),Me=He.sdf,void 0===a.sdfIcons?a.sdfIcons=He.sdf:a.sdfIcons!==He.sdf&&Qn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(He.pixelRatio!==a.pixelRatio||0!==C.get("icon-rotate").constantOr(1))&&(a.iconsNeedLinear=!0))}const ke=Mp(de.horizontal)||de.vertical;a.iconsInText||(a.iconsInText=!!ke&&ke.iconsInText),(ke||Se)&&Lv(a,N,de,Se,c,I,te,0,Ie,Me,y)}_&&a.generateCollisionDebugBuffers(w,a.collisionBoxArray)}function Ip(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Lv(a,i,l,c,f,_,y,w,C,D,I){let R=_.textMaxSize.evaluate(i,{},I);void 0===R&&(R=y);const k=a.layers[0].layout,N=k.get("icon-offset").evaluate(i,{},I),H=Mp(l.horizontal)||l.vertical,q=y/24,te=a.tilePixelRatio*R/24,de=a.tilePixelRatio*k.get("symbol-spacing"),_e=k.get("text-padding")*a.tilePixelRatio,Se=k.get("icon-padding")*a.tilePixelRatio,Ie=Pe(k.get("text-max-angle")),Me="map"===k.get("text-rotation-alignment")&&"point"!==k.get("symbol-placement"),ke="map"===k.get("icon-rotation-alignment")&&"point"!==k.get("symbol-placement"),He=k.get("symbol-placement"),Je=de/2,Qe=k.get("icon-text-fit");let st;c&&"none"!==Qe&&(a.allowVerticalPlacement&&l.vertical&&(st=wp(c,l.vertical,Qe,k.get("icon-text-fit-padding"),N,q)),H&&(c=wp(c,H,Qe,k.get("icon-text-fit-padding"),N,q)));const Ze=(Ye,dt)=>{dt.x<0||dt.x>=Sn||dt.y<0||dt.y>=Sn||function(We,Vt,xt,An,Ot,dn,Rt,Lt,fn,li,lr,Ir,Br,br,Ln,kn,_i,wr,Kr,Ur,jn,Ii,pr,En){const cr=We.addToLineVertexArray(Vt,An);let ji,ci,Mr,pn,Mi,yi,eo,ns=0,ko=0,ws=0,Ri=0,Es=-1,xc=-1;const to={};let Oh=md(""),Zp=0,Qd=0;if(void 0===fn._unevaluatedLayout.getValue("text-radial-offset")?[Zp,Qd]=fn.layout.get("text-offset").evaluate(jn,{},En).map(ho=>24*ho):(Zp=24*fn.layout.get("text-radial-offset").evaluate(jn,{},En),Qd=Ug),We.allowVerticalPlacement&&Ot.vertical){const ho=Ot.vertical;if(Ln)yi=Rp(ho),Lt&&(eo=Rp(Lt));else{const ui=fn.layout.get("text-rotate").evaluate(jn,{},En)+90;Mr=Bd(li,xt,Vt,lr,Ir,Br,ho,br,ui,kn),Lt&&(pn=Bd(li,xt,Vt,lr,Ir,Br,Lt,wr,ui))}}if(dn){const ho=fn.layout.get("icon-rotate").evaluate(jn,{},En),ui="none"!==fn.layout.get("icon-text-fit"),Lh=Nd(dn,ho,pr,ui),Wp=Lt?Nd(Lt,ho,pr,ui):void 0;ci=Bd(li,xt,Vt,lr,Ir,Br,dn,wr,ho),ns=4*Lh.length;const i_=We.iconSizeData;let bc=null;"source"===i_.kind?(bc=[Ws*fn.layout.get("icon-size").evaluate(jn,{},En)],bc[0]>gi&&Qn(`${We.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===i_.kind&&(bc=[Ws*Ii.compositeIconSizes[0].evaluate(jn,{},En),Ws*Ii.compositeIconSizes[1].evaluate(jn,{},En)],(bc[0]>gi||bc[1]>gi)&&Qn(`${We.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),We.addSymbols(We.icon,Lh,bc,Ur,Kr,jn,!1,xt,Vt,cr.lineStartIndex,cr.lineLength,-1,En),Es=We.icon.placedSymbolArray.length-1,Wp&&(ko=4*Wp.length,We.addSymbols(We.icon,Wp,bc,Ur,Kr,jn,Mo.vertical,xt,Vt,cr.lineStartIndex,cr.lineLength,-1,En),xc=We.icon.placedSymbolArray.length-1)}for(const ho in Ot.horizontal){const ui=Ot.horizontal[ho];ji||(Oh=md(ui.text),Ln?Mi=Rp(ui):ji=Bd(li,xt,Vt,lr,Ir,Br,ui,br,fn.layout.get("text-rotate").evaluate(jn,{},En),kn));const Lh=1===ui.positionedLines.length;if(ws+=Gg(We,xt,Vt,ui,Rt,fn,Ln,jn,kn,cr,Ot.vertical?Mo.horizontal:Mo.horizontalOnly,Lh?Object.keys(Ot.horizontal):[ho],to,Es,Ii,En),Lh)break}Ot.vertical&&(Ri+=Gg(We,xt,Vt,Ot.vertical,Rt,fn,Ln,jn,kn,cr,Mo.vertical,["vertical"],to,xc,Ii,En));let Po=-1;const Jd=(ho,ui)=>ho?Math.max(ho,ui):ui;Po=Jd(Mi,Po),Po=Jd(yi,Po),Po=Jd(eo,Po);const Xv=Po>-1?1:0;We.glyphOffsetArray.length>=Da.MAX_GLYPHS&&Qn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==jn.sortKey&&We.addToSortKeyRanges(We.symbolInstances.length,jn.sortKey),We.symbolInstances.emplaceBack(xt.x,xt.y,xt.z,Vt.x,Vt.y,to.right>=0?to.right:-1,to.center>=0?to.center:-1,to.left>=0?to.left:-1,to.vertical>=0?to.vertical:-1,Es,xc,Oh,void 0!==ji?ji:We.collisionBoxArray.length,void 0!==ji?ji+1:We.collisionBoxArray.length,void 0!==Mr?Mr:We.collisionBoxArray.length,void 0!==Mr?Mr+1:We.collisionBoxArray.length,void 0!==ci?ci:We.collisionBoxArray.length,void 0!==ci?ci+1:We.collisionBoxArray.length,pn||We.collisionBoxArray.length,pn?pn+1:We.collisionBoxArray.length,lr,ws,Ri,ns,ko,Xv,0,Zp,Qd,Po)}(a,dt,dt,Ye,l,c,f,st,a.layers[0],a.collisionBoxArray,i.index,i.sourceLayerIndex,a.index,_e,Me,C,0,Se,ke,N,i,_,D,I)};if("line"===He)for(const Ye of Dp(i.geometry,0,0,Sn,Sn)){const dt=zg(Ye,de,Ie,l.vertical||H,c,24,te,a.overscaling,Sn);for(const We of dt){const Vt=H;Vt&&Nv(a,Vt.text,Je,We)||Ze(Ye,We)}}else if("line-center"===He){for(const Ye of i.geometry)if(Ye.length>1){const dt=Pv(Ye,Ie,l.vertical||H,c,24,te);dt&&Ze(Ye,dt)}}else if("Polygon"===i.type)for(const Ye of sp(i.geometry,0)){const dt=Bg(Ye,16);Ze(Ye[0],new co(dt.x,dt.y,0,0,void 0))}else if("LineString"===i.type)for(const Ye of i.geometry)Ze(Ye,new co(Ye[0].x,Ye[0].y,0,0,void 0));else if("Point"===i.type)for(const Ye of i.geometry)for(const dt of Ye)Ze([dt],new co(dt.x,dt.y,0,0,void 0))}const gi=32640;function Gg(a,i,l,c,f,_,y,w,C,D,I,R,k,N,H,q){const te=function(Se,Ie,Me,ke,He,Je,Qe,st){const Ze=[];if(0===Ie.positionedLines.length)return Ze;const Ye=ke.layout.get("text-rotate").evaluate(Je,{})*Math.PI/180,dt=function(Ot){const dn=Ot[0],Rt=Ot[1],Lt=dn*Rt;return Lt>0?[dn,-Rt]:Lt<0?[-dn,Rt]:0===dn?[Rt,dn]:[Rt,-dn]}(Me);let We=Math.abs(Ie.top-Ie.bottom);for(const Ot of Ie.positionedLines)We-=Ot.lineOffset;const Vt=Ie.positionedLines.length,xt=We/Vt;let An=Ie.top-Me[1];for(let Ot=0;Ot<Vt;++Ot){const dn=Ie.positionedLines[Ot];An=Vg(Ie,xt,An,Ot);for(const Rt of dn.positionedGlyphs){if(!Rt.rect)continue;const Lt=Rt.rect||{};let fn=4,li=!0,lr=1,Ir=0;if(Rt.imageName){const pn=Qe[Rt.imageName];if(!pn)continue;if(pn.sdf){Qn("SDF images are not supported in formatted text and will be ignored.");continue}li=!1,lr=pn.pixelRatio,fn=1/lr}const Br=(He||st)&&Rt.vertical,br=Rt.metrics.advance*Rt.scale/2,Ln=Rt.metrics,kn=Rt.rect;if(null===kn)continue;st&&Ie.verticalizable&&(Ir=Rt.imageName?br-Rt.metrics.width*Rt.scale/2:0);const _i=He?[Rt.x+br,Rt.y]:[0,0];let wr=[0,0],Kr=[0,0],Ur=!1;He||(Br?(Kr=[Rt.x+br+dt[0],Rt.y+dt[1]-Ir],Ur=!0):wr=[Rt.x+br+Me[0],Rt.y+Me[1]-Ir]);const jn=kn.w*Rt.scale/(lr*(Rt.localGlyph?2:1)),Ii=kn.h*Rt.scale/(lr*(Rt.localGlyph?2:1));let pr,En,cr,ji;if(Br){const pn=Rt.y-An,Mi=new ne(-br,br-pn),yi=-Math.PI/2,eo=new ne(...Kr);pr=new ne(-br+wr[0],wr[1]),pr._rotateAround(yi,Mi)._add(eo),pr.x+=-pn+br,pr.y-=(Ln.left-fn)*Rt.scale;const ns=Rt.imageName?Ln.advance*Rt.scale:24*Rt.scale,ko=String.fromCharCode(Rt.glyph);Tg(ko)?pr.x+=(1-fn)*Rt.scale:Iv(ko)?pr.x+=ns-Ln.height*Rt.scale+(-fn-1)*Rt.scale:pr.x+=Rt.imageName||Ln.width+2*fn===kn.w&&Ln.height+2*fn===kn.h?(ns-Ii)/2:(ns-(Ln.height+2*fn)*Rt.scale)/2,En=new ne(pr.x,pr.y-jn),cr=new ne(pr.x+Ii,pr.y),ji=new ne(pr.x+Ii,pr.y-jn)}else{const pn=(Ln.left-fn)*Rt.scale-br+wr[0],Mi=(-Ln.top-fn)*Rt.scale+wr[1],yi=pn+jn,eo=Mi+Ii;pr=new ne(pn,Mi),En=new ne(yi,Mi),cr=new ne(pn,eo),ji=new ne(yi,eo)}if(Ye){let pn;pn=He?new ne(0,0):Ur?new ne(dt[0],dt[1]):new ne(Me[0],Me[1]),pr._rotateAround(Ye,pn),En._rotateAround(Ye,pn),cr._rotateAround(Ye,pn),ji._rotateAround(Ye,pn)}const ci=new ne(0,0),Mr=new ne(0,0);Ze.push({tl:pr,tr:En,bl:cr,br:ji,tex:Lt,writingMode:Ie.writingMode,glyphOffset:_i,sectionIndex:Rt.sectionIndex,isSDF:li,pixelOffsetTL:ci,pixelOffsetBR:Mr,minFontScaleX:0,minFontScaleY:0})}}return Ze}(0,c,C,_,y,w,f,a.allowVerticalPlacement),de=a.textSizeData;let _e=null;"source"===de.kind?(_e=[Ws*_.layout.get("text-size").evaluate(w,{},q)],_e[0]>gi&&Qn(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===de.kind&&(_e=[Ws*H.compositeTextSizes[0].evaluate(w,{},q),Ws*H.compositeTextSizes[1].evaluate(w,{},q)],(_e[0]>gi||_e[1]>gi)&&Qn(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),a.addSymbols(a.text,te,_e,C,y,w,I,i,l,D.lineStartIndex,D.lineLength,N,q);for(const Se of R)k[Se]=a.text.placedSymbolArray.length-1;return 4*te.length}function Mp(a){for(const i in a)return a[i];return null}function Bd(a,i,l,c,f,_,y,w,C,D){let I=y.top,R=y.bottom,k=y.left,N=y.right;const H=y.collisionPadding;if(H&&(k-=H[0],I-=H[1],N+=H[2],R+=H[3]),C){const q=new ne(k,I),te=new ne(N,I),de=new ne(k,R),_e=new ne(N,R),Se=Pe(C);let Ie=new ne(0,0);D&&(Ie=new ne(D[0],D[1])),q._rotateAround(Se,Ie),te._rotateAround(Se,Ie),de._rotateAround(Se,Ie),_e._rotateAround(Se,Ie),k=Math.min(q.x,te.x,de.x,_e.x),N=Math.max(q.x,te.x,de.x,_e.x),I=Math.min(q.y,te.y,de.y,_e.y),R=Math.max(q.y,te.y,de.y,_e.y)}return a.emplaceBack(i.x,i.y,i.z,l.x,l.y,k,I,N,R,w,c,f,_),a.length-1}function Rp(a){a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const i=a.bottom-a.top;return i>0?Math.max(10,i):null}function Nv(a,i,l,c){const f=a.compareText;if(i in f){const _=f[i];for(let y=_.length-1;y>=0;y--)if(c.dist(_[y])<l)return!0}else f[i]=[];return f[i].push(c),!1}const zv=yu.VectorTileFeature.types,qg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ud(a,i,l,c,f,_,y,w,C,D,I,R,k,N,H,q){const te=I?Math.min(gi,Math.round(I[0])):0,de=I?Math.min(gi,Math.round(I[1])):0;a.emplaceBack(i,l,Math.round(32*y),Math.round(32*w),C,D,(te<<1)+(R?1:0),de,16*k,16*N,256*H,256*q,c,f,_,0)}function kp(a,i,l){a.emplaceBack(i.x,i.y,l),a.emplaceBack(i.x,i.y,l),a.emplaceBack(i.x,i.y,l),a.emplaceBack(i.x,i.y,l)}function Vv(a){for(const i of a.sections)if(p(i.text))return!0;return!1}class Kt{constructor(i){this.layoutVertexArray=new ao,this.indexArray=new Vn,this.programConfigurations=i,this.segments=new Vr,this.dynamicLayoutVertexArray=new Zt,this.opacityVertexArray=new Qo,this.placedSymbolArray=new ou}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(i,l,c,f){this.isEmpty()||(c&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Dv.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,db.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,qg,!0),this.opacityVertexBuffer.itemSize=1),(c||f)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}yt("SymbolBuffers",Kt);class jd{constructor(i,l,c){this.layoutVertexArray=new i,this.layoutAttributes=l,this.indexArray=new c,this.segments=new Vr,this.collisionVertexArray=new es,this.collisionVertexArrayExt=new Zt}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,Eg.members,!0),this.collisionVertexBufferExt=i.createVertexBuffer(this.collisionVertexArrayExt,Md.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}yt("CollisionBuffers",jd);class Da{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(y=>y.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Gs([]),this.placementViewportMatrix=Gs([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=dp(this.zoom,l["text-size"]),this.iconSizeData=dp(this.zoom,l["icon-size"]);const c=this.layers[0].layout,f=c.get("symbol-sort-key"),_=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==_&&void 0!==f.constantOr(1),this.sortFeaturesByY=("viewport-y"===_||"auto"===_&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(y=>Mo[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=i.sourceID}createArrays(){this.text=new Kt(new oi(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new Kt(new oi(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new Km,this.lineVertexArray=new Kf,this.symbolInstances=new un}calculateGlyphDependencies(i,l,c,f,_){for(let y=0;y<i.length;y++)if(l[i.charCodeAt(y)]=!0,f&&_){const w=Bi[i.charAt(y)];w&&(l[w.charCodeAt(0)]=!0)}}populate(i,l,c){const f=this.layers[0],_=f.layout,y=_.get("text-font"),w=_.get("text-field"),C=_.get("icon-image"),D=("constant"!==w.value.kind||w.value.value instanceof Hr&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&("constant"!==y.value.kind||y.value.value.length>0),I="constant"!==C.value.kind||!!C.value.value||Object.keys(C.parameters).length>0,R=_.get("symbol-sort-key");if(this.features=[],!D&&!I)return;const k=l.iconDependencies,N=l.glyphDependencies,H=l.availableImages,q=new $(this.zoom);for(const{feature:te,id:de,index:_e,sourceLayerIndex:Se}of i){const Ie=f._featureFilter.needGeometry,Me=wa(te,Ie);if(!f._featureFilter.filter(q,Me,c))continue;let ke,He;if(Ie||(Me.geometry=bs(te)),D){const Qe=f.getValueAndResolveTokens("text-field",Me,c,H),st=Hr.factory(Qe);Vv(st)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===L()||this.hasRTLText&&U.isParsed())&&(ke=kd(st,f,Me))}if(I){const Qe=f.getValueAndResolveTokens("icon-image",Me,c,H);He=Qe instanceof Mt?Qe:Mt.fromString(Qe)}if(!ke&&!He)continue;const Je=this.sortFeaturesByKey?R.evaluate(Me,{},c):void 0;if(this.features.push({id:de,text:ke,icon:He,index:_e,sourceLayerIndex:Se,geometry:Me.geometry,properties:te.properties,type:zv[te.type],sortKey:Je}),He&&(k[He.name]=!0),ke){const Qe=y.evaluate(Me,{},c).join(","),st="map"===_.get("text-rotation-alignment")&&"point"!==_.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Mo.vertical)>=0;for(const Ze of ke.sections)if(Ze.image)k[Ze.image.name]=!0;else{const Ye=ya(ke.toString()),dt=Ze.fontStack||Qe,We=N[dt]=N[dt]||{};this.calculateGlyphDependencies(Ze.text,We,st,this.allowVerticalPlacement,Ye)}}}"line"===_.get("symbol-placement")&&(this.features=function(te){const de={},_e={},Se=[];let Ie=0;function Me(Qe){Se.push(te[Qe]),Ie++}function ke(Qe,st,Ze){const Ye=_e[Qe];return delete _e[Qe],_e[st]=Ye,Se[Ye].geometry[0].pop(),Se[Ye].geometry[0]=Se[Ye].geometry[0].concat(Ze[0]),Ye}function He(Qe,st,Ze){const Ye=de[st];return delete de[st],de[Qe]=Ye,Se[Ye].geometry[0].shift(),Se[Ye].geometry[0]=Ze[0].concat(Se[Ye].geometry[0]),Ye}function Je(Qe,st,Ze){const Ye=Ze?st[0][st[0].length-1]:st[0][0];return`${Qe}:${Ye.x}:${Ye.y}`}for(let Qe=0;Qe<te.length;Qe++){const st=te[Qe],Ze=st.geometry,Ye=st.text?st.text.toString():null;if(!Ye){Me(Qe);continue}const dt=Je(Ye,Ze),We=Je(Ye,Ze,!0);if(dt in _e&&We in de&&_e[dt]!==de[We]){const Vt=He(dt,We,Ze),xt=ke(dt,We,Se[Vt].geometry);delete de[dt],delete _e[We],_e[Je(Ye,Se[xt].geometry,!0)]=xt,Se[Vt].geometry=null}else dt in _e?ke(dt,We,Ze):We in de?He(dt,We,Ze):(Me(Qe),de[dt]=Ie-1,_e[We]=Ie-1)}return Se.filter(Qe=>Qe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((te,de)=>te.sortKey-de.sortKey)}update(i,l,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,l,this.layers,c),this.icon.programConfigurations.updatePaintArrays(i,l,this.layers,c))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,l){const c=this.lineVertexArray.length;if(void 0!==i.segment){let f=i.dist(l[i.segment+1]),_=i.dist(l[i.segment]);const y={};for(let w=i.segment+1;w<l.length;w++)y[w]={x:l[w].x,y:l[w].y,tileUnitDistanceFromAnchor:f},w<l.length-1&&(f+=l[w+1].dist(l[w]));for(let w=i.segment||0;w>=0;w--)y[w]={x:l[w].x,y:l[w].y,tileUnitDistanceFromAnchor:_},w>0&&(_+=l[w-1].dist(l[w]));for(let w=0;w<l.length;w++){const C=y[w];this.lineVertexArray.emplaceBack(C.x,C.y,C.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(i,l,c,f,_,y,w,C,D,I,R,k,N){const H=i.indexArray,q=i.layoutVertexArray,te=i.segments.prepareSegment(4*l.length,q,H,this.canOverlap?y.sortKey:void 0),de=this.glyphOffsetArray.length,_e=te.vertexLength,Se=this.allowVerticalPlacement&&w===Mo.vertical?Math.PI/2:0,Ie=y.text&&y.text.sections;for(let Me=0;Me<l.length;Me++){const{tl:ke,tr:He,bl:Je,br:Qe,tex:st,pixelOffsetTL:Ze,pixelOffsetBR:Ye,minFontScaleX:dt,minFontScaleY:We,glyphOffset:Vt,isSDF:xt,sectionIndex:An}=l[Me],Ot=te.vertexLength,dn=Vt[1];Ud(q,C.x,C.y,C.z,D.x,D.y,ke.x,dn+ke.y,st.x,st.y,c,xt,Ze.x,Ze.y,dt,We),Ud(q,C.x,C.y,C.z,D.x,D.y,He.x,dn+He.y,st.x+st.w,st.y,c,xt,Ye.x,Ze.y,dt,We),Ud(q,C.x,C.y,C.z,D.x,D.y,Je.x,dn+Je.y,st.x,st.y+st.h,c,xt,Ze.x,Ye.y,dt,We),Ud(q,C.x,C.y,C.z,D.x,D.y,Qe.x,dn+Qe.y,st.x+st.w,st.y+st.h,c,xt,Ye.x,Ye.y,dt,We),kp(i.dynamicLayoutVertexArray,C,Se),H.emplaceBack(Ot,Ot+1,Ot+2),H.emplaceBack(Ot+1,Ot+2,Ot+3),te.vertexLength+=4,te.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Vt[0]),Me!==l.length-1&&An===l[Me+1].sectionIndex||i.programConfigurations.populatePaintArrays(q.length,y,y.index,{},N,Ie&&Ie[An])}i.placedSymbolArray.emplaceBack(C.x,C.y,C.z,D.x,D.y,de,this.glyphOffsetArray.length-de,_e,I,R,D.segment,c?c[0]:0,c?c[1]:0,f[0],f[1],w,0,!1,0,k,0)}_commitLayoutVertex(i,l,c,f,_,y,w){i.emplaceBack(l,c,f,_,y,Math.round(w.x),Math.round(w.y))}_addCollisionDebugVertices(i,l,c,f,_,y,w){const C=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),D=C.vertexLength,I=w.tileAnchorX,R=w.tileAnchorY;for(let N=0;N<4;N++)c.collisionVertexArray.emplaceBack(0,0,0,0);c.collisionVertexArrayExt.emplaceBack(l,-i.padding,-i.padding),c.collisionVertexArrayExt.emplaceBack(l,i.padding,-i.padding),c.collisionVertexArrayExt.emplaceBack(l,i.padding,i.padding),c.collisionVertexArrayExt.emplaceBack(l,-i.padding,i.padding),this._commitLayoutVertex(c.layoutVertexArray,f,_,y,I,R,new ne(i.x1,i.y1)),this._commitLayoutVertex(c.layoutVertexArray,f,_,y,I,R,new ne(i.x2,i.y1)),this._commitLayoutVertex(c.layoutVertexArray,f,_,y,I,R,new ne(i.x2,i.y2)),this._commitLayoutVertex(c.layoutVertexArray,f,_,y,I,R,new ne(i.x1,i.y2)),C.vertexLength+=4;const k=c.indexArray;k.emplaceBack(D,D+1),k.emplaceBack(D+1,D+2),k.emplaceBack(D+2,D+3),k.emplaceBack(D+3,D),C.primitiveLength+=4}_addTextDebugCollisionBoxes(i,l,c,f,_,y){for(let w=f;w<_;w++){const C=c.get(w),D=this.getSymbolInstanceTextSize(i,y,l,w);this._addCollisionDebugVertices(C,D,this.textCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(i,l,c,f,_,y){for(let w=f;w<_;w++){const C=c.get(w),D=this.getSymbolInstanceIconSize(i,l,w);this._addCollisionDebugVertices(C,D,this.iconCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,y)}}generateCollisionDebugBuffers(i,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new jd(Zr,Cg.members,vr),this.iconCollisionBox=new jd(Zr,Cg.members,vr);const c=vu(this.iconSizeData,i),f=vu(this.textSizeData,i);for(let _=0;_<this.symbolInstances.length;_++){const y=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(f,i,l,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(f,i,l,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(c,i,l,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(c,i,l,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(i,l,c,f){const _=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:f),y=Rd(this.textSizeData,i,_)/24;return this.tilePixelRatio*y}getSymbolInstanceIconSize(i,l,c){const f=this.icon.placedSymbolArray.get(c),_=Rd(this.iconSizeData,i,f);return this.tilePixelRatio*_}_commitDebugCollisionVertexUpdate(i,l,c){i.emplaceBack(l,-c,-c),i.emplaceBack(l,c,-c),i.emplaceBack(l,c,c),i.emplaceBack(l,-c,c)}_updateTextDebugCollisionBoxes(i,l,c,f,_,y){for(let w=f;w<_;w++){const C=c.get(w),D=this.getSymbolInstanceTextSize(i,y,l,w);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,D,C.padding)}}_updateIconDebugCollisionBoxes(i,l,c,f,_){for(let y=f;y<_;y++){const w=c.get(y),C=this.getSymbolInstanceIconSize(i,l,y);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,C,w.padding)}}updateCollisionDebugBuffers(i,l){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const c=vu(this.iconSizeData,i),f=vu(this.textSizeData,i);for(let _=0;_<this.symbolInstances.length;_++){const y=this.symbolInstances.get(_);this._updateTextDebugCollisionBoxes(f,i,l,y.textBoxStartIndex,y.textBoxEndIndex,y),this._updateTextDebugCollisionBoxes(f,i,l,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._updateIconDebugCollisionBoxes(c,i,l,y.iconBoxStartIndex,y.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(c,i,l,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(i,l,c,f,_,y,w,C,D){const I={};for(let R=l;R<c;R++){const k=i.get(R);I.textBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},I.textFeatureIndex=k.featureIndex;break}for(let R=f;R<_;R++){const k=i.get(R);I.verticalTextBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},I.verticalTextFeatureIndex=k.featureIndex;break}for(let R=y;R<w;R++){const k=i.get(R);I.iconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},I.iconFeatureIndex=k.featureIndex;break}for(let R=C;R<D;R++){const k=i.get(R);I.verticalIconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},I.verticalIconFeatureIndex=k.featureIndex;break}return I}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const c=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,l){const c=i.placedSymbolArray.get(l),f=c.vertexStartIndex+4*c.numGlyphs;for(let _=c.vertexStartIndex;_<f;_+=4)i.indexArray.emplaceBack(_,_+1,_+2),i.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const l=Math.sin(i),c=Math.cos(i),f=[],_=[],y=[];for(let w=0;w<this.symbolInstances.length;++w){y.push(w);const C=this.symbolInstances.get(w);f.push(0|Math.round(l*C.tileAnchorX+c*C.tileAnchorY)),_.push(C.featureIndex)}return y.sort((w,C)=>f[w]-f[C]||_[C]-_[w]),y}addToSortKeyRanges(i,l){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===l?c.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const c=this.symbolInstances.get(l);this.featureSortOrder.push(c.featureIndex),[c.rightJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.leftJustifiedTextSymbolIndex].forEach((f,_,y)=>{f>=0&&y.indexOf(f)===_&&this.addIndicesForPlacedSymbol(this.text,f)}),c.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,c.verticalPlacedTextSymbolIndex),c.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.placedIconSymbolIndex),c.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}yt("SymbolBucket",Da,{omit:["layers","collisionBoxArray","features","compareText"]}),Da.MAX_GLYPHS=65535,Da.addDynamicAttributes=kp;const $d=new Ne({"symbol-placement":new J(ue.layout_symbol["symbol-placement"]),"symbol-spacing":new J(ue.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new J(ue.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new we(ue.layout_symbol["symbol-sort-key"]),"symbol-z-order":new J(ue.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new J(ue.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new J(ue.layout_symbol["icon-ignore-placement"]),"icon-optional":new J(ue.layout_symbol["icon-optional"]),"icon-rotation-alignment":new J(ue.layout_symbol["icon-rotation-alignment"]),"icon-size":new we(ue.layout_symbol["icon-size"]),"icon-text-fit":new J(ue.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new J(ue.layout_symbol["icon-text-fit-padding"]),"icon-image":new we(ue.layout_symbol["icon-image"]),"icon-rotate":new we(ue.layout_symbol["icon-rotate"]),"icon-padding":new J(ue.layout_symbol["icon-padding"]),"icon-keep-upright":new J(ue.layout_symbol["icon-keep-upright"]),"icon-offset":new we(ue.layout_symbol["icon-offset"]),"icon-anchor":new we(ue.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new J(ue.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new J(ue.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new J(ue.layout_symbol["text-rotation-alignment"]),"text-field":new we(ue.layout_symbol["text-field"]),"text-font":new we(ue.layout_symbol["text-font"]),"text-size":new we(ue.layout_symbol["text-size"]),"text-max-width":new we(ue.layout_symbol["text-max-width"]),"text-line-height":new we(ue.layout_symbol["text-line-height"]),"text-letter-spacing":new we(ue.layout_symbol["text-letter-spacing"]),"text-justify":new we(ue.layout_symbol["text-justify"]),"text-radial-offset":new we(ue.layout_symbol["text-radial-offset"]),"text-variable-anchor":new J(ue.layout_symbol["text-variable-anchor"]),"text-anchor":new we(ue.layout_symbol["text-anchor"]),"text-max-angle":new J(ue.layout_symbol["text-max-angle"]),"text-writing-mode":new J(ue.layout_symbol["text-writing-mode"]),"text-rotate":new we(ue.layout_symbol["text-rotate"]),"text-padding":new J(ue.layout_symbol["text-padding"]),"text-keep-upright":new J(ue.layout_symbol["text-keep-upright"]),"text-transform":new we(ue.layout_symbol["text-transform"]),"text-offset":new we(ue.layout_symbol["text-offset"]),"text-allow-overlap":new J(ue.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new J(ue.layout_symbol["text-ignore-placement"]),"text-optional":new J(ue.layout_symbol["text-optional"])});var Ro={paint:new Ne({"icon-opacity":new we(ue.paint_symbol["icon-opacity"]),"icon-color":new we(ue.paint_symbol["icon-color"]),"icon-halo-color":new we(ue.paint_symbol["icon-halo-color"]),"icon-halo-width":new we(ue.paint_symbol["icon-halo-width"]),"icon-halo-blur":new we(ue.paint_symbol["icon-halo-blur"]),"icon-translate":new J(ue.paint_symbol["icon-translate"]),"icon-translate-anchor":new J(ue.paint_symbol["icon-translate-anchor"]),"text-opacity":new we(ue.paint_symbol["text-opacity"]),"text-color":new we(ue.paint_symbol["text-color"],{runtimeType:Ho,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new we(ue.paint_symbol["text-halo-color"]),"text-halo-width":new we(ue.paint_symbol["text-halo-width"]),"text-halo-blur":new we(ue.paint_symbol["text-halo-blur"]),"text-translate":new J(ue.paint_symbol["text-translate"]),"text-translate-anchor":new J(ue.paint_symbol["text-translate-anchor"])}),layout:$d};class Pp{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:Rs,this.defaultValue=i}evaluate(i){if(i.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(i.formattedSection))return l.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}yt("FormatSectionOverride",Pp,{omit:["defaultValue"]});class Hd extends xs{constructor(i){super(i,Ro)}recalculate(i,l){super.recalculate(i,l),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const f=[];for(const _ of c)f.indexOf(_)<0&&f.push(_);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(i,l,c,f){const _=this.layout.get(i).evaluate(l,{},c,f),y=this._unevaluatedLayout._values[i];return y.isDataDriven()||Xo(y.value)||!_?_:(w=l.properties,_.replace(/{([^{}]+)}/g,(D,I)=>I in w?String(w[I]):""));var w}createBucket(i){return new Da(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const i of Ro.paint.overridableProperties){if(!Hd.hasPaintOverride(this.layout,i))continue;const l=this.paint.get(i),c=new Pp(l),f=new od(c,l.property.specification);let _=null;_="constant"===l.value.kind||"source"===l.value.kind?new Lr("source",f):new ms("composite",f,l.value.zoomStops,l.value._interpolationType),this.paint._values[i]=new he(l.property,_,l.parameters)}}_handleOverridablePaintPropertyUpdate(i,l,c){return!(!this.layout||l.isDataDriven()||c.isDataDriven())&&Hd.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,l){const c=i.get("text-field"),f=Ro.paint.properties[l];let _=!1;const y=w=>{for(const C of w)if(f.overrides&&f.overrides.hasOverride(C))return void(_=!0)};if("constant"===c.value.kind&&c.value.value instanceof Hr)y(c.value.value.sections);else if("source"===c.value.kind){const w=D=>{_||(D instanceof ks&&Kn(D.value)===Fc?y(D.value.sections):D instanceof zc?y(D.sections):D.eachChild(w))},C=c.value;C._styleExpression&&w(C._styleExpression.expression)}return _}getProgramConfiguration(i){return new $s(this,i)}}var Fp={paint:new Ne({"background-color":new J(ue.paint_background["background-color"]),"background-pattern":new Xe(ue.paint_background["background-pattern"]),"background-opacity":new J(ue.paint_background["background-opacity"])})},Sa={paint:new Ne({"raster-opacity":new J(ue.paint_raster["raster-opacity"]),"raster-hue-rotate":new J(ue.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new J(ue.paint_raster["raster-brightness-min"]),"raster-brightness-max":new J(ue.paint_raster["raster-brightness-max"]),"raster-saturation":new J(ue.paint_raster["raster-saturation"]),"raster-contrast":new J(ue.paint_raster["raster-contrast"]),"raster-resampling":new J(ue.paint_raster["raster-resampling"]),"raster-fade-duration":new J(ue.paint_raster["raster-fade-duration"])})};class Op extends xs{constructor(i){super(i,{}),this.implementation=i}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(i){this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)}onRemove(i){this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)}}var Zg={paint:new Ne({"sky-type":new J(ue.paint_sky["sky-type"]),"sky-atmosphere-sun":new J(ue.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new J(ue.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new J(ue.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new J(ue.paint_sky["sky-gradient-radius"]),"sky-gradient":new ve(ue.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new J(ue.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new J(ue.paint_sky["sky-atmosphere-color"]),"sky-opacity":new J(ue.paint_sky["sky-opacity"])})};function Mh(a,i,l){const c=lc(0,0,1),f=ag(np());return function(_,y,w){w*=.5;var C=y[0],D=y[1],I=y[2],R=y[3],k=Math.sin(w),N=Math.cos(w);_[0]=C*N-I*k,_[1]=D*N+R*k,_[2]=I*N+C*k,_[3]=R*N-D*k}(f,f,l?-Pe(a)+Math.PI:Pe(a)),fh(f,f,-Pe(i)),og(c,c,f),pu(c,c)}const gb={circle:class extends xs{constructor(a){super(a,du)}createBucket(a){return new Jf(a)}queryRadius(a){const i=a;return Hs("circle-radius",this,i)+Hs("circle-stroke-width",this,i)+xd(this.paint.get("circle-translate"))}queryIntersectsFeature(a,i,l,c,f,_,y,w){const C=tp(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),_.angle,a.pixelToTileUnitsFactor),D=this.paint.get("circle-radius").evaluate(i,l)+this.paint.get("circle-stroke-width").evaluate(i,l);return wd(a,c,_,y,w,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),C,D)}getProgramIds(){return["circle"]}getProgramConfiguration(a){return new $s(this,a)}},heatmap:class extends xs{createBucket(a){return new ph(a)}constructor(a){super(a,ev),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"heatmap-color"===a&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ip({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(a){return Hs("heatmap-radius",this,a)}queryIntersectsFeature(a,i,l,c,f,_,y,w){const C=this.paint.get("heatmap-radius").evaluate(i,l);return wd(a,c,_,y,w,!0,!0,new ne(0,0),C)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(a){return new $s(this,a)}},hillshade:class extends xs{constructor(a){super(a,tv)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(a){return new $s(this,a)}},fill:class extends xs{constructor(a){super(a,lp)}getProgramIds(){const a=this.paint.get("fill-pattern"),i=a&&a.constantOr(1),l=[i?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(i&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getProgramConfiguration(a){return new $s(this,a)}recalculate(a,i){super.recalculate(a,i);const l=this.paint._values["fill-outline-color"];"constant"===l.value.kind&&void 0===l.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new _u(a)}queryRadius(){return xd(this.paint.get("fill-translate"))}queryIntersectsFeature(a,i,l,c,f,_){return!a.queryGeometry.isAboveHorizon&&vd(ep(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),_.angle,a.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}},"fill-extrusion":class extends xs{constructor(a){super(a,Vi)}createBucket(a){return new Sd(a)}queryRadius(){return xd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(a){return new $s(this,a)}queryIntersectsFeature(a,i,l,c,f,_,y,w,C){const D=tp(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),_.angle,a.pixelToTileUnitsFactor),I=this.paint.get("fill-extrusion-height").evaluate(i,l),R=this.paint.get("fill-extrusion-base").evaluate(i,l),k=[0,0],N=w&&_.elevation,H=_.elevation?_.elevation.exaggeration():1;if(N){const de=a.tile.getBucket(this).centroidVertexArray,_e=C+1;if(_e<de.length){const Se=de.get(_e);k[0]=Se.a_centroid_pos0,k[1]=Se.a_centroid_pos1}}if(0===k[0]&&1===k[1])return!1;const q=(de=c,_e=R,Se=I,Ie=D,Me=y,(ke=N?w:null)?function(st,Ze,Ye,dt,We,Vt,xt,An,Ot){const dn=[],Rt=[],Lt=[0,0,0,1];for(const fn of st){const li=[],lr=[];for(const Ir of fn){const Br=Ir.x+dt.x,br=Ir.y+dt.y,Ln=bv(Br,br,Ze,Ye,Vt,xt,An,Ot);Lt[0]=Br,Lt[1]=br,Lt[2]=Ln.base,Lt[3]=1,dh(Lt,Lt,We),Lt[3]=Math.max(Lt[3],1e-5);const kn=vg([Lt[0]/Lt[3],Lt[1]/Lt[3],Lt[2]/Lt[3]]);Lt[0]=Br,Lt[1]=br,Lt[2]=Ln.top,Lt[3]=1,dh(Lt,Lt,We),Lt[3]=Math.max(Lt[3],1e-5);const _i=vg([Lt[0]/Lt[3],Lt[1]/Lt[3],Lt[2]/Lt[3]]);li.push(kn),lr.push(_i)}dn.push(li),Rt.push(lr)}return[dn,Rt]}(de,_e,Se,Ie,Me,ke,k,H,_.center.lat):function(st,Ze,Ye,dt,We){const Vt=[],xt=[],An=We[8]*Ze,Ot=We[9]*Ze,dn=We[10]*Ze,Rt=We[11]*Ze,Lt=We[8]*Ye,fn=We[9]*Ye,li=We[10]*Ye,lr=We[11]*Ye;for(const Ir of st){const Br=[],br=[];for(const Ln of Ir){const kn=Ln.x+dt.x,_i=Ln.y+dt.y,wr=We[0]*kn+We[4]*_i+We[12],Kr=We[1]*kn+We[5]*_i+We[13],Ur=We[2]*kn+We[6]*_i+We[14],jn=We[3]*kn+We[7]*_i+We[15],Ii=wr+An,pr=Kr+Ot,En=Ur+dn,cr=Math.max(jn+Rt,1e-5),ji=wr+Lt,ci=Kr+fn,Mr=Ur+li,pn=Math.max(jn+lr,1e-5),Mi=new ne(Ii/cr,pr/cr);Mi.z=En/cr,Br.push(Mi);const yi=new ne(ji/pn,ci/pn);yi.z=Mr/pn,br.push(yi)}Vt.push(Br),xt.push(br)}return[Vt,xt]}(de,_e,Se,Ie,Me)),te=a.queryGeometry;var de,_e,Se,Ie,Me,ke;return function(de,_e,Se){let Ie=1/0;vd(Se,_e)&&(Ie=Ad(Se,_e[0]));for(let Me=0;Me<_e.length;Me++){const ke=_e[Me],He=de[Me];for(let Je=0;Je<ke.length-1;Je++){const Qe=ke[Je],st=[Qe,ke[Je+1],He[Je+1],He[Je],Qe];Jm(Se,st)&&(Ie=Math.min(Ie,Ad(Se,st)))}}return Ie!==1/0&&Ie}(q[0],q[1],te.isPointQuery()?te.screenBounds:te.screenGeometry)}},line:class extends xs{constructor(a){super(a,up),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){if("line-gradient"===a){const i=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=i._styleExpression&&i._styleExpression.expression instanceof ei,this.gradientVersion=(this.gradientVersion+1)%Ct}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,i){super.recalculate(a,i),this.paint._values["line-floorwidth"]=Id.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new cp(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(a){return new $s(this,a)}queryRadius(a){const i=a,l=hp(Hs("line-width",this,i),Hs("line-gap-width",this,i)),c=Hs("line-offset",this,i);return l/2+Math.abs(c)+xd(this.paint.get("line-translate"))}queryIntersectsFeature(a,i,l,c,f,_){if(a.queryGeometry.isAboveHorizon)return!1;const y=ep(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),_.angle,a.pixelToTileUnitsFactor),w=a.pixelToTileUnitsFactor/2*hp(this.paint.get("line-width").evaluate(i,l),this.paint.get("line-gap-width").evaluate(i,l)),C=this.paint.get("line-offset").evaluate(i,l);return C&&(c=function(D,I){const R=[],k=new ne(0,0);for(let N=0;N<D.length;N++){const H=D[N],q=[];for(let te=0;te<H.length;te++){const de=H[te-1],_e=H[te],Se=H[te+1],Ie=0===te?k:_e.sub(de)._unit()._perp(),Me=te===H.length-1?k:Se.sub(_e)._unit()._perp(),ke=Ie._add(Me)._unit();ke._mult(1/(ke.x*Me.x+ke.y*Me.y)),q.push(ke._mult(I)._add(_e))}R.push(q)}return R}(c,C*a.pixelToTileUnitsFactor)),function(D,I,R){for(let k=0;k<I.length;k++){const N=I[k];if(D.length>=3)for(let H=0;H<N.length;H++)if(sc(D,N[H]))return!0;if(sb(D,N,R))return!0}return!1}(y,c,w)}isTileClipped(){return!0}},symbol:Hd,background:class extends xs{constructor(a){super(a,Fp)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends xs{constructor(a){super(a,Sa)}getProgramIds(){return["raster"]}},sky:class extends xs{constructor(a){super(a,Zg),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"sky-gradient"===a?this._updateColorRamp():"sky-atmosphere-sun"!==a&&"sky-atmosphere-halo-color"!==a&&"sky-atmosphere-color"!==a&&"sky-atmosphere-sun-intensity"!==a||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=ip({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const i=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==i.azimuthal||this._lightPosition.polar!==i.polar}}getCenter(a,i){const l=this.paint.get("sky-type");if("atmosphere"===l){const c=this.paint.get("sky-atmosphere-sun"),f=!c,_=a.style.light,y=_.properties.get("position");return f&&"viewport"===_.properties.get("anchor")&&Qn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?Mh(y.azimuthal,90-y.polar,i):Mh(c[0],90-c[1],i)}if("gradient"===l){const c=this.paint.get("sky-gradient-center");return Mh(c[0],90-c[1],i)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return"atmosphere"===a?["skyboxCapture","skybox"]:"gradient"===a?["skyboxGradient"]:null}}},{HTMLImageElement:Lp,HTMLCanvasElement:Bv,HTMLVideoElement:Xs,ImageData:Rh,ImageBitmap:gc}=Fe;class wu{constructor(i,l,c,f){this.context=i,this.format=c,this.texture=i.gl.createTexture(),this.update(l,f)}update(i,l,c){const{width:f,height:_}=i,y=!(this.size&&this.size[0]===f&&this.size[1]===_||c),{context:w}=this,{gl:C}=w;if(this.useMipmap=Boolean(l&&l.useMipmap),C.bindTexture(C.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===C.RGBA&&(!l||!1!==l.premultiply)),y)this.size=[f,_],i instanceof Lp||i instanceof Bv||i instanceof Xs||i instanceof Rh||gc&&i instanceof gc?C.texImage2D(C.TEXTURE_2D,0,this.format,this.format,C.UNSIGNED_BYTE,i):C.texImage2D(C.TEXTURE_2D,0,this.format,f,_,0,this.format,C.UNSIGNED_BYTE,i.data);else{const{x:D,y:I}=c||{x:0,y:0};i instanceof Lp||i instanceof Bv||i instanceof Xs||i instanceof Rh||gc&&i instanceof gc?C.texSubImage2D(C.TEXTURE_2D,0,D,I,C.RGBA,C.UNSIGNED_BYTE,i):C.texSubImage2D(C.TEXTURE_2D,0,D,I,f,_,C.RGBA,C.UNSIGNED_BYTE,i.data)}this.useMipmap&&this.isSizePowerOfTwo()&&C.generateMipmap(C.TEXTURE_2D)}bind(i,l,c){const{context:f}=this,{gl:_}=f;_.bindTexture(_.TEXTURE_2D,this.texture),c!==_.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(c=_.LINEAR),i!==this.filter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,i),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,c||i),this.filter=i),l!==this.wrap&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,l),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class Eu{constructor(i,l){i&&(l?this.setSouthWest(i).setNorthEast(l):4===i.length?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1]))}setNorthEast(i){return this._ne=i instanceof _r?new _r(i.lng,i.lat):_r.convert(i),this}setSouthWest(i){return this._sw=i instanceof _r?new _r(i.lng,i.lat):_r.convert(i),this}extend(i){const l=this._sw,c=this._ne;let f,_;if(i instanceof _r)f=i,_=i;else{if(!(i instanceof Eu))return Array.isArray(i)?4===i.length||i.every(Array.isArray)?this.extend(Eu.convert(i)):this.extend(_r.convert(i)):this;if(f=i._sw,_=i._ne,!f||!_)return this}return l||c?(l.lng=Math.min(f.lng,l.lng),l.lat=Math.min(f.lat,l.lat),c.lng=Math.max(_.lng,c.lng),c.lat=Math.max(_.lat,c.lat)):(this._sw=new _r(f.lng,f.lat),this._ne=new _r(_.lng,_.lat)),this}getCenter(){return new _r((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new _r(this.getWest(),this.getNorth())}getSouthEast(){return new _r(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:l,lat:c}=_r.convert(i);let f=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&f}static convert(i){return!i||i instanceof Eu?i:new Eu(i)}}const Wg=6371008.8;class _r{constructor(i,l){if(isNaN(i)||isNaN(l))throw new Error(`Invalid LngLat object: (${i}, ${l})`);if(this.lng=+i,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new _r(ye(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const l=Math.PI/180,c=this.lat*l,f=i.lat*l,_=Math.sin(c)*Math.sin(f)+Math.cos(c)*Math.cos(f)*Math.cos((i.lng-this.lng)*l);return Wg*Math.acos(Math.min(_,1))}toBounds(i=0){const l=360*i/40075017,c=l/Math.cos(Math.PI/180*this.lat);return new Eu(new _r(this.lng-c,this.lat-l),new _r(this.lng+c,this.lat+l))}static convert(i){if(i instanceof _r)return i;if(Array.isArray(i)&&(2===i.length||3===i.length))return new _r(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&"object"==typeof i&&null!==i)return new _r(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Uv=2*Math.PI*Wg;function Xg(a){return Uv*Math.cos(a*Math.PI/180)}function jv(a){return(180+a)/360}function Np(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function Gd(a,i){return a/Xg(i)}function qd(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function kh(a,i){return a*Xg(qd(i))}class Ph{constructor(i,l,c=0){this.x=+i,this.y=+l,this.z=+c}static fromLngLat(i,l=0){const c=_r.convert(i);return new Ph(jv(c.lng),Np(c.lat),Gd(l,c.lat))}toLngLat(){return new _r(360*this.x-180,qd(this.y))}toAltitude(){return kh(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Uv*(i=qd(this.y),1/Math.cos(i*Math.PI/180));var i}}class Kg{constructor(i,l){this.width=i,this.height=l,this.nextRow=0,this.image=new Ca({width:i,height:l}),this.positions={},this.uploaded=!1}getDash(i,l){const c=this.getKey(i,l);return this.positions[c]}trim(){const i=this.width,l=this.height=Fn(this.nextRow);this.image.resize({width:i,height:l})}getKey(i,l){return i.join(",")+l}getDashRanges(i,l,c){const f=[];let _=i.length%2==1?-i[i.length-1]*c:0,y=i[0]*c,w=!0;f.push({left:_,right:y,isDash:w,zeroLength:0===i[0]});let C=i[0];for(let D=1;D<i.length;D++){w=!w;const I=i[D];_=C*c,C+=I,y=C*c,f.push({left:_,right:y,isDash:w,zeroLength:0===I})}return f}addRoundDash(i,l,c){const f=l/2;for(let _=-c;_<=c;_++){const y=this.width*(this.nextRow+c+_);let w=0,C=i[w];for(let D=0;D<this.width;D++){D/C.right>1&&(C=i[++w]);const I=Math.abs(D-C.left),R=Math.abs(D-C.right),k=Math.min(I,R);let N;const H=_/c*(f+1);if(C.isDash){const q=f-Math.abs(H);N=Math.sqrt(k*k+q*q)}else N=f-Math.sqrt(k*k+H*H);this.image.data[y+D]=Math.max(0,Math.min(255,N+128))}}}addRegularDash(i,l){for(let C=i.length-1;C>=0;--C){const D=i[C],I=i[C+1];D.zeroLength?i.splice(C,1):I&&I.isDash===D.isDash&&(I.left=D.left,i.splice(C,1))}const c=i[0],f=i[i.length-1];c.isDash===f.isDash&&(c.left=f.left-this.width,f.right=c.right+this.width);const _=this.width*this.nextRow;let y=0,w=i[y];for(let C=0;C<this.width;C++){C/w.right>1&&(w=i[++y]);const D=Math.abs(C-w.left),I=Math.abs(C-w.right),R=Math.min(D,I);this.image.data[_+C]=Math.max(0,Math.min(255,(w.isDash?R:-R)+l+128))}}addDash(i,l){const c=this.getKey(i,l);if(this.positions[c])return this.positions[c];const f="round"===l,_=f?7:0,y=2*_+1;if(this.nextRow+y>this.height)return Qn("LineAtlas out of space"),null;0===i.length&&i.push(1);let w=0;for(let I=0;I<i.length;I++)i[I]<0&&(Qn("Negative value is found in line dasharray, replacing values with 0"),i[I]=0),w+=i[I];if(0!==w){const I=this.width/w,R=this.getDashRanges(i,this.width,I);f?this.addRoundDash(R,I,_):this.addRegularDash(R,"square"===l?.5*I:0)}const C=this.nextRow+_;this.nextRow+=y;const D={tl:[C,_],br:[w,0]};return this.positions[c]=D,D}}yt("LineAtlas",Kg);class _b{constructor(i){this._callback=i,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const yb=Fe.performance;function $v(a){const i=a?a.url.toString():void 0;return yb.getEntriesByName(i)}class vb{constructor(){this.tasks={},this.taskQueue=[],di(["process"],this),this.invoker=new _b(this.process),this.nextId=0}add(i,l){const c=this.nextId++,f=function({type:_,isSymbolTile:y,zoom:w}){return w=w||0,"message"===_?0:"maybePrepare"!==_||y?"parseTile"!==_||y?"parseTile"===_&&y?300-w:"maybePrepare"===_&&y?400-w:500:200-w:100-w}(l);if(0===f){_o();try{i()}finally{}return{cancel:()=>{}}}return this.tasks[c]={fn:i,metadata:l,priority:f,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){_o();try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const i=this.pick();if(null===i)return;const l=this.tasks[i];if(delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let i=null,l=1/0;for(let f=0;f<this.taskQueue.length;f++){const _=this.tasks[this.taskQueue[f]];_.priority<l&&(l=_.priority,i=f)}if(null===i)return null;const c=this.taskQueue[i];return this.taskQueue.splice(i,1),c}remove(){this.invoker.remove()}}function Hv(a,i,l){var c=2*Math.PI*6378137/256/Math.pow(2,l);return[a*c-2*Math.PI*6378137/2,i*c-2*Math.PI*6378137/2]}class Yg{constructor(i,l,c){this.z=i,this.x=l,this.y=c,this.key=Zd(0,i,i,l,c)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,l){const c=(_=this.y,y=this.z,w=Hv(256*(f=this.x),256*(_=Math.pow(2,y)-_-1),y),C=Hv(256*(f+1),256*(_+1),y),w[0]+","+w[1]+","+C[0]+","+C[1]);var f,_,y,w,C;const D=function(I,R,k){let N,H="";for(let q=I;q>0;q--)N=1<<q-1,H+=(R&N?1:0)+(k&N?2:0);return H}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===l?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",D).replace("{bbox-epsg-3857}",c)}getTilePoint(i){const l=Math.pow(2,this.z);return new ne((i.x*l-this.x)*Sn,(i.y*l-this.y)*Sn)}getTileVec3(i){const l=Math.pow(2,this.z);return lc((i.x*l-this.x)*Sn,(i.y*l-this.y)*Sn,kh(i.z,i.y))}toString(){return`${this.z}/${this.x}/${this.y}`}}class Gv{constructor(i,l){this.wrap=i,this.canonical=l,this.key=Zd(i,l.z,l.z,l.x,l.y)}}class uo{constructor(i,l,c,f,_){this.overscaledZ=i,this.wrap=l,this.canonical=new Yg(c,+f,+_),this.key=0===l&&i===c?this.canonical.key:Zd(l,i,c,f,_)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){const l=this.canonical.z-i;return i>this.canonical.z?new uo(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new uo(i,this.wrap,i,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(i,l=!0){if(this.overscaledZ===i&&l)return this.key;if(i>this.canonical.z)return Zd(this.wrap*+l,i,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-i;return Zd(this.wrap*+l,i,i,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(i){if(i.wrap!==this.wrap)return!1;const l=this.canonical.z-i.canonical.z;return 0===i.overscaledZ||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>l&&i.canonical.y===this.canonical.y>>l}children(i){if(this.overscaledZ>=i)return[new uo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,c=2*this.canonical.x,f=2*this.canonical.y;return[new uo(l,this.wrap,l,c,f),new uo(l,this.wrap,l,c+1,f),new uo(l,this.wrap,l,c,f+1),new uo(l,this.wrap,l,c+1,f+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new uo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new uo(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Gv(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(i){return this.canonical.getTilePoint(new Ph(i.x-this.wrap,i.y))}getTileVec3(i){return this.canonical.getTileVec3(new Ph(i.x-this.wrap,i.y,i.z))}}function Zd(a,i,l,c,f){const _=1<<Math.min(l,22);let y=_*(f%_)+c%_;return a&&l<22&&(y+=_*_*((a<0?-2*a-1:2*a)%(1<<2*(22-l)))),16*(32*y+l)+(i-l)}yt("CanonicalTileID",Yg),yt("OverscaledTileID",uo,{omit:["projMatrix"]});class Aa{constructor(i){this._stringToNumber={},this._numberToString=[];for(let l=0;l<i.length;l++){const c=i[l];this._stringToNumber[c]=l,this._numberToString[l]=c}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}class Wd{constructor(i,l,c,f,_){this.type="Feature",this._vectorTileFeature=i,i._z=l,i._x=c,i._y=f,this.properties=i.properties,this.id=_}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={geometry:this.geometry};for(const l in this)"_geometry"!==l&&"_vectorTileFeature"!==l&&(i[l]=this[l]);return i}}var qv=bt([{name:"a_pos",type:"Int16",components:2}]);class zp{constructor(i,l,c){this.tileID=i,this.uid=jt(),this.uses=0,this.tileSize=l,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(i){const l=i+this.timeAdded;l<Ki.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}loadVectorData(i,l,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(f,_){const y={};if(!_)return y;for(const w of f){const C=w.layerIds.map(D=>_.getLayer(D)).filter(Boolean);if(0!==C.length){w.layers=C,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(D=>C.filter(I=>I.id===D)[0]));for(const D of C)y[D.id]=w}}return y}(i.buckets,l.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const _=this.buckets[f];if(_ instanceof Da){if(this.hasSymbolBuckets=!0,!c)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const _=this.buckets[f];if(_ instanceof Da&&_.hasRTLText){this.hasRTLText=!0,U.isLoading()||U.isLoaded()||"deferred"!==L()||B();break}}this.queryPadding=0;for(const f in this.buckets){const _=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(f).queryRadius(_))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas)}else this.collisionBoxArray=new hl}unloadVectorData(){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(i){return this.buckets[i.id]}upload(i){for(const c in this.buckets){const f=this.buckets[c];f.uploadPending()&&f.upload(i)}const l=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new wu(i,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new wu(i,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new wu(i,this.lineAtlas.image,l.ALPHA),this.lineAtlas.uploaded=!0)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,l,c,f,_,y,w,C){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:f,pixelPosMatrix:w,transform:y,params:_},i,l,c):{}}querySourceFeatures(i,l){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const f=c.loadVTLayers(),_=l?l.sourceLayer:"",y=f._geojsonTileLayer||f[_];if(!y)return;const w=rl(l&&l.filter),{z:C,x:D,y:I}=this.tileID.canonical,R={z:C,x:D,y:I};for(let k=0;k<y.length;k++){const N=y.feature(k);if(w.needGeometry){const te=wa(N,!0);if(!w.filter(new $(this.tileID.overscaledZ),te,this.tileID.canonical))continue}else if(!w.filter(new $(this.tileID.overscaledZ),N))continue;const H=c.getId(N,_),q=new Wd(N,C,D,I,H);q.tile=R,i.push(q)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const l=this.expirationTime;if(i.cacheControl){const c=Xi(i.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const c=Date.now();let f=!1;if(this.expirationTime>c)f=!1;else if(l)if(this.expirationTime<l)f=!0;else{const _=this.expirationTime-l;_?this.expirationTime=c+Math.max(_,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(i,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(i).length)return;const c=this.latestFeatureIndex.loadVTLayers();for(const f in this.buckets){if(!l.style.hasLayer(f))continue;const _=this.buckets[f],y=_.layers[0].sourceLayer||"_geojsonTileLayer",w=c[y],C=i[y];if(!w||!C||0===Object.keys(C).length)continue;_.update(C,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});const D=l&&l.style&&l.style.getLayer(f);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(_)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ki.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=Ki.now()+i}setDependencies(i,l){const c={};for(const f of l)c[f]=!0;this.dependencies[i]=c}hasDependency(i,l){for(const c of i){const f=this.dependencies[c];if(f)for(const _ of l)if(f[_])return!0}return!1}clearQueryDebugViz(){}}class Vp{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,l,c){const f=String(l);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][f]=this.stateChanges[i][f]||{},pt(this.stateChanges[i][f],c),null===this.deletedStates[i]){this.deletedStates[i]={};for(const _ in this.state[i])_!==f&&(this.deletedStates[i][_]=null)}else if(this.deletedStates[i]&&null===this.deletedStates[i][f]){this.deletedStates[i][f]={};for(const _ in this.state[i][f])c[_]||(this.deletedStates[i][f][_]=null)}else for(const _ in c)this.deletedStates[i]&&this.deletedStates[i][f]&&null===this.deletedStates[i][f][_]&&delete this.deletedStates[i][f][_]}removeFeatureState(i,l,c){if(null===this.deletedStates[i])return;const f=String(l);if(this.deletedStates[i]=this.deletedStates[i]||{},c&&void 0!==l)null!==this.deletedStates[i][f]&&(this.deletedStates[i][f]=this.deletedStates[i][f]||{},this.deletedStates[i][f][c]=null);else if(void 0!==l)if(this.stateChanges[i]&&this.stateChanges[i][f])for(c in this.deletedStates[i][f]={},this.stateChanges[i][f])this.deletedStates[i][f][c]=null;else this.deletedStates[i][f]=null;else this.deletedStates[i]=null}getState(i,l){const c=String(l),f=pt({},(this.state[i]||{})[c],(this.stateChanges[i]||{})[c]);if(null===this.deletedStates[i])return{};if(this.deletedStates[i]){const _=this.deletedStates[i][l];if(null===_)return{};for(const y in _)delete f[y]}return f}initializeTileState(i,l){i.setFeatureState(this.state,l)}coalesceChanges(i,l){const c={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const _={};for(const y in this.stateChanges[f])this.state[f][y]||(this.state[f][y]={}),pt(this.state[f][y],this.stateChanges[f][y]),_[y]=this.state[f][y];c[f]=_}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const _={};if(null===this.deletedStates[f])for(const y in this.state[f])_[y]={},this.state[f][y]={};else for(const y in this.deletedStates[f]){if(null===this.deletedStates[f][y])this.state[f][y]={};else for(const w of Object.keys(this.deletedStates[f][y]))delete this.state[f][y][w];_[y]=this.state[f][y]}c[f]=c[f]||{},pt(c[f],_)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(c).length)for(const f in i)i[f].setFeatureState(c,l)}}class Bp{constructor(i){this.size=i,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(i,l){const c=this.toIdx(i,l);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(i,l){return this.leaves[this.toIdx(i,l)]}toIdx(i,l){return l*this.size+i}}function Xd(a,i,l,c){let f=0,_=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(c[y])<1e-15){if(l[y]<a[y]||l[y]>i[y])return null}else{const w=1/c[y];let C=(a[y]-l[y])*w,D=(i[y]-l[y])*w;if(C>D){const I=C;C=D,D=I}if(C>f&&(f=C),D<_&&(_=D),f>_)return null}return f}function Qg(a,i,l,c,f,_,y,w,C,D,I){const R=c-a,k=f-i,N=_-l,H=y-a,q=w-i,te=C-l,de=I[1]*te-I[2]*q,_e=I[2]*H-I[0]*te,Se=I[0]*q-I[1]*H,Ie=R*de+k*_e+N*Se;if(Math.abs(Ie)<1e-15)return null;const Me=1/Ie,ke=D[0]-a,He=D[1]-i,Je=D[2]-l,Qe=(ke*de+He*_e+Je*Se)*Me;if(Qe<0||Qe>1)return null;const st=He*N-Je*k,Ze=Je*R-ke*N,Ye=ke*k-He*R,dt=(I[0]*st+I[1]*Ze+I[2]*Ye)*Me;return dt<0||Qe+dt>1?null:(H*st+q*Ze+te*Ye)*Me}function Ia(a,i,l){return(a-i)/(l-i)}function Up(a,i,l,c,f,_,y,w,C){const D=1<<l,I=_-c,R=y-f,k=(a+1)/D*I+c,N=(i+0)/D*R+f,H=(i+1)/D*R+f;w[0]=(a+0)/D*I+c,w[1]=N,C[0]=k,C[1]=H}class Jg{constructor(i){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=i,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=function(_){const y=Math.ceil(Math.log2(_.dim/8)),w=[];let C=Math.ceil(Math.pow(2,y));const D=1/C,I=(N,H,q,te,de)=>{const _e=te?1:0,Se=(N+1)*q-_e,Ie=H*q,Me=(H+1)*q-_e;de[0]=N*q,de[1]=Ie,de[2]=Se,de[3]=Me};let R=new Bp(C);const k=[];for(let N=0;N<C*C;N++){I(N%C,Math.floor(N/C),D,!1,k);const H=Ks(k[0],k[1],_),q=Ks(k[2],k[1],_),te=Ks(k[2],k[3],_),de=Ks(k[0],k[3],_);R.minimums.push(Math.min(H,q,te,de)),R.maximums.push(Math.max(H,q,te,de)),R.leaves.push(1)}for(w.push(R),C/=2;C>=1;C/=2){const N=w[w.length-1];R=new Bp(C);for(let H=0;H<C*C;H++){I(H%C,Math.floor(H/C),2,!0,k);const q=N.getElevation(k[0],k[1]),te=N.getElevation(k[2],k[1]),de=N.getElevation(k[2],k[3]),_e=N.getElevation(k[0],k[3]),Se=N.isLeaf(k[0],k[1]),Ie=N.isLeaf(k[2],k[1]),Me=N.isLeaf(k[2],k[3]),ke=N.isLeaf(k[0],k[3]),He=Math.min(q.min,te.min,de.min,_e.min),Je=Math.max(q.max,te.max,de.max,_e.max),Qe=Se&&Ie&&Me&&ke;R.maximums.push(Je),R.minimums.push(He),R.leaves.push(Je-He<=5&&Qe?1:0)}w.push(R)}return w}(this.dem),c=l.length-1,f=l[c];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(l,0,0,c,0)}raycastRoot(i,l,c,f,_,y,w=1){return Xd([i,l,-100],[c,f,this.maximums[0]*w],_,y)}raycast(i,l,c,f,_,y,w=1){if(!this.nodeCount)return null;const C=this.raycastRoot(i,l,c,f,_,y,w);if(null==C)return null;const D=[],I=[],R=[],k=[],N=[{idx:0,t:C,nodex:0,nodey:0,depth:0}];for(;N.length>0;){const{idx:H,t:q,nodex:te,nodey:de,depth:_e}=N.pop();if(this.leaves[H]){Up(te,de,_e,i,l,c,f,R,k);const Ie=1<<_e,Me=(te+0)/Ie,ke=(te+1)/Ie,He=(de+0)/Ie,Je=(de+1)/Ie,Qe=Ks(Me,He,this.dem)*w,st=Ks(ke,He,this.dem)*w,Ze=Ks(ke,Je,this.dem)*w,Ye=Ks(Me,Je,this.dem)*w,dt=Qg(R[0],R[1],Qe,k[0],R[1],st,k[0],k[1],Ze,_,y),We=Qg(k[0],k[1],Ze,R[0],k[1],Ye,R[0],R[1],Qe,_,y),Vt=Math.min(null!==dt?dt:Number.MAX_VALUE,null!==We?We:Number.MAX_VALUE);if(Vt!==Number.MAX_VALUE)return Vt;{const xt=cc([],_,y,q);if(Zv(Qe,st,Ye,Ze,Ia(xt[0],R[0],k[0]),Ia(xt[1],R[1],k[1]))>=xt[2])return q}continue}let Se=0;for(let Ie=0;Ie<this._siblingOffset.length;Ie++){Up((te<<1)+this._siblingOffset[Ie][0],(de<<1)+this._siblingOffset[Ie][1],_e+1,i,l,c,f,R,k),R[2]=-100,k[2]=this.maximums[this.childOffsets[H]+Ie]*w;const Me=Xd(R,k,_,y);if(null!=Me){const ke=Me;D[Ie]=ke;let He=!1;for(let Je=0;Je<Se&&!He;Je++)ke>=D[I[Je]]&&(I.splice(Je,0,Ie),He=!0);He||(I[Se]=Ie),Se++}}for(let Ie=0;Ie<Se;Ie++){const Me=I[Ie];N.push({idx:this.childOffsets[H]+Me,t:D[Me],nodex:(te<<1)+this._siblingOffset[Me][0],nodey:(de<<1)+this._siblingOffset[Me][1],depth:_e+1})}}return null}_addNode(i,l,c){return this.minimums.push(i),this.maximums.push(l),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(i,l,c,f,_){if(1===i[f].isLeaf(l,c))return;this.childOffsets[_]||(this.childOffsets[_]=this.nodeCount);const y=f-1,w=i[y];let C,D=0;for(let I=0;I<this._siblingOffset.length;I++){const R=2*l+this._siblingOffset[I][0],k=2*c+this._siblingOffset[I][1],N=w.getElevation(R,k),H=w.isLeaf(R,k),q=this._addNode(N.min,N.max,H);H&&(D|=1<<I),C||(C=q)}for(let I=0;I<this._siblingOffset.length;I++)D&1<<I||this._construct(i,2*l+this._siblingOffset[I][0],2*c+this._siblingOffset[I][1],y,C+I)}}function Zv(a,i,l,c,f,_){return Dn(Dn(a,l,_),Dn(i,c,_),f)}function Ks(a,i,l){const c=l.dim,f=Oe(a*c-.5,0,c-1),_=Oe(i*c-.5,0,c-1),y=Math.floor(f),w=Math.floor(_),C=Math.min(y+1,c-1),D=Math.min(w+1,c-1);return Zv(l.get(y,w),l.get(C,w),l.get(y,D),l.get(C,D),f-y,_-w)}const e_={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Fh{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(i,l,c,f=!1,_=!1){if(this.uid=i,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(c&&"mapbox"!==c&&"terrarium"!==c)return Qn(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const y=this.dim=l.height-2;if(this.data=new Uint32Array(l.data.buffer),this.encoding=c||"mapbox",this.borderReady=f,!f){for(let w=0;w<y;w++)this.data[this._idx(-1,w)]=this.data[this._idx(0,w)],this.data[this._idx(y,w)]=this.data[this._idx(y-1,w)],this.data[this._idx(w,-1)]=this.data[this._idx(w,0)],this.data[this._idx(w,y)]=this.data[this._idx(w,y-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(y,-1)]=this.data[this._idx(y-1,0)],this.data[this._idx(-1,y)]=this.data[this._idx(0,y-1)],this.data[this._idx(y,y)]=this.data[this._idx(y-1,y-1)],_&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Jg(this)}get(i,l,c=!1){const f=new Uint8Array(this.data.buffer);c&&(i=Oe(i,-1,this.dim),l=Oe(l,-1,this.dim));const _=4*this._idx(i,l);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(f[_],f[_+1],f[_+2])}static getUnpackVector(i){return e_[i]}get unpackVector(){return e_[this.encoding]}_idx(i,l){if(i<-1||i>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(i+1)}_unpackMapbox(i,l,c){return(256*i*256+256*l+c)/10-1e4}_unpackTerrarium(i,l,c){return 256*i+l+c/256-32768}static pack(i,l){const c=[0,0,0,0],f=Fh.getUnpackVector(l);let _=Math.floor((i+f[3])/f[2]);return c[2]=_%256,_=Math.floor(_/256),c[1]=_%256,_=Math.floor(_/256),c[0]=_,c}getPixels(){return new si({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(i,l,c){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let f=l*this.dim,_=l*this.dim+this.dim,y=c*this.dim,w=c*this.dim+this.dim;switch(l){case-1:f=_-1;break;case 1:_=f+1}switch(c){case-1:y=w-1;break;case 1:w=y+1}const C=-l*this.dim,D=-c*this.dim;for(let I=y;I<w;I++)for(let R=f;R<_;R++)this.data[this._idx(R,I)]=i.data[this._idx(R+C,I+D)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}yt("DEMData",Fh),yt("DemMinMaxQuadTree",Jg,{omit:["dem"]});class Wv{constructor(i,l){this.max=i,this.onRemove=l,this.reset()}reset(){for(const i in this.data)for(const l of this.data[i])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(i,l,c){const f=i.wrapped().key;void 0===this.data[f]&&(this.data[f]=[]);const _={value:l,timeout:void 0};if(void 0!==c&&(_.timeout=setTimeout(()=>{this.remove(i,_)},c)),this.data[f].push(_),this.order.push(f),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const l=this.data[i].shift();return l.timeout&&clearTimeout(l.timeout),0===this.data[i].length&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),l.value}getByKey(i){const l=this.data[i];return l?l[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,l){if(!this.has(i))return this;const c=i.wrapped().key,f=void 0===l?0:this.data[c].indexOf(l),_=this.data[c][f];return this.data[c].splice(f,1),_.timeout&&clearTimeout(_.timeout),0===this.data[c].length&&delete this.data[c],this.onRemove(_.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(i){const l=[];for(const c in this.data)for(const f of this.data[c])i(f.value)||l.push(f);for(const c of l)this.remove(c.value.tileID,c)}}class Cu{constructor(i,l,c){this.func=i,this.mask=l,this.range=c}}Cu.ReadOnly=!1,Cu.ReadWrite=!0,Cu.disabled=new Cu(519,Cu.ReadOnly,[0,1]);class yl{constructor(i,l,c,f,_,y){this.test=i,this.ref=l,this.mask=c,this.fail=f,this.depthFail=_,this.pass=y}}yl.disabled=new yl({func:519,mask:0},0,0,7680,7680,7680);class ts{constructor(i,l,c){this.blendFunction=i,this.blendColor=l,this.mask=c}}ts.Replace=[1,0],ts.disabled=new ts(ts.Replace,Gt.transparent,[!1,!1,!1,!1]),ts.unblended=new ts(ts.Replace,Gt.transparent,[!0,!0,!0,!0]),ts.alphaBlended=new ts([1,771],Gt.transparent,[!0,!0,!0,!0]);class Ui{constructor(i,l,c){this.enable=i,this.mode=l,this.frontFace=c}}Ui.disabled=new Ui(!1,1029,2305),Ui.backCCW=new Ui(!0,1029,2305),Ui.backCW=new Ui(!0,1029,2304),Ui.frontCW=new Ui(!0,1028,2304),Ui.frontCCW=new Ui(!0,1028,2305);class vc extends It{constructor(i,l,c){super(),this.id=i,this._onlySymbols=c,l.on("data",f=>{"source"===f.dataType&&"metadata"===f.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===f.dataType&&"content"===f.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new Wv(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Vp}onAdd(i){this.map=i,this._maxTileCacheSize=i?i._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles){const l=this._tiles[i];if("loaded"!==l.state&&"errored"!==l.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,l){return i.isSymbolTile=this._onlySymbols,this._source.loadTile(i,l)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i,()=>{})}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i,()=>{})}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const c=this._tiles[l];c.upload(i),c.prepare(this.map.style.imageManager)}}getIds(){return ct(this._tiles).map(i=>i.tileID).sort(jp).map(i=>i.key)}getRenderableIds(i){const l=[];for(const c in this._tiles)this._isIdRenderable(+c,i)&&l.push(this._tiles[c]);return i?l.sort((c,f)=>{const _=c.tileID,y=f.tileID,w=new ne(_.canonical.x,_.canonical.y)._rotate(this.transform.angle),C=new ne(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return _.overscaledZ-y.overscaledZ||C.y-w.y||C.x-w.x}).map(c=>c.tileID.key):l.map(c=>c.tileID).sort(jp).map(c=>c.key)}hasRenderableParent(i){const l=this.findLoadedParent(i,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(i,l){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(l||!this._tiles[i].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)"errored"!==this._tiles[i].state&&this._reloadTile(+i,"reloading")}}_reloadTile(i,l){const c=this._tiles[i];c&&("loading"!==c.state&&(c.state=l),this._loadTile(c,this._tileLoaded.bind(this,c,i,l)))}_tileLoaded(i,l,c,f){if(f)return i.state="errored",void(404!==f.status?this._source.fire(new Ke(f,{tile:i})):this.update(this.transform));i.timeAdded=Ki.now(),"expired"===c&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(l,i),"raster-dem"===this.getSource().type&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new ht("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const l=this.getRenderableIds();for(let f=0;f<l.length;f++){const _=l[f];if(i.neighboringTiles&&i.neighboringTiles[_]){const y=this.getTileByID(_);c(i,y),c(y,i)}}function c(f,_){if(!f.dem||f.dem.borderReady)return;f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0;let y=_.tileID.canonical.x-f.tileID.canonical.x;const w=_.tileID.canonical.y-f.tileID.canonical.y,C=Math.pow(2,f.tileID.canonical.z),D=_.tileID.key;0===y&&0===w||Math.abs(w)>1||(Math.abs(y)>1&&(1===Math.abs(y+C)?y+=C:1===Math.abs(y-C)&&(y-=C)),_.dem&&f.dem&&(f.dem.backfillBorder(_.dem,y,w),f.neighboringTiles&&f.neighboringTiles[D]&&(f.neighboringTiles[D].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,l,c,f){for(const _ in this._tiles){let y=this._tiles[_];if(f[_]||!y.hasData()||y.tileID.overscaledZ<=l||y.tileID.overscaledZ>c)continue;let w=y.tileID;for(;y&&y.tileID.overscaledZ>l+1;){const D=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[D.key],y&&y.hasData()&&(w=D)}let C=w;for(;C.overscaledZ>l;)if(C=C.scaledTo(C.overscaledZ-1),i[C.key]){f[w.key]=w;break}}}findLoadedParent(i,l){if(i.key in this._loadedParentTiles){const c=this._loadedParentTiles[i.key];return c&&c.tileID.overscaledZ>=l?c:null}for(let c=i.overscaledZ-1;c>=l;c--){const f=i.scaledTo(c),_=this._getLoadedTile(f);if(_)return _}}_getLoadedTile(i){const l=this._tiles[i.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,l){l=l||this._source.tileSize;const c=Math.ceil(i.width/l)+1,f=Math.ceil(i.height/l)+1,_=Math.floor(c*f*5),y="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(y)}handleWrapJump(i){const l=Math.round((i-(void 0===this._prevLng?i:this._prevLng))/360);if(this._prevLng=i,l){const c={};for(const f in this._tiles){const _=this._tiles[f];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+l),c[_.tileID.key]=_}this._tiles=c;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(+f,this._tiles[f])}}update(i,l,c){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;let f;this.updateCacheSize(i,l),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(w=>new uo(w.canonical.z,w.wrap,w.canonical.z,w.canonical.x,w.canonical.y)):(f=i.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(f=f.filter(w=>this._source.hasTile(w)))):f=[];const _=this._updateRetainedTiles(f);if($p(this._source.type)&&0!==f.length){const w={},C={},D=Object.keys(_);for(const R of D){const k=_[R],N=this._tiles[R];if(!N||N.fadeEndTime&&N.fadeEndTime<=Ki.now())continue;const H=this.findLoadedParent(k,Math.max(k.overscaledZ-vc.maxOverzooming,this._source.minzoom));H&&(this._addTile(H.tileID),w[H.tileID.key]=H.tileID),C[R]=k}const I=f[f.length-1].overscaledZ;for(const R in this._tiles){const k=this._tiles[R];if(_[R]||!k.hasData())continue;let N=k.tileID;for(;N.overscaledZ>I;){N=N.scaledTo(N.overscaledZ-1);const H=this._tiles[N.key];if(H&&H.hasData()&&C[N.key]){_[R]=k.tileID;break}}}for(const R in w)_[R]||(this._coveredTiles[R]=!0,_[R]=w[R])}for(const w in _)this._tiles[w].clearFadeHold();const y=function(w,C){const D=[];for(const I in w)I in C||D.push(I);return D}(this._tiles,_);for(const w of y){const C=this._tiles[w];C.hasSymbolBuckets&&!C.holdingForFade()?C.setHoldDuration(this.map._fadeDuration):C.hasSymbolBuckets&&!C.symbolFadeFinished()||this._removeTile(+w)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const l={};if(0===i.length)return l;const c={},f=i[i.length-1].overscaledZ,_=i[0].overscaledZ,y=Math.max(_-vc.maxOverzooming,this._source.minzoom),w=Math.max(_+vc.maxUnderzooming,this._source.minzoom),C={};for(const D of i){const I=this._addTile(D);l[D.key]=D,I.hasData()||f<this._source.maxzoom&&(C[D.key]=D)}this._retainLoadedChildren(C,f,w,l);for(const D of i){let I=this._tiles[D.key];if(I.hasData())continue;if(D.canonical.z>=this._source.maxzoom){const k=D.children(this._source.maxzoom)[0],N=this.getTile(k);if(N&&N.hasData()){l[k.key]=k;continue}}else{const k=D.children(this._source.maxzoom);if(l[k[0].key]&&l[k[1].key]&&l[k[2].key]&&l[k[3].key])continue}let R=I.wasRequested();for(let k=D.overscaledZ-1;k>=y;--k){const N=D.scaledTo(k);if(c[N.key]||(c[N.key]=!0,I=this.getTile(N),!I&&R&&(I=this._addTile(N)),I&&(l[N.key]=N,R=I.wasRequested(),I.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const l=[];let c,f=this._tiles[i].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){c=this._loadedParentTiles[f.key];break}l.push(f.key);const _=f.scaledTo(f.overscaledZ-1);if(c=this._getLoadedTile(_),c)break;f=_}for(const _ of l)this._loadedParentTiles[_]=c}}_addTile(i){let l=this._tiles[i.key];if(l)return l;l=this._cache.getAndRemove(i),l&&(this._setTileReloadTimer(i.key,l),l.tileID=i,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,l)));const c=Boolean(l);return c||(l=new zp(i,this._source.tileSize*i.overscaleFactor(),this.transform.tileZoom),this._loadTile(l,this._tileLoaded.bind(this,l,i.key,l.state))),l?(l.uses++,this._tiles[i.key]=l,c||this._source.fire(new ht("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(i,l){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const c=l.getExpiryTimeout();c&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},c))}_removeTile(i){const l=this._tiles[i];l&&(l.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),l.uses>0||(l.hasData()&&"reloading"!==l.state?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._cache.reset()}tilesIn(i,l,c){const f=[],_=this.transform;if(!_)return f;for(const y in this._tiles){const w=this._tiles[y];if(c&&w.clearQueryDebugViz(),w.holdingForFade())continue;const C=i.containsTile(w,_,l);C&&f.push(C)}return f}getVisibleCoordinates(i){const l=this.getRenderableIds(i).map(c=>this._tiles[c].tileID);for(const c of l)c.projMatrix=this.transform.calculateProjMatrix(c.toUnwrapped());return l}hasTransition(){if(this._source.hasTransition())return!0;if($p(this._source.type))for(const i in this._tiles){const l=this._tiles[i];if(void 0!==l.fadeEndTime&&l.fadeEndTime>=Ki.now())return!0}return!1}setFeatureState(i,l,c){this._state.updateState(i=i||"_geojsonTileLayer",l,c)}removeFeatureState(i,l,c){this._state.removeFeatureState(i=i||"_geojsonTileLayer",l,c)}getFeatureState(i,l){return this._state.getState(i=i||"_geojsonTileLayer",l)}setDependencies(i,l,c){const f=this._tiles[i];f&&f.setDependencies(l,c)}reloadTilesForDependencies(i,l){for(const c in this._tiles)this._tiles[c].hasDependency(i,l)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(i,l))}}function jp(a,i){const l=Math.abs(2*a.wrap)-+(a.wrap<0),c=Math.abs(2*i.wrap)-+(i.wrap<0);return a.overscaledZ-i.overscaledZ||c-l||i.canonical.y-a.canonical.y||i.canonical.x-a.canonical.x}function $p(a){return"raster"===a||"image"===a||"video"===a}vc.maxOverzooming=10,vc.maxUnderzooming=3;class Tu{constructor(i,l,c){this._demTile=i,this._dem=this._demTile.dem,this._scale=l,this._offset=c}static create(i,l,c){const f=c||i.findDEMTileFor(l);if(!f||!f.dem)return;const _=f.dem,y=f.tileID,w=1<<l.canonical.z-y.canonical.z;return new Tu(f,f.tileSize/Sn/w,[(l.canonical.x/w-y.canonical.x)*_.dim,(l.canonical.y/w-y.canonical.y)*_.dim])}tileCoordToPixel(i,l){const c=l*this._scale+this._offset[1],f=Math.floor(i*this._scale+this._offset[0]),_=Math.floor(c);return new ne(f,_)}getElevationAt(i,l,c,f){const _=i*this._scale+this._offset[0],y=l*this._scale+this._offset[1],w=Math.floor(_),C=Math.floor(y),D=this._dem;return f=!!f,c?Dn(Dn(D.get(w,C,f),D.get(w,C+1,f),y-C),Dn(D.get(w+1,C,f),D.get(w+1,C+1,f),y-C),_-w):D.get(w,C,f)}getElevationAtPixel(i,l,c){return this._dem.get(i,l,!!c)}getMeterToDEM(i){return(1<<this._demTile.tileID.canonical.z)*Gd(1,i)*this._dem.stride}}class Kd{constructor(i,l){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new sl(Sn,16,0),this.featureIndexArray=new $y,this.promoteId=l}insert(i,l,c,f,_,y=0){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,f,_,y);const C=this.grid;for(let D=0;D<l.length;D++){const I=l[D],R=[1/0,1/0,-1/0,-1/0];for(let k=0;k<I.length;k++){const N=I[k];R[0]=Math.min(R[0],N.x),R[1]=Math.min(R[1],N.y),R[2]=Math.max(R[2],N.x),R[3]=Math.max(R[3],N.y)}R[0]<Sn&&R[1]<Sn&&R[2]>=0&&R[3]>=0&&C.insert(w,R[0],R[1],R[2],R[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new yu.VectorTile(new Pd(this.rawTileData)).layers,this.sourceLayerCoder=new Aa(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(i,l,c,f){this.loadVTLayers();const _=i.params||{},y=rl(_.filter),w=i.tileResult,C=i.transform,D=w.bufferedTilespaceBounds,I=this.grid.query(D.min.x,D.min.y,D.max.x,D.max.y,(H,q,te,de)=>Yy(w.bufferedTilespaceGeometry,H,q,te,de));I.sort(Yd);let R=null;C.elevation&&I.length>0&&(R=Tu.create(C.elevation,this.tileID));const k={};let N;for(let H=0;H<I.length;H++){const q=I[H];if(q===N)continue;N=q;const te=this.featureIndexArray.get(q);let de=null;this.loadMatchingFeature(k,te,y,_.layers,_.availableImages,l,c,f,(_e,Se,Ie,Me=0)=>(de||(de=bs(_e)),Se.queryIntersectsFeature(w,_e,Ie,de,this.z,i.transform,i.pixelPosMatrix,R,Me)))}return k}loadMatchingFeature(i,l,c,f,_,y,w,C,D){const{featureIndex:I,bucketIndex:R,sourceLayerIndex:k,layoutVertexArrayOffset:N}=l,H=this.bucketLayerIDs[R];if(f&&!function(_e,Se){for(let Ie=0;Ie<_e.length;Ie++)if(Se.indexOf(_e[Ie])>=0)return!0;return!1}(f,H))return;const q=this.sourceLayerCoder.decode(k),te=this.vtLayers[q].feature(I);if(c.needGeometry){const _e=wa(te,!0);if(!c.filter(new $(this.tileID.overscaledZ),_e,this.tileID.canonical))return}else if(!c.filter(new $(this.tileID.overscaledZ),te))return;const de=this.getId(te,q);for(let _e=0;_e<H.length;_e++){const Se=H[_e];if(f&&f.indexOf(Se)<0)continue;const Ie=y[Se];if(!Ie)continue;let Me={};void 0!==de&&C&&(Me=C.getState(Ie.sourceLayer||"_geojsonTileLayer",de));const ke=pt({},w[Se]);ke.paint=Hp(ke.paint,Ie.paint,te,Me,_),ke.layout=Hp(ke.layout,Ie.layout,te,Me,_);const He=!D||D(te,Ie,Me,N);if(!He)continue;const Je=new Wd(te,this.z,this.x,this.y,de);Je.layer=ke;let Qe=i[Se];void 0===Qe&&(Qe=i[Se]=[]),Qe.push({featureIndex:I,feature:Je,intersectionZ:He})}}lookupSymbolFeatures(i,l,c,f,_,y,w,C){const D={};this.loadVTLayers();const I=rl(_);for(const R of i)this.loadMatchingFeature(D,{bucketIndex:c,sourceLayerIndex:f,featureIndex:R,layoutVertexArrayOffset:0},I,y,w,C,l);return D}hasLayer(i){for(const l of this.bucketLayerIDs)for(const c of l)if(i===c)return!0;return!1}getId(i,l){let c=i.id;return this.promoteId&&(c=i.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[l]],"boolean"==typeof c&&(c=Number(c))),c}}function Hp(a,i,l,c,f){return Wi(a,(_,y)=>{const w=i instanceof ge?i.get(y):null;return w&&w.evaluate?w.evaluate(l,c,f):w})}function Yd(a,i){return i-a}yt("FeatureIndex",Kd,{omit:["rawTileData","sourceLayerCoder"]});class t_{constructor(i){const l={},c=[];for(const w in i){const C=i[w],D=l[w]={};for(const I in C.glyphs){const R=C.glyphs[+I];if(!R||0===R.bitmap.width||0===R.bitmap.height)continue;const k=R.metrics.localGlyph?2:1,N={x:0,y:0,w:R.bitmap.width+2*k,h:R.bitmap.height+2*k};c.push(N),D[I]=N}}const{w:f,h:_}=gl(c),y=new Ca({width:f||1,height:_||1});for(const w in i){const C=i[w];for(const D in C.glyphs){const I=C.glyphs[+D];if(!I||0===I.bitmap.width||0===I.bitmap.height)continue;const R=l[w][D],k=I.metrics.localGlyph?2:1;Ca.copy(I.bitmap,y,{x:0,y:0},{x:R.x+k,y:R.y+k},I.bitmap)}}this.image=y,this.positions=l}}yt("GlyphAtlas",t_);class n_{constructor(i){this.tileID=new uo(i.tileID.overscaledZ,i.tileID.wrap,i.tileID.canonical.z,i.tileID.canonical.x,i.tileID.canonical.y),this.tileZoom=i.tileZoom,this.uid=i.uid,this.zoom=i.zoom,this.pixelRatio=i.pixelRatio,this.tileSize=i.tileSize,this.source=i.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=i.showCollisionBoxes,this.collectResourceTiming=!!i.collectResourceTiming,this.returnDependencies=!!i.returnDependencies,this.promoteId=i.promoteId,this.enableTerrain=!!i.enableTerrain,this.isSymbolTile=i.isSymbolTile}parse(i,l,c,f,_){this.status="parsing",this.data=i,this.collisionBoxArray=new hl;const y=new Aa(Object.keys(i.layers).sort()),w=new Kd(this.tileID,this.promoteId);w.bucketLayerIDs=[];const C={},D=new Kg(256,256),I={featureIndex:w,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:D,availableImages:c},R=l.familiesBySource[this.source];for(const Me in R){const ke=i.layers[Me];if(!ke)continue;let He=!1,Je=!1;for(const Ze of R[Me])"symbol"===Ze[0].type?He=!0:Je=!0;if(!0===this.isSymbolTile&&!He||!1===this.isSymbolTile&&!Je)continue;1===ke.version&&Qn(`Vector tile source "${this.source}" layer "${Me}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Qe=y.encode(Me),st=[];for(let Ze=0;Ze<ke.length;Ze++){const Ye=ke.feature(Ze),dt=w.getId(Ye,Me);st.push({feature:Ye,id:dt,index:Ze,sourceLayerIndex:Qe})}for(const Ze of R[Me]){const Ye=Ze[0];void 0!==this.isSymbolTile&&"symbol"===Ye.type!==this.isSymbolTile||Ye.minzoom&&this.zoom<Math.floor(Ye.minzoom)||Ye.maxzoom&&this.zoom>=Ye.maxzoom||"none"!==Ye.visibility&&(r_(Ze,this.zoom,c),(C[Ye.id]=Ye.createBucket({index:w.bucketLayerIDs.length,layers:Ze,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Qe,sourceID:this.source,enableTerrain:this.enableTerrain})).populate(st,I,this.tileID.canonical),w.bucketLayerIDs.push(Ze.map(dt=>dt.id)))}}let k,N,H,q;D.trim();const te={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},de=Wi(I.glyphDependencies,Me=>Object.keys(Me).map(Number));Object.keys(de).length?f.send("getGlyphs",{uid:this.uid,stacks:de},(Me,ke)=>{k||(k=Me,N=ke,Ie.call(this))},void 0,!1,te):N={};const _e=Object.keys(I.iconDependencies);_e.length?f.send("getImages",{icons:_e,source:this.source,tileID:this.tileID,type:"icons"},(Me,ke)=>{k||(k=Me,H=ke,Ie.call(this))},void 0,!1,te):H={};const Se=Object.keys(I.patternDependencies);function Ie(){if(k)return _(k);if(N&&H&&q){const Me=new t_(N),ke=new yp(H,q);for(const He in C){const Je=C[He];Je instanceof Da?(r_(Je.layers,this.zoom,c),Hg(Je,N,Me.positions,H,ke.iconPositions,this.showCollisionBoxes,this.tileID.canonical,this.tileZoom)):Je.hasPattern&&(Je instanceof cp||Je instanceof _u||Je instanceof Sd)&&(r_(Je.layers,this.zoom,c),Je.addFeatures(I,this.tileID.canonical,ke.patternPositions))}this.status="done",_(null,{buckets:ct(C).filter(He=>!He.isEmpty()),featureIndex:w,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Me.image,lineAtlas:D,imageAtlas:ke,glyphMap:this.returnDependencies?N:null,iconMap:this.returnDependencies?H:null,glyphPositions:this.returnDependencies?Me.positions:null})}}Se.length?f.send("getImages",{icons:Se,source:this.source,tileID:this.tileID,type:"patterns"},(Me,ke)=>{k||(k=Me,q=ke,Ie.call(this))},void 0,!1,te):q={},Ie.call(this)}}function r_(a,i,l){const c=new $(i);for(const f of a)f.recalculate(c,l)}class Gp{constructor(i){this.entries={},this.scheduler=i}request(i,l,c,f){const _=this.entries[i]=this.entries[i]||{callbacks:[]};if(_.result){const[y,w]=_.result;return this.scheduler?this.scheduler.add(()=>{f(y,w)},l):f(y,w),()=>{}}return _.callbacks.push(f),_.cancel||(_.cancel=c((y,w)=>{_.result=[y,w];for(const C of _.callbacks)this.scheduler?this.scheduler.add(()=>{C(y,w)},l):C(y,w);setTimeout(()=>delete this.entries[i],3e3)})),()=>{_.result||(_.callbacks=_.callbacks.filter(y=>y!==f),_.callbacks.length||(_.cancel(),delete this.entries[i]))}}}function qp(a,i,l){const c=JSON.stringify(a.request);return a.data&&(this.deduped.entries[c]={result:[null,a.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},f=>{const _=O(a.request,(y,w,C,D)=>{y?f(y):w&&f(null,{vectorTile:l?void 0:new yu.VectorTile(new Pd(w)),rawData:w,cacheControl:C,expires:D})});return()=>{_.cancel(),f()}},i)}d.ARRAY_TYPE=sr,d.AUTH_ERR_MSG=ls,d.Actor=class{constructor(a,i,l){this.target=a,this.parent=i,this.mapId=l,this.callbacks={},this.cancelCallbacks={},di(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=_o()?a:Fe,this.scheduler=new vb}send(a,i,l,c,f=!1,_){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=_,this.callbacks[y]=l);const w=ro(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:a,hasCallback:!!l,targetMapId:c,mustQueue:f,sourceMapId:this.mapId,data:ql(i,w)},w),{cancel:()=>{l&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(a){const i=a.data,l=i.id;if(l&&(!i.targetMapId||this.mapId===i.targetMapId))if("<cancel>"===i.type){const c=this.cancelCallbacks[l];delete this.cancelCallbacks[l],c&&c.cancel()}else if(i.mustQueue||_o()){const c=this.callbacks[l];this.cancelCallbacks[l]=this.scheduler.add(()=>this.processTask(l,i),c&&c.metadata||{type:"message"})}else this.processTask(l,i)}processTask(a,i){if("<response>"===i.type){const l=this.callbacks[a];delete this.callbacks[a],l&&(i.error?l(zs(i.error)):l(null,zs(i.data)))}else{const l=ro(this.globalScope)?void 0:[],c=i.hasCallback?(_,y)=>{delete this.cancelCallbacks[a],this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:_?ql(_):null,data:ql(y,l)},l)}:_=>{},f=zs(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,f,c);else if(this.parent.getWorkerSource){const _=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,_[0],f.source)[_[1]](f,c)}else c(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},d.CanonicalTileID=Yg,d.Color=Gt,d.ColorMode=ts,d.CullFaceMode=Ui,d.DEMData=Fh,d.DataConstantProperty=J,d.DedupedRequest=Gp,d.DepthMode=Cu,d.EXTENT=Sn,d.Elevation=class{getAtPointOrZero(a,i=0){return this.getAtPoint(a,i)||0}getAtPoint(a,i,l=!0){null==i&&(i=null);const c=this._source();if(!c||a.y<0||a.y>1)return i;const f=c.getSource().maxzoom,_=1<<f,y=Math.floor(a.x),w=a.x-y,C=new uo(f,y,f,Math.floor(w*_),Math.floor(a.y*_)),D=this.findDEMTileFor(C);if(!D||!D.dem)return i;const I=D.dem,R=1<<D.tileID.canonical.z,k=(w*R-D.tileID.canonical.x)*I.dim,N=(a.y*R-D.tileID.canonical.y)*I.dim,H=Math.floor(k),q=Math.floor(N);return(l?this.exaggeration():1)*Dn(Dn(I.get(H,q),I.get(H,q+1),N-q),Dn(I.get(H+1,q),I.get(H+1,q+1),N-q),k-H)}getAtTileOffset(a,i,l){const c=1<<a.canonical.z;return this.getAtPointOrZero(new Ph(a.wrap+(a.canonical.x+i/Sn)/c,(a.canonical.y+l/Sn)/c))}getForTilePoints(a,i,l,c){const f=Tu.create(this,a,c);return!!f&&(i.forEach(_=>{_[2]=this.exaggeration()*f.getElevationAt(_[0],_[1],l)}),!0)}getMinMaxForTile(a){const i=this.findDEMTileFor(a);if(!i||!i.dem)return null;const l=i.dem.tree,c=i.tileID,f=1<<a.canonical.z-c.canonical.z;let _=a.canonical.x/f-c.canonical.x,y=a.canonical.y/f-c.canonical.y,w=0;for(let C=0;C<a.canonical.z-c.canonical.z&&!l.leaves[w];C++){_*=2,y*=2;const D=2*Math.floor(y)+Math.floor(_);w=l.childOffsets[w]+D,_%=1,y%=1}return{min:this.exaggeration()*l.minimums[w],max:this.exaggeration()*l.maximums[w]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,i,l){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},d.ErrorEvent=Ke,d.EvaluationParameters=$,d.Event=ht,d.Evented=It,d.GlyphManager=pc,d.ImagePosition=Th,d.LineAtlas=Kg,d.LngLat=_r,d.LngLatBounds=Eu,d.LocalGlyphMode=bu,d.MAX_SAFE_INTEGER=Ct,d.MercatorCoordinate=Ph,d.ONE_EM=24,d.OverscaledTileID=uo,d.Properties=Ne,d.RGBAImage=si,d.RequestManager=class{constructor(a,i,l){this._transformRequestFn=a,this._customAccessToken=i,this._silenceAuthErrors=!!l,this._createSkuToken()}_createSkuToken(){const a=function(){let i="";for(let l=0;l<10;l++)i+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Rl,i].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(a,i){return this._transformRequestFn&&this._transformRequestFn(a,i)||{url:a}}normalizeStyleURL(a,i){if(!jo(a))return a;const l=io(a);return l.path=`/styles/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||i)}normalizeGlyphsURL(a,i){if(!jo(a))return a;const l=io(a);return l.path=`/fonts/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||i)}normalizeSourceURL(a,i){if(!jo(a))return a;const l=io(a);return l.path=`/v4/${l.authority}.json`,l.params.push("secure"),this._makeAPIURL(l,this._customAccessToken||i)}normalizeSpriteURL(a,i,l,c){const f=io(a);return jo(a)?(f.path=`/styles/v1${f.path}/sprite${i}${l}`,this._makeAPIURL(f,this._customAccessToken||c)):(f.path+=`${i}${l}`,Ds(f))}normalizeTileURL(a,i,l){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!jo(a))return a;const c=io(a);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${i||l&&"raster"!==c.authority&&512===l?"@2x":""}${Bo.supported?".webp":"$1"}`),"raster"===c.authority?c.path=`/${vn.RASTER_URL_PREFIX}${c.path}`:(c.path=c.path.replace(/^.+\/v4\//,"/"),c.path=`/${vn.TILE_URL_VERSION}${c.path}`);const f=this._customAccessToken||function(_){for(const y of _){const w=y.match(/^access_token=(.*)$/);if(w)return w[1]}return null}(c.params)||vn.ACCESS_TOKEN;return vn.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&c.params.push(`sku=${this._skuToken}`),this._makeAPIURL(c,f)}canonicalizeTileURL(a,i){const l=io(a);if(!l.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!l.path.match(/\.[\w]+$/))return a;let c="mapbox://";l.path.match(/^\/raster\/v1\//)?c+=`raster/${l.path.replace(`/${vn.RASTER_URL_PREFIX}/`,"")}`:c+=`tiles/${l.path.replace(`/${vn.TILE_URL_VERSION}/`,"")}`;let f=l.params;return i&&(f=f.filter(_=>!_.match(/^access_token=/))),f.length&&(c+=`?${f.join("&")}`),c}canonicalizeTileset(a,i){const l=!!i&&jo(i),c=[];for(const f of a.tiles||[])$o(f)?c.push(this.canonicalizeTileURL(f,l)):c.push(f);return c}_makeAPIURL(a,i){const l="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",c=io(vn.API_URL);if(a.protocol=c.protocol,a.authority=c.authority,"http"===a.protocol){const f=a.params.indexOf("secure");f>=0&&a.params.splice(f,1)}if("/"!==c.path&&(a.path=`${c.path}${a.path}`),!vn.REQUIRE_ACCESS_TOKEN)return Ds(a);if(i=i||vn.ACCESS_TOKEN,!this._silenceAuthErrors){if(!i)throw new Error(`An API access token is required to use Mapbox GL. ${l}`);if("s"===i[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${l}`)}return a.params=a.params.filter(f=>-1===f.indexOf("access_token")),a.params.push(`access_token=${i||""}`),Ds(a)}},d.ResourceType=us,d.SegmentVector=Vr,d.SourceCache=vc,d.StencilMode=yl,d.StructArrayLayout1ui2=ii,d.StructArrayLayout2f1f2i16=Jo,d.StructArrayLayout2i4=zt,d.StructArrayLayout2ui4=vr,d.StructArrayLayout3f12=Zt,d.StructArrayLayout3ui6=Vn,d.StructArrayLayout4i8=gr,d.Texture=wu,d.Tile=zp,d.Transitionable=le,d.Uniform1f=gd,d.Uniform1i=class extends rc{constructor(a,i){super(a,i),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},d.Uniform2f=class extends rc{constructor(a,i){super(a,i),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},d.Uniform3f=class extends rc{constructor(a,i){super(a,i),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},d.Uniform4f=Ao,d.UniformColor=vs,d.UniformMatrix3f=class extends rc{constructor(a,i){super(a,i),this.current=ic}set(a){for(let i=0;i<9;i++)if(a[i]!==this.current[i]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}},d.UniformMatrix4f=class extends rc{constructor(a,i){super(a,i),this.current=_d}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let i=1;i<16;i++)if(a[i]!==this.current[i]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},d.UnwrappedTileID=Gv,d.ValidationError=Ve,d.VectorTileWorkerSource=class extends It{constructor(a,i,l,c,f){super(),this.actor=a,this.layerIndex=i,this.availableImages=l,this.loadVectorData=f||qp,this.loading={},this.loaded={},this.deduped=new Gp(a.scheduler),this.isSpriteLoaded=c,this.scheduler=a.scheduler}loadTile(a,i){const l=a.uid,c=a&&a.request,f=c&&c.collectResourceTiming,_=this.loading[l]=new n_(a);_.abort=this.loadVectorData(a,(y,w)=>{const C=!this.loading[l];if(delete this.loading[l],C||y||!w)return _.status="done",C||(this.loaded[l]=_),i(y);const D=w.rawData,I={};w.expires&&(I.expires=w.expires),w.cacheControl&&(I.cacheControl=w.cacheControl),_.vectorTile=w.vectorTile||new yu.VectorTile(new Pd(D));const R=()=>{_.parse(_.vectorTile,this.layerIndex,this.availableImages,this.actor,(k,N)=>{if(k||!N)return i(k);const H={};if(f){const q=$v(c);q.length>0&&(H.resourceTiming=JSON.parse(JSON.stringify(q)))}i(null,pt({rawTileData:D.slice(0)},N,I,H))})};this.isSpriteLoaded?R():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(R,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom}):R()}),this.loaded=this.loaded||{},this.loaded[l]=_})}reloadTile(a,i){const l=this.loaded,c=a.uid,f=this;if(l&&l[c]){const _=l[c];_.showCollisionBoxes=a.showCollisionBoxes,_.enableTerrain=!!a.enableTerrain;const y=(w,C)=>{const D=_.reloadCallback;D&&(delete _.reloadCallback,_.parse(_.vectorTile,f.layerIndex,this.availableImages,f.actor,D)),i(w,C)};"parsing"===_.status?_.reloadCallback=y:"done"===_.status&&(_.vectorTile?_.parse(_.vectorTile,this.layerIndex,this.availableImages,this.actor,y):y())}}abortTile(a,i){const l=a.uid,c=this.loading[l];c&&(c.abort&&c.abort(),delete this.loading[l]),i()}removeTile(a,i){const l=this.loaded,c=a.uid;l&&l[c]&&delete l[c],i()}},d.WritingMode=Mo,d.ZoomHistory=Zl,d.add=function(a,i,l){return a[0]=i[0]+l[0],a[1]=i[1]+l[1],a[2]=i[2]+l[2],a},d.addDynamicAttributes=kp,d.altitudeFromMercatorZ=kh,d.asyncAll=ze,d.bezier=et,d.bindAll=di,d.bufferConvexPolygon=function(a,i){const l=[];for(let c=0;c<a.length;c++){const f=ye(c-1,-1,a.length-1),_=ye(c+1,-1,a.length-1),y=a[c],w=a[_],C=a[f].sub(y).unit(),D=w.sub(y).unit(),I=D.angleWithSep(C.x,C.y),R=C.add(D).unit().mult(-1*i/Math.sin(I/2));l.push(y.add(R))}return l},d.cacheEntryPossiblyAdded=function(a){mn++,mn>Pl&&(a.getActor().send("enforceCacheSizeLimit",Pc),mn=0)},d.clamp=Oe,d.clearTileCache=function(a){const i=Fe.caches.delete(Ha);a&&i.catch(a).then(()=>a())},d.clipLine=Dp,d.clone=function(a){var i=new sr(3);return i[0]=a[0],i[1]=a[1],i[2]=a[2],i},d.clone$1=function(a){var i=new sr(16);return i[0]=a[0],i[1]=a[1],i[2]=a[2],i[3]=a[3],i[4]=a[4],i[5]=a[5],i[6]=a[6],i[7]=a[7],i[8]=a[8],i[9]=a[9],i[10]=a[10],i[11]=a[11],i[12]=a[12],i[13]=a[13],i[14]=a[14],i[15]=a[15],i},d.clone$2=Pt,d.collisionCircleLayout=Sv,d.config=vn,d.conjugate=function(a,i){return a[0]=-i[0],a[1]=-i[1],a[2]=-i[2],a[3]=i[3],a},d.copy=function(a,i){return a[0]=i[0],a[1]=i[1],a[2]=i[2],a},d.create=fu,d.create$1=function(){var a=new sr(16);return sr!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},d.create$2=uh,d.createExpression=so,d.createFilter=rl,d.createLayout=bt,d.createStyleLayer=function(a){return"custom"===a.type?new Op(a):new gb[a.type](a)},d.cross=function(a,i,l){var c=i[0],f=i[1],_=i[2],y=l[0],w=l[1],C=l[2];return a[0]=f*C-_*w,a[1]=_*y-c*C,a[2]=c*w-f*y,a},d.degToRad=Pe,d.div=function(a,i,l){return a[0]=i[0]/l[0],a[1]=i[1]/l[1],a[2]=i[2]/l[2],a},d.dot=function(a,i){return a[0]*i[0]+a[1]*i[1]+a[2]*i[2]},d.dot$1=function(a,i){return a[0]*i[0]+a[1]*i[1]+a[2]*i[2]+a[3]*i[3]},d.ease=wt,d.easeCubicInOut=Le,d.emitValidationErrors=xn,d.endsWith=Cr,d.enforceCacheSizeLimit=function(a){Is(),vo&&vo.then(i=>{i.keys().then(l=>{for(let c=0;c<l.length-a;c++)i.delete(l[c])})})},d.evaluateSizeForFeature=Rd,d.evaluateSizeForZoom=vu,d.evaluateVariableOffset=$g,d.evented=F,d.exactEquals=function(a,i){return a[0]===i[0]&&a[1]===i[1]&&a[2]===i[2]&&a[3]===i[3]},d.exactEquals$1=function(a,i){return a[0]===i[0]&&a[1]===i[1]&&a[2]===i[2]},d.exported=Ki,d.exported$1=Bo,d.extend=pt,d.filterObject=Pr,d.fromMat4=function(a,i){return a[0]=i[0],a[1]=i[1],a[2]=i[2],a[3]=i[4],a[4]=i[5],a[5]=i[6],a[6]=i[8],a[7]=i[9],a[8]=i[10],a},d.fromQuat=function(a,i){var l=i[0],c=i[1],f=i[2],_=i[3],y=l+l,w=c+c,C=f+f,D=l*y,I=c*y,R=c*w,k=f*y,N=f*w,H=f*C,q=_*y,te=_*w,de=_*C;return a[0]=1-R-H,a[1]=I+de,a[2]=k-te,a[3]=0,a[4]=I-de,a[5]=1-D-H,a[6]=N+q,a[7]=0,a[8]=k+te,a[9]=N-q,a[10]=1-D-R,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},d.fromRotation=function(a,i){var l=Math.sin(i),c=Math.cos(i);return a[0]=c,a[1]=l,a[2]=0,a[3]=-l,a[4]=c,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},d.fromScaling=function(a,i){return a[0]=i[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=i[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=i[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},d.furthestTileCorner=function(a){const i=Math.round((a+45+360)%360/90)%4;return je[i]},d.getAABBPointSquareDist=function(a,i,l){let c=0;for(let f=0;f<2;++f){const _=l?l[f]:0;a[f]>_&&(c+=(a[f]-_)*(a[f]-_)),i[f]<_&&(c+=(_-i[f])*(_-i[f]))}return c},d.getAnchorAlignment=bp,d.getAnchorJustification=Ip,d.getBounds=function(a){let i=1/0,l=1/0,c=-1/0,f=-1/0;for(const _ of a)i=Math.min(i,_.x),l=Math.min(l,_.y),c=Math.max(c,_.x),f=Math.max(f,_.y);return{min:new ne(i,l),max:new ne(c,f)}},d.getImage=oe,d.getJSON=function(a,i){return X(pt(a,{type:"json"}),i)},d.getMapSessionAPI=kc,d.getPerformanceMeasurement=$v,d.getRTLTextPluginStatus=L,d.getReferrer=oo,d.getVideo=function(a,i){const l=Fe.document.createElement("video");l.muted=!0,l.onloadstart=function(){i(null,l)};for(let c=0;c<a.length;c++){const f=Fe.document.createElement("source");ee(a[c])||(l.crossOrigin="Anonymous"),f.src=a[c],l.appendChild(f)}return{cancel:()=>{}}},d.identity=Gs,d.identity$1=ag,d.invert=function(a,i){var l=i[0],c=i[1],f=i[2],_=i[3],y=i[4],w=i[5],C=i[6],D=i[7],I=i[8],R=i[9],k=i[10],N=i[11],H=i[12],q=i[13],te=i[14],de=i[15],_e=l*w-c*y,Se=l*C-f*y,Ie=l*D-_*y,Me=c*C-f*w,ke=c*D-_*w,He=f*D-_*C,Je=I*q-R*H,Qe=I*te-k*H,st=I*de-N*H,Ze=R*te-k*q,Ye=R*de-N*q,dt=k*de-N*te,We=_e*dt-Se*Ye+Ie*Ze+Me*st-ke*Qe+He*Je;return We?(a[0]=(w*dt-C*Ye+D*Ze)*(We=1/We),a[1]=(f*Ye-c*dt-_*Ze)*We,a[2]=(q*He-te*ke+de*Me)*We,a[3]=(k*ke-R*He-N*Me)*We,a[4]=(C*st-y*dt-D*Qe)*We,a[5]=(l*dt-f*st+_*Qe)*We,a[6]=(te*Ie-H*He-de*Se)*We,a[7]=(I*He-k*Ie+N*Se)*We,a[8]=(y*Ye-w*st+D*Je)*We,a[9]=(c*st-l*Ye-_*Je)*We,a[10]=(H*ke-q*Ie+de*_e)*We,a[11]=(R*Ie-I*ke-N*_e)*We,a[12]=(w*Qe-y*Ze-C*Je)*We,a[13]=(l*Ze-c*Qe+f*Je)*We,a[14]=(q*Se-H*Me-te*_e)*We,a[15]=(I*Me-R*Se+k*_e)*We,a):null},d.isMapAuthenticated=function(a){return sa.has(a)},d.isMapboxURL=jo,d.latFromMercatorY=qd,d.len=lb,d.length=hh,d.length$1=function(a){return Math.hypot(a[0],a[1],a[2],a[3])},d.loadVectorTile=qp,d.makeRequest=X,d.mercatorXfromLng=jv,d.mercatorYfromLat=Np,d.mercatorZfromAltitude=Gd,d.mul=function(a,i,l){return a[0]=i[0]*l[0],a[1]=i[1]*l[1],a[2]=i[2]*l[2],a[3]=i[3]*l[3],a},d.mul$1=ng,d.mul$2=Qy,d.multiply=tg,d.multiply$1=ig,d.nextPowerOfTwo=Fn,d.normalize=pu,d.normalize$1=function(a,i){var l=i[0],c=i[1],f=i[2],_=i[3],y=l*l+c*c+f*f+_*_;return y>0&&(y=1/Math.sqrt(y)),a[0]=l*y,a[1]=c*y,a[2]=f*y,a[3]=_*y,a},d.number=Dn,d.ortho=function(a,i,l,c,f,_,y){var w=1/(i-l),C=1/(c-f),D=1/(_-y);return a[0]=-2*w,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*C,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*D,a[11]=0,a[12]=(i+l)*w,a[13]=(f+c)*C,a[14]=(y+_)*D,a[15]=1,a},d.pbf=Pd,d.perspective=function(a,i,l,c,f){var _,y=1/Math.tan(i/2);return a[0]=y/l,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=y,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,null!=f&&f!==1/0?(a[10]=(f+c)*(_=1/(c-f)),a[14]=2*f*c*_):(a[10]=-1,a[14]=-2*c),a},d.pick=function(a,i){const l={};for(let c=0;c<i.length;c++){const f=i[c];f in a&&(l[f]=a[f])}return l},d.plugin=U,d.pointGeometry=ne,d.polygonIntersectsBox=Yy,d.polygonIntersectsPolygon=Jm,d.polygonizeBounds=function(a,i,l=0,c=!0){const f=new ne(l,l),_=a.sub(f),y=i.add(f),w=[_,new ne(y.x,_.y),y,new ne(_.x,y.y)];return c&&w.push(_),w},d.posAttributes=qv,d.postMapLoadEvent=kl,d.postTurnstileEvent=Mc,d.potpack=gl,d.prevPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},d.radToDeg=function(a){return a*me},d.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],d.registerForPluginStateChange=function(a){return a({pluginStatus:b,pluginURL:T}),F.on("pluginStateChange",a),a},d.removeAuthState=function(a){sa.delete(a)},d.renderColorRamp=ip,d.rotateX=function(a,i,l){var c=Math.sin(l),f=Math.cos(l),_=i[4],y=i[5],w=i[6],C=i[7],D=i[8],I=i[9],R=i[10],k=i[11];return i!==a&&(a[0]=i[0],a[1]=i[1],a[2]=i[2],a[3]=i[3],a[12]=i[12],a[13]=i[13],a[14]=i[14],a[15]=i[15]),a[4]=_*f+D*c,a[5]=y*f+I*c,a[6]=w*f+R*c,a[7]=C*f+k*c,a[8]=D*f-_*c,a[9]=I*f-y*c,a[10]=R*f-w*c,a[11]=k*f-C*c,a},d.rotateX$1=fh,d.rotateY=function(a,i,l){var c=Math.sin(l),f=Math.cos(l),_=i[0],y=i[1],w=i[2],C=i[3],D=i[8],I=i[9],R=i[10],k=i[11];return i!==a&&(a[4]=i[4],a[5]=i[5],a[6]=i[6],a[7]=i[7],a[12]=i[12],a[13]=i[13],a[14]=i[14],a[15]=i[15]),a[0]=_*f-D*c,a[1]=y*f-I*c,a[2]=w*f-R*c,a[3]=C*f-k*c,a[8]=_*c+D*f,a[9]=y*c+I*f,a[10]=w*c+R*f,a[11]=C*c+k*f,a},d.rotateZ=function(a,i,l){var c=Math.sin(l),f=Math.cos(l),_=i[0],y=i[1],w=i[2],C=i[3],D=i[4],I=i[5],R=i[6],k=i[7];return i!==a&&(a[8]=i[8],a[9]=i[9],a[10]=i[10],a[11]=i[11],a[12]=i[12],a[13]=i[13],a[14]=i[14],a[15]=i[15]),a[0]=_*f+D*c,a[1]=y*f+I*c,a[2]=w*f+R*c,a[3]=C*f+k*c,a[4]=D*f-_*c,a[5]=I*f-y*c,a[6]=R*f-w*c,a[7]=k*f-C*c,a},d.rotateZ$1=function(a,i,l){l*=.5;var c=i[0],f=i[1],_=i[2],y=i[3],w=Math.sin(l),C=Math.cos(l);return a[0]=c*C+f*w,a[1]=f*C-c*w,a[2]=_*C+y*w,a[3]=y*C-_*w,a},d.scale=function(a,i,l){return a[0]=i[0]*l,a[1]=i[1]*l,a[2]=i[2]*l,a},d.scale$1=function(a,i,l){var c=l[0],f=l[1],_=l[2];return a[0]=i[0]*c,a[1]=i[1]*c,a[2]=i[2]*c,a[3]=i[3]*c,a[4]=i[4]*f,a[5]=i[5]*f,a[6]=i[6]*f,a[7]=i[7]*f,a[8]=i[8]*_,a[9]=i[9]*_,a[10]=i[10]*_,a[11]=i[11]*_,a[12]=i[12],a[13]=i[13],a[14]=i[14],a[15]=i[15],a},d.scale$2=function(a,i,l){return a[0]=i[0]*l,a[1]=i[1]*l,a[2]=i[2]*l,a[3]=i[3]*l,a},d.scaleAndAdd=cc,d.setCacheLimits=function(a,i){Pc=a,Pl=i},d.setRTLTextPlugin=function(a,i,l=!1){if(b===o||b===h||b===g)throw new Error("setRTLTextPlugin cannot be called multiple times.");T=Ki.resolveURL(a),b=o,x=i,M(),l||B()},d.smoothstep=function(a,i,l){return(l=Oe((l-a)/(i-a),0,1))*l*(3-2*l)},d.spec=ue,d.storeAuthState=function(a,i){i?sa.add(a):sa.delete(a)},d.sub=sg,d.subtract=rg,d.symbolSize=Av,d.transformMat3=function(a,i,l){var c=i[0],f=i[1],_=i[2];return a[0]=c*l[0]+f*l[3]+_*l[6],a[1]=c*l[1]+f*l[4]+_*l[7],a[2]=c*l[2]+f*l[5]+_*l[8],a},d.transformMat4=dh,d.transformMat4$1=function(a,i,l){var c=i[0],f=i[1],_=i[2],y=l[3]*c+l[7]*f+l[11]*_+l[15];return a[0]=(l[0]*c+l[4]*f+l[8]*_+l[12])/(y=y||1),a[1]=(l[1]*c+l[5]*f+l[9]*_+l[13])/y,a[2]=(l[2]*c+l[6]*f+l[10]*_+l[14])/y,a},d.transformQuat=og,d.translate=function(a,i,l){var c,f,_,y,w,C,D,I,R,k,N,H,q=l[0],te=l[1],de=l[2];return i===a?(a[12]=i[0]*q+i[4]*te+i[8]*de+i[12],a[13]=i[1]*q+i[5]*te+i[9]*de+i[13],a[14]=i[2]*q+i[6]*te+i[10]*de+i[14],a[15]=i[3]*q+i[7]*te+i[11]*de+i[15]):(f=i[1],_=i[2],y=i[3],w=i[4],C=i[5],D=i[6],I=i[7],R=i[8],k=i[9],N=i[10],H=i[11],a[0]=c=i[0],a[1]=f,a[2]=_,a[3]=y,a[4]=w,a[5]=C,a[6]=D,a[7]=I,a[8]=R,a[9]=k,a[10]=N,a[11]=H,a[12]=c*q+w*te+R*de+i[12],a[13]=f*q+C*te+k*de+i[13],a[14]=_*q+D*te+N*de+i[14],a[15]=y*q+I*te+H*de+i[15]),a},d.triggerPluginCompletionEvent=A,d.uniqueId=jt,d.validateCustomStyleLayer=function(a){const i=[],l=a.id;return void 0===l&&i.push({message:`layers.${l}: missing required property "id"`}),void 0===a.render&&i.push({message:`layers.${l}: missing required method "render"`}),a.renderingMode&&"2d"!==a.renderingMode&&"3d"!==a.renderingMode&&i.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),i},d.validateFog=eu,d.validateLight=Jc,d.validateStyle=ol,d.values=ct,d.vectorTile=yu,d.version="2.5.1",d.warnOnce=Qn,d.window=Fe,d.wrap=ye}),Ae(0,function(d){function re(X){const O=typeof X;if("number"===O||"boolean"===O||"string"===O||null==X)return JSON.stringify(X);if(Array.isArray(X)){let ee="[";for(const ce of X)ee+=`${re(ce)},`;return`${ee}]`}const z=Object.keys(X).sort();let W="{";for(let ee=0;ee<z.length;ee++)W+=`${JSON.stringify(z[ee])}:${re(X[z[ee]])},`;return`${W}}`}function Ce(X){let O="";for(const z of d.refProperties)O+=`/${re(X[z])}`;return O}class Te{constructor(O){this.keyCache={},O&&this.replace(O)}replace(O){this._layerConfigs={},this._layers={},this.update(O,[])}update(O,z){for(const ee of O){this._layerConfigs[ee.id]=ee;const ce=this._layers[ee.id]=d.createStyleLayer(ee);ce._featureFilter=d.createFilter(ce.filter),this.keyCache[ee.id]&&delete this.keyCache[ee.id]}for(const ee of z)delete this.keyCache[ee],delete this._layerConfigs[ee],delete this._layers[ee];this.familiesBySource={};const W=function(ee,ce){const De={};for(let oe=0;oe<ee.length;oe++){const xe=ce&&ce[ee[oe].id]||Ce(ee[oe]);ce&&(ce[ee[oe].id]=xe);let Ge=De[xe];Ge||(Ge=De[xe]=[]),Ge.push(ee[oe])}const Ee=[];for(const oe in De)Ee.push(De[oe]);return Ee}(d.values(this._layerConfigs),this.keyCache);for(const ee of W){const ce=ee.map(ht=>this._layers[ht.id]),De=ce[0];if("none"===De.visibility)continue;const Ee=De.source||"";let oe=this.familiesBySource[Ee];oe||(oe=this.familiesBySource[Ee]={});const xe=De.sourceLayer||"_geojsonTileLayer";let Ge=oe[xe];Ge||(Ge=oe[xe]=[]),Ge.push(ce)}}}const{ImageBitmap:ne}=d.window;class ie{loadTile(O,z){const{uid:W,encoding:ee,rawImageData:ce,padding:De,buildQuadTree:Ee}=O,oe=ne&&ce instanceof ne?this.getImageData(ce,De):ce;z(null,new d.DEMData(W,oe,ee,De<1,Ee))}getImageData(O,z){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(O.width,O.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=O.width,this.offscreenCanvas.height=O.height,this.offscreenCanvasContext.drawImage(O,0,0,O.width,O.height);const W=this.offscreenCanvasContext.getImageData(-z,-z,O.width+2*z,O.height+2*z);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new d.RGBAImage({width:W.width,height:W.height},W.data)}}var Fe=function X(O,z){var W,ee=O&&O.type;if("FeatureCollection"===ee)for(W=0;W<O.features.length;W++)X(O.features[W],z);else if("GeometryCollection"===ee)for(W=0;W<O.geometries.length;W++)X(O.geometries[W],z);else if("Feature"===ee)X(O.geometry,z);else if("Polygon"===ee)Ct(O.coordinates,z);else if("MultiPolygon"===ee)for(W=0;W<O.coordinates.length;W++)Ct(O.coordinates[W],z);return O};function Ct(X,O){if(0!==X.length){it(X[0],O);for(var z=1;z<X.length;z++)it(X[z],!O)}}function it(X,O){for(var z=0,W=0,ee=X.length,ce=ee-1;W<ee;ce=W++)z+=(X[W][0]-X[ce][0])*(X[ce][1]+X[W][1]);z>=0!=!!O&&X.reverse()}const me=d.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Pe{constructor(O){this._feature=O,this.extent=d.EXTENT,this.type=O.type,this.properties=O.tags,"id"in O&&!isNaN(O.id)&&(this.id=parseInt(O.id,10))}loadGeometry(){if(1===this._feature.type){const O=[];for(const z of this._feature.geometry)O.push([new d.pointGeometry(z[0],z[1])]);return O}{const O=[];for(const z of this._feature.geometry){const W=[];for(const ee of z)W.push(new d.pointGeometry(ee[0],ee[1]));O.push(W)}return O}}toGeoJSON(O,z,W){return me.call(this,O,z,W)}}class je{constructor(O){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=d.EXTENT,this.length=O.length,this._features=O}feature(O){return new Pe(this._features[O])}}var Le=d.vectorTile.VectorTileFeature,et=wt;function wt(X,O){this.options=O||{},this.features=X,this.length=X.length}function Oe(X,O){this.id="number"==typeof X.id?X.id:void 0,this.type=X.type,this.rawGeometry=1===X.type?[X.geometry]:X.geometry,this.properties=X.tags,this.extent=O||4096}wt.prototype.feature=function(X){return new Oe(this.features[X],this.options.extent)},Oe.prototype.loadGeometry=function(){var X=this.rawGeometry;this.geometry=[];for(var O=0;O<X.length;O++){for(var z=X[O],W=[],ee=0;ee<z.length;ee++)W.push(new d.pointGeometry(z[ee][0],z[ee][1]));this.geometry.push(W)}return this.geometry},Oe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var X=this.geometry,O=1/0,z=-1/0,W=1/0,ee=-1/0,ce=0;ce<X.length;ce++)for(var De=X[ce],Ee=0;Ee<De.length;Ee++){var oe=De[Ee];O=Math.min(O,oe.x),z=Math.max(z,oe.x),W=Math.min(W,oe.y),ee=Math.max(ee,oe.y)}return[O,W,z,ee]},Oe.prototype.toGeoJSON=Le.prototype.toGeoJSON;var ye=ct,ze=et;function ct(X){var O=new d.pbf;return function(z,W){for(var ee in z.layers)W.writeMessage(3,pt,z.layers[ee])}(X,O),O.finish()}function pt(X,O){var z;O.writeVarintField(15,X.version||1),O.writeStringField(1,X.name||""),O.writeVarintField(5,X.extent||4096);var W={keys:[],values:[],keycache:{},valuecache:{}};for(z=0;z<X.length;z++)W.feature=X.feature(z),O.writeMessage(2,Dt,W);var ee=W.keys;for(z=0;z<ee.length;z++)O.writeStringField(3,ee[z]);var ce=W.values;for(z=0;z<ce.length;z++)O.writeMessage(4,di,ce[z])}function Dt(X,O){var z=X.feature;void 0!==z.id&&O.writeVarintField(1,z.id),O.writeMessage(2,jt,X),O.writeVarintField(3,z.type),O.writeMessage(4,kr,z)}function jt(X,O){var z=X.feature,W=X.keys,ee=X.values,ce=X.keycache,De=X.valuecache;for(var Ee in z.properties){var oe=ce[Ee];void 0===oe&&(W.push(Ee),ce[Ee]=oe=W.length-1),O.writeVarint(oe);var xe=z.properties[Ee],Ge=typeof xe;"string"!==Ge&&"boolean"!==Ge&&"number"!==Ge&&(xe=JSON.stringify(xe));var ht=Ge+":"+xe,Ke=De[ht];void 0===Ke&&(ee.push(xe),De[ht]=Ke=ee.length-1),O.writeVarint(Ke)}}function Wn(X,O){return(O<<3)+(7&X)}function Fn(X){return X<<1^X>>31}function kr(X,O){for(var z=X.loadGeometry(),W=X.type,ee=0,ce=0,De=z.length,Ee=0;Ee<De;Ee++){var oe=z[Ee],xe=1;1===W&&(xe=oe.length),O.writeVarint(Wn(1,xe));for(var Ge=3===W?oe.length-1:oe.length,ht=0;ht<Ge;ht++){1===ht&&1!==W&&O.writeVarint(Wn(2,Ge-1));var Ke=oe[ht].x-ee,It=oe[ht].y-ce;O.writeVarint(Fn(Ke)),O.writeVarint(Fn(It)),ee+=Ke,ce+=It}3===W&&O.writeVarint(Wn(7,1))}}function di(X,O){var z=typeof X;"string"===z?O.writeStringField(1,X):"boolean"===z?O.writeBooleanField(7,X):"number"===z&&(X%1!=0?O.writeDoubleField(3,X):X<0?O.writeSVarintField(6,X):O.writeVarintField(5,X))}function Cr(X,O,z,W,ee,ce){if(ee-W<=z)return;const De=W+ee>>1;Wi(X,O,De,W,ee,ce%2),Cr(X,O,z,W,De-1,ce+1),Cr(X,O,z,De+1,ee,ce+1)}function Wi(X,O,z,W,ee,ce){for(;ee>W;){if(ee-W>600){const xe=ee-W+1,Ge=z-W+1,ht=Math.log(xe),Ke=.5*Math.exp(2*ht/3),It=.5*Math.sqrt(ht*Ke*(xe-Ke)/xe)*(Ge-xe/2<0?-1:1);Wi(X,O,z,Math.max(W,Math.floor(z-Ge*Ke/xe+It)),Math.min(ee,Math.floor(z+(xe-Ge)*Ke/xe+It)),ce)}const De=O[2*z+ce];let Ee=W,oe=ee;for(Pr(X,O,W,z),O[2*ee+ce]>De&&Pr(X,O,W,ee);Ee<oe;){for(Pr(X,O,Ee,oe),Ee++,oe--;O[2*Ee+ce]<De;)Ee++;for(;O[2*oe+ce]>De;)oe--}O[2*W+ce]===De?Pr(X,O,W,oe):(oe++,Pr(X,O,oe,ee)),oe<=z&&(W=oe+1),z<=oe&&(ee=oe-1)}}function Pr(X,O,z,W){Pt(X,z,W),Pt(O,2*z,2*W),Pt(O,2*z+1,2*W+1)}function Pt(X,O,z){const W=X[O];X[O]=X[z],X[z]=W}function is(X,O,z,W){const ee=X-z,ce=O-W;return ee*ee+ce*ce}ye.fromVectorTileJs=ct,ye.fromGeojsonVt=function(X,O){O=O||{};var z={};for(var W in X)z[W]=new et(X[W].features,O),z[W].name=W,z[W].version=O.version,z[W].extent=O.extent;return ct({layers:z})},ye.GeoJSONWrapper=ze;const Qn=X=>X[0],Ti=X=>X[1];class zo{constructor(O,z=Qn,W=Ti,ee=64,ce=Float64Array){this.nodeSize=ee,this.points=O;const De=O.length<65536?Uint16Array:Uint32Array,Ee=this.ids=new De(O.length),oe=this.coords=new ce(2*O.length);for(let xe=0;xe<O.length;xe++)Ee[xe]=xe,oe[2*xe]=z(O[xe]),oe[2*xe+1]=W(O[xe]);Cr(Ee,oe,ee,0,Ee.length-1,0)}range(O,z,W,ee){return function(ce,De,Ee,oe,xe,Ge,ht){const Ke=[0,ce.length-1,0],It=[];let ue,Ve;for(;Ke.length;){const Bt=Ke.pop(),tn=Ke.pop(),Ft=Ke.pop();if(tn-Ft<=ht){for(let Xn=Ft;Xn<=tn;Xn++)ue=De[2*Xn],Ve=De[2*Xn+1],ue>=Ee&&ue<=xe&&Ve>=oe&&Ve<=Ge&&It.push(ce[Xn]);continue}const Tn=Math.floor((Ft+tn)/2);ue=De[2*Tn],Ve=De[2*Tn+1],ue>=Ee&&ue<=xe&&Ve>=oe&&Ve<=Ge&&It.push(ce[Tn]);const gn=(Bt+1)%2;(0===Bt?Ee<=ue:oe<=Ve)&&(Ke.push(Ft),Ke.push(Tn-1),Ke.push(gn)),(0===Bt?xe>=ue:Ge>=Ve)&&(Ke.push(Tn+1),Ke.push(tn),Ke.push(gn))}return It}(this.ids,this.coords,O,z,W,ee,this.nodeSize)}within(O,z,W){return function(ee,ce,De,Ee,oe,xe){const Ge=[0,ee.length-1,0],ht=[],Ke=oe*oe;for(;Ge.length;){const It=Ge.pop(),ue=Ge.pop(),Ve=Ge.pop();if(ue-Ve<=xe){for(let gn=Ve;gn<=ue;gn++)is(ce[2*gn],ce[2*gn+1],De,Ee)<=Ke&&ht.push(ee[gn]);continue}const Bt=Math.floor((Ve+ue)/2),tn=ce[2*Bt],Ft=ce[2*Bt+1];is(tn,Ft,De,Ee)<=Ke&&ht.push(ee[Bt]);const Tn=(It+1)%2;(0===It?De-oe<=tn:Ee-oe<=Ft)&&(Ge.push(Ve),Ge.push(Bt-1),Ge.push(Tn)),(0===It?De+oe>=tn:Ee+oe>=Ft)&&(Ge.push(Bt+1),Ge.push(ue),Ge.push(Tn))}return ht}(this.ids,this.coords,O,z,W,this.nodeSize)}}const _o={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:X=>X},Xi=Math.fround||(os=new Float32Array(1),X=>(os[0]=+X,os[0]));var os;class cn{constructor(O){this.options=Bo(Object.create(_o),O),this.trees=new Array(this.options.maxZoom+1)}load(O){const{log:z,minZoom:W,maxZoom:ee,nodeSize:ce}=this.options;z&&console.time("total time");const De=`prepare ${O.length} points`;z&&console.time(De),this.points=O;let Ee=[];for(let oe=0;oe<O.length;oe++)O[oe].geometry&&Ee.push(Di(O[oe],oe));this.trees[ee+1]=new zo(Ee,Ts,as,ce,Float32Array),z&&console.timeEnd(De);for(let oe=ee;oe>=W;oe--){const xe=+Date.now();Ee=this._cluster(Ee,oe),this.trees[oe]=new zo(Ee,Ts,as,ce,Float32Array),z&&console.log("z%d: %d clusters in %dms",oe,Ee.length,+Date.now()-xe)}return z&&console.timeEnd("total time"),this}getClusters(O,z){let W=((O[0]+180)%360+360)%360-180;const ee=Math.max(-90,Math.min(90,O[1]));let ce=180===O[2]?180:((O[2]+180)%360+360)%360-180;const De=Math.max(-90,Math.min(90,O[3]));if(O[2]-O[0]>=360)W=-180,ce=180;else if(W>ce){const Ge=this.getClusters([W,ee,180,De],z),ht=this.getClusters([-180,ee,ce,De],z);return Ge.concat(ht)}const Ee=this.trees[this._limitZoom(z)],oe=Ee.range(Ki(W),ss(De),Ki(ce),ss(ee)),xe=[];for(const Ge of oe){const ht=Ee.points[Ge];xe.push(ht.numPoints?ro(ht):this.points[ht.index])}return xe}getChildren(O){const z=this._getOriginId(O),W=this._getOriginZoom(O),ee="No cluster with the specified id.",ce=this.trees[W];if(!ce)throw new Error(ee);const De=ce.points[z];if(!De)throw new Error(ee);const Ee=this.options.radius/(this.options.extent*Math.pow(2,W-1)),oe=ce.within(De.x,De.y,Ee),xe=[];for(const Ge of oe){const ht=ce.points[Ge];ht.parentId===O&&xe.push(ht.numPoints?ro(ht):this.points[ht.index])}if(0===xe.length)throw new Error(ee);return xe}getLeaves(O,z,W){const ee=[];return this._appendLeaves(ee,O,z=z||10,W=W||0,0),ee}getTile(O,z,W){const ee=this.trees[this._limitZoom(O)],ce=Math.pow(2,O),{extent:De,radius:Ee}=this.options,oe=Ee/De,xe=(W-oe)/ce,Ge=(W+1+oe)/ce,ht={features:[]};return this._addTileFeatures(ee.range((z-oe)/ce,xe,(z+1+oe)/ce,Ge),ee.points,z,W,ce,ht),0===z&&this._addTileFeatures(ee.range(1-oe/ce,xe,1,Ge),ee.points,ce,W,ce,ht),z===ce-1&&this._addTileFeatures(ee.range(0,xe,oe/ce,Ge),ee.points,-1,W,ce,ht),ht.features.length?ht:null}getClusterExpansionZoom(O){let z=this._getOriginZoom(O)-1;for(;z<=this.options.maxZoom;){const W=this.getChildren(O);if(z++,1!==W.length)break;O=W[0].properties.cluster_id}return z}_appendLeaves(O,z,W,ee,ce){const De=this.getChildren(z);for(const Ee of De){const oe=Ee.properties;if(oe&&oe.cluster?ce+oe.point_count<=ee?ce+=oe.point_count:ce=this._appendLeaves(O,oe.cluster_id,W,ee,ce):ce<ee?ce++:O.push(Ee),O.length===W)break}return ce}_addTileFeatures(O,z,W,ee,ce,De){for(const Ee of O){const oe=z[Ee],xe=oe.numPoints;let Ge,ht,Ke;if(xe)Ge=Vo(oe),ht=oe.x,Ke=oe.y;else{const Ve=this.points[oe.index];Ge=Ve.properties,ht=Ki(Ve.geometry.coordinates[0]),Ke=ss(Ve.geometry.coordinates[1])}const It={type:1,geometry:[[Math.round(this.options.extent*(ht*ce-W)),Math.round(this.options.extent*(Ke*ce-ee))]],tags:Ge};let ue;xe?ue=oe.id:this.options.generateId?ue=oe.index:this.points[oe.index].id&&(ue=this.points[oe.index].id),void 0!==ue&&(It.id=ue),De.features.push(It)}}_limitZoom(O){return Math.max(this.options.minZoom,Math.min(+O,this.options.maxZoom+1))}_cluster(O,z){const W=[],{radius:ee,extent:ce,reduce:De,minPoints:Ee}=this.options,oe=ee/(ce*Math.pow(2,z));for(let xe=0;xe<O.length;xe++){const Ge=O[xe];if(Ge.zoom<=z)continue;Ge.zoom=z;const ht=this.trees[z+1],Ke=ht.within(Ge.x,Ge.y,oe),It=Ge.numPoints||1;let ue=It;for(const Ve of Ke){const Bt=ht.points[Ve];Bt.zoom>z&&(ue+=Bt.numPoints||1)}if(ue>=Ee){let Ve=Ge.x*It,Bt=Ge.y*It,tn=De&&It>1?this._map(Ge,!0):null;const Ft=(xe<<5)+(z+1)+this.points.length;for(const Tn of Ke){const gn=ht.points[Tn];if(gn.zoom<=z)continue;gn.zoom=z;const Xn=gn.numPoints||1;Ve+=gn.x*Xn,Bt+=gn.y*Xn,gn.parentId=Ft,De&&(tn||(tn=this._map(Ge,!0)),De(tn,this._map(gn)))}Ge.parentId=Ft,W.push(Jn(Ve/ue,Bt/ue,Ft,ue,tn))}else if(W.push(Ge),ue>1)for(const Ve of Ke){const Bt=ht.points[Ve];Bt.zoom<=z||(Bt.zoom=z,W.push(Bt))}}return W}_getOriginId(O){return O-this.points.length>>5}_getOriginZoom(O){return(O-this.points.length)%32}_map(O,z){if(O.numPoints)return z?Bo({},O.properties):O.properties;const W=this.points[O.index].properties,ee=this.options.map(W);return z&&ee===W?Bo({},ee):ee}}function Jn(X,O,z,W,ee){return{x:Xi(X),y:Xi(O),zoom:1/0,id:z,parentId:-1,numPoints:W,properties:ee}}function Di(X,O){const[z,W]=X.geometry.coordinates;return{x:Xi(Ki(z)),y:Xi(ss(W)),zoom:1/0,index:O,parentId:-1}}function ro(X){return{type:"Feature",id:X.id,properties:Vo(X),geometry:{type:"Point",coordinates:[(O=X.x,360*(O-.5)),vn(X.y)]}};var O}function Vo(X){const O=X.numPoints,z=O>=1e4?`${Math.round(O/1e3)}k`:O>=1e3?Math.round(O/100)/10+"k":O;return Bo(Bo({},X.properties),{cluster:!0,cluster_id:X.id,point_count:O,point_count_abbreviated:z})}function Ki(X){return X/360+.5}function ss(X){const O=Math.sin(X*Math.PI/180),z=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return z<0?0:z>1?1:z}function vn(X){const O=(180-360*X)*Math.PI/180;return 360*Math.atan(Math.exp(O))/Math.PI-90}function Bo(X,O){for(const z in O)X[z]=O[z];return X}function Ts(X){return X.x}function as(X){return X.y}function ia(X,O,z,W){for(var ee,ce=W,De=z-O>>1,Ee=z-O,oe=X[O],xe=X[O+1],Ge=X[z],ht=X[z+1],Ke=O+3;Ke<z;Ke+=3){var It=Ar(X[Ke],X[Ke+1],oe,xe,Ge,ht);if(It>ce)ee=Ke,ce=It;else if(It===ce){var ue=Math.abs(Ke-De);ue<Ee&&(ee=Ke,Ee=ue)}}ce>W&&(ee-O>3&&ia(X,O,ee,W),X[ee+2]=ce,z-ee>3&&ia(X,ee,z,W))}function Ar(X,O,z,W,ee,ce){var De=ee-z,Ee=ce-W;if(0!==De||0!==Ee){var oe=((X-z)*De+(O-W)*Ee)/(De*De+Ee*Ee);oe>1?(z=ee,W=ce):oe>0&&(z+=De*oe,W+=Ee*oe)}return(De=X-z)*De+(Ee=O-W)*Ee}function Uo(X,O,z,W){var ee={id:void 0===X?null:X,type:O,geometry:z,tags:W,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ce){var De=ce.geometry,Ee=ce.type;if("Point"===Ee||"MultiPoint"===Ee||"LineString"===Ee)Rl(ce,De);else if("Polygon"===Ee||"MultiLineString"===Ee)for(var oe=0;oe<De.length;oe++)Rl(ce,De[oe]);else if("MultiPolygon"===Ee)for(oe=0;oe<De.length;oe++)for(var xe=0;xe<De[oe].length;xe++)Rl(ce,De[oe][xe])}(ee),ee}function Rl(X,O){for(var z=0;z<O.length;z+=3)X.minX=Math.min(X.minX,O[z]),X.minY=Math.min(X.minY,O[z+1]),X.maxX=Math.max(X.maxX,O[z]),X.maxY=Math.max(X.maxY,O[z+1])}function ls(X,O,z,W){if(O.geometry){var ee=O.geometry.coordinates,ce=O.geometry.type,De=Math.pow(z.tolerance/((1<<z.maxZoom)*z.extent),2),Ee=[],oe=O.id;if(z.promoteId?oe=O.properties[z.promoteId]:z.generateId&&(oe=W||0),"Point"===ce)jo(ee,Ee);else if("MultiPoint"===ce)for(var xe=0;xe<ee.length;xe++)jo(ee[xe],Ee);else if("LineString"===ce)$o(ee,Ee,De,!1);else if("MultiLineString"===ce){if(z.lineMetrics){for(xe=0;xe<ee.length;xe++)$o(ee[xe],Ee=[],De,!1),X.push(Uo(oe,"LineString",Ee,O.properties));return}Tr(ee,Ee,De,!1)}else if("Polygon"===ce)Tr(ee,Ee,De,!0);else{if("MultiPolygon"!==ce){if("GeometryCollection"===ce){for(xe=0;xe<O.geometry.geometries.length;xe++)ls(X,{id:oe,geometry:O.geometry.geometries[xe],properties:O.properties},z,W);return}throw new Error("Input data is not a valid GeoJSON object.")}for(xe=0;xe<ee.length;xe++){var Ge=[];Tr(ee[xe],Ge,De,!0),Ee.push(Ge)}}X.push(Uo(oe,ce,Ee,O.properties))}}function jo(X,O){O.push(io(X[0])),O.push(Ds(X[1])),O.push(0)}function $o(X,O,z,W){for(var ee,ce,De=0,Ee=0;Ee<X.length;Ee++){var oe=io(X[Ee][0]),xe=Ds(X[Ee][1]);O.push(oe),O.push(xe),O.push(0),Ee>0&&(De+=W?(ee*xe-oe*ce)/2:Math.sqrt(Math.pow(oe-ee,2)+Math.pow(xe-ce,2))),ee=oe,ce=xe}var Ge=O.length-3;O[2]=1,ia(O,0,Ge,z),O[Ge+2]=1,O.size=Math.abs(De),O.start=0,O.end=O.size}function Tr(X,O,z,W){for(var ee=0;ee<X.length;ee++){var ce=[];$o(X[ee],ce,z,W),O.push(ce)}}function io(X){return X/360+.5}function Ds(X){var O=Math.sin(X*Math.PI/180),z=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return z<0?0:z>1?1:z}function yo(X,O,z,W,ee,ce,De,Ee){if(W/=O,ce>=(z/=O)&&De<W)return X;if(De<z||ce>=W)return null;for(var oe=[],xe=0;xe<X.length;xe++){var Ge=X[xe],ht=Ge.geometry,Ke=Ge.type,It=0===ee?Ge.minX:Ge.minY,ue=0===ee?Ge.maxX:Ge.maxY;if(It>=z&&ue<W)oe.push(Ge);else if(!(ue<z||It>=W)){var Ve=[];if("Point"===Ke||"MultiPoint"===Ke)cs(ht,Ve,z,W,ee);else if("LineString"===Ke)oa(ht,Ve,z,W,ee,!1,Ee.lineMetrics);else if("MultiLineString"===Ke)Ss(ht,Ve,z,W,ee,!1);else if("Polygon"===Ke)Ss(ht,Ve,z,W,ee,!0);else if("MultiPolygon"===Ke)for(var Bt=0;Bt<ht.length;Bt++){var tn=[];Ss(ht[Bt],tn,z,W,ee,!0),tn.length&&Ve.push(tn)}if(Ve.length){if(Ee.lineMetrics&&"LineString"===Ke){for(Bt=0;Bt<Ve.length;Bt++)oe.push(Uo(Ge.id,Ke,Ve[Bt],Ge.tags));continue}"LineString"!==Ke&&"MultiLineString"!==Ke||(1===Ve.length?(Ke="LineString",Ve=Ve[0]):Ke="MultiLineString"),"Point"!==Ke&&"MultiPoint"!==Ke||(Ke=3===Ve.length?"Point":"MultiPoint"),oe.push(Uo(Ge.id,Ke,Ve,Ge.tags))}}}return oe.length?oe:null}function cs(X,O,z,W,ee){for(var ce=0;ce<X.length;ce+=3){var De=X[ce+ee];De>=z&&De<=W&&(O.push(X[ce]),O.push(X[ce+1]),O.push(X[ce+2]))}}function oa(X,O,z,W,ee,ce,De){for(var Ee,oe,xe=Mc(X),Ge=0===ee?Rc:kc,ht=X.start,Ke=0;Ke<X.length-3;Ke+=3){var It=X[Ke],ue=X[Ke+1],Ve=X[Ke+2],Bt=X[Ke+3],tn=X[Ke+4],Ft=0===ee?It:ue,Tn=0===ee?Bt:tn,gn=!1;De&&(Ee=Math.sqrt(Math.pow(It-Bt,2)+Math.pow(ue-tn,2))),Ft<z?Tn>z&&(oe=Ge(xe,It,ue,Bt,tn,z),De&&(xe.start=ht+Ee*oe)):Ft>W?Tn<W&&(oe=Ge(xe,It,ue,Bt,tn,W),De&&(xe.start=ht+Ee*oe)):kl(xe,It,ue,Ve),Tn<z&&Ft>=z&&(oe=Ge(xe,It,ue,Bt,tn,z),gn=!0),Tn>W&&Ft<=W&&(oe=Ge(xe,It,ue,Bt,tn,W),gn=!0),!ce&&gn&&(De&&(xe.end=ht+Ee*oe),O.push(xe),xe=Mc(X)),De&&(ht+=Ee)}var Xn=X.length-3;It=X[Xn],ue=X[Xn+1],Ve=X[Xn+2],(Ft=0===ee?It:ue)>=z&&Ft<=W&&kl(xe,It,ue,Ve),Xn=xe.length-3,ce&&Xn>=3&&(xe[Xn]!==xe[0]||xe[Xn+1]!==xe[1])&&kl(xe,xe[0],xe[1],xe[2]),xe.length&&O.push(xe)}function Mc(X){var O=[];return O.size=X.size,O.start=X.start,O.end=X.end,O}function Ss(X,O,z,W,ee,ce){for(var De=0;De<X.length;De++)oa(X[De],O,z,W,ee,ce,!1)}function kl(X,O,z,W){X.push(O),X.push(z),X.push(W)}function Rc(X,O,z,W,ee,ce){var De=(ce-O)/(W-O);return X.push(ce),X.push(z+(ee-z)*De),X.push(1),De}function kc(X,O,z,W,ee,ce){var De=(ce-z)/(ee-z);return X.push(O+(W-O)*De),X.push(ce),X.push(1),De}function sa(X,O){for(var z=[],W=0;W<X.length;W++){var ee,ce=X[W],De=ce.type;if("Point"===De||"MultiPoint"===De||"LineString"===De)ee=Ha(ce.geometry,O);else if("MultiLineString"===De||"Polygon"===De){ee=[];for(var Ee=0;Ee<ce.geometry.length;Ee++)ee.push(Ha(ce.geometry[Ee],O))}else if("MultiPolygon"===De)for(ee=[],Ee=0;Ee<ce.geometry.length;Ee++){for(var oe=[],xe=0;xe<ce.geometry[Ee].length;xe++)oe.push(Ha(ce.geometry[Ee][xe],O));ee.push(oe)}z.push(Uo(ce.id,De,ee,ce.tags))}return z}function Ha(X,O){var z=[];z.size=X.size,void 0!==X.start&&(z.start=X.start,z.end=X.end);for(var W=0;W<X.length;W+=3)z.push(X[W]+O,X[W+1],X[W+2]);return z}function vo(X,O){if(X.transformed)return X;var z,W,ee,ce=1<<X.z,De=X.x,Ee=X.y;for(z=0;z<X.features.length;z++){var oe=X.features[z],xe=oe.geometry,Ge=oe.type;if(oe.geometry=[],1===Ge)for(W=0;W<xe.length;W+=2)oe.geometry.push(As(xe[W],xe[W+1],O,ce,De,Ee));else for(W=0;W<xe.length;W++){var ht=[];for(ee=0;ee<xe[W].length;ee+=2)ht.push(As(xe[W][ee],xe[W][ee+1],O,ce,De,Ee));oe.geometry.push(ht)}}return X.transformed=!0,X}function As(X,O,z,W,ee,ce){return[Math.round(z*(X*W-ee)),Math.round(z*(O*W-ce))]}function Pc(X,O,z,W,ee){for(var ce=O===ee.maxZoom?0:ee.tolerance/((1<<O)*ee.extent),De={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:z,y:W,z:O,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ee=0;Ee<X.length;Ee++){De.numFeatures++,Pl(De,X[Ee],ce,ee);var oe=X[Ee].minX,xe=X[Ee].minY,Ge=X[Ee].maxX,ht=X[Ee].maxY;oe<De.minX&&(De.minX=oe),xe<De.minY&&(De.minY=xe),Ge>De.maxX&&(De.maxX=Ge),ht>De.maxY&&(De.maxY=ht)}return De}function Pl(X,O,z,W){var ee=O.geometry,ce=O.type,De=[];if("Point"===ce||"MultiPoint"===ce)for(var Ee=0;Ee<ee.length;Ee+=3)De.push(ee[Ee]),De.push(ee[Ee+1]),X.numPoints++,X.numSimplified++;else if("LineString"===ce)Is(De,ee,X,z,!1,!1);else if("MultiLineString"===ce||"Polygon"===ce)for(Ee=0;Ee<ee.length;Ee++)Is(De,ee[Ee],X,z,"Polygon"===ce,0===Ee);else if("MultiPolygon"===ce)for(var oe=0;oe<ee.length;oe++){var xe=ee[oe];for(Ee=0;Ee<xe.length;Ee++)Is(De,xe[Ee],X,z,!0,0===Ee)}if(De.length){var Ge=O.tags||null;if("LineString"===ce&&W.lineMetrics){for(var ht in Ge={},O.tags)Ge[ht]=O.tags[ht];Ge.mapbox_clip_start=ee.start/ee.size,Ge.mapbox_clip_end=ee.end/ee.size}var Ke={geometry:De,type:"Polygon"===ce||"MultiPolygon"===ce?3:"LineString"===ce||"MultiLineString"===ce?2:1,tags:Ge};null!==O.id&&(Ke.id=O.id),X.features.push(Ke)}}function Is(X,O,z,W,ee,ce){var De=W*W;if(W>0&&O.size<(ee?De:W))z.numPoints+=O.length/3;else{for(var Ee=[],oe=0;oe<O.length;oe+=3)(0===W||O[oe+2]>De)&&(z.numSimplified++,Ee.push(O[oe]),Ee.push(O[oe+1])),z.numPoints++;ee&&function(xe,Ge){for(var ht=0,Ke=0,It=xe.length,ue=It-2;Ke<It;ue=Ke,Ke+=2)ht+=(xe[Ke]-xe[ue])*(xe[Ke+1]+xe[ue+1]);if(ht>0===Ge)for(Ke=0,It=xe.length;Ke<It/2;Ke+=2){var Ve=xe[Ke],Bt=xe[Ke+1];xe[Ke]=xe[It-2-Ke],xe[Ke+1]=xe[It-1-Ke],xe[It-2-Ke]=Ve,xe[It-1-Ke]=Bt}}(Ee,ce),X.push(Ee)}}function Ms(X,O){var z=(O=this.options=function(ee,ce){for(var De in ce)ee[De]=ce[De];return ee}(Object.create(this.options),O)).debug;if(z&&console.time("preprocess data"),O.maxZoom<0||O.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(O.promoteId&&O.generateId)throw new Error("promoteId and generateId cannot be used together.");var ee,ce,De,Ee,oe,xe,W=function(ee,ce){var De=[];if("FeatureCollection"===ee.type)for(var Ee=0;Ee<ee.features.length;Ee++)ls(De,ee.features[Ee],ce,Ee);else ls(De,"Feature"===ee.type?ee:{geometry:ee},ce);return De}(X,O);this.tiles={},this.tileCoords=[],z&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",O.indexMaxZoom,O.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ee=W,ce=O,De=ce.buffer/ce.extent,Ee=ee,oe=yo(ee,1,-1-De,De,0,-1,2,ce),xe=yo(ee,1,1-De,2+De,0,-1,2,ce),(oe||xe)&&(Ee=yo(ee,1,-De,1+De,0,-1,2,ce)||[],oe&&(Ee=sa(oe,1).concat(Ee)),xe&&(Ee=Ee.concat(sa(xe,-1)))),W=Ee).length&&this.splitTile(W,0,0,0),z&&(W.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function mn(X,O,z){return 32*((1<<X)*z+O)+X}function us(X,O){const z=X.tileID.canonical;if(!this._geoJSONIndex)return O(null,null);const W=this._geoJSONIndex.getTile(z.z,z.x,z.y);if(!W)return O(null,null);const ee=new je(W.features);let ce=ye(ee);0===ce.byteOffset&&ce.byteLength===ce.buffer.byteLength||(ce=new Uint8Array(ce)),O(null,{vectorTile:ee,rawData:ce.buffer})}Ms.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ms.prototype.splitTile=function(X,O,z,W,ee,ce,De){for(var Ee=[X,O,z,W],oe=this.options,xe=oe.debug;Ee.length;){W=Ee.pop(),z=Ee.pop(),O=Ee.pop(),X=Ee.pop();var Ge=1<<O,ht=mn(O,z,W),Ke=this.tiles[ht];if(!Ke&&(xe>1&&console.time("creation"),Ke=this.tiles[ht]=Pc(X,O,z,W,oe),this.tileCoords.push({z:O,x:z,y:W}),xe)){xe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",O,z,W,Ke.numFeatures,Ke.numPoints,Ke.numSimplified),console.timeEnd("creation"));var It="z"+O;this.stats[It]=(this.stats[It]||0)+1,this.total++}if(Ke.source=X,ee){if(O===oe.maxZoom||O===ee)continue;var ue=1<<ee-O;if(z!==Math.floor(ce/ue)||W!==Math.floor(De/ue))continue}else if(O===oe.indexMaxZoom||Ke.numPoints<=oe.indexMaxPoints)continue;if(Ke.source=null,0!==X.length){xe>1&&console.time("clipping");var Ve,Bt,tn,Ft,Tn,gn,Xn=.5*oe.buffer/oe.extent,Rs=.5-Xn,ft=.5+Xn,rn=1+Xn;Ve=Bt=tn=Ft=null,Tn=yo(X,Ge,z-Xn,z+ft,0,Ke.minX,Ke.maxX,oe),gn=yo(X,Ge,z+Rs,z+rn,0,Ke.minX,Ke.maxX,oe),X=null,Tn&&(Ve=yo(Tn,Ge,W-Xn,W+ft,1,Ke.minY,Ke.maxY,oe),Bt=yo(Tn,Ge,W+Rs,W+rn,1,Ke.minY,Ke.maxY,oe),Tn=null),gn&&(tn=yo(gn,Ge,W-Xn,W+ft,1,Ke.minY,Ke.maxY,oe),Ft=yo(gn,Ge,W+Rs,W+rn,1,Ke.minY,Ke.maxY,oe),gn=null),xe>1&&console.timeEnd("clipping"),Ee.push(Ve||[],O+1,2*z,2*W),Ee.push(Bt||[],O+1,2*z,2*W+1),Ee.push(tn||[],O+1,2*z+1,2*W),Ee.push(Ft||[],O+1,2*z+1,2*W+1)}}},Ms.prototype.getTile=function(X,O,z){var W=this.options,ee=W.extent,ce=W.debug;if(X<0||X>24)return null;var De=1<<X,Ee=mn(X,O=(O%De+De)%De,z);if(this.tiles[Ee])return vo(this.tiles[Ee],ee);ce>1&&console.log("drilling down to z%d-%d-%d",X,O,z);for(var oe,xe=X,Ge=O,ht=z;!oe&&xe>0;)xe--,Ge=Math.floor(Ge/2),ht=Math.floor(ht/2),oe=this.tiles[mn(xe,Ge,ht)];return oe&&oe.source?(ce>1&&console.log("found parent tile z%d-%d-%d",xe,Ge,ht),ce>1&&console.time("drilling down"),this.splitTile(oe.source,xe,Ge,ht,X,O,z),ce>1&&console.timeEnd("drilling down"),this.tiles[Ee]?vo(this.tiles[Ee],ee):null):null};class Wt extends d.VectorTileWorkerSource{constructor(O,z,W,ee,ce){super(O,z,W,ee,us),ce&&(this.loadGeoJSON=ce)}loadData(O,z){const W=O&&O.request,ee=W&&W.collectResourceTiming;this.loadGeoJSON(O,(ce,De)=>{if(ce||!De)return z(ce);if("object"!=typeof De)return z(new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`));{Fe(De,!0);try{if(O.filter){const oe=d.createExpression(O.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===oe.result)throw new Error(oe.value.map(Ge=>`${Ge.key}: ${Ge.message}`).join(", "));const xe=De.features.filter(Ge=>oe.value.evaluate({zoom:0},Ge));De={type:"FeatureCollection",features:xe}}this._geoJSONIndex=O.cluster?new cn(function({superclusterOptions:oe,clusterProperties:xe}){if(!xe||!oe)return oe;const Ge={},ht={},Ke={accumulated:null,zoom:0},It={properties:null},ue=Object.keys(xe);for(const Ve of ue){const[Bt,tn]=xe[Ve],Ft=d.createExpression(tn),Tn=d.createExpression("string"==typeof Bt?[Bt,["accumulated"],["get",Ve]]:Bt);Ge[Ve]=Ft.value,ht[Ve]=Tn.value}return oe.map=Ve=>{It.properties=Ve;const Bt={};for(const tn of ue)Bt[tn]=Ge[tn].evaluate(Ke,It);return Bt},oe.reduce=(Ve,Bt)=>{It.properties=Bt;for(const tn of ue)Ke.accumulated=Ve[tn],Ve[tn]=ht[tn].evaluate(Ke,It)},oe}(O)).load(De.features):new Ms(oe=De,O.geojsonVtOptions)}catch(oe){return z(oe)}this.loaded={};const Ee={};if(ee){const oe=d.getPerformanceMeasurement(W);oe&&(Ee.resourceTiming={},Ee.resourceTiming[O.source]=JSON.parse(JSON.stringify(oe)))}z(null,Ee)}var oe})}reloadTile(O,z){const W=this.loaded;return W&&W[O.uid]?super.reloadTile(O,z):this.loadTile(O,z)}loadGeoJSON(O,z){if(O.request)d.getJSON(O.request,z);else{if("string"!=typeof O.data)return z(new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`));try{return z(null,JSON.parse(O.data))}catch(W){return z(new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(O,z){try{z(null,this._geoJSONIndex.getClusterExpansionZoom(O.clusterId))}catch(W){z(W)}}getClusterChildren(O,z){try{z(null,this._geoJSONIndex.getChildren(O.clusterId))}catch(W){z(W)}}getClusterLeaves(O,z){try{z(null,this._geoJSONIndex.getLeaves(O.clusterId,O.limit,O.offset))}catch(W){z(W)}}}class oo{constructor(O){this.self=O,this.actor=new d.Actor(O,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded=!1,this.workerSourceTypes={vector:d.VectorTileWorkerSource,geojson:Wt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(z,W)=>{if(this.workerSourceTypes[z])throw new Error(`Worker source with name "${z}" already registered.`);this.workerSourceTypes[z]=W},this.self.registerRTLTextPlugin=z=>{if(d.plugin.isParsed())throw new Error("RTL text plugin already registered.");d.plugin.applyArabicShaping=z.applyArabicShaping,d.plugin.processBidirectionalText=z.processBidirectionalText,d.plugin.processStyledBidirectionalText=z.processStyledBidirectionalText}}checkIfReady(O,z,W){W()}setReferrer(O,z){this.referrer=z}spriteLoaded(O,z){this.isSpriteLoaded=z;for(const W in this.workerSources[O]){const ee=this.workerSources[O][W];for(const ce in ee)ee[ce]instanceof d.VectorTileWorkerSource&&(ee[ce].isSpriteLoaded=z,ee[ce].fire(new d.Event("isSpriteLoaded")))}}setImages(O,z,W){this.availableImages[O]=z;for(const ee in this.workerSources[O]){const ce=this.workerSources[O][ee];for(const De in ce)ce[De].availableImages=z}W()}enableTerrain(O,z,W){this.terrain=z,W()}setLayers(O,z,W){this.getLayerIndex(O).replace(z),W()}updateLayers(O,z,W){this.getLayerIndex(O).update(z.layers,z.removedIds),W()}loadTile(O,z,W){const ee=this.enableTerrain?d.extend({enableTerrain:this.terrain},z):z;this.getWorkerSource(O,z.type,z.source).loadTile(ee,W)}loadDEMTile(O,z,W){const ee=this.enableTerrain?d.extend({buildQuadTree:this.terrain},z):z;this.getDEMWorkerSource(O,z.source).loadTile(ee,W)}reloadTile(O,z,W){const ee=this.enableTerrain?d.extend({enableTerrain:this.terrain},z):z;this.getWorkerSource(O,z.type,z.source).reloadTile(ee,W)}abortTile(O,z,W){this.getWorkerSource(O,z.type,z.source).abortTile(z,W)}removeTile(O,z,W){this.getWorkerSource(O,z.type,z.source).removeTile(z,W)}removeSource(O,z,W){if(!this.workerSources[O]||!this.workerSources[O][z.type]||!this.workerSources[O][z.type][z.source])return;const ee=this.workerSources[O][z.type][z.source];delete this.workerSources[O][z.type][z.source],void 0!==ee.removeSource?ee.removeSource(z,W):W()}loadWorkerSource(O,z,W){try{this.self.importScripts(z.url),W()}catch(ee){W(ee.toString())}}syncRTLPluginState(O,z,W){try{d.plugin.setState(z);const ee=d.plugin.getPluginURL();if(d.plugin.isLoaded()&&!d.plugin.isParsed()&&null!=ee){this.self.importScripts(ee);const ce=d.plugin.isParsed();W(ce?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ee}`),ce)}}catch(ee){W(ee.toString())}}getAvailableImages(O){let z=this.availableImages[O];return z||(z=[]),z}getLayerIndex(O){let z=this.layerIndexes[O];return z||(z=this.layerIndexes[O]=new Te),z}getWorkerSource(O,z,W){return this.workerSources[O]||(this.workerSources[O]={}),this.workerSources[O][z]||(this.workerSources[O][z]={}),this.workerSources[O][z][W]||(this.workerSources[O][z][W]=new this.workerSourceTypes[z]({send:(ee,ce,De,Ee,oe,xe)=>{this.actor.send(ee,ce,De,O,oe,xe)},scheduler:this.actor.scheduler},this.getLayerIndex(O),this.getAvailableImages(O),this.isSpriteLoaded)),this.workerSources[O][z][W]}getDEMWorkerSource(O,z){return this.demWorkerSources[O]||(this.demWorkerSources[O]={}),this.demWorkerSources[O][z]||(this.demWorkerSources[O][z]=new ie),this.demWorkerSources[O][z]}enforceCacheSizeLimit(O,z){d.enforceCacheSizeLimit(z)}getWorkerPerformanceMetrics(O,z,W){W(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new oo(self)),oo}),Ae(0,function(d){var re=Ce;function Ce(p){return o=p,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,x,b=new Blob([""],{type:"text/javascript"}),T=URL.createObjectURL(b);try{x=new Worker(T),g=!0}catch(A){g=!1}return x&&x.terminate(),URL.revokeObjectURL(T),g}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var g=document.createElement("canvas");g.width=g.height=1;var x=g.getContext("2d");if(!x)return!1;var b=x.getImageData(0,0,1,1);return b&&b.width===g.width}()||(void 0===Te[h=o&&o.failIfMajorPerformanceCaveat]&&(Te[h]=function(g){var x,T,A,M,b=(T=g,A=document.createElement("canvas"),(M=Object.create(Ce.webGLContextAttributes)).failIfMajorPerformanceCaveat=T,A.getContext("webgl",M)||A.getContext("experimental-webgl",M));if(!b)return!1;try{x=b.createShader(b.VERTEX_SHADER)}catch(T){return!1}return!(!x||b.isContextLost())&&(b.shaderSource(x,"void main() {}"),b.compileShader(x),!0===b.getShaderParameter(x,b.COMPILE_STATUS))}(h)),!Te[h]||document.documentMode));var o,h}var Te={};function ne(p,o){if(Array.isArray(p)){if(!Array.isArray(o)||p.length!==o.length)return!1;for(let h=0;h<p.length;h++)if(!ne(p[h],o[h]))return!1;return!0}if("object"==typeof p&&null!==p&&null!==o){if("object"!=typeof o||Object.keys(p).length!==Object.keys(o).length)return!1;for(const h in p)if(!ne(p[h],o[h]))return!1;return!0}return p===o}Ce.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ie={create:function(p,o,h){const g=d.window.document.createElement(p);return void 0!==o&&(g.className=o),h&&h.appendChild(g),g},createNS:function(p,o){return d.window.document.createElementNS(p,o)}},Fe=d.window.document&&d.window.document.documentElement.style,Ct=Fe&&void 0!==Fe.userSelect?"userSelect":"WebkitUserSelect";let it;ie.disableDrag=function(){Fe&&Ct&&(it=Fe[Ct],Fe[Ct]="none")},ie.enableDrag=function(){Fe&&Ct&&(Fe[Ct]=it)},ie.setTransform=function(p,o){p.style.transform=o};let me=!1;try{const p=Object.defineProperty({},"passive",{get(){me=!0}});d.window.addEventListener("test",p,p),d.window.removeEventListener("test",p,p)}catch(p){me=!1}ie.addEventListener=function(p,o,h,g={}){p.addEventListener(o,h,"passive"in g&&me?g:g.capture)},ie.removeEventListener=function(p,o,h,g={}){p.removeEventListener(o,h,"passive"in g&&me?g:g.capture)};const Pe=function(p){p.preventDefault(),p.stopPropagation(),d.window.removeEventListener("click",Pe,!0)};function je(p,o,h){const g=p.offsetWidth===o.width?1:p.offsetWidth/o.width;return new d.pointGeometry((h.clientX-o.left)*g,(h.clientY-o.top)*g)}ie.suppressClick=function(){d.window.addEventListener("click",Pe,!0),d.window.setTimeout(()=>{d.window.removeEventListener("click",Pe,!0)},0)},ie.mousePos=function(p,o){const h=p.getBoundingClientRect();return je(p,h,o)},ie.touchPos=function(p,o){const h=p.getBoundingClientRect(),g=[];for(let x=0;x<o.length;x++)g.push(je(p,h,o[x]));return g},ie.mouseButton=function(p){return void 0!==d.window.InstallTrigger&&2===p.button&&p.ctrlKey&&d.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:p.button},ie.remove=function(p){p.parentNode&&p.parentNode.removeChild(p)};class Le{constructor(o,h){this.pos=o,this.dir=h}intersectsPlane(o,h,g){const x=d.dot(h,this.dir);if(Math.abs(x)<1e-6)return!1;const b=d.dot(d.sub(d.create(),o,this.pos),h)/x,T=d.scaleAndAdd(d.create(),this.pos,this.dir,b);return d.copy(g,T),!0}}class et{constructor(o,h){this.points=o,this.planes=h}static fromInvProjectionMatrix(o,h,g){const x=Math.pow(2,g),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(A=>{const M=d.transformMat4([],A,o),F=1/M[3]/h*x;return d.mul(M,M,[F,F,1/M[3],F])}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(A=>{const M=d.sub([],b[A[0]],b[A[1]]),F=d.sub([],b[A[2]],b[A[1]]),L=d.normalize([],d.cross([],M,F)),B=-d.dot(L,b[A[1]]);return L.concat(B)});return new et(b,T)}}class wt{constructor(o,h){this.min=o,this.max=h,this.center=d.scale([],d.add([],this.min,this.max),.5)}quadrant(o){const h=[o%2==0,o<2],g=d.clone(this.min),x=d.clone(this.max);for(let b=0;b<h.length;b++)g[b]=h[b]?this.min[b]:this.center[b],x[b]=h[b]?this.center[b]:this.max[b];return x[2]=this.max[2],new wt(g,x)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}distanceZ(o){return Math.max(Math.min(this.max[2],o[2]),this.min[2])-o[2]}intersects(o){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let g=!0;for(let x=0;x<o.planes.length;x++){const b=o.planes[x];let T=0;for(let A=0;A<h.length;A++)T+=d.dot$1(b,h[A])>=0;if(0===T)return 0;T!==h.length&&(g=!1)}if(g)return 2;for(let x=0;x<3;x++){let b=Number.MAX_VALUE,T=-Number.MAX_VALUE;for(let A=0;A<o.points.length;A++){const M=o.points[A][x]-this.min[x];b=Math.min(b,M),T=Math.max(T,M)}if(T<0||b>this.max[x]-this.min[x])return 0}return 1}}function Oe(p){const{userImage:o}=p;return!!(o&&o.render&&o.render())&&(p.data.replace(new Uint8Array(o.data.buffer)),!0)}class ye extends d.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:h,callback:g}of this.requestors)this._notify(h,g);this.requestors=[]}}getImage(o){return this.images[o]}addImage(o,h){this._validate(o,h)&&(this.images[o]=h)}_validate(o,h){let g=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new d.ErrorEvent(new Error(`Image "${o}" has invalid "stretchX" value`))),g=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new d.ErrorEvent(new Error(`Image "${o}" has invalid "stretchY" value`))),g=!1),this._validateContent(h.content,h)||(this.fire(new d.ErrorEvent(new Error(`Image "${o}" has invalid "content" value`))),g=!1),g}_validateStretch(o,h){if(!o)return!0;let g=0;for(const x of o){if(x[0]<g||x[1]<x[0]||h<x[1])return!1;g=x[1]}return!0}_validateContent(o,h){return!(o&&(4!==o.length||o[0]<0||h.data.width<o[0]||o[1]<0||h.data.height<o[1]||o[2]<0||h.data.width<o[2]||o[3]<0||h.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))}updateImage(o,h){h.version=this.images[o].version+1,this.images[o]=h,this.updatedImages[o]=!0}removeImage(o){const h=this.images[o];delete this.images[o],delete this.patterns[o],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o,h){let g=!0;if(!this.isLoaded())for(const x of o)this.images[x]||(g=!1);this.isLoaded()||g?this._notify(o,h):this.requestors.push({ids:o,callback:h})}_notify(o,h){const g={};for(const x of o){this.images[x]||this.fire(new d.Event("styleimagemissing",{id:x}));const b=this.images[x];b?g[x]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:Boolean(b.userImage&&b.userImage.render)}:d.warnOnce(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,g)}getPixelSize(){const{width:o,height:h}=this.atlasImage;return{width:o,height:h}}getPattern(o){const h=this.patterns[o],g=this.getImage(o);if(!g)return null;if(h&&h.position.version===g.version)return h.position;if(h)h.position.version=g.version;else{const x={w:g.data.width+2,h:g.data.height+2,x:0,y:0},b=new d.ImagePosition(x,g);this.patterns[o]={bin:x,position:b}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const h=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new d.Texture(o,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const b in this.patterns)o.push(this.patterns[b].bin);const{w:h,h:g}=d.potpack(o),x=this.atlasImage;x.resize({width:h||1,height:g||1});for(const b in this.patterns){const{bin:T}=this.patterns[b],A=T.x+1,M=T.y+1,F=this.images[b].data,L=F.width,B=F.height;d.RGBAImage.copy(F,x,{x:0,y:0},{x:A,y:M},{width:L,height:B}),d.RGBAImage.copy(F,x,{x:0,y:B-1},{x:A,y:M-1},{width:L,height:1}),d.RGBAImage.copy(F,x,{x:0,y:0},{x:A,y:M+B},{width:L,height:1}),d.RGBAImage.copy(F,x,{x:L-1,y:0},{x:A-1,y:M},{width:1,height:B}),d.RGBAImage.copy(F,x,{x:0,y:0},{x:A+L,y:M},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const h of o){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const g=this.images[h];Oe(g)&&this.updateImage(h,g)}}}const ze=new d.Properties({anchor:new d.DataConstantProperty(d.spec.light.anchor),position:new class{constructor(){this.specification=d.spec.light.position}possiblyEvaluate(p,o){return function([h,g,x]){const b=d.degToRad(g+90),T=d.degToRad(x);return{x:h*Math.cos(b)*Math.sin(T),y:h*Math.sin(b)*Math.sin(T),z:h*Math.cos(T),azimuthal:g,polar:x}}(p.expression.evaluate(o))}interpolate(p,o,h){return{x:d.number(p.x,o.x,h),y:d.number(p.y,o.y,h),z:d.number(p.z,o.z,h),azimuthal:d.number(p.azimuthal,o.azimuthal,h),polar:d.number(p.polar,o.polar,h)}}},color:new d.DataConstantProperty(d.spec.light.color),intensity:new d.DataConstantProperty(d.spec.light.intensity)}),ct="-transition";class pt extends d.Evented{constructor(o){super(),this._transitionable=new d.Transitionable(ze),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,h={}){if(!this._validate(d.validateLight,o,h))for(const g in o){const x=o[g];d.endsWith(g,ct)?this._transitionable.setTransition(g.slice(0,-ct.length),x):this._transitionable.setValue(g,x)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,h,g){return(!g||!1!==g.validate)&&d.emitValidationErrors(this,o.call(d.validateStyle,d.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:d.spec})))}}const Dt=new d.Properties({source:new d.DataConstantProperty(d.spec.terrain.source),exaggeration:new d.DataConstantProperty(d.spec.terrain.exaggeration)}),jt="-transition";class Wn extends d.Evented{constructor(o){super(),this._transitionable=new d.Transitionable(Dt),this.set(o),this._transitioning=this._transitionable.untransitioned()}get(){return this._transitionable.serialize()}set(o){for(const h in o){const g=o[h];d.endsWith(h,jt)?this._transitionable.setTransition(h.slice(0,-jt.length),g):this._transitionable.setValue(h,g)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}}function Fn(p,o,h,g){const x=d.smoothstep(45,65,h),[b,T]=kr(p,g),A=d.length(o);let M=1-Math.min(1,Math.exp((A-b)/(T-b)*-6));return M*=M*M,M=Math.min(1,1.00747*M),M*x*p.alpha}function kr(p,o){const h=.5/Math.tan(.5*o);return[p.range[0]+h,p.range[1]+h]}const di=new d.Properties({range:new d.DataConstantProperty(d.spec.fog.range),color:new d.DataConstantProperty(d.spec.fog.color),"horizon-blend":new d.DataConstantProperty(d.spec.fog["horizon-blend"])}),Cr="-transition";class Wi extends d.Evented{constructor(o){super(),this._transitionable=new d.Transitionable(di),this.set(o),this._transitioning=this._transitionable.untransitioned()}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,h={}){if(!this._validate(d.validateFog,o,h))for(const g in o){const x=o[g];d.endsWith(g,Cr)?this._transitionable.setTransition(g.slice(0,-Cr.length),x):this._transitionable.setValue(g,x)}}getOpacity(o){const h=this.properties&&this.properties.get("color")||1;return d.smoothstep(45,65,o)*h.a}getOpacityAtLatLng(o,h){return function(g,x,b){const T=d.MercatorCoordinate.fromLngLat(x),A=b.elevation?b.elevation.getAtPointOrZero(T):0,M=[T.x,T.y,A];return d.transformMat4$1(M,M,b.mercatorFogMatrix),Fn(g,M,b.pitch,b._fov)}(this.state,o,h)}getFovAdjustedRange(o){return kr(this.state,o)}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,h,g){return(!g||!1!==g.validate)&&d.emitValidationErrors(this,o.call(d.validateStyle,d.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:d.spec})))}}class Pr{constructor(o,h){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=d.uniqueId();const g=this.workerPool.acquire(this.id);for(let x=0;x<g.length;x++){const b=new Pr.Actor(g[x],h,this.id);b.name=`Worker ${x}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(o,h,g){d.asyncAll(this.actors,(x,b)=>{x.send(o,h,b)},g=g||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Pt(p,o,h){return o*(d.EXTENT/(p.tileSize*Math.pow(2,h-p.tileID.overscaledZ)))}Pr.Actor=d.Actor;class is{constructor(o,h,g,x){this.screenBounds=o,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=g,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(b=>x.pointCoordinate3D(b)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(o,h){let g,x;if(o instanceof d.pointGeometry||"number"==typeof o[0]){const b=d.pointGeometry.convert(o);g=[d.pointGeometry.convert(o)],x=h.isPointAboveHorizon(b)}else{const b=d.pointGeometry.convert(o[0]),T=d.pointGeometry.convert(o[1]);g=[b,T],x=d.polygonizeBounds(b,T).every(A=>h.isPointAboveHorizon(A))}return new is(g,h.getCameraPoint(),x,h)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(o){return d.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){const h=this.screenBounds[0],g=1===this.screenBounds.length?this.screenBounds[0].add(new d.pointGeometry(1,1)):this.screenBounds[1],x=d.polygonizeBounds(h,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<g.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?x[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(x[3]=this.cameraPoint)),d.bufferConvexPolygon(x,o)}containsTile(o,h,g){const x=o.queryPadding+1,b=g?this._bufferedCameraMercator(x,h).map($=>o.tileID.getTilePoint($)):this._bufferedScreenMercator(x,h).map($=>o.tileID.getTilePoint($)),T=this.screenGeometryMercator.map($=>o.tileID.getTileVec3($)),A=T.map($=>new d.pointGeometry($[0],$[1])),M=h.getFreeCameraOptions().position||new d.MercatorCoordinate(0,0,0),F=o.tileID.getTileVec3(M),L=T.map($=>{const K=d.sub($,$,F);return d.normalize(K,K),new Le(F,K)}),B=Pt(o,1,h.zoom);if(d.polygonIntersectsBox(b,0,0,d.EXTENT,d.EXTENT))return{queryGeometry:this,tilespaceGeometry:A,tilespaceRays:L,bufferedTilespaceGeometry:b,bufferedTilespaceBounds:(U=d.getBounds(b),U.min.x=d.clamp(U.min.x,0,d.EXTENT),U.min.y=d.clamp(U.min.y,0,d.EXTENT),U.max.x=d.clamp(U.max.x,0,d.EXTENT),U.max.y=d.clamp(U.max.y,0,d.EXTENT),U),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:B};var U}_bufferedScreenMercator(o,h){const g=Qn(o);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{const x=this.bufferedScreenGeometry(o).map(b=>h.pointCoordinate3D(b));return this._screenRaycastCache[g]=x,x}}_bufferedCameraMercator(o,h){const g=Qn(o);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{const x=this.bufferedCameraGeometry(o).map(b=>h.pointCoordinate3D(b));return this._cameraRaycastCache[g]=x,x}}}function Qn(p){return 100*p|0}function Ti(p,o,h){const g=function(x,b){if(x)return h(x);if(b){const T=d.pick(d.extend(b,p),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);b.vector_layers&&(T.vectorLayers=b.vector_layers,T.vectorLayerIds=T.vectorLayers.map(A=>A.id)),T.tiles=o.canonicalizeTileset(T,p.url),h(null,T)}};return p.url?d.getJSON(o.transformRequest(o.normalizeSourceURL(p.url),d.ResourceType.Source),g):d.exported.frame(()=>g(null,p))}class zo{constructor(o,h,g){this.bounds=d.LngLatBounds.convert(this.validateBounds(o)),this.minzoom=h||0,this.maxzoom=g||24}validateBounds(o){return Array.isArray(o)&&4===o.length?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const h=Math.pow(2,o.z),g=Math.floor(d.mercatorXfromLng(this.bounds.getWest())*h),x=Math.floor(d.mercatorYfromLat(this.bounds.getNorth())*h),b=Math.ceil(d.mercatorXfromLng(this.bounds.getEast())*h),T=Math.ceil(d.mercatorYfromLat(this.bounds.getSouth())*h);return o.x>=g&&o.x<b&&o.y>=x&&o.y<T}}class _o{constructor(o,h,g){this.context=o;const x=o.gl;this.buffer=x.createBuffer(),this.dynamicDraw=Boolean(g),this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Xi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class os{constructor(o,h,g,x){this.length=h.length,this.attributes=g,this.itemSize=h.bytesPerElement,this.dynamicDraw=x,this.context=o;const b=o.gl;this.buffer=b.createBuffer(),o.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,h){for(let g=0;g<this.attributes.length;g++){const x=h.attributes[this.attributes[g].name];void 0!==x&&o.enableVertexAttribArray(x)}}setVertexAttribPointers(o,h,g){for(let x=0;x<this.attributes.length;x++){const b=this.attributes[x],T=h.attributes[b.name];void 0!==T&&o.vertexAttribPointer(T,b.components,o[Xi[b.type]],!1,this.itemSize,b.offset+this.itemSize*(g||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class cn{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Jn extends cn{getDefault(){return d.Color.transparent}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Di extends cn{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class ro extends cn{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class Vo extends cn{getDefault(){return[!0,!0,!0,!0]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Ki extends cn{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class ss extends cn{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class vn extends cn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const h=this.current;(o.func!==h.func||o.ref!==h.ref||o.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class Bo extends cn{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class Ts extends cn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=o,this.dirty=!1}}class as extends cn{getDefault(){return[0,1]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class ia extends cn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=o,this.dirty=!1}}class Ar extends cn{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Uo extends cn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.BLEND):h.disable(h.BLEND),this.current=o,this.dirty=!1}}class Rl extends cn{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class ls extends cn{getDefault(){return d.Color.transparent}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class jo extends cn{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class $o extends cn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=o,this.dirty=!1}}class Tr extends cn{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class io extends cn{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class Ds extends cn{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class yo extends cn{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class cs extends cn{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class oa extends cn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class Mc extends cn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Ss extends cn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class kl extends cn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Rc extends cn{getDefault(){return null}set(o){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class kc extends cn{constructor(o){super(o),this.vao=o.extVertexArrayObject}getDefault(){return null}set(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)}}class sa extends cn{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class Ha extends cn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class vo extends cn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class As extends cn{constructor(o,h){super(o),this.context=o,this.parent=h}getDefault(){return null}}class Pc extends As{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Pl extends As{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Is extends Pl{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Ms{constructor(o,h,g,x){this.context=o,this.width=h,this.height=g;const b=this.framebuffer=o.gl.createFramebuffer();this.colorAttachment=new Pc(o,b),x&&(this.depthAttachment=new Pl(o,b))}destroy(){const o=this.context.gl,h=this.colorAttachment.get();if(h&&o.deleteTexture(h),this.depthAttachment){const g=this.depthAttachment.get();g&&o.deleteRenderbuffer(g)}o.deleteFramebuffer(this.framebuffer)}}class mn{constructor(o){this.gl=o,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Jn(this),this.clearDepth=new Di(this),this.clearStencil=new ro(this),this.colorMask=new Vo(this),this.depthMask=new Ki(this),this.stencilMask=new ss(this),this.stencilFunc=new vn(this),this.stencilOp=new Bo(this),this.stencilTest=new Ts(this),this.depthRange=new as(this),this.depthTest=new ia(this),this.depthFunc=new Ar(this),this.blend=new Uo(this),this.blendFunc=new Rl(this),this.blendColor=new ls(this),this.blendEquation=new jo(this),this.cullFace=new $o(this),this.cullFaceSide=new Tr(this),this.frontFace=new io(this),this.program=new Ds(this),this.activeTexture=new yo(this),this.viewport=new cs(this),this.bindFramebuffer=new oa(this),this.bindRenderbuffer=new Mc(this),this.bindTexture=new Ss(this),this.bindVertexBuffer=new kl(this),this.bindElementBuffer=new Rc(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new kc(this),this.pixelStoreUnpack=new sa(this),this.pixelStoreUnpackPremultiplyAlpha=new Ha(this),this.pixelStoreUnpackFlipY=new vo(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=o.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(o.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,h){return new _o(this,o,h)}createVertexBuffer(o,h,g){return new os(this,o,h,g)}createRenderbuffer(o,h,g){const x=this.gl,b=x.createRenderbuffer();return this.bindRenderbuffer.set(b),x.renderbufferStorage(x.RENDERBUFFER,o,h,g),this.bindRenderbuffer.set(null),b}createFramebuffer(o,h,g){return new Ms(this,o,h,g)}clear({color:o,depth:h,stencil:g}){const x=this.gl;let b=0;o&&(b|=x.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),void 0!==h&&(b|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),void 0!==g&&(b|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),x.clear(b)}setCullFace(o){!1===o.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){ne(o.blendFunction,d.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class us extends d.Evented{constructor(o,h,g,x){super(),this.id=o,this.dispatcher=g,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.extend({type:"raster"},h),d.extend(this,d.pick(h,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ti(this._options,this.map._requestManager,(o,h)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new d.ErrorEvent(o)):h&&(d.extend(this,h),h.bounds&&(this.tileBounds=new zo(h.bounds,this.minzoom,this.maxzoom)),d.postTurnstileEvent(h.tiles),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return d.extend({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,h){const g=d.exported.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);o.request=d.getImage(this.map._requestManager.transformRequest(x,d.ResourceType.Tile),(b,T,A,M)=>{if(delete o.request,o.aborted)o.state="unloaded",h(null);else if(b)o.state="errored",h(b);else if(T){this.map._refreshExpiredTiles&&o.setExpiryData({cacheControl:A,expires:M});const F=this.map.painter.context,L=F.gl;o.texture=this.map.painter.getTileTexture(T.width),o.texture?o.texture.update(T,{useMipmap:!0}):(o.texture=new d.Texture(F,T,L.RGBA,{useMipmap:!0}),o.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),F.extTextureFilterAnisotropic&&L.texParameterf(L.TEXTURE_2D,F.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,F.extTextureFilterAnisotropicMax)),o.state="loaded",d.cacheEntryPossiblyAdded(this.dispatcher),h(null)}})}abortTile(o,h){o.request&&(o.request.cancel(),delete o.request),h()}unloadTile(o,h){o.texture&&this.map.painter.saveTileTexture(o.texture),h()}hasTransition(){return!1}}let Wt;var oo=d.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class X extends d.Evented{constructor(o,h,g,x){super(),this.id=o,this.dispatcher=g,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=h}load(o,h){this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this.url=this.options.url,d.getImage(this.map._requestManager.transformRequest(this.url,d.ResourceType.Image),(g,x)=>{this._loaded=!0,g?this.fire(new d.ErrorEvent(g)):x&&(this.image=d.exported.getImageData(x),o&&(this.coordinates=o),h&&h(),this._finishLoading())})}loaded(){return this._loaded}updateImage(o){return this.image&&o.url?(this.options.url=o.url,this.load(o.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}setCoordinates(o){this.coordinates=o;const h=o.map(d.MercatorCoordinate.fromLngLat);this.tileID=function(x){let b=1/0,T=1/0,A=-1/0,M=-1/0;for(const U of x)b=Math.min(b,U.x),T=Math.min(T,U.y),A=Math.max(A,U.x),M=Math.max(M,U.y);const F=Math.max(A-b,M-T),L=Math.max(0,Math.floor(-Math.log(F)/Math.LN2)),B=Math.pow(2,L);return new d.CanonicalTileID(L,Math.floor((b+A)/2*B),Math.floor((T+M)/2*B))}(h),this.minzoom=this.maxzoom=this.tileID.z;const g=h.map(x=>this.tileID.getTilePoint(x)._round());return this._boundsArray=new d.StructArrayLayout4i8,this._boundsArray.emplaceBack(g[0].x,g[0].y,0,0),this._boundsArray.emplaceBack(g[1].x,g[1].y,d.EXTENT,0),this._boundsArray.emplaceBack(g[3].x,g[3].y,0,d.EXTENT),this._boundsArray.emplaceBack(g[2].x,g[2].y,d.EXTENT,d.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const o=this.map.painter.context,h=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,oo.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new d.Texture(o,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));for(const g in this.tiles){const x=this.tiles[g];"loaded"!==x.state&&(x.state="loaded",x.texture=this.texture)}}loadTile(o,h){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},h(null)):(o.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const O={vector:class extends d.Evented{constructor(p,o,h,g){if(super(),this.id=p,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.extend(this,d.pick(o,["url","scheme","tileSize","promoteId"])),this._options=d.extend({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new d.DedupedRequest}load(){this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ti(this._options,this.map._requestManager,(p,o)=>{this._tileJSONRequest=null,this._loaded=!0,p?this.fire(new d.ErrorEvent(p)):o&&(d.extend(this,o),o.bounds&&(this.tileBounds=new zo(o.bounds,this.minzoom,this.maxzoom)),d.postTurnstileEvent(o.tiles,this.map._requestManager._customAccessToken),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}onAdd(p){this.map=p,this.load()}setSourceProperty(p){this._tileJSONRequest&&this._tileJSONRequest.cancel(),p();const o=this.map.style._getSourceCaches(this.id);for(const h of o)h.clearTiles();this.load()}setTiles(p){return this.setSourceProperty(()=>{this._options.tiles=p}),this}setUrl(p){return this.setSourceProperty(()=>{this.url=p,this._options.url=p}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return d.extend({},this._options)}loadTile(p,o){const h=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(h,d.ResourceType.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:d.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:p.isSymbolTile};if(g.request.collectResourceTiming=this._collectResourceTiming,p.actor&&"expired"!==p.state)"loading"===p.state?p.reloadCallback=o:p.request=p.actor.send("reloadTile",g,x.bind(this));else if(p.actor=this._tileWorkers[h]=this._tileWorkers[h]||this.dispatcher.getActor(),this.dispatcher.ready)p.request=p.actor.send("loadTile",g,x.bind(this),void 0,!0);else{const b=d.loadVectorTile.call({deduped:this._deduped},g,(T,A)=>{T||!A?x.call(this,T):(g.data={cacheControl:A.cacheControl,expires:A.expires,rawData:A.rawData.slice(0)},p.actor&&p.actor.send("loadTile",g,x.bind(this),void 0,!0))},!0);p.request={cancel:b}}function x(b,T){return delete p.request,p.aborted?o(null):b&&404!==b.status?o(b):(T&&T.resourceTiming&&(p.resourceTiming=T.resourceTiming),this.map._refreshExpiredTiles&&T&&p.setExpiryData(T),p.loadVectorData(T,this.map.painter),d.cacheEntryPossiblyAdded(this.dispatcher),o(null),void(p.reloadCallback&&(this.loadTile(p,p.reloadCallback),p.reloadCallback=null)))}}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.actor&&p.actor.send("abortTile",{uid:p.uid,type:this.type,source:this.id})}unloadTile(p){p.unloadVectorData(),p.actor&&p.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:us,"raster-dem":class extends us{constructor(p,o,h,g){super(p,o,h,g),this.type="raster-dem",this.maxzoom=22,this._options=d.extend({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(p,o){const h=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(x,b){x&&(p.state="errored",o(x)),b&&(p.dem=b,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",o(null))}p.request=d.getImage(this.map._requestManager.transformRequest(h,d.ResourceType.Tile),function(x,b,T,A){if(delete p.request,p.aborted)p.state="unloaded",o(null);else if(x)p.state="errored",o(x);else if(b){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:T,expires:A});const M=d.window.ImageBitmap&&b instanceof d.window.ImageBitmap&&(null==Wt&&(Wt=d.window.OffscreenCanvas&&new d.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof d.window.createImageBitmap),Wt),F=1-(b.width-d.prevPowerOfTwo(b.width))/2;F<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const L=M?b:d.exported.getImageData(b,F),B={uid:p.uid,coord:p.tileID,source:this.id,rawImageData:L,encoding:this.encoding,padding:F};p.actor&&"expired"!==p.state||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",B,g.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(p){const o=p.canonical,h=Math.pow(2,o.z),g=(o.x-1+h)%h,x=0===o.x?p.wrap-1:p.wrap,b=(o.x+1+h)%h,T=o.x+1===h?p.wrap+1:p.wrap,A={};return A[new d.OverscaledTileID(p.overscaledZ,x,o.z,g,o.y).key]={backfilled:!1},A[new d.OverscaledTileID(p.overscaledZ,T,o.z,b,o.y).key]={backfilled:!1},o.y>0&&(A[new d.OverscaledTileID(p.overscaledZ,x,o.z,g,o.y-1).key]={backfilled:!1},A[new d.OverscaledTileID(p.overscaledZ,p.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},A[new d.OverscaledTileID(p.overscaledZ,T,o.z,b,o.y-1).key]={backfilled:!1}),o.y+1<h&&(A[new d.OverscaledTileID(p.overscaledZ,x,o.z,g,o.y+1).key]={backfilled:!1},A[new d.OverscaledTileID(p.overscaledZ,p.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},A[new d.OverscaledTileID(p.overscaledZ,T,o.z,b,o.y+1).key]={backfilled:!1}),A}unloadTile(p){p.demTexture&&this.map.painter.saveTileTexture(p.demTexture),p.fbo&&(p.fbo.destroy(),delete p.fbo),p.dem&&delete p.dem,delete p.neighboringTiles,p.state="unloaded"}},geojson:class extends d.Evented{constructor(p,o,h,g){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(g),this._data=o.data,this._options=d.extend({},o),this._collectResourceTiming=o.collectResourceTiming,void 0!==o.maxzoom&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const x=d.EXTENT/this.tileSize;this.workerOptions=d.extend({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(void 0!==o.buffer?o.buffer:128)*x,tolerance:(void 0!==o.tolerance?o.tolerance:.375)*x,extent:d.EXTENT,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:void 0!==o.clusterMaxZoom?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:d.EXTENT,radius:(void 0!==o.clusterRadius?o.clusterRadius:50)*x,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}getClusterExpansionZoom(p,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id},o),this}getClusterChildren(p,o){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id},o),this}getClusterLeaves(p,o,h,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:p,limit:o,offset:h},g),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new d.Event("dataloading",{dataType:"source"})),this._loaded=!1;const p=d.extend({},this.workerOptions),o=this._data;"string"==typeof o?(p.request=this.map._requestManager.transformRequest(d.exported.resolveURL(o),d.ResourceType.Source),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,p,(h,g)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new d.ErrorEvent(h));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(x.resourceTiming=g.resourceTiming[this.id]),this.fire(new d.Event("data",x)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(p,o){const h=p.actor?"reloadTile":"loadTile";p.actor=this.actor,p.request=this.actor.send(h,{type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:d.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(g,x)=>(delete p.request,p.unloadVectorData(),p.aborted?o(null):g?o(g):(p.loadVectorData(x,this.map.painter,"reloadTile"===h),o(null))),void 0,"loadTile"===h)}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p){p.unloadVectorData(),this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return d.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends X{constructor(p,o,h,g){super(p,o,h,g),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const o of p.urls)this.urls.push(this.map._requestManager.transformRequest(o,d.ResourceType.Source).url);d.getVideo(this.urls,(o,h)=>{this._loaded=!0,o?this.fire(new d.ErrorEvent(o)):h&&(this.video=h,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const o=this.video.seekable;p<o.start(0)||p>o.end(0)?this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const p=this.map.painter.context,o=p.gl;this.boundsBuffer||(this.boundsBuffer=p.createVertexBuffer(this._boundsArray,oo.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new d.Texture(p,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));for(const h in this.tiles){const g=this.tiles[h];"loaded"!==g.state&&(g.state="loaded",g.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:X,canvas:class extends X{constructor(p,o,h,g){super(p,o,h,g),o.coordinates?Array.isArray(o.coordinates)&&4===o.coordinates.length&&!o.coordinates.some(x=>!Array.isArray(x)||2!==x.length||x.some(b=>"number"!=typeof b))||this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${p}`,null,'missing required property "coordinates"'))),o.animate&&"boolean"!=typeof o.animate&&this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),o.canvas?"string"==typeof o.canvas||o.canvas instanceof d.window.HTMLCanvasElement||this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${p}`,null,'missing required property "canvas"'))),this.options=o,this.animate=void 0===o.animate||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof d.window.HTMLCanvasElement?this.options.canvas:d.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const o=this.map.painter.context,h=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,oo.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(p||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new d.Texture(o,this.canvas,h.RGBA,{premultiply:!0});for(const g in this.tiles){const x=this.tiles[g];"loaded"!==x.state&&(x.state="loaded",x.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}}},z=function(p,o,h,g){const x=new O[o.type](p,o,h,g);if(x.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${x.id}`);return d.bindAll(["load","abort","unload","serialize","prepare"],x),x};function W(p,o){const h=d.identity([]);return d.scale$1(h,h,[.5*p.width,.5*-p.height,1]),d.translate(h,h,[1,-1,0]),d.multiply(h,h,p.calculateProjMatrix(o.toUnwrapped()))}function ee(p,o,h,g,x,b,T,A=!1){const M=p.tilesIn(g,T,A);M.sort(De);const F=[];for(const B of M)F.push({wrappedTileID:B.tile.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(o,h,p._state,B,x,b,W(p.transform,B.tile.tileID),A)});const L=function(B){const U={},$={};for(const K of B){const Y=K.queryResults,le=K.wrappedTileID,Z=$[le]=$[le]||{};for(const Q in Y){const ae=Y[Q],he=Z[Q]=Z[Q]||{},ge=U[Q]=U[Q]||[];for(const J of ae)he[J.featureIndex]||(he[J.featureIndex]=!0,ge.push(J))}}return U}(F);for(const B in L)L[B].forEach(U=>{const $=U.feature,K=p.getFeatureState($.layer["source-layer"],$.id);$.source=$.layer.source,$.layer["source-layer"]&&($.sourceLayer=$.layer["source-layer"]),$.state=K});return L}function ce(p,o){const h=p.getRenderableIds().map(b=>p.getTileByID(b)),g=[],x={};for(let b=0;b<h.length;b++){const T=h[b],A=T.tileID.canonical.key;x[A]||(x[A]=!0,T.querySourceFeatures(g,o))}return g}function De(p,o){const h=p.tileID,g=o.tileID;return h.overscaledZ-g.overscaledZ||h.canonical.y-g.canonical.y||h.wrap-g.wrap||h.canonical.x-g.canonical.x}function Ee(){return null!=xa.workerClass?new xa.workerClass:new d.window.Worker(xa.workerUrl)}const oe="mapboxgl_preloaded_worker_pool";class xe{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<xe.workerCount;)this.workers.push(new Ee);return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],0===this.numActive()&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[oe]}numActive(){return Object.keys(this.active).length}}let Ge;function ht(){return Ge||(Ge=new xe),Ge}function Ke(p,o){const h={};for(const g in p)"ref"!==g&&(h[g]=p[g]);return d.refProperties.forEach(g=>{g in o&&(h[g]=o[g])}),h}function It(p){p=p.slice();const o=Object.create(null);for(let h=0;h<p.length;h++)o[p[h].id]=p[h];for(let h=0;h<p.length;h++)"ref"in p[h]&&(p[h]=Ke(p[h],o[p[h].ref]));return p}xe.workerCount=2;const ue={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog"};function Ve(p,o,h){h.push({command:ue.addSource,args:[p,o[p]]})}function Bt(p,o,h){o.push({command:ue.removeSource,args:[p]}),h[p]=!0}function tn(p,o,h,g){Bt(p,h,g),Ve(p,o,h)}function Ft(p,o,h){let g;for(g in p[h])if(p[h].hasOwnProperty(g)&&"data"!==g&&!ne(p[h][g],o[h][g]))return!1;for(g in o[h])if(o[h].hasOwnProperty(g)&&"data"!==g&&!ne(p[h][g],o[h][g]))return!1;return!0}function Tn(p,o,h,g,x,b){let T;for(T in o=o||{},p=p||{})p.hasOwnProperty(T)&&(ne(p[T],o[T])||h.push({command:b,args:[g,T,o[T],x]}));for(T in o)o.hasOwnProperty(T)&&!p.hasOwnProperty(T)&&(ne(p[T],o[T])||h.push({command:b,args:[g,T,o[T],x]}))}function gn(p){return p.id}function Xn(p,o){return p[o.id]=o,p}class Rs{constructor(o,h){this.reset(o,h)}reset(o,h){this.points=o||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(1===this.points.length)return this.points[0];o=d.clamp(o,0,1);let h=1,g=this._distances[h];const x=o*this.paddedLength+this.padding;for(;g<x&&h<this._distances.length;)g=this._distances[++h];const b=h-1,T=this._distances[b],A=g-T,M=A>0?(x-T)/A:0;return this.points[b].mult(1-M).add(this.points[h].mult(M))}}class ft{constructor(o,h,g){const x=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(o/g),this.yCellCount=Math.ceil(h/g);for(let T=0;T<this.xCellCount*this.yCellCount;T++)x.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=h,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,h,g,x,b){this._forEachCell(h,g,x,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(x),this.bboxes.push(b)}insertCircle(o,h,g,x){this._forEachCell(h-x,g-x,h+x,g+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(h),this.circles.push(g),this.circles.push(x)}_insertBoxCell(o,h,g,x,b,T){this.boxCells[b].push(T)}_insertCircleCell(o,h,g,x,b,T){this.circleCells[b].push(T)}_query(o,h,g,x,b,T){if(g<0||o>this.width||x<0||h>this.height)return!b&&[];const A=[];if(o<=0&&h<=0&&this.width<=g&&this.height<=x){if(b)return!0;for(let M=0;M<this.boxKeys.length;M++)A.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const F=this.circles[3*M],L=this.circles[3*M+1],B=this.circles[3*M+2];A.push({key:this.circleKeys[M],x1:F-B,y1:L-B,x2:F+B,y2:L+B})}return T?A.filter(T):A}return this._forEachCell(o,h,g,x,this._queryCell,A,{hitTest:b,seenUids:{box:{},circle:{}}},T),b?A.length>0:A}_queryCircle(o,h,g,x,b){const T=o-g,A=o+g,M=h-g,F=h+g;if(A<0||T>this.width||F<0||M>this.height)return!x&&[];const L=[];return this._forEachCell(T,M,A,F,this._queryCellCircle,L,{hitTest:x,circle:{x:o,y:h,radius:g},seenUids:{box:{},circle:{}}},b),x?L.length>0:L}query(o,h,g,x,b){return this._query(o,h,g,x,!1,b)}hitTest(o,h,g,x,b){return this._query(o,h,g,x,!0,b)}hitTestCircle(o,h,g,x){return this._queryCircle(o,h,g,!0,x)}_queryCell(o,h,g,x,b,T,A,M){const F=A.seenUids,L=this.boxCells[b];if(null!==L){const U=this.bboxes;for(const $ of L)if(!F.box[$]){F.box[$]=!0;const K=4*$;if(o<=U[K+2]&&h<=U[K+3]&&g>=U[K+0]&&x>=U[K+1]&&(!M||M(this.boxKeys[$]))){if(A.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[$],x1:U[K],y1:U[K+1],x2:U[K+2],y2:U[K+3]})}}}const B=this.circleCells[b];if(null!==B){const U=this.circles;for(const $ of B)if(!F.circle[$]){F.circle[$]=!0;const K=3*$;if(this._circleAndRectCollide(U[K],U[K+1],U[K+2],o,h,g,x)&&(!M||M(this.circleKeys[$]))){if(A.hitTest)return T.push(!0),!0;{const Y=U[K],le=U[K+1],Z=U[K+2];T.push({key:this.circleKeys[$],x1:Y-Z,y1:le-Z,x2:Y+Z,y2:le+Z})}}}}}_queryCellCircle(o,h,g,x,b,T,A,M){const F=A.circle,L=A.seenUids,B=this.boxCells[b];if(null!==B){const $=this.bboxes;for(const K of B)if(!L.box[K]){L.box[K]=!0;const Y=4*K;if(this._circleAndRectCollide(F.x,F.y,F.radius,$[Y+0],$[Y+1],$[Y+2],$[Y+3])&&(!M||M(this.boxKeys[K])))return T.push(!0),!0}}const U=this.circleCells[b];if(null!==U){const $=this.circles;for(const K of U)if(!L.circle[K]){L.circle[K]=!0;const Y=3*K;if(this._circlesCollide($[Y],$[Y+1],$[Y+2],F.x,F.y,F.radius)&&(!M||M(this.circleKeys[K])))return T.push(!0),!0}}}_forEachCell(o,h,g,x,b,T,A,M){const F=this._convertToXCellCoord(o),L=this._convertToYCellCoord(h),B=this._convertToXCellCoord(g),U=this._convertToYCellCoord(x);for(let $=F;$<=B;$++)for(let K=L;K<=U;K++)if(b.call(this,o,h,g,x,this.xCellCount*K+$,T,A,M))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,h,g,x,b,T){const A=x-o,M=b-h,F=g+T;return F*F>A*A+M*M}_circleAndRectCollide(o,h,g,x,b,T,A){const M=(T-x)/2,F=Math.abs(o-(x+M));if(F>M+g)return!1;const L=(A-b)/2,B=Math.abs(h-(b+L));if(B>L+g)return!1;if(F<=M||B<=L)return!0;const U=F-M,$=B-L;return U*U+$*$<=g*g}}const rn=Math.tan(85*Math.PI/180);function Qt(p,o,h,g,x){const b=d.create$1();return o?(d.scale$1(b,b,[1/x,1/x,1]),h||d.rotateZ(b,b,g.angle)):d.multiply(b,g.labelPlaneMatrix,p),b}function Ho(p,o,h,g,x){if(o){const b=d.clone$1(p);return d.scale$1(b,b,[x,x,1]),h||d.rotateZ(b,b,-g.angle),b}return g.glCoordMatrix}function $n(p,o,h=0){const g=[p.x,p.y,h,1];h?d.transformMat4(g,g,o):Oc(g,g,o);const x=g[3];return{point:new d.pointGeometry(g[0]/x,g[1]/x),signedDistanceFromCamera:x}}function At(p,o){return Math.min(.5+p/o*.5,1.5)}function Bu(p,o){const h=p[0]/p[3],g=p[1]/p[3];return h>=-o[0]&&h<=o[0]&&g>=-o[1]&&g<=o[1]}function Fc(p,o,h,g,x,b,T,A,M){const F=g?p.textSizeData:p.iconSizeData,L=d.evaluateSizeForZoom(F,h.transform.zoom),B=[256/h.width*2+1,256/h.height*2+1],U=g?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;U.clear();const $=p.lineVertexArray,K=g?p.text.placedSymbolArray:p.icon.placedSymbolArray,Y=h.transform.width/h.transform.height;let le=!1;for(let Z=0;Z<K.length;Z++){const Q=K.get(Z);if(Q.writingMode!==d.WritingMode.vertical||le||0!==Z&&K.get(Z-1).writingMode===d.WritingMode.horizontal||(le=!0),Q.hidden||Q.writingMode===d.WritingMode.vertical&&!le){hs(Q.numGlyphs,U);continue}le=!1;const ae=new d.pointGeometry(Q.tileAnchorX,Q.tileAnchorY),he=M?M(ae):0,ge=[ae.x,ae.y,he],J=[...ge,1];if(d.transformMat4(J,J,o),!Bu(J,B)){hs(Q.numGlyphs,U);continue}const we=At(h.transform.cameraToCenterDistance,J[3]),$e=d.evaluateSizeForFeature(F,L,Q),Xe=T?$e/we:$e*we,ve=$n(new d.pointGeometry(ge[0],ge[1]),x,ge[2]);if(ve.signedDistanceFromCamera<=0){hs(Q.numGlyphs,U);continue}let Ne={};const mt=T?null:M,vt=ur(Q,Xe,!1,A,o,x,b,p.glyphOffsetArray,$,U,ve.point,ae,Ne,Y,mt);le=vt.useVertical,mt&&vt.needsFlipping&&(Ne={}),(vt.notEnoughRoom||le||vt.needsFlipping&&ur(Q,Xe,!0,A,o,x,b,p.glyphOffsetArray,$,U,ve.point,ae,Ne,Y,mt).notEnoughRoom)&&hs(Q.numGlyphs,U)}g?p.text.dynamicLayoutVertexBuffer.updateData(U):p.icon.dynamicLayoutVertexBuffer.updateData(U)}function Fl(p,o,h,g,x,b,T,A,M,F,L,B,U){const $=A.glyphStartIndex+A.numGlyphs,K=A.lineStartIndex,Y=A.lineStartIndex+A.lineLength,le=o.getoffsetX(A.glyphStartIndex),Z=o.getoffsetX($-1),Q=aa(p*le,h,g,x,b,T,A.segment,K,Y,M,F,L,B,U,!0);if(!Q)return null;const ae=aa(p*Z,h,g,x,b,T,A.segment,K,Y,M,F,L,B,U,!0);return ae?{first:Q,last:ae}:null}function kt(p,o,h,g){return p.writingMode===d.WritingMode.horizontal&&Math.abs(h.y-o.y)>Math.abs(h.x-o.x)*g?{useVertical:!0}:p.writingMode===d.WritingMode.vertical?o.y<h.y?{needsFlipping:!0}:null:0!==p.flipState&&function(x,b,T){const A=(b.x-x.x)*T;return 0===A||Math.abs((b.y-x.y)/A)>rn}(o,h,g)?1===p.flipState?{needsFlipping:!0}:null:o.x>h.x?{needsFlipping:!0}:null}function ur(p,o,h,g,x,b,T,A,M,F,L,B,U,$,K){const Y=o/24,le=p.lineOffsetX*Y,Z=p.lineOffsetY*Y;let Q;if(p.numGlyphs>1){const ae=p.glyphStartIndex+p.numGlyphs,he=p.lineStartIndex,ge=p.lineStartIndex+p.lineLength,J=Fl(Y,A,le,Z,h,L,B,p,M,b,U,K,!1);if(!J)return{notEnoughRoom:!0};const we=$n(J.first.point,T).point,$e=$n(J.last.point,T).point;if(g&&!h){const Xe=kt(p,we,$e,$);if(p.flipState=Xe&&Xe.needsFlipping?1:2,Xe)return Xe}Q=[J.first];for(let Xe=p.glyphStartIndex+1;Xe<ae-1;Xe++)Q.push(aa(Y*A.getoffsetX(Xe),le,Z,h,L,B,p.segment,he,ge,M,b,U,K,!1,!1));Q.push(J.last)}else{if(g&&!h){const he=$n(B,x).point,ge=p.lineStartIndex+p.segment+1,J=new d.pointGeometry(M.getx(ge),M.gety(ge)),we=$n(J,x),$e=kt(p,he,we.signedDistanceFromCamera>0?we.point:Oi(B,J,he,1,x,void 0),$);if(p.flipState=$e&&$e.needsFlipping?1:2,$e)return $e}const ae=aa(Y*A.getoffsetX(p.glyphStartIndex),le,Z,h,L,B,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,M,b,U,K,!1,!1);if(!ae)return{notEnoughRoom:!0};Q=[ae]}for(const ae of Q)d.addDynamicAttributes(F,ae.point,ae.angle);return{}}function Qr(p,o,h){const g={x:p.x,y:p.y,z:0};if(!h)return $n(g,o,g.z);const x=h(p);return $n(new d.pointGeometry(g.x,g.y),o,g.z+x)}function Oi(p,o,h,g,x,b){const T=Qr(p.add(p.sub(o)._unit()),x,b).point,A=h.sub(T);return h.add(A._mult(g/A.mag()))}function aa(p,o,h,g,x,b,T,A,M,F,L,B,U,$,K){const Y=g?p-o:p+o;let le=Y>0?1:-1,Z=0;g&&(le*=-1,Z=Math.PI),le<0&&(Z+=Math.PI);let Q=le>0?A+T:A+T+1,ae=x,he=x,ge=0,J=0;const we=Math.abs(Y),$e=[],Xe=[];let ve=b;const Ne=()=>{const Xt=Q-le;return 0===ge?b:new d.pointGeometry(F.getx(Xt),F.gety(Xt))},mt=()=>Oi(Ne(),ve,he,we-ge+1,L,U);for(;ge+J<=we;){if(Q+=le,Q<A||Q>=M)return null;if(he=ae,$e.push(ae),$&&Xe.push(ve||Ne()),ae=B[Q],void 0===ae){ve=new d.pointGeometry(F.getx(Q),F.gety(Q));const Xt=Qr(ve,L,U);ae=Xt.signedDistanceFromCamera>0?B[Q]=Xt.point:mt()}else ve=null;ge+=J,J=he.dist(ae)}K&&U&&(ve=ve||new d.pointGeometry(F.getx(Q),F.gety(Q)),B[Q]=ae=void 0===B[Q]?ae:mt(),J=he.dist(ae));const vt=(we-ge)/J,gt=ae.sub(he),nt=gt.mult(vt)._add(he);h&&nt._add(gt._unit()._perp()._mult(h*le));const bt=Z+Math.atan2(ae.y-he.y,ae.x-he.x);return $e.push(nt),$&&(ve=ve||new d.pointGeometry(F.getx(Q),F.gety(Q)),Xe.push(function(Xt,zt,gr){const Yn=1-gr;return new d.pointGeometry(Xt.x*Yn+zt.x*gr,Xt.y*Yn+zt.y*gr)}(Xe.length>0?Xe[Xe.length-1]:ve,ve,vt))),{point:nt,angle:bt,path:$e,tilePath:Xe}}const Ol=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function hs(p,o){for(let h=0;h<p;h++){const g=o.length;o.resize(g+4),o.float32.set(Ol,3*g)}}function Oc(p,o,h){const g=o[0],x=o[1];return p[0]=h[0]*g+h[4]*x+h[12],p[1]=h[1]*g+h[5]*x+h[13],p[3]=h[3]*g+h[7]*x+h[15],p}const Gt=100;class Ll{constructor(o,h,g=new ft(o.width+200,o.height+200,25),x=new ft(o.width+200,o.height+200,25)){this.transform=o,this.grid=g,this.ignoredGrid=x,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+Gt,this.screenBottomBoundary=o.height+Gt,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=h}placeCollisionBox(o,h,g,x,b,T,A){let M=h.projectedAnchorZ;h.elevation&&(M+=h.elevation);const F=this.projectAndGetPerspectiveRatio(T,h.projectedAnchorX,h.projectedAnchorY,M,h.tileID),L=b*F.perspectiveRatio,B=(h.x1*o+g.x-h.padding)*L+F.point.x,U=(h.y1*o+g.y-h.padding)*L+F.point.y,$=(h.x2*o+g.x+h.padding)*L+F.point.x,K=(h.y2*o+g.y+h.padding)*L+F.point.y,Y=F.perspectiveRatio<=.55||F.aboveHorizon;return!this.isInsideGrid(B,U,$,K)||!x&&this.grid.hitTest(B,U,$,K,A)||Y?{box:[],offscreen:!1}:{box:[B,U,$,K],offscreen:this.isOffscreen(B,U,$,K)}}placeCollisionCircles(o,h,g,x,b,T,A,M,F,L,B,U,$,K){const Y=[],le=this.transform.elevation,Z=le?mt=>le.getAtTileOffset(K,mt.x,mt.y):mt=>0,Q=new d.pointGeometry(h.tileAnchorX,h.tileAnchorY),ae=Z(Q),he=this.projectAndGetPerspectiveRatio(T,Q.x,Q.y,ae,K),{perspectiveRatio:ge}=he,J=(L?b/ge:b*ge)/d.ONE_EM,we=$n(Q,A,ae).point,$e=he.signedDistanceFromCamera>0?Fl(J,x,h.lineOffsetX*J,h.lineOffsetY*J,!1,we,Q,h,g,A,{},le&&!L?Z:null,L&&!!le):null;let Xe=!1,ve=!1,Ne=!0;if($e&&!he.aboveHorizon){const mt=.5*U*ge+$,vt=new d.pointGeometry(-100,-100),gt=new d.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),nt=new Rs,bt=$e.first,Xt=$e.last;let zt=[];for(let Zt=bt.path.length-1;Zt>=1;Zt--)zt.push(bt.path[Zt]);for(let Zt=1;Zt<Xt.path.length;Zt++)zt.push(Xt.path[Zt]);const gr=2.5*mt;if(M){const Zt=zt.map(le?(nn,tr)=>{const ao=Z(tr<bt.path.length-1?bt.tilePath[bt.path.length-1-tr]:Xt.tilePath[tr-bt.path.length+2]);return $n(nn,M,ao)}:nn=>$n(nn,M));zt=Zt.some(nn=>nn.signedDistanceFromCamera<=0)?[]:Zt.map(nn=>nn.point)}let Yn=[];if(zt.length>0){const Zt=zt[0].clone(),nn=zt[0].clone();for(let tr=1;tr<zt.length;tr++)Zt.x=Math.min(Zt.x,zt[tr].x),Zt.y=Math.min(Zt.y,zt[tr].y),nn.x=Math.max(nn.x,zt[tr].x),nn.y=Math.max(nn.y,zt[tr].y);Yn=Zt.x>=vt.x&&nn.x<=gt.x&&Zt.y>=vt.y&&nn.y<=gt.y?[zt]:nn.x<vt.x||Zt.x>gt.x||nn.y<vt.y||Zt.y>gt.y?[]:d.clipLine([zt],vt.x,vt.y,gt.x,gt.y)}for(const Zt of Yn){nt.reset(Zt,.25*mt);let nn=0;nn=nt.length<=.5*mt?1:Math.ceil(nt.paddedLength/gr)+1;for(let tr=0;tr<nn;tr++){const ao=tr/Math.max(nn-1,1),Qo=nt.lerp(ao),zr=Qo.x+Gt,Zr=Qo.y+Gt;Y.push(zr,Zr,mt,0);const Jo=zr-mt,es=Zr-mt,Vn=zr+mt,qn=Zr+mt;if(Ne=Ne&&this.isOffscreen(Jo,es,Vn,qn),ve=ve||this.isInsideGrid(Jo,es,Vn,qn),!o&&this.grid.hitTestCircle(zr,Zr,mt,B)&&(Xe=!0,!F))return{circles:[],offscreen:!1,collisionDetected:Xe}}}}return{circles:!F&&Xe||!ve?[]:Y,offscreen:Ne,collisionDetected:Xe}}queryRenderedSymbols(o){if(0===o.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const h=[];let g=1/0,x=1/0,b=-1/0,T=-1/0;for(const L of o){const B=new d.pointGeometry(L.x+Gt,L.y+Gt);g=Math.min(g,B.x),x=Math.min(x,B.y),b=Math.max(b,B.x),T=Math.max(T,B.y),h.push(B)}const A=this.grid.query(g,x,b,T).concat(this.ignoredGrid.query(g,x,b,T)),M={},F={};for(const L of A){const B=L.key;if(void 0===M[B.bucketInstanceId]&&(M[B.bucketInstanceId]={}),M[B.bucketInstanceId][B.featureIndex])continue;const U=[new d.pointGeometry(L.x1,L.y1),new d.pointGeometry(L.x2,L.y1),new d.pointGeometry(L.x2,L.y2),new d.pointGeometry(L.x1,L.y2)];d.polygonIntersectsPolygon(h,U)&&(M[B.bucketInstanceId][B.featureIndex]=!0,void 0===F[B.bucketInstanceId]&&(F[B.bucketInstanceId]=[]),F[B.bucketInstanceId].push(B.featureIndex))}return F}insertCollisionBox(o,h,g,x,b){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:x,collisionGroupID:b},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,h,g,x,b){const T=h?this.ignoredGrid:this.grid,A={bucketInstanceId:g,featureIndex:x,collisionGroupID:b};for(let M=0;M<o.length;M+=4)T.insertCircle(A,o[M],o[M+1],o[M+2])}projectAndGetPerspectiveRatio(o,h,g,x,b){const T=[h,g,x||0,1];let A=!1;if(x||this.transform.pitch>0){d.transformMat4(T,T,o);let M=!1;this.fogState&&b&&(M=function(F,L,B,U,$,K){const Y=K.calculateFogTileMatrix($),le=[L,B,U];return d.transformMat4$1(le,le,Y),Fn(F,le,K.pitch,K._fov)}(this.fogState,h,g,x||0,b.toUnwrapped(),this.transform)>.9),A=T[2]>T[3]||M}else Oc(T,T,o);return{point:new d.pointGeometry((T[0]/T[3]+1)/2*this.transform.width+Gt,(-T[1]/T[3]+1)/2*this.transform.height+Gt),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/T[3]*.5,1.5),signedDistanceFromCamera:T[3],aboveHorizon:A}}isOffscreen(o,h,g,x){return g<Gt||o>=this.screenRightBoundary||x<Gt||h>this.screenBottomBoundary}isInsideGrid(o,h,g,x){return g>=0&&o<this.gridRightBoundary&&x>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const o=d.identity([]);return d.translate(o,o,[-100,-100,0]),o}}class Nl{constructor(o,h,g,x){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?h:-h))):x&&g?1:0,this.placed=g}isHidden(){return 0===this.opacity&&!this.placed}}class Hr{constructor(o,h,g,x,b){this.text=new Nl(o?o.text:null,h,g,b),this.icon=new Nl(o?o.icon:null,h,x,b)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Mt{constructor(o,h,g){this.text=o,this.icon=h,this.skipFade=g}}class Lc{constructor(){this.invProjMatrix=d.create$1(),this.viewportMatrix=d.create$1(),this.circles=[]}}class Nc{constructor(o,h,g,x,b){this.bucketInstanceId=o,this.featureIndex=h,this.sourceLayerIndex=g,this.bucketIndex=x,this.tileID=b}}class Kn{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const h=++this.maxGroupID;this.collisionGroups[o]={ID:h,predicate:g=>g.collisionGroupID===h}}return this.collisionGroups[o]}}function la(p,o,h,g,x){const{horizontalAlign:b,verticalAlign:T}=d.getAnchorAlignment(p),A=-(b-.5)*o,M=-(T-.5)*h,F=d.evaluateVariableOffset(p,g);return new d.pointGeometry(A+F[0]*x,M+F[1]*x)}function ks(p,o,h,g,x){const b=new d.pointGeometry(p,o);return h&&b._rotate(g?x:-x),b}class hr{constructor(o,h,g,x,b){this.transform=o.clone(),this.collisionIndex=new Ll(this.transform,b),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new Kn(g),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,h,g,x){const b=g.getBucket(h),T=g.latestFeatureIndex;if(!b||!T||h.id!==b.layerIds[0])return;const A=g.collisionBoxArray,M=b.layers[0].layout,F=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),L=g.tileSize/d.EXTENT,B=this.transform.calculateProjMatrix(g.tileID.toUnwrapped()),U="map"===M.get("text-pitch-alignment"),$="map"===M.get("text-rotation-alignment"),K=Pt(g,1,this.transform.zoom),Y=Qt(B,U,$,this.transform,K);let le=null;if(U){const Q=Ho(B,U,$,this.transform,K);le=d.multiply([],this.transform.labelPlaneMatrix,Q)}this.retainedQueryData[b.bucketInstanceId]=new Nc(b.bucketInstanceId,T,b.sourceLayerIndex,b.index,g.tileID);const Z={bucket:b,layout:M,posMatrix:B,textLabelPlaneMatrix:Y,labelToScreenMatrix:le,scale:F,textPixelRatio:L,holdingForFade:g.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:d.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:d.evaluateSizeForZoom(b.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(x)for(const Q of b.sortKeyRanges){const{sortKey:ae,symbolInstanceStart:he,symbolInstanceEnd:ge}=Q;o.push({sortKey:ae,symbolInstanceStart:he,symbolInstanceEnd:ge,parameters:Z})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Z})}attemptAnchorPlacement(o,h,g,x,b,T,A,M,F,L,B,U,$,K,Y,le,Z,Q){const ae=[U.textOffset0,U.textOffset1],he=la(o,g,x,ae,b),ge=this.collisionIndex.placeCollisionBox(b,h,ks(he.x,he.y,T,A,this.transform.angle),B,M,F,L.predicate);if((!le||0!==this.collisionIndex.placeCollisionBox(K.getSymbolInstanceIconSize(Q,this.transform.zoom,$),le,ks(he.x,he.y,T,A,this.transform.angle),B,M,F,L.predicate).box.length)&&ge.box.length>0){let J;return this.prevPlacement&&this.prevPlacement.variableOffsets[U.crossTileID]&&this.prevPlacement.placements[U.crossTileID]&&this.prevPlacement.placements[U.crossTileID].text&&(J=this.prevPlacement.variableOffsets[U.crossTileID].anchor),this.variableOffsets[U.crossTileID]={textOffset:ae,width:g,height:x,anchor:o,textScale:b,prevAnchor:J},this.markUsedJustification(K,o,U,Y),K.allowVerticalPlacement&&(this.markUsedOrientation(K,Y,U),this.placedOrientations[U.crossTileID]=Y),{shift:he,placedGlyphBoxes:ge}}}placeLayerBucketPart(o,h,g,x){const{bucket:b,layout:T,posMatrix:A,textLabelPlaneMatrix:M,labelToScreenMatrix:F,textPixelRatio:L,holdingForFade:B,collisionBoxArray:U,partiallyEvaluatedTextSize:$,partiallyEvaluatedIconSize:K,collisionGroup:Y}=o.parameters,le=T.get("text-optional"),Z=T.get("icon-optional"),Q=T.get("text-allow-overlap"),ae=T.get("icon-allow-overlap"),he="map"===T.get("text-rotation-alignment"),ge="map"===T.get("text-pitch-alignment"),J="none"!==T.get("icon-text-fit"),we="viewport-y"===T.get("symbol-z-order"),$e=Q&&(ae||!b.hasIconData()||Z),Xe=ae&&(Q||!b.hasTextData()||le);!b.collisionArrays&&U&&b.deserializeCollisionBoxes(U),g&&x&&b.updateCollisionDebugBuffers(this.transform.zoom,U);const ve=(Ne,mt,vt)=>{if(h[Ne.crossTileID])return;if(B)return void(this.placements[Ne.crossTileID]=new Mt(!1,!1,!1));let gt=!1,nt=!1,bt=!0,Xt=null,zt={box:null,offscreen:null},gr={box:null,offscreen:null},Yn=null,Zt=null,nn=null,tr=0,ao=0,Qo=0;vt.textFeatureIndex?tr=vt.textFeatureIndex:Ne.useRuntimeCollisionCircles&&(tr=Ne.featureIndex),vt.verticalTextFeatureIndex&&(ao=vt.verticalTextFeatureIndex);const zr=Vn=>{Vn.tileID=this.retainedQueryData[b.bucketInstanceId].tileID,(this.transform.elevation||Vn.elevation)&&(Vn.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[b.bucketInstanceId].tileID,Vn.tileAnchorX,Vn.tileAnchorY):0)},Zr=vt.textBox;if(Zr){zr(Zr);const Vn=en=>{let or=d.WritingMode.horizontal;if(b.allowVerticalPlacement&&!en&&this.prevPlacement){const Wr=this.prevPlacement.placedOrientations[Ne.crossTileID];Wr&&(this.placedOrientations[Ne.crossTileID]=Wr,or=Wr,this.markUsedOrientation(b,or,Ne))}return or},qn=(en,or)=>{if(b.allowVerticalPlacement&&Ne.numVerticalGlyphVertices>0&&vt.verticalTextBox){for(const Wr of b.writingModes)if(Wr===d.WritingMode.vertical?(zt=or(),gr=zt):zt=en(),zt&&zt.box&&zt.box.length)break}else zt=en()};if(T.get("text-variable-anchor")){let en=T.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ne.crossTileID]){const Rn=this.prevPlacement.variableOffsets[Ne.crossTileID];en.indexOf(Rn.anchor)>0&&(en=en.filter(vr=>vr!==Rn.anchor),en.unshift(Rn.anchor))}const or=(Rn,vr,ii)=>{const zi=b.getSymbolInstanceTextSize($,Ne,this.transform.zoom,mt),ul=(Rn.x2-Rn.x1)*zi+2*Rn.padding,ys=(Rn.y2-Rn.y1)*zi+2*Rn.padding,sh=J&&!ae?vr:null;sh&&zr(sh);let hl={box:[],offscreen:!1};const pd=Q?2*en.length:en.length;for(let ou=0;ou<pd;++ou){const su=this.attemptAnchorPlacement(en[ou%en.length],Rn,ul,ys,zi,he,ge,L,A,Y,ou>=en.length,Ne,mt,b,ii,sh,$,K);if(su&&(hl=su.placedGlyphBoxes,hl&&hl.box&&hl.box.length)){gt=!0,Xt=su.shift;break}}return hl};qn(()=>or(Zr,vt.iconBox,d.WritingMode.horizontal),()=>{const Rn=vt.verticalTextBox;return Rn&&zr(Rn),b.allowVerticalPlacement&&!(zt&&zt.box&&zt.box.length)&&Ne.numVerticalGlyphVertices>0&&Rn?or(Rn,vt.verticalIconBox,d.WritingMode.vertical):{box:null,offscreen:null}}),zt&&(gt=zt.box,bt=zt.offscreen);const Wr=Vn(zt&&zt.box);if(!gt&&this.prevPlacement){const Rn=this.prevPlacement.variableOffsets[Ne.crossTileID];Rn&&(this.variableOffsets[Ne.crossTileID]=Rn,this.markUsedJustification(b,Rn.anchor,Ne,Wr))}}else{const en=(or,Wr)=>{const Rn=b.getSymbolInstanceTextSize($,Ne,this.transform.zoom,mt),vr=this.collisionIndex.placeCollisionBox(Rn,or,new d.pointGeometry(0,0),Q,L,A,Y.predicate);return vr&&vr.box&&vr.box.length&&(this.markUsedOrientation(b,Wr,Ne),this.placedOrientations[Ne.crossTileID]=Wr),vr};qn(()=>en(Zr,d.WritingMode.horizontal),()=>{const or=vt.verticalTextBox;return b.allowVerticalPlacement&&Ne.numVerticalGlyphVertices>0&&or?(zr(or),en(or,d.WritingMode.vertical)):{box:null,offscreen:null}}),Vn(zt&&zt.box&&zt.box.length)}}if(Yn=zt,gt=Yn&&Yn.box&&Yn.box.length>0,bt=Yn&&Yn.offscreen,Ne.useRuntimeCollisionCircles){const Vn=b.text.placedSymbolArray.get(Ne.centerJustifiedTextSymbolIndex>=0?Ne.centerJustifiedTextSymbolIndex:Ne.verticalPlacedTextSymbolIndex),qn=d.evaluateSizeForFeature(b.textSizeData,$,Vn),en=T.get("text-padding");Zt=this.collisionIndex.placeCollisionCircles(Q,Vn,b.lineVertexArray,b.glyphOffsetArray,qn,A,M,F,g,ge,Y.predicate,Ne.collisionCircleDiameter*qn/d.ONE_EM,en,this.retainedQueryData[b.bucketInstanceId].tileID),gt=Q||Zt.circles.length>0&&!Zt.collisionDetected,bt=bt&&Zt.offscreen}if(vt.iconFeatureIndex&&(Qo=vt.iconFeatureIndex),vt.iconBox){const Vn=qn=>{zr(qn);const en=J&&Xt?ks(Xt.x,Xt.y,he,ge,this.transform.angle):new d.pointGeometry(0,0),or=b.getSymbolInstanceIconSize(K,this.transform.zoom,mt);return this.collisionIndex.placeCollisionBox(or,qn,en,ae,L,A,Y.predicate)};gr&&gr.box&&gr.box.length&&vt.verticalIconBox?(nn=Vn(vt.verticalIconBox),nt=nn.box.length>0):(nn=Vn(vt.iconBox),nt=nn.box.length>0),bt=bt&&nn.offscreen}const Jo=le||0===Ne.numHorizontalGlyphVertices&&0===Ne.numVerticalGlyphVertices,es=Z||0===Ne.numIconVertices;if(Jo||es?es?Jo||(nt=nt&&gt):gt=nt&&gt:nt=gt=nt&&gt,gt&&Yn&&Yn.box&&this.collisionIndex.insertCollisionBox(Yn.box,T.get("text-ignore-placement"),b.bucketInstanceId,gr&&gr.box&&ao?ao:tr,Y.ID),nt&&nn&&this.collisionIndex.insertCollisionBox(nn.box,T.get("icon-ignore-placement"),b.bucketInstanceId,Qo,Y.ID),Zt&&(gt&&this.collisionIndex.insertCollisionCircles(Zt.circles,T.get("text-ignore-placement"),b.bucketInstanceId,tr,Y.ID),g)){const Vn=b.bucketInstanceId;let qn=this.collisionCircleArrays[Vn];void 0===qn&&(qn=this.collisionCircleArrays[Vn]=new Lc);for(let en=0;en<Zt.circles.length;en+=4)qn.circles.push(Zt.circles[en+0]),qn.circles.push(Zt.circles[en+1]),qn.circles.push(Zt.circles[en+2]),qn.circles.push(Zt.collisionDetected?1:0)}this.placements[Ne.crossTileID]=new Mt(gt||$e,nt||Xe,bt||b.justReloaded),h[Ne.crossTileID]=!0};if(we){const Ne=b.getSortedSymbolIndexes(this.transform.angle);for(let mt=Ne.length-1;mt>=0;--mt){const vt=Ne[mt];ve(b.symbolInstances.get(vt),vt,b.collisionArrays[vt])}}else for(let Ne=o.symbolInstanceStart;Ne<o.symbolInstanceEnd;Ne++)ve(b.symbolInstances.get(Ne),Ne,b.collisionArrays[Ne]);if(g&&b.bucketInstanceId in this.collisionCircleArrays){const Ne=this.collisionCircleArrays[b.bucketInstanceId];d.invert(Ne.invProjMatrix,A),Ne.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(o,h,g,x){let b;b=x===d.WritingMode.vertical?g.verticalPlacedTextSymbolIndex:{left:g.leftJustifiedTextSymbolIndex,center:g.centerJustifiedTextSymbolIndex,right:g.rightJustifiedTextSymbolIndex}[d.getAnchorJustification(h)];const T=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex,g.verticalPlacedTextSymbolIndex];for(const A of T)A>=0&&(o.text.placedSymbolArray.get(A).crossTileID=b>=0&&A!==b?0:g.crossTileID)}markUsedOrientation(o,h,g){const x=h===d.WritingMode.horizontal||h===d.WritingMode.horizontalOnly?h:0,b=h===d.WritingMode.vertical?h:0,T=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex];for(const A of T)o.text.placedSymbolArray.get(A).placedOrientation=x;g.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(g.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let g=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const x=h?h.symbolFadeChange(o):1,b=h?h.opacities:{},T=h?h.variableOffsets:{},A=h?h.placedOrientations:{};for(const M in this.placements){const F=this.placements[M],L=b[M];L?(this.opacities[M]=new Hr(L,x,F.text,F.icon),g=g||F.text!==L.text.placed||F.icon!==L.icon.placed):(this.opacities[M]=new Hr(null,x,F.text,F.icon,F.skipFade),g=g||F.text||F.icon)}for(const M in b){const F=b[M];if(!this.opacities[M]){const L=new Hr(F,x,!1,!1);L.isHidden()||(this.opacities[M]=L,g=g||F.text.placed||F.icon.placed)}}for(const M in T)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=T[M]);for(const M in A)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=A[M]);g?this.lastPlacementChangeTime=o:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:o)}updateLayerOpacities(o,h){const g={};for(const x of h){const b=x.getBucket(o);b&&x.latestFeatureIndex&&o.id===b.layerIds[0]&&this.updateBucketOpacities(b,g,x.collisionBoxArray)}}updateBucketOpacities(o,h,g){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const x=o.layers[0].layout,b=new Hr(null,0,!1,!1,!0),T=x.get("text-allow-overlap"),A=x.get("icon-allow-overlap"),M=x.get("text-variable-anchor"),F="map"===x.get("text-rotation-alignment"),L="map"===x.get("text-pitch-alignment"),B="none"!==x.get("icon-text-fit"),U=new Hr(null,0,T&&(A||!o.hasIconData()||x.get("icon-optional")),A&&(T||!o.hasTextData()||x.get("text-optional")),!0);!o.collisionArrays&&g&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(g);const $=(K,Y,le)=>{for(let Z=0;Z<Y/4;Z++)K.opacityVertexArray.emplaceBack(le)};for(let K=0;K<o.symbolInstances.length;K++){const Y=o.symbolInstances.get(K),{numHorizontalGlyphVertices:le,numVerticalGlyphVertices:Z,crossTileID:Q}=Y;let ae=this.opacities[Q];h[Q]?ae=b:ae||(ae=U,this.opacities[Q]=ae),h[Q]=!0;const he=Y.numIconVertices>0,ge=this.placedOrientations[Y.crossTileID],J=ge===d.WritingMode.vertical,we=ge===d.WritingMode.horizontal||ge===d.WritingMode.horizontalOnly;if(le>0||Z>0){const $e=on(ae.text);$(o.text,le,J?Ga:$e),$(o.text,Z,we?Ga:$e);const Xe=ae.text.isHidden();[Y.rightJustifiedTextSymbolIndex,Y.centerJustifiedTextSymbolIndex,Y.leftJustifiedTextSymbolIndex].forEach(mt=>{mt>=0&&(o.text.placedSymbolArray.get(mt).hidden=Xe||J?1:0)}),Y.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(Y.verticalPlacedTextSymbolIndex).hidden=Xe||we?1:0);const ve=this.variableOffsets[Y.crossTileID];ve&&this.markUsedJustification(o,ve.anchor,Y,ge);const Ne=this.placedOrientations[Y.crossTileID];Ne&&(this.markUsedJustification(o,"left",Y,Ne),this.markUsedOrientation(o,Ne,Y))}if(he){const $e=on(ae.icon);Y.placedIconSymbolIndex>=0&&($(o.icon,Y.numIconVertices,J?Ga:$e),o.icon.placedSymbolArray.get(Y.placedIconSymbolIndex).hidden=ae.icon.isHidden()),Y.verticalPlacedIconSymbolIndex>=0&&($(o.icon,Y.numVerticalIconVertices,we?Ga:$e),o.icon.placedSymbolArray.get(Y.verticalPlacedIconSymbolIndex).hidden=ae.icon.isHidden())}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const $e=o.collisionArrays[K];if($e){let Xe=new d.pointGeometry(0,0);if($e.textBox||$e.verticalTextBox){let Ne=!0;if(M){const mt=this.variableOffsets[Q];mt?(Xe=la(mt.anchor,mt.width,mt.height,mt.textOffset,mt.textScale),F&&Xe._rotate(L?this.transform.angle:-this.transform.angle)):Ne=!1}$e.textBox&&Jr(o.textCollisionBox.collisionVertexArray,ae.text.placed,!Ne||J,Xe.x,Xe.y),$e.verticalTextBox&&Jr(o.textCollisionBox.collisionVertexArray,ae.text.placed,!Ne||we,Xe.x,Xe.y)}const ve=Boolean(!we&&$e.verticalIconBox);$e.iconBox&&Jr(o.iconCollisionBox.collisionVertexArray,ae.icon.placed,ve,B?Xe.x:0,B?Xe.y:0),$e.verticalIconBox&&Jr(o.iconCollisionBox.collisionVertexArray,ae.icon.placed,!ve,B?Xe.x:0,B?Xe.y:0)}}}if(o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const K=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=K.invProjMatrix,o.placementViewportMatrix=K.viewportMatrix,o.collisionCircleArray=K.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return 0===this.fadeDuration?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,h){const g=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*g>o}setStale(){this.stale=!0}}function Jr(p,o,h,g,x){p.emplaceBack(o?1:0,h?1:0,g||0,x||0),p.emplaceBack(o?1:0,h?1:0,g||0,x||0),p.emplaceBack(o?1:0,h?1:0,g||0,x||0),p.emplaceBack(o?1:0,h?1:0,g||0,x||0)}const Go=Math.pow(2,25),zc=Math.pow(2,24),yr=Math.pow(2,17),Bf=Math.pow(2,16),Ps=Math.pow(2,9),Uf=Math.pow(2,8),jf=Math.pow(2,1);function on(p){if(0===p.opacity&&!p.placed)return 0;if(1===p.opacity&&p.placed)return 4294967295;const o=p.placed?1:0,h=Math.floor(127*p.opacity);return h*Go+o*zc+h*yr+o*Bf+h*Ps+o*Uf+h*jf+o}const Ga=0;class ca{constructor(o){this._sortAcrossTiles="viewport-y"!==o.layout.get("symbol-z-order")&&void 0!==o.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,h,g,x,b){const T=this._bucketParts;for(;this._currentTileIndex<o.length;)if(h.getBucketParts(T,x,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((A,M)=>A.sortKey-M.sortKey));this._currentPartIndex<T.length;){const A=T[this._currentPartIndex];if(h.placeLayerBucketPart(A,this._seenCrossTileIDs,g,0===A.symbolInstanceStart),this._currentPartIndex++,b())return!0}return!1}}class Fs{constructor(o,h,g,x,b,T,A,M){this.placement=new hr(o,b,T,A,M),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(o,h,g){const x=d.exported.now(),b=()=>{const T=d.exported.now()-x;return!this._forceFullPlacement&&T>2};for(;this._currentPlacementIndex>=0;){const T=h[o[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if("symbol"===T.type&&(!T.minzoom||T.minzoom<=A)&&(!T.maxzoom||T.maxzoom>A)){if(this._inProgressLayer||(this._inProgressLayer=new ca(T)),this._inProgressLayer.continuePlacement(g[T.source],this.placement,this._showCollisionBoxes,T,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const On=512/d.EXTENT/2;class Vc{constructor(o,h,g){this.tileID=o,this.indexedSymbolInstances={},this.bucketInstanceId=g;for(let x=0;x<h.length;x++){const b=h.get(x),T=b.key;this.indexedSymbolInstances[T]||(this.indexedSymbolInstances[T]=[]),this.indexedSymbolInstances[T].push({crossTileID:b.crossTileID,coord:this.getScaledCoordinates(b,o)})}}getScaledCoordinates(o,h){const g=On/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*d.EXTENT+o.tileAnchorX)*g),y:Math.floor((h.canonical.y*d.EXTENT+o.tileAnchorY)*g)}}findMatches(o,h,g){const x=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let b=0;b<o.length;b++){const T=o.get(b);if(T.crossTileID)continue;const A=this.indexedSymbolInstances[T.key];if(!A)continue;const M=this.getScaledCoordinates(T,h);for(const F of A)if(Math.abs(F.coord.x-M.x)<=x&&Math.abs(F.coord.y-M.y)<=x&&!g[F.crossTileID]){g[F.crossTileID]=!0,T.crossTileID=F.crossTileID;break}}}}class Uu{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class zl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const h=Math.round((o-this.lng)/360);if(0!==h)for(const g in this.indexes){const x=this.indexes[g],b={};for(const T in x){const A=x[T];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+h),b[A.tileID.key]=A}this.indexes[g]=b}this.lng=o}addBucket(o,h,g){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let b=0;b<h.symbolInstances.length;b++)h.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const x=this.usedCrossTileIDs[o.overscaledZ];for(const b in this.indexes){const T=this.indexes[b];if(Number(b)>o.overscaledZ)for(const A in T){const M=T[A];M.tileID.isChildOf(o)&&M.findMatches(h.symbolInstances,o,x)}else{const A=T[o.scaledTo(Number(b)).key];A&&A.findMatches(h.symbolInstances,o,x)}}for(let b=0;b<h.symbolInstances.length;b++){const T=h.symbolInstances.get(b);T.crossTileID||(T.crossTileID=g.generate(),x[T.crossTileID]=!0)}return void 0===this.indexes[o.overscaledZ]&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Vc(o,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(o,h){for(const g in h.indexedSymbolInstances)for(const x of h.indexedSymbolInstances[g])delete this.usedCrossTileIDs[o][x.crossTileID]}removeStaleBuckets(o){let h=!1;for(const g in this.indexes){const x=this.indexes[g];for(const b in x)o[x[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,x[b]),delete x[b],h=!0)}return h}}class ju{constructor(){this.layerIndexes={},this.crossTileIDs=new Uu,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,h,g){let x=this.layerIndexes[o.id];void 0===x&&(x=this.layerIndexes[o.id]=new zl);let b=!1;const T={};x.handleWrapJump(g);for(const A of h){const M=A.getBucket(o);M&&o.id===M.layerIds[0]&&(M.bucketInstanceId||(M.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(A.tileID,M,this.crossTileIDs)&&(b=!0),T[M.bucketInstanceId]=!0)}return x.removeStaleBuckets(T)&&(b=!0),b}pruneUnusedLayers(o){const h={};o.forEach(g=>{h[g]=!0});for(const g in this.layerIndexes)h[g]||delete this.layerIndexes[g]}}const Vl=(p,o)=>d.emitValidationErrors(p,o&&o.filter(h=>"source.canvas"!==h.identifier)),ds=d.pick(ue,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog"]),qa=d.pick(ue,["setCenter","setZoom","setBearing","setPitch"]),$f=function(){const p={},o=d.spec.$version;for(const h in d.spec.$root){const g=d.spec.$root[h];if(g.required){let x=null;x="version"===h?o:"array"===g.type?[]:{},null!=x&&(p[h]=x)}}return p}(),fs={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class xo extends d.Evented{constructor(o,h={}){super(),this.map=o,this.dispatcher=new Pr(ht(),this),this.imageManager=new ye,this.imageManager.setEventedParent(this),this.glyphManager=new d.GlyphManager(o._requestManager,h.localFontFamily?d.LocalGlyphMode.all:h.localIdeographFontFamily?d.LocalGlyphMode.ideographs:d.LocalGlyphMode.none,h.localFontFamily||h.localIdeographFontFamily),this.lineAtlas=new d.LineAtlas(256,512),this.crossTileSymbolIndex=new ju,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new d.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",d.getReferrer());const g=this;this._rtlTextPluginCallback=xo.registerForPluginStateChange(x=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(b,T)=>{if(d.triggerPluginCompletionEvent(b),T&&T.every(A=>A))for(const A in g._sourceCaches){const M=g._sourceCaches[A],F=M.getSource().type;"vector"!==F&&"geojson"!==F||M.reload()}})}),this.on("data",x=>{if("source"!==x.dataType||"metadata"!==x.sourceDataType)return;const b=this.getSource(x.sourceId);if(b&&b.vectorLayerIds)for(const T in this._layers){const A=this._layers[T];A.source===b.id&&this._validateLayer(A)}})}loadURL(o,h={}){this.fire(new d.Event("dataloading",{dataType:"style"}));const g="boolean"==typeof h.validate?h.validate:!d.isMapboxURL(o);o=this.map._requestManager.normalizeStyleURL(o,h.accessToken);const x=this.map._requestManager.transformRequest(o,d.ResourceType.Style);this._request=d.getJSON(x,(b,T)=>{this._request=null,b?this.fire(new d.ErrorEvent(b)):T&&this._load(T,g)})}loadJSON(o,h={}){this.fire(new d.Event("dataloading",{dataType:"style"})),this._request=d.exported.frame(()=>{this._request=null,this._load(o,!1!==h.validate)})}loadEmpty(){this.fire(new d.Event("dataloading",{dataType:"style"})),this._load($f,!1)}_updateLayerCount(o,h){const g=h?1:-1;o.is3D()&&(this._num3DLayers+=g),"circle"===o.type&&(this._numCircleLayers+=g),"symbol"===o.type&&(this._numSymbolLayers+=g)}_load(o,h){if(h&&Vl(this,d.validateStyle(o)))return;this._loaded=!0,this.stylesheet=o;for(const x in o.sources)this.addSource(x,o.sources[x],{validate:!1});this._changed=!1,o.sprite?this._loadSprite(o.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(o.glyphs);const g=It(this.stylesheet.layers);this._order=g.map(x=>x.id),this._layers={},this._serializedLayers={};for(let x of g)x=d.createStyleLayer(x),x.setEventedParent(this,{layer:{id:x.id}}),this._layers[x.id]=x,this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new pt(this.stylesheet.light),this.stylesheet.terrain&&this._createTerrain(this.stylesheet.terrain),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new d.Event("data",{dataType:"style"})),this.fire(new d.Event("style.load"))}_loadSprite(o){this._spriteRequest=function(h,g,x){let b,T,A;const M=d.exported.devicePixelRatio>1?"@2x":"";let F=d.getJSON(g.transformRequest(g.normalizeSpriteURL(h,M,".json"),d.ResourceType.SpriteJSON),(U,$)=>{F=null,A||(A=U,b=$,B())}),L=d.getImage(g.transformRequest(g.normalizeSpriteURL(h,M,".png"),d.ResourceType.SpriteImage),(U,$)=>{L=null,A||(A=U,T=$,B())});function B(){if(A)x(A);else if(b&&T){const U=d.exported.getImageData(T),$={};for(const K in b){const{width:Y,height:le,x:Z,y:Q,sdf:ae,pixelRatio:he,stretchX:ge,stretchY:J,content:we}=b[K],$e=new d.RGBAImage({width:Y,height:le});d.RGBAImage.copy(U,$e,{x:Z,y:Q},{x:0,y:0},{width:Y,height:le}),$[K]={data:$e,pixelRatio:he,sdf:ae,stretchX:ge,stretchY:J,content:we}}x(null,$)}}return{cancel(){F&&(F.cancel(),F=null),L&&(L.cancel(),L=null)}}}(o,this.map._requestManager,(h,g)=>{if(this._spriteRequest=null,h)this.fire(new d.ErrorEvent(h));else if(g)for(const x in g)this.imageManager.addImage(x,g[x]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new d.Event("data",{dataType:"style"}))})}_validateLayer(o){const h=this.getSource(o.source);if(!h)return;const g=o.sourceLayer;g&&("geojson"===h.type||h.vectorLayerIds&&-1===h.vectorLayerIds.indexOf(g))&&this.fire(new d.ErrorEvent(new Error(`Source layer "${g}" does not exist on source "${h.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(o){const h=[];for(const g of o){const x=this._layers[g];"custom"!==x.type&&h.push(x.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(o){return!!this.terrain&&fs[o.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(o){if(!this._loaded)return;const h=this._changed;if(this._changed){const x=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(x.length||b.length)&&this._updateWorkerLayers(x,b);for(const T in this._updatedSources){const A=this._updatedSources[T];"reload"===A?this._reloadSource(T):"clear"===A&&this._clearSource(T)}this._updateTilesForChangedImages();for(const T in this._updatedPaintProps)this._layers[T].updateTransitions(o);this.light.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this._resetUpdates()}const g={};for(const x in this._sourceCaches){const b=this._sourceCaches[x];g[x]=b.used,b.used=!1}for(const x of this._order){const b=this._layers[x];if(b.recalculate(o,this._availableImages),!b.isHidden(o.zoom)){const A=this._getLayerSourceCache(b);A&&(A.used=!0)}const T=this.map.painter;if(T){const A=b.getProgramIds();if(!A)continue;const M=b.getProgramConfiguration(o.zoom);for(const F of A)T.useProgram(F,M)}}for(const x in g){const b=this._sourceCaches[x];g[x]!==b.used&&b.getSource().fire(new d.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),h&&this.fire(new d.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateWorkerLayers(o,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(o){if(this._checkLoaded(),Vl(this,d.validateStyle(o)))return!1;(o=d.clone$2(o)).layers=It(o.layers);const h=function(x,b){if(!x)return[{command:ue.setStyle,args:[b]}];let T=[];try{if(!ne(x.version,b.version))return[{command:ue.setStyle,args:[b]}];ne(x.center,b.center)||T.push({command:ue.setCenter,args:[b.center]}),ne(x.zoom,b.zoom)||T.push({command:ue.setZoom,args:[b.zoom]}),ne(x.bearing,b.bearing)||T.push({command:ue.setBearing,args:[b.bearing]}),ne(x.pitch,b.pitch)||T.push({command:ue.setPitch,args:[b.pitch]}),ne(x.sprite,b.sprite)||T.push({command:ue.setSprite,args:[b.sprite]}),ne(x.glyphs,b.glyphs)||T.push({command:ue.setGlyphs,args:[b.glyphs]}),ne(x.transition,b.transition)||T.push({command:ue.setTransition,args:[b.transition]}),ne(x.light,b.light)||T.push({command:ue.setLight,args:[b.light]}),ne(x.fog,b.fog)||T.push({command:ue.setFog,args:[b.fog]});const A={},M=[];!function(B,U,$,K){let Y;for(Y in U=U||{},B=B||{})B.hasOwnProperty(Y)&&(U.hasOwnProperty(Y)||Bt(Y,$,K));for(Y in U)U.hasOwnProperty(Y)&&(B.hasOwnProperty(Y)?ne(B[Y],U[Y])||("geojson"===B[Y].type&&"geojson"===U[Y].type&&Ft(B,U,Y)?$.push({command:ue.setGeoJSONSourceData,args:[Y,U[Y].data]}):tn(Y,U,$,K)):Ve(Y,U,$))}(x.sources,b.sources,M,A);const F=[];x.layers&&x.layers.forEach(B=>{A[B.source]?T.push({command:ue.removeLayer,args:[B.id]}):F.push(B)});let L=x.terrain;L&&A[L.source]&&(T.push({command:ue.setTerrain,args:[void 0]}),L=void 0),T=T.concat(M),ne(L,b.terrain)||T.push({command:ue.setTerrain,args:[b.terrain]}),function(B,U,$){U=U||[];const K=(B=B||[]).map(gn),Y=U.map(gn),le=B.reduce(Xn,{}),Z=U.reduce(Xn,{}),Q=K.slice(),ae=Object.create(null);let he,ge,J,we,$e,Xe,ve;for(he=0,ge=0;he<K.length;he++)J=K[he],Z.hasOwnProperty(J)?ge++:($.push({command:ue.removeLayer,args:[J]}),Q.splice(Q.indexOf(J,ge),1));for(he=0,ge=0;he<Y.length;he++)J=Y[Y.length-1-he],Q[Q.length-1-he]!==J&&(le.hasOwnProperty(J)?($.push({command:ue.removeLayer,args:[J]}),Q.splice(Q.lastIndexOf(J,Q.length-ge),1)):ge++,Xe=Q[Q.length-he],$.push({command:ue.addLayer,args:[Z[J],Xe]}),Q.splice(Q.length-he,0,J),ae[J]=!0);for(he=0;he<Y.length;he++)if(J=Y[he],we=le[J],$e=Z[J],!ae[J]&&!ne(we,$e))if(ne(we.source,$e.source)&&ne(we["source-layer"],$e["source-layer"])&&ne(we.type,$e.type)){for(ve in Tn(we.layout,$e.layout,$,J,null,ue.setLayoutProperty),Tn(we.paint,$e.paint,$,J,null,ue.setPaintProperty),ne(we.filter,$e.filter)||$.push({command:ue.setFilter,args:[J,$e.filter]}),ne(we.minzoom,$e.minzoom)&&ne(we.maxzoom,$e.maxzoom)||$.push({command:ue.setLayerZoomRange,args:[J,$e.minzoom,$e.maxzoom]}),we)we.hasOwnProperty(ve)&&"layout"!==ve&&"paint"!==ve&&"filter"!==ve&&"metadata"!==ve&&"minzoom"!==ve&&"maxzoom"!==ve&&(0===ve.indexOf("paint.")?Tn(we[ve],$e[ve],$,J,ve.slice(6),ue.setPaintProperty):ne(we[ve],$e[ve])||$.push({command:ue.setLayerProperty,args:[J,ve,$e[ve]]}));for(ve in $e)$e.hasOwnProperty(ve)&&!we.hasOwnProperty(ve)&&"layout"!==ve&&"paint"!==ve&&"filter"!==ve&&"metadata"!==ve&&"minzoom"!==ve&&"maxzoom"!==ve&&(0===ve.indexOf("paint.")?Tn(we[ve],$e[ve],$,J,ve.slice(6),ue.setPaintProperty):ne(we[ve],$e[ve])||$.push({command:ue.setLayerProperty,args:[J,ve,$e[ve]]}))}else $.push({command:ue.removeLayer,args:[J]}),Xe=Q[Q.lastIndexOf(J)+1],$.push({command:ue.addLayer,args:[$e,Xe]})}(F,b.layers,T)}catch(A){console.warn("Unable to compute style diff:",A),T=[{command:ue.setStyle,args:[b]}]}return T}(this.serialize(),o).filter(x=>!(x.command in qa));if(0===h.length)return!1;const g=h.filter(x=>!(x.command in ds));if(g.length>0)throw new Error(`Unimplemented: ${g.map(x=>x.command).join(", ")}.`);return h.forEach(x=>{"setTransition"!==x.command&&this[x.command].apply(this,x.args)}),this.stylesheet=o,!0}addImage(o,h){if(this.getImage(o))return this.fire(new d.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(o,h),this._afterImageUpdated(o)}updateImage(o,h){this.imageManager.updateImage(o,h)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new d.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new d.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(o,h,g={}){if(this._checkLoaded(),void 0!==this.getSource(o))throw new Error("There is already a source with this ID");if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(d.validateStyle.source,`sources.${o}`,h,null,g))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const x=z(o,h,this.dispatcher,this);x.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:x.serialize(),sourceId:o}));const b=T=>{const A=(T?"symbol:":"other:")+o,M=this._sourceCaches[A]=new d.SourceCache(A,x,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[o]=M,M.style=this,M.onAdd(this.map)};b(!1),"vector"!==h.type&&"geojson"!==h.type||b(!0),x.onAdd&&x.onAdd(this.map),this._changed=!0}removeSource(o){this._checkLoaded();const h=this.getSource(o);if(void 0===h)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===o)return this.fire(new d.ErrorEvent(new Error(`Source "${o}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.get().source===o)return this.fire(new d.ErrorEvent(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));const g=this._getSourceCaches(o);for(const x of g)delete this._sourceCaches[x.id],delete this._updatedSources[x.id],x.fire(new d.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles();delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,h){this._checkLoaded(),this.getSource(o).setData(h),this._changed=!0}getSource(o){const h=this._getSourceCache(o);return h&&h.getSource()}addLayer(o,h,g={}){this._checkLoaded();const x=o.id;if(this.getLayer(x))return void this.fire(new d.ErrorEvent(new Error(`Layer with id "${x}" already exists on this map`)));let b;if("custom"===o.type){if(Vl(this,d.validateCustomStyleLayer(o)))return;b=d.createStyleLayer(o)}else{if("object"==typeof o.source&&(this.addSource(x,o.source),o=d.clone$2(o),o=d.extend(o,{source:x})),this._validate(d.validateStyle.layer,`layers.${x}`,o,{arrayIndex:-1},g))return;b=d.createStyleLayer(o),this._validateLayer(b),b.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}const T=h?this._order.indexOf(h):this._order.length;if(h&&-1===T)return void this.fire(new d.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`)));this._order.splice(T,0,x),this._layerOrderChanged=!0,this._layers[x]=b;const A=this._getLayerSourceCache(b);if(this._removedLayers[x]&&b.source&&A&&"custom"!==b.type){const M=this._removedLayers[x];delete this._removedLayers[x],M.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",A.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(o,h){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new d.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===h)return;const g=this._order.indexOf(o);this._order.splice(g,1);const x=h?this._order.indexOf(h):this._order.length;h&&-1===x?this.fire(new d.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`))):(this._order.splice(x,0,o),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(o){this._checkLoaded();const h=this._layers[o];if(!h)return void this.fire(new d.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be removed.`)));h.setEventedParent(null),this._updateLayerCount(h,!1);const g=this._order.indexOf(o);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=h,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],h.onRemove&&h.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(o){return this._layers[o]}hasLayer(o){return o in this._layers}hasLayerType(o){for(const h in this._layers)if(this._layers[h].type===o)return!0;return!1}setLayerZoomRange(o,h,g){this._checkLoaded();const x=this.getLayer(o);x?x.minzoom===h&&x.maxzoom===g||(null!=h&&(x.minzoom=h),null!=g&&(x.maxzoom=g),this._updateLayer(x)):this.fire(new d.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(o,h,g={}){this._checkLoaded();const x=this.getLayer(o);if(x){if(!ne(x.filter,h))return null==h?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(d.validateStyle.filter,`layers.${x.id}.filter`,h,null,g)||(x.filter=d.clone$2(h),this._updateLayer(x)))}else this.fire(new d.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be filtered.`)))}getFilter(o){return d.clone$2(this.getLayer(o).filter)}setLayoutProperty(o,h,g,x={}){this._checkLoaded();const b=this.getLayer(o);b?ne(b.getLayoutProperty(h),g)||(b.setLayoutProperty(h,g,x),this._updateLayer(b)):this.fire(new d.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(o,h){const g=this.getLayer(o);if(g)return g.getLayoutProperty(h);this.fire(new d.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style.`)))}setPaintProperty(o,h,g,x={}){this._checkLoaded();const b=this.getLayer(o);b?ne(b.getPaintProperty(h),g)||(b.setPaintProperty(h,g,x)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new d.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(o,h){return this.getLayer(o).getPaintProperty(h)}setFeatureState(o,h){this._checkLoaded();const g=o.source,x=o.sourceLayer,b=this.getSource(g);if(void 0===b)return void this.fire(new d.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const T=b.type;if("geojson"===T&&x)return void this.fire(new d.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===T&&!x)return void this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===o.id&&this.fire(new d.ErrorEvent(new Error("The feature id parameter must be provided.")));const A=this._getSourceCaches(g);for(const M of A)M.setFeatureState(x,o.id,h)}removeFeatureState(o,h){this._checkLoaded();const g=o.source,x=this.getSource(g);if(void 0===x)return void this.fire(new d.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const b=x.type,T="vector"===b?o.sourceLayer:void 0;if("vector"===b&&!T)return void this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&"string"!=typeof o.id&&"number"!=typeof o.id)return void this.fire(new d.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const A=this._getSourceCaches(g);for(const M of A)M.removeFeatureState(T,o.id,h)}getFeatureState(o){this._checkLoaded();const h=o.source,g=o.sourceLayer,x=this.getSource(h);if(void 0!==x){if("vector"!==x.type||g)return void 0===o.id&&this.fire(new d.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(h)[0].getFeatureState(g,o.id);this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new d.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return d.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const o={};for(const h in this._sourceCaches){const g=this._sourceCaches[h].getSource();o[g.id]||(o[g.id]=g.serialize())}return d.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:o,layers:this._serializeLayers(this._order)},h=>void 0!==h)}_updateLayer(o){this._updatedLayers[o.id]=!0;const h=this._getLayerSourceCache(o);o.source&&!this._updatedSources[o.source]&&h&&"raster"!==h.getSource().type&&(this._updatedSources[o.source]="reload",h.pause()),this._changed=!0}_flattenAndSortRenderedFeatures(o){const h=T=>"fill-extrusion"===this._layers[T].type,g={},x=[];for(let T=this._order.length-1;T>=0;T--){const A=this._order[T];if(h(A)){g[A]=T;for(const M of o){const F=M[A];if(F)for(const L of F)x.push(L)}}}x.sort((T,A)=>A.intersectionZ-T.intersectionZ);const b=[];for(let T=this._order.length-1;T>=0;T--){const A=this._order[T];if(h(A))for(let M=x.length-1;M>=0;M--){const F=x[M].feature;if(g[F.layer.id]<T)break;b.push(F),x.pop()}else for(const M of o){const F=M[A];if(F)for(const L of F)b.push(L.feature)}}return b}queryRenderedFeatures(o,h,g){h&&h.filter&&this._validate(d.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);const x={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new d.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const M of h.layers){const F=this._layers[M];if(!F)return this.fire(new d.ErrorEvent(new Error(`The layer '${M}' does not exist in the map's style and cannot be queried for features.`))),[];x[F.source]=!0}}const b=[];h.availableImages=this._availableImages;const T=h&&h.layers?h.layers.some(M=>{const F=this.getLayer(M);return F&&F.is3D()}):this.has3DLayers(),A=is.createFromScreenPoints(o,g);for(const M in this._sourceCaches){const F=this._sourceCaches[M].getSource().id;h.layers&&!x[F]||b.push(ee(this._sourceCaches[M],this._layers,this._serializedLayers,A,h,g,T,!!this.map._showQueryGeometry))}return this.placement&&b.push(function(M,F,L,B,U,$,K){const Y={},le=$.queryRenderedSymbols(B),Z=[];for(const Q of Object.keys(le).map(Number))Z.push(K[Q]);Z.sort(De);for(const Q of Z){const ae=Q.featureIndex.lookupSymbolFeatures(le[Q.bucketInstanceId],F,Q.bucketIndex,Q.sourceLayerIndex,U.filter,U.layers,U.availableImages,M);for(const he in ae){const ge=Y[he]=Y[he]||[],J=ae[he];J.sort((we,$e)=>{const Xe=Q.featureSortOrder;if(Xe){const ve=Xe.indexOf(we.featureIndex);return Xe.indexOf($e.featureIndex)-ve}return $e.featureIndex-we.featureIndex});for(const we of J)ge.push(we)}}for(const Q in Y)Y[Q].forEach(ae=>{const he=ae.feature,ge=L(M[Q]).getFeatureState(he.layer["source-layer"],he.id);he.source=he.layer.source,he.layer["source-layer"]&&(he.sourceLayer=he.layer["source-layer"]),he.state=ge});return Y}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),A.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(o,h){h&&h.filter&&this._validate(d.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);const g=this._getSourceCaches(o);let x=[];for(const b of g)x=x.concat(ce(b,h));return x}addSourceType(o,h,g){return xo.getSourceType(o)?g(new Error(`A source type called "${o}" already exists.`)):(xo.setSourceType(o,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:h.workerSourceURL},g):g(null,null))}getLight(){return this.light.getLight()}setLight(o,h={}){this._checkLoaded();const g=this.light.getLight();let x=!1;for(const T in o)if(!ne(o[T],g[T])){x=!0;break}if(!x)return;const b={now:d.exported.now(),transition:d.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,h),this.light.updateTransitions(b)}getTerrain(){return this.terrain?this.terrain.get():null}setTerrain(o){if(this._checkLoaded(),!o)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if("object"==typeof o.source){const h="terrain-dem-src";this.addSource(h,o.source),o=d.clone$2(o),o=d.extend(o,{source:h})}if(!this._validate(d.validateStyle.terrain,"terrain",o)){if(this.terrain){const h=this.terrain,g=h.get();for(const x in o)if(!ne(o[x],g[x])){h.set(o),this.stylesheet.terrain=o;const b={now:d.exported.now(),transition:d.extend({duration:0},this.stylesheet.transition)};h.updateTransitions(b);break}}else this._createTerrain(o);this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}}_createFog(o){const h=this.fog=new Wi(o);this.stylesheet.fog=o;const g={now:d.exported.now(),transition:d.extend({duration:0},this.stylesheet.transition)};h.updateTransitions(g)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog,g=h.get();for(const x in o)if(!ne(o[x],g[x])){h.set(o),this.stylesheet.fog=o;const b={now:d.exported.now(),transition:d.extend({duration:0},this.stylesheet.transition)};h.updateTransitions(b);break}}else this._createFog(o);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const o=this._order.filter(g=>this.isLayerDraped(this._layers[g])),h=this._order.filter(g=>!this.isLayerDraped(this._layers[g]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...h)}_createTerrain(o){const h=this.terrain=new Wn(o);this.stylesheet.terrain=o,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const g={now:d.exported.now(),transition:d.extend({duration:0},this.stylesheet.transition)};h.updateTransitions(g)}_force3DLayerUpdate(){for(const o in this._layers){const h=this._layers[o];"fill-extrusion"===h.type&&this._updateLayer(h)}}_validate(o,h,g,x,b={}){return(!b||!1!==b.validate)&&Vl(this,o.call(d.validateStyle,d.extend({key:h,style:this.serialize(),value:g,styleSpec:d.spec},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),d.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this._sourceCaches)this._sourceCaches[o].clearTiles(),this._sourceCaches[o].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(o){const h=this._getSourceCaches(o);for(const g of h)g.clearTiles()}_reloadSource(o){const h=this._getSourceCaches(o);for(const g of h)g.resume(),g.reload()}_updateSources(o){for(const h in this._sourceCaches)this._sourceCaches[h].update(o)}_generateCollisionBoxes(){for(const o in this._sourceCaches){const h=this._sourceCaches[o];h.resume(),h.reload()}}_updatePlacement(o,h,g,x,b=!1){let T=!1,A=!1;const M={};for(const F of this._order){const L=this._layers[F];if("symbol"!==L.type)continue;if(!M[L.source]){const U=this._getLayerSourceCache(L);if(!U)continue;M[L.source]=U.getRenderableIds(!0).map($=>U.getTileByID($)).sort(($,K)=>K.tileID.overscaledZ-$.tileID.overscaledZ||($.tileID.isLessThan(K.tileID)?-1:1))}const B=this.crossTileSymbolIndex.addLayer(L,M[L.source],o.center.lng);T=T||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),b=b||this._layerOrderChanged||0===g,this._layerOrderChanged&&this.fire(new d.Event("neworder")),(b||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(d.exported.now(),o.zoom))&&(this.pauseablePlacement=new Fs(o,this._order,b,h,g,x,this.placement,this.fog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(d.exported.now()),A=!0),T&&this.pauseablePlacement.placement.setStale()),A||T)for(const F of this._order){const L=this._layers[F];"symbol"===L.type&&this.placement.updateLayerOpacities(L,M[L.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(d.exported.now())}_releaseSymbolFadeTiles(){for(const o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,h,g){this.imageManager.getImages(h.icons,g),this._updateTilesForChangedImages();const x=b=>{b&&b.setDependencies(h.tileID.key,h.type,h.icons)};x(this._otherSourceCaches[h.source]),x(this._symbolSourceCaches[h.source])}getGlyphs(o,h,g){this.glyphManager.getGlyphs(h.stacks,g)}getResource(o,h,g){return d.makeRequest(h,g)}_getSourceCache(o){return this._otherSourceCaches[o]}_getLayerSourceCache(o){return"symbol"===o.type?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}_getSourceCaches(o){const h=[];return this._otherSourceCaches[o]&&h.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&h.push(this._symbolSourceCaches[o]),h}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}}xo.getSourceType=function(p){return O[p]},xo.setSourceType=function(p,o){O[p]=o},xo.registerForPluginStateChange=d.registerForPluginStateChange;var Bc="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",Uc="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let Za={},dr={};Za=$t("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec3 elevationVector(vec2 pos) {vec2 uv=pos/8192.0;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif",!0),dr=$t("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const Bl=$t("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),ua=Bc;var Ut={background:$t("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:$t("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:$t("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);vec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:$t("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:$t("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec3 pos=vec3(floor(a_pos*0.5)+extrude,elevation(floor(a_pos*0.5)));gl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:$t("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:$t("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:$t("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:$t("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);}"),fill:$t("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:$t("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:$t("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:$t("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:$t("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:$t("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:$t("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:$t("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:$t("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:$t("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:$t("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:$t("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec4 projectedPoint=u_matrix*vec4(vec3(a_pos,anchorZ)+h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(vec3(a_projected_pos.xy,anchorZ)+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));}"),symbolSDF:$t("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec4 projectedPoint=u_matrix*vec4(vec3(a_pos,anchorZ)+h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(vec3(a_projected_pos.xy,anchorZ)+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:$t("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec4 projectedPoint=u_matrix*vec4(vec3(a_pos,anchorZ)+h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(vec3(a_projected_pos.xy,anchorZ)+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrainRaster:$t("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:$t("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:$t("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Uc),skyboxGradient:$t("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Uc),skyboxCapture:$t("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:$t("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {vec4 color=texture2D(u_image0,v_pos0);gl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_globe_matrix;attribute vec3 a_globe_pos;attribute vec2 a_uv;varying vec2 v_pos0;void main() {v_pos0=a_uv;gl_Position=u_globe_matrix*vec4(a_globe_pos+elevationVector(a_uv*8192.0)*elevation(a_uv*8192.0),1.0);}"),globeAtmosphere:$t("uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)\ndiscard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}"),globeDepth:$t("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_globe_matrix;attribute vec3 a_globe_pos;attribute vec2 a_uv;varying float v_depth;void main() {gl_Position=u_globe_matrix*vec4(a_globe_pos+elevationVector(a_uv*8192.0)*elevation(a_uv*8192.0),1.0);v_depth=gl_Position.z/gl_Position.w;}")};function $t(p,o,h){const g=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,x=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,b=o.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),T=p.match(x),A=o.match(x),M=Bc.match(x);let F=A?A.concat(T):T;h||(Za.staticUniforms&&(F=Za.staticUniforms.concat(F)),dr.staticUniforms&&(F=dr.staticUniforms.concat(F))),F&&(F=F.concat(M));const L={};return{fragmentSource:p=p.replace(g,(B,U,$,K,Y)=>(L[Y]=!0,"define"===U?`\n#ifndef HAS_UNIFORM_u_${Y}\nvarying ${$} ${K} ${Y};\n#else\nuniform ${$} ${K} u_${Y};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${Y}\n    ${$} ${K} ${Y} = u_${Y};\n#endif\n`)),vertexSource:o=o.replace(g,(B,U,$,K,Y)=>{const le="float"===K?"vec2":"vec4",Z=Y.match(/color/)?"color":le;return L[Y]?"define"===U?`\n#ifndef HAS_UNIFORM_u_${Y}\nuniform lowp float u_${Y}_t;\nattribute ${$} ${le} a_${Y};\nvarying ${$} ${K} ${Y};\n#else\nuniform ${$} ${K} u_${Y};\n#endif\n`:"vec4"===Z?`\n#ifndef HAS_UNIFORM_u_${Y}\n    ${Y} = a_${Y};\n#else\n    ${$} ${K} ${Y} = u_${Y};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Y}\n    ${Y} = unpack_mix_${Z}(a_${Y}, u_${Y}_t);\n#else\n    ${$} ${K} ${Y} = u_${Y};\n#endif\n`:"define"===U?`\n#ifndef HAS_UNIFORM_u_${Y}\nuniform lowp float u_${Y}_t;\nattribute ${$} ${le} a_${Y};\n#else\nuniform ${$} ${K} u_${Y};\n#endif\n`:"vec4"===Z?`\n#ifndef HAS_UNIFORM_u_${Y}\n    ${$} ${K} ${Y} = a_${Y};\n#else\n    ${$} ${K} ${Y} = u_${Y};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Y}\n    ${$} ${K} ${Y} = unpack_mix_${Z}(a_${Y}, u_${Y}_t);\n#else\n    ${$} ${K} ${Y} = u_${Y};\n#endif\n`}),staticAttributes:b,staticUniforms:F}}class Gr{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,h,g,x,b,T,A,M){this.context=o;let F=this.boundPaintVertexBuffers.length!==x.length;for(let L=0;!F&&L<x.length;L++)this.boundPaintVertexBuffers[L]!==x[L]&&(F=!0);o.extVertexArrayObject&&this.vao&&this.boundProgram===h&&this.boundLayoutVertexBuffer===g&&!F&&this.boundIndexBuffer===b&&this.boundVertexOffset===T&&this.boundDynamicVertexBuffer===A&&this.boundDynamicVertexBuffer2===M?(o.bindVertexArrayOES.set(this.vao),A&&A.bind(),b&&b.dynamicDraw&&b.bind(),M&&M.bind()):this.freshBind(h,g,x,b,T,A,M)}freshBind(o,h,g,x,b,T,A){let M;const F=o.numAttributes,L=this.context,B=L.gl;if(L.extVertexArrayObject)this.vao&&this.destroy(),this.vao=L.extVertexArrayObject.createVertexArrayOES(),L.bindVertexArrayOES.set(this.vao),M=0,this.boundProgram=o,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=x,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=T,this.boundDynamicVertexBuffer2=A;else{M=L.currentNumAttributes||0;for(let U=F;U<M;U++)B.disableVertexAttribArray(U)}h.enableAttributes(B,o);for(const U of g)U.enableAttributes(B,o);T&&T.enableAttributes(B,o),A&&A.enableAttributes(B,o),h.bind(),h.setVertexAttribPointers(B,o,b);for(const U of g)U.bind(),U.setVertexAttribPointers(B,o,b);T&&(T.bind(),T.setVertexAttribPointers(B,o,b)),x&&x.bind(),A&&(A.bind(),A.setVertexAttribPointers(B,o,b)),L.currentNumAttributes=F}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function qo(p,o){const h=Math.pow(2,o.canonical.z),g=o.canonical.y;return[new d.MercatorCoordinate(0,g/h).toLngLat().lat,new d.MercatorCoordinate(0,(g+1)/h).toLngLat().lat]}function Zo(p,o,h,g,x,b,T){const A=p.context,M=A.gl,F=h.fbo;if(!F)return;p.prepareDrawTile(o);const L=p.useProgram("hillshade");A.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,F.colorAttachment.get());const B=((U,$,K,Y)=>{const le=K.paint.get("hillshade-shadow-color"),Z=K.paint.get("hillshade-highlight-color"),Q=K.paint.get("hillshade-accent-color");let ae=K.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===K.paint.get("hillshade-illumination-anchor")&&(ae-=U.transform.angle);const he=!U.options.moving;return{u_matrix:Y||U.transform.calculateProjMatrix($.tileID.toUnwrapped(),he),u_image:0,u_latrange:qo(0,$.tileID),u_light:[K.paint.get("hillshade-exaggeration"),ae],u_shadow:le,u_highlight:Z,u_accent:Q}})(p,h,g,p.terrain?o.projMatrix:null);p.prepareDrawProgram(A,L,o.toUnwrapped()),L.draw(A,M.TRIANGLES,x,b,T,d.CullFaceMode.disabled,B,g.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}function ei(p,o,h){if(!o.needsDEMTextureUpload)return;const g=p.context,x=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||p.getTileTexture(h.stride);const b=h.getPixels();o.demTexture?o.demTexture.update(b,{premultiply:!1}):o.demTexture=new d.Texture(g,b,x.RGBA,{premultiply:!1}),o.needsDEMTextureUpload=!1}function Dn(p,o,h,g,x,b){const T=p.context,A=T.gl;if(!o.dem)return;const M=o.dem;if(T.activeTexture.set(A.TEXTURE1),ei(p,o,M),!o.demTexture)return;o.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE);const F=M.dim;T.activeTexture.set(A.TEXTURE0);let L=o.fbo;if(!L){const B=new d.Texture(T,{width:F,height:F,data:null},A.RGBA);B.bind(A.LINEAR,A.CLAMP_TO_EDGE),L=o.fbo=T.createFramebuffer(F,F,!0),L.colorAttachment.set(B.texture)}T.bindFramebuffer.set(L.framebuffer),T.viewport.set([0,0,F,F]),p.useProgram("hillshadePrepare").draw(T,A.TRIANGLES,g,x,b,d.CullFaceMode.disabled,((B,U)=>{const $=U.stride,K=d.create$1();return d.ortho(K,0,d.EXTENT,-d.EXTENT,0,0,1),d.translate(K,K,[0,-d.EXTENT,0]),{u_matrix:K,u_image:1,u_dimension:[$,$],u_zoom:B.overscaledZ,u_unpack:U.unpackVector}})(o.tileID,M),h.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments),o.needsHillshadePrepare=!1}const fi=(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_image0:new d.Uniform1i(p,o.u_image0),u_skirt_height:new d.Uniform1f(p,o.u_skirt_height)}),Et=(p,o)=>({u_matrix:p,u_image0:0,u_skirt_height:o}),an=new class{constructor(){this.operations={}}newMorphing(p,o,h,g,x){if(p in this.operations){const b=this.operations[p];b.to.tileID.key!==h.tileID.key&&(b.queued=h)}else this.operations[p]={startTime:g,phase:0,duration:x,from:o,to:h,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const o=this.operations[p];return{from:o.from,to:o.to,phase:o.phase}}update(p){for(const o in this.operations){const h=this.operations[o];for(h.phase=(p-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,p)){delete this.operations[o];break}}}_nextOp(p,o){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=o,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},er={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Si(p,o){const h=1<<p.z;return!o&&(0===p.x||p.x===h-1)||0===p.y||p.y===h-1}const Wo=p=>({u_matrix:p});function Fr(p,o,h,g,x){if(x>0){const b=d.exported.now(),T=(b-p.timeAdded)/x,A=o?(b-o.timeAdded)/x:-1,M=h.getSource(),F=g.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),L=!o||Math.abs(o.tileID.overscaledZ-F)>Math.abs(p.tileID.overscaledZ-F),B=L&&p.refreshedUponExpiration?1:d.clamp(L?T:1-A,0,1);return p.refreshedUponExpiration&&T>=1&&(p.refreshedUponExpiration=!1),o?{opacity:1,mix:1-B}:{opacity:B,mix:0}}return{opacity:1,mix:0}}class ha extends d.SourceCache{constructor(o){const h=z("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},new Pr(ht(),null),o.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,h,g){if(o.freezeTileCoverage)return;this.transform=o;const x=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,T)=>{if(b[T.key]="",!this._tiles[T.key]){const A=new d.Tile(T,this._source.tileSize*T.overscaleFactor(),o.tileZoom);A.state="loaded",this._tiles[T.key]=A}return b},{});for(const b in this._tiles)b in x||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(o){const h=this.proxyCachedFBO[o];if(void 0!==h){const g=Object.values(h);this.renderCachePool.push(...g),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class fr extends d.OverscaledTileID{constructor(o,h,g){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=h,this.projMatrix=g}}class da extends d.Elevation{constructor(o,h){super(),this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[g,x,b]=function(M){const F=new d.StructArrayLayout4i8,L=new d.StructArrayLayout3ui6,B=131;F.reserve(17161),L.reserve(33800);const U=d.EXTENT/128,$=d.EXTENT+U/2,K=$+U;for(let le=-U;le<K;le+=U)for(let Z=-U;Z<K;Z+=U){const Q=Z<0||Z>$||le<0||le>$?24575:0,ae=d.clamp(Math.round(Z),0,d.EXTENT),he=d.clamp(Math.round(le),0,d.EXTENT);F.emplaceBack(ae+Q,he,ae,he)}const Y=(le,Z)=>{const Q=Z*B+le;L.emplaceBack(Q+1,Q,Q+B),L.emplaceBack(Q+B,Q+B+1,Q+1)};for(let le=1;le<129;le++)for(let Z=1;Z<129;Z++)Y(Z,le);return[0,129].forEach(le=>{for(let Z=0;Z<130;Z++)Y(Z,le),Y(le,Z)}),[F,L,32768]}(),T=o.context;this.gridBuffer=T.createVertexBuffer(g,oo.members),this.gridIndexBuffer=T.createIndexBuffer(x),this.gridSegments=d.SegmentVector.simpleSegment(0,0,g.length,x.length),this.gridNoSkirtSegments=d.SegmentVector.simpleSegment(0,0,g.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new ha(h.map),this.orthoMatrix=d.create$1(),d.ortho(this.orthoMatrix,0,d.EXTENT,0,d.EXTENT,0,1);const A=T.gl;this._overlapStencilMode=new d.StencilMode({func:A.GEQUAL,mask:255},0,255,A.KEEP,A.KEEP,A.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),o.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=o,this._checkRenderCacheEfficiency()}update(o,h,g){if(o&&o.terrain){this._style!==o&&(this.style=o),this.enabled=!0;const x=o.terrain.properties;this.sourceCache=o._getSourceCache(x.get("source")),this._exaggeration=x.get("exaggeration");const b=()=>{this.sourceCache.used&&d.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const T=this.sourceCache.getSource().tileSize/128,A=this.proxySourceCache.getSource().tileSize;this.sourceCache.update(h,T*A,!0),this._findCoveringTileCache[this.sourceCache.id]={}};this.sourceCache.usedForTerrain||(this._findCoveringTileCache[this.sourceCache.id]={},this.sourceCache.usedForTerrain=!0,b(),this._initializing=!0),b(),h.updateElevation(!g),this._findCoveringTileCache[this.proxySourceCache.id]={},this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0}else this._disable()}_checkRenderCacheEfficiency(){const o=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==o.efficiency&&d.warnOnce(`Terrain render cache efficiency is not optimal (${o.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${o.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(o){o.coord&&"source"===o.dataType?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):"style"===o.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const o in this._style._sourceCaches)this._style._sourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=0===g._centerAltitude&&-1===this.getAtPointOrZero(d.MercatorCoordinate.fromLngLat(g.center),-1),this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=h.getIds().map(M=>{const F=h.getTileByID(M).tileID;return F.projMatrix=g.calculateProjMatrix(F.toUnwrapped()),F});(function(M,F){const L=F.transform.pointCoordinate(F.transform.getCameraPoint()),B=new d.pointGeometry(L.x,L.y);M.sort((U,$)=>{if($.overscaledZ-U.overscaledZ)return $.overscaledZ-U.overscaledZ;const K=new d.pointGeometry(U.canonical.x+(1<<U.canonical.z)*U.wrap,U.canonical.y),Y=new d.pointGeometry($.canonical.x+(1<<$.canonical.z)*$.wrap,$.canonical.y),le=B.mult(1<<U.canonical.z);return le.x-=.5,le.y-=.5,le.distSqr(K)-le.distSqr(Y)})})(x,this.painter),this._previousZoom=g.zoom;const b=this.proxyToSource||{};this.proxyToSource={},x.forEach(M=>{this.proxyToSource[M.key]={}}),this.terrainTileForTile={};const T=this._style._sourceCaches;for(const M in T){const F=T[M];if(!F.used||(F!==this.sourceCache&&(this._findCoveringTileCache[F.id]={}),this._setupProxiedCoordsForOrtho(F,o[M],b),F.usedForTerrain))continue;const L=o[M];F.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[h.id]=x.map(M=>new fr(M,M.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1,this._updateTimestamp=d.exported.now();const A={};this._visibleDemTiles=[];for(const M of this.proxyCoords){const F=this.terrainTileForTile[M.key];if(!F)continue;const L=F.tileID.key;L in A||(this._visibleDemTiles.push(F),A[L]=L)}}_assignTerrainTiles(o){this._initializing||o.forEach(h=>{if(this.terrainTileForTile[h.key])return;const g=this._findTileCoveringTileID(h,this.sourceCache);g&&(this.terrainTileForTile[h.key]=g)})}_prepareDEMTextures(){const o=this.painter.context,h=o.gl;for(const g in this.terrainTileForTile){const x=this.terrainTileForTile[g],b=x.dem;!b||x.demTexture&&!x.needsDEMTextureUpload||(o.activeTexture.set(h.TEXTURE1),ei(this.painter,x,b))}}_prepareDemTileUniforms(o,h,g,x){if(!h||null==h.demTexture)return!1;const b=o.tileID.canonical,T=Math.pow(2,h.tileID.canonical.z-b.z),A=x||"";return g[`u_dem_tl${A}`]=[b.x*T%1,b.y*T%1],g[`u_dem_scale${A}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){let o=0;const h=this._visibleDemTiles.reduce((g,x)=>{if(!x.dem)return g;const b=x.dem.tree.minimums[0];return b>0&&o++,g+b},0);return o?h/o:0}_updateEmptyDEMTexture(){const o=this.painter.context,h=o.gl;o.activeTexture.set(h.TEXTURE2);const g=this._getLoadedAreaMinimum(),x={width:1,height:1,data:new Uint8Array(d.DEMData.pack(g,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(x,{premultiply:!1}):b=this._emptyDEMTexture=new d.Texture(o,x,h.RGBA,{premultiply:!1}),b}setupElevationDraw(o,h,g){const x=this.painter.context,b=x.gl,T=(A=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:d.DEMData.getUnpackVector(A),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var A;T.u_dem_size=this.sourceCache.getSource().tileSize,T.u_exaggeration=this.exaggeration();let M=null,F=null,L=1;if(g&&g.morphing&&this._useVertexMorphing){const B=g.morphing.srcDemTile,U=g.morphing.dstDemTile;L=g.morphing.phase,B&&U&&(this._prepareDemTileUniforms(o,B,T,"_prev")&&(F=B),this._prepareDemTileUniforms(o,U,T)&&(M=U))}if(F&&M?(x.activeTexture.set(b.TEXTURE2),M.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),x.activeTexture.set(b.TEXTURE4),F.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),T.u_dem_lerp=L):(M=this.terrainTileForTile[o.tileID.key],x.activeTexture.set(b.TEXTURE2),(this._prepareDemTileUniforms(o,M,T)?M.demTexture:this.emptyDEMTexture).bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST)),g&&g.useDepthForOcclusion&&(x.activeTexture.set(b.TEXTURE3),this._depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),T.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]),g&&g.useMeterToDem&&M){const B=(1<<M.tileID.canonical.z)*d.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=B}g&&g.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),h.setTerrainUniformValues(x,T)}renderToBackBuffer(o){const h=this.painter,g=this.painter.context;0!==o.length&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,h.width,h.height]),this.renderingToTexture=!1,function(x,b,T,A,M){const F=x.context,L=F.gl;let B,U;const $=x.options.showTerrainWireframe?2:0,K=(ae,he)=>{if(U===ae)return;const ge=[er[ae]];he&&ge.push(er[$]),B=x.useProgram("terrainRaster",null,ge),U=ae},Y=x.colorModeForRenderPass(),le=new d.DepthMode(L.LEQUAL,d.DepthMode.ReadWrite,x.depthRangeFor3D);an.update(M);const Z=x.transform,Q=6*Math.pow(1.5,22-Z.zoom)*b.exaggeration();($?[!1,!0]:[!1]).forEach(ae=>{U=-1;const he=ae?L.LINES:L.TRIANGLES,[ge,J]=ae?b.getWirefameBuffer():[b.gridIndexBuffer,b.gridSegments];for(const Xe of A){const ve=T.getTile(Xe),Ne=d.StencilMode.disabled,mt=b.prevTerrainTileForTile[Xe.key],vt=b.terrainTileForTile[Xe.key];$e=vt,null!=(we=mt)&&null!=$e&&we.hasData()&&$e.hasData()&&null!=we.demTexture&&null!=$e.demTexture&&we.tileID.key!==$e.tileID.key&&an.newMorphing(Xe.key,mt,vt,M,250),F.activeTexture.set(L.TEXTURE0),ve.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST);const gt=an.getMorphValuesForProxy(Xe.key),nt=gt?1:0;let bt;gt&&(bt={morphing:{srcDemTile:gt.from,dstDemTile:gt.to,phase:d.easeCubicInOut(gt.phase)}});const Xt=Et(Xe.projMatrix,Si(Xe.canonical,Z.renderWorldCopies)?Q/10:Q);K(nt,ae),b.setupElevationDraw(ve,B,bt),x.prepareDrawProgram(F,B,Xe.toUnwrapped()),B.draw(F,he,le,Ne,Y,d.CullFaceMode.backCCW,Xt,"terrain_raster",b.gridBuffer,ge,J)}var we,$e})}(h,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,o.splice(0,o.length))}renderBatch(o){if(0===this._drapedRenderBatches.length)return o+1;this.renderingToTexture=!0;const h=this.painter,g=this.painter.context,x=this.proxySourceCache,b=this.proxiedCoords[x.id],T=this._drapedRenderBatches.shift(),A=[],M=h.style.order;let F=0;for(const L of b){const B=x.getTileByID(L.proxyTileKey),U=x.proxyCachedFBO[L.key]?x.proxyCachedFBO[L.key][o]:void 0,$=void 0!==U?x.renderCache[U]:this.pool[F++],K=void 0!==U;if(B.texture=$.tex,K&&!$.dirty){A.push(B.tileID);continue}let Y;g.bindFramebuffer.set($.fb.framebuffer),this.renderedToTile=!1,$.dirty&&(g.clear({color:d.Color.transparent}),$.dirty=!1);for(let le=T.start;le<=T.end;++le){const Z=h.style._layers[M[le]];if(Z.isHidden(h.transform.zoom))continue;const Q=h.style._getLayerSourceCache(Z),ae=Q?this.proxyToSource[L.key][Q.id]:[L];if(!ae)continue;const he=ae;g.viewport.set([0,0,$.fb.width,$.fb.height]),Y!==(Q?Q.id:null)&&(this._setupStencil($,ae,Z,Q),Y=Q?Q.id:null),h.renderLayer(h,Q,Z,he)}this.renderedToTile?($.dirty=!0,A.push(B.tileID)):K||--F,5===F&&(F=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,h.width,h.height]),T.end+1}postRender(){}renderCacheEfficiency(o){const h=o.order.length;if(0===h)return{efficiency:100};let g,x=0,b=0,T=!1;for(let A=0;A<h;++A){const M=o._layers[o.order[A]];this._style.isLayerDraped(M)?(T&&++x,++b):T||(T=!0,g=M.id)}return 0===b?{efficiency:100}:{efficiency:100*(1-x/b),firstUndrapedLayer:g}}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{o=Math.min(o,h.dem.tree.minimums[0])}),0===o?o:(o-30)*this._exaggeration}raycast(o,h,g){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const T=b.tileID,A=Math.pow(2,T.overscaledZ),{x:M,y:F}=T.canonical,L=M/A,B=(M+1)/A,U=F/A,$=(F+1)/A;return{minx:L,miny:U,maxx:B,maxy:$,t:b.dem.tree.raycastRoot(L,U,B,$,o,h,g),tile:b}});x.sort((b,T)=>(null!==b.t?b.t:Number.MAX_VALUE)-(null!==T.t?T.t:Number.MAX_VALUE));for(const b of x){if(null==b.t)return null;const T=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,o,h,g);if(null!=T)return T}return null}_createFBO(){const o=this.painter.context,h=o.gl,g=this.drapeBufferSize;o.activeTexture.set(h.TEXTURE0);const x=new d.Texture(o,{width:g[0],height:g[1],data:null},h.RGBA);x.bind(h.LINEAR,h.CLAMP_TO_EDGE);const b=o.createFramebuffer(g[0],g[1],!1);return b.colorAttachment.set(x.texture),b.depthAttachment=new Is(o,b.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&!o.extTextureFilterAnisotropicForceOff&&h.texParameterf(h.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:b,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const o in this._style._sourceCaches)if(this._style._sourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{const h=this._style._layers[o],g=h.isHidden(this.painter.transform.zoom),x=h.getCrossfadeParameters(),b=!!x&&1!==x.t,T=h.hasTransition();return"custom"!==h.type&&!g&&(b||T)})}_clearRasterFadeFromRenderCache(){let o=!1;for(const h in this._style._sourceCaches)if(this._style._sourceCaches[h]._source instanceof us){o=!0;break}if(o)for(let h=0;h<this._style.order.length;++h){const g=this._style._layers[this._style.order[h]],x=g.isHidden(this.painter.transform.zoom),b=this._style._getLayerSourceCache(g);if("raster"!==g.type||x||!b)continue;const T=g.paint.get("raster-fade-duration");for(const A of this.proxyCoords){const M=this.proxyToSource[A.key][b.id];if(M)for(const F of M){const L=Fr(b.getTile(F),b.findLoadedParent(F,0),b,this.painter.transform,T);(1!==L.opacity||0!==L.mix)&&this._clearRenderCacheForTile(b.id,F)}}}}_setupDrapedRenderBatches(){const o=this._style.order,h=o.length;if(0===h)return;const g=[];let x,b=0,T=this._style._layers[o[b]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++b<h;)T=this._style._layers[o[b]];for(;b<h;++b){const A=this._style._layers[o[b]];A.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(A)?void 0===x&&(x=b):void 0!==x&&(g.push({start:x,end:b-1}),x=void 0))}void 0!==x&&g.push({start:x,end:b-1}),this._drapedRenderBatches=g}_setupRenderCache(o){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const T=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let A=0;A<T.length;++A){const M=Object.values(T[A]);h.renderCachePool.push(...M)}}return}this._clearRasterFadeFromRenderCache();const g=this.proxyCoords,x=this._tilesDirty;for(let T=g.length-1;T>=0;T--){const A=g[T];if(h.getTileByID(A.key),void 0!==h.proxyCachedFBO[A.key]){const M=o[A.key],F=this.proxyToSource[A.key];let L=0;for(const B in F){const U=F[B],$=M[B];if(!$||$.length!==U.length||U.some((K,Y)=>K!==$[Y]||x[B]&&x[B].hasOwnProperty(K.key))){L=-1;break}++L}for(const B in h.proxyCachedFBO[A.key])h.renderCache[h.proxyCachedFBO[A.key][B]].dirty=L<0||L!==Object.values(M).length}}const b=[...this._drapedRenderBatches];b.sort((T,A)=>A.end-A.start-(T.end-T.start));for(const T of b)for(const A of g){if(h.proxyCachedFBO[A.key])continue;let M=h.renderCachePool.pop();void 0===M&&h.renderCache.length<50&&(M=h.renderCache.length,h.renderCache.push(this._createFBO())),void 0!==M&&(h.proxyCachedFBO[A.key]={},h.proxyCachedFBO[A.key][T.start]=M,h.renderCache[M].dirty=!0)}this._tilesDirty={}}_setupStencil(o,h,g,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,T=b.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let A;if(g.isTileClipped())A=h.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);A=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+A>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=A,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):d.StencilMode.disabled}_renderTileClippingMasks(o,h){const g=this.painter,x=this.painter.context,b=x.gl;g._tileClippingMaskIDs={},x.setColorMode(d.ColorMode.disabled),x.setDepthMode(d.DepthMode.disabled);const T=g.useProgram("clippingMask");for(const A of o){const M=g._tileClippingMaskIDs[A.key]=--h;T.draw(x,b.TRIANGLES,d.DepthMode.disabled,new d.StencilMode({func:b.ALWAYS,mask:0},M,255,b.KEEP,b.KEEP,b.REPLACE),d.ColorMode.disabled,d.CullFaceMode.disabled,Wo(A.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(o){const h=this.painter.transform;if(o.x<0||o.x>h.width||o.y<0||o.y>h.height)return null;const g=[o.x,o.y,1,1];d.transformMat4(g,g,h.pixelMatrixInverse),d.scale$2(g,g,1/g[3]),g[0]/=h.worldSize,g[1]/=h.worldSize;const x=h._camera.position,b=d.mercatorZfromAltitude(1,h.center.lat),T=[x[0],x[1],x[2]/b,0],A=d.subtract([],g.slice(0,3),T);d.normalize(A,A);const M=this.raycast(T,A,this._exaggeration);return null!==M&&M?(d.scaleAndAdd(T,T,A,M),T[3]=T[2],T[2]*=b,T):null}drawDepth(){const o=this.painter,h=o.context,g=this.proxySourceCache,x=Math.ceil(o.width),b=Math.ceil(o.height);if(!this._depthFBO||this._depthFBO.width===x&&this._depthFBO.height===b||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const T=h.gl,A=h.createFramebuffer(x,b,!0);h.activeTexture.set(T.TEXTURE0);const M=new d.Texture(h,{width:x,height:b,data:null},T.RGBA);M.bind(T.NEAREST,T.CLAMP_TO_EDGE),A.colorAttachment.set(M.texture);const F=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,x,b);A.depthAttachment.set(F),this._depthFBO=A,this._depthTexture=M}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,x,b]),function(T,A,M,F){const L=T.context,B=L.gl;L.clear({depth:1});const U=T.useProgram("terrainDepth"),$=new d.DepthMode(B.LESS,d.DepthMode.ReadWrite,T.depthRangeFor3D);for(const K of F){const Y=M.getTile(K),le=Et(K.projMatrix,0);A.setupElevationDraw(Y,U),U.draw(L,B.TRIANGLES,$,d.StencilMode.disabled,d.ColorMode.unblended,d.CullFaceMode.backCCW,le,"terrain_depth",A.gridBuffer,A.gridIndexBuffer,A.gridNoSkirtSegments)}}(o,this,g,this.proxyCoords)}_setupProxiedCoordsForOrtho(o,h,g){if(o.getSource()instanceof X)return this._setupProxiedCoordsForImageSource(o,h,g);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};const x=this.proxiedCoords[o.id]=[],b=this.proxyCoords;for(let A=0;A<b.length;A++){const M=b[A],F=this._findTileCoveringTileID(M,o);if(F){const L=this._createProxiedId(M,F,g[M.key]&&g[M.key][o.id]);x.push(L),this.proxyToSource[M.key][o.id]=[L]}}let T=!1;for(let A=0;A<h.length;A++){const M=o.getTile(h[A]);if(!M||!M.hasData())continue;const F=this._findTileCoveringTileID(M.tileID,this.proxySourceCache);if(F&&F.tileID.canonical.z!==M.tileID.canonical.z){const L=this.proxyToSource[F.tileID.key][o.id],B=this._createProxiedId(F.tileID,M,g[F.tileID.key]&&g[F.tileID.key][o.id]);L?L.splice(L.length-1,0,B):this.proxyToSource[F.tileID.key][o.id]=[B],x.push(B),T=!0}}this._sourceTilesOverlap[o.id]=T}_setupProxiedCoordsForImageSource(o,h,g){if(!o.getSource().loaded())return;const x=this.proxiedCoords[o.id]=[],b=this.proxyCoords,T=o.getSource(),A=new d.pointGeometry(T.tileID.x,T.tileID.y)._div(1<<T.tileID.z),M=T.coordinates.map(d.MercatorCoordinate.fromLngLat).reduce((L,B)=>(L.min.x=Math.min(L.min.x,B.x-A.x),L.min.y=Math.min(L.min.y,B.y-A.y),L.max.x=Math.max(L.max.x,B.x-A.x),L.max.y=Math.max(L.max.y,B.y-A.y),L),{min:new d.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new d.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),F=(L,B)=>{const U=L.wrap+L.canonical.x/(1<<L.canonical.z),$=L.canonical.y/(1<<L.canonical.z),K=d.EXTENT/(1<<L.canonical.z),Y=B.wrap+B.canonical.x/(1<<B.canonical.z),le=B.canonical.y/(1<<B.canonical.z);return U+K<Y+M.min.x||U>Y+M.max.x||$+K<le+M.min.y||$>le+M.max.y};for(let L=0;L<b.length;L++){const B=b[L];for(let U=0;U<h.length;U++){const $=o.getTile(h[U]);if(!$||!$.hasData()||F(B,$.tileID))continue;const K=this._createProxiedId(B,$,g[B.key]&&g[B.key][o.id]),Y=this.proxyToSource[B.key][o.id];Y?Y.push(K):this.proxyToSource[B.key][o.id]=[K],x.push(K)}}}_createProxiedId(o,h,g){let x=this.orthoMatrix;if(g){const b=g.find(T=>T.key===h.tileID.key);if(b)return b}if(h.tileID.key!==o.key){const b=o.canonical.z-h.tileID.canonical.z;let T,A,M;x=d.create$1();const F=h.tileID.wrap-o.wrap<<o.overscaledZ;b>0?(T=d.EXTENT>>b,A=T*((h.tileID.canonical.x<<b)-o.canonical.x+F),M=T*((h.tileID.canonical.y<<b)-o.canonical.y)):(T=d.EXTENT<<-b,A=d.EXTENT*(h.tileID.canonical.x-(o.canonical.x+F<<-b)),M=d.EXTENT*(h.tileID.canonical.y-(o.canonical.y<<-b))),d.ortho(x,0,T,0,T,0,1),d.translate(x,x,[A,M,0])}return new fr(h.tileID,o.key,x)}_findTileCoveringTileID(o,h){let g=h.getTile(o);if(g&&g.hasData())return g;const x=this._findCoveringTileCache[h.id],b=x[o.key];if(g=b?h.getTileByID(b):null,g&&g.hasData()||null===b)return g;let T=g?g.tileID:o,A=T.overscaledZ;const M=h.getSource().minzoom,F=[];if(!b){const B=h.getSource().maxzoom;if(o.canonical.z>=B){const U=o.canonical.z-B;h.getSource().reparseOverscaled?(A=Math.max(o.canonical.z+2,h.transform.tileZoom),T=new d.OverscaledTileID(A,o.wrap,B,o.canonical.x>>U,o.canonical.y>>U)):0!==U&&(A=B,T=new d.OverscaledTileID(A,o.wrap,B,o.canonical.x>>U,o.canonical.y>>U))}T.key!==o.key&&(F.push(T.key),g=h.getTile(T))}const L=B=>{F.forEach(U=>{x[U]=B}),F.length=0};for(A-=1;A>=M&&(!g||!g.hasData());A--){g&&L(g.tileID.key);const B=T.calculateScaledKey(A);if(g=h.getTileByID(B),g&&g.hasData())break;const U=x[B];if(null===U)break;void 0===U?F.push(B):g=h.getTileByID(U)}return L(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(o){this.renderedToTile=!0}_clearRenderCacheForTile(o,h){let g=this._tilesDirty[o];g||(g=this._tilesDirty[o]={}),g[h.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const o=function(h){let g,x,b;const T=new d.StructArrayLayout2ui4,A=131;for(x=1;x<129;x++){for(g=1;g<129;g++)b=x*A+g,T.emplaceBack(b,b+1),T.emplaceBack(b,b+A),T.emplaceBack(b+1,b+A),128===x&&T.emplaceBack(b+A,b+A+1);T.emplaceBack(b+1,b+1+A)}return T}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(o),this.wireframeSegments=d.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,o.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function ps(p){const o=[];for(let h=0;h<p.length;h++){if(null===p[h])continue;const g=p[h].split(" ");o.push(g.pop())}return o}class Jt{static cacheKey(o,h,g){let x=`${o}${g?g.cacheKey:""}`;for(const b of h)x+=`/${b}`;return x}constructor(o,h,g,x,b,T){const A=o.gl;this.program=A.createProgram();const M=ps(g.staticAttributes),F=x?x.getBinderAttributes():[],L=M.concat(F),B=g.staticUniforms?ps(g.staticUniforms):[],U=x?x.getBinderUniforms():[],$=B.concat(U),K=[];for(const ge of $)K.indexOf(ge)<0&&K.push(ge);let Y=x?x.defines():[];Y=Y.concat(T.map(ge=>`#define ${ge}`));const le=Y.concat(Bl.fragmentSource,ua,dr.fragmentSource,g.fragmentSource).join("\n"),Z=Y.concat(Bl.vertexSource,ua,dr.vertexSource,Za.vertexSource,g.vertexSource).join("\n"),Q=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(Q,le),A.compileShader(Q),A.attachShader(this.program,Q);const ae=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(ae,Z),A.compileShader(ae),A.attachShader(this.program,ae),this.attributes={};const he={};this.numAttributes=L.length;for(let ge=0;ge<this.numAttributes;ge++)L[ge]&&(A.bindAttribLocation(this.program,ge,L[ge]),this.attributes[L[ge]]=ge);A.linkProgram(this.program),A.deleteShader(ae),A.deleteShader(Q);for(let ge=0;ge<K.length;ge++){const J=K[ge];if(J&&!he[J]){const we=A.getUniformLocation(this.program,J);we&&(he[J]=we)}}var ge,J;this.fixedUniforms=b(o,he),this.binderUniforms=x?x.getUniforms(o,he):[],-1!==T.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new d.Uniform1i(ge=o,(J=he).u_dem),u_dem_prev:new d.Uniform1i(ge,J.u_dem_prev),u_dem_unpack:new d.Uniform4f(ge,J.u_dem_unpack),u_dem_tl:new d.Uniform2f(ge,J.u_dem_tl),u_dem_scale:new d.Uniform1f(ge,J.u_dem_scale),u_dem_tl_prev:new d.Uniform2f(ge,J.u_dem_tl_prev),u_dem_scale_prev:new d.Uniform1f(ge,J.u_dem_scale_prev),u_dem_size:new d.Uniform1f(ge,J.u_dem_size),u_dem_lerp:new d.Uniform1f(ge,J.u_dem_lerp),u_exaggeration:new d.Uniform1f(ge,J.u_exaggeration),u_depth:new d.Uniform1i(ge,J.u_depth),u_depth_size_inv:new d.Uniform2f(ge,J.u_depth_size_inv),u_meter_to_dem:new d.Uniform1f(ge,J.u_meter_to_dem),u_label_plane_matrix_inv:new d.UniformMatrix4f(ge,J.u_label_plane_matrix_inv),u_tile_tl_up:new d.Uniform3f(ge,J.u_tile_tl_up),u_tile_tr_up:new d.Uniform3f(ge,J.u_tile_tr_up),u_tile_br_up:new d.Uniform3f(ge,J.u_tile_br_up),u_tile_bl_up:new d.Uniform3f(ge,J.u_tile_bl_up),u_tile_up_scale:new d.Uniform1f(ge,J.u_tile_up_scale)}),-1!==T.indexOf("FOG")&&(this.fogUniforms=((ge,J)=>({u_fog_matrix:new d.UniformMatrix4f(ge,J.u_fog_matrix),u_fog_range:new d.Uniform2f(ge,J.u_fog_range),u_fog_color:new d.Uniform4f(ge,J.u_fog_color),u_fog_horizon_blend:new d.Uniform1f(ge,J.u_fog_horizon_blend),u_fog_temporal_offset:new d.Uniform1f(ge,J.u_fog_temporal_offset)}))(o,he))}setTerrainUniformValues(o,h){if(!this.terrainUniforms)return;const g=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const x in h)g[x].set(h[x])}}setFogUniformValues(o,h){if(!this.fogUniforms)return;const g=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const x in h)g[x].location&&g[x].set(h[x])}}draw(o,h,g,x,b,T,A,M,F,L,B,U,$,K,Y,le){const Z=o.gl;if(this.failedToCreate)return;o.program.set(this.program),o.setDepthMode(g),o.setStencilMode(x),o.setColorMode(b),o.setCullFace(T);for(const ae in this.fixedUniforms)this.fixedUniforms[ae].set(A[ae]);K&&K.setUniforms(o,this.binderUniforms,U,{zoom:$});const Q={[Z.LINES]:2,[Z.TRIANGLES]:3,[Z.LINE_STRIP]:1}[h];for(const ae of B.get()){const he=ae.vaos||(ae.vaos={});(he[M]||(he[M]=new Gr)).bind(o,this,F,K?K.getPaintVertexBuffers():[],L,ae.vertexOffset,Y,le),Z.drawElements(h,ae.primitiveLength*Q,Z.UNSIGNED_SHORT,ae.primitiveOffset*Q*2)}}}function Wa(p,o,h){const g=1/Pt(h,1,o.transform.tileZoom),x=Math.pow(2,h.tileID.overscaledZ),b=h.tileSize*Math.pow(2,o.transform.tileZoom)/x,T=b*(h.tileID.canonical.x+h.tileID.wrap*x),A=b*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[g,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[T>>16,A>>16],u_pixel_coord_lower:[65535&T,65535&A]}}const Os=(p,o,h,g)=>{const x=o.style.light,b=x.properties.get("position"),T=[b.x,b.y,b.z],A=d.create$2();"viewport"===x.properties.get("anchor")&&(d.fromRotation(A,-o.transform.angle),d.transformMat3(T,T,A));const M=x.properties.get("color");return{u_matrix:p,u_lightpos:T,u_lightintensity:x.properties.get("intensity"),u_lightcolor:[M.r,M.g,M.b],u_vertical_gradient:+h,u_opacity:g}},$u=(p,o,h,g,x,b,T)=>d.extend(Os(p,o,h,g),Wa(b,o,T),{u_height_factor:-Math.pow(2,x.overscaledZ)/T.tileSize/8}),bo=p=>({u_matrix:p}),Or=(p,o,h,g)=>d.extend(bo(p),Wa(h,o,g)),Xa=(p,o)=>({u_matrix:p,u_world:o}),qr=(p,o,h,g,x)=>d.extend(Or(p,o,h,g),{u_world:x}),Yi=(p,o,h,g)=>{const x=p.transform;let b;if("map"===g.paint.get("circle-pitch-alignment")){const T=Pt(h,1,x.zoom);b=[T,T]}else b=x.pixelsToGLUnits;return{u_camera_to_center_distance:x.cameraToCenterDistance,u_matrix:p.translatePosMatrix(o.projMatrix,h,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_device_pixel_ratio:d.exported.devicePixelRatio,u_extrude_scale:b}},Hn=p=>{const o=[];return"map"===p.paint.get("circle-pitch-alignment")&&o.push("PITCH_WITH_MAP"),"map"===p.paint.get("circle-pitch-scale")&&o.push("SCALE_WITH_MAP"),o},jc=(p,o,h)=>{const g=d.EXTENT/h.tileSize;return{u_matrix:p,u_camera_to_center_distance:o.cameraToCenterDistance,u_extrude_scale:[o.pixelsToGLUnits[0]/g,o.pixelsToGLUnits[1]/g]}},$c=(p,o,h=1)=>({u_matrix:p,u_color:o,u_overlay:0,u_overlay_scale:h}),Ka=(p,o,h,g)=>({u_matrix:p,u_extrude_scale:Pt(o,1,h),u_intensity:g}),Ya=(p,o,h,g,x,b)=>{const T=p.transform,A={u_matrix:wo(p,o,h,x),u_ratio:1/Pt(o,1,T.zoom),u_device_pixel_ratio:d.exported.devicePixelRatio,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:b,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0};if(Hu(h)){const M=pa(o,p.transform);A.u_texsize=o.lineAtlasTexture.size,A.u_scale=[M,g.fromScale,g.toScale],A.u_mix=g.t}return A},fa=(p,o,h,g,x)=>{const b=p.transform,T=pa(o,b);return{u_matrix:wo(p,o,h,x),u_texsize:o.imageAtlasTexture.size,u_ratio:1/Pt(o,1,b.zoom),u_device_pixel_ratio:d.exported.devicePixelRatio,u_image:0,u_scale:[T,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}};function pa(p,o){return 1/Pt(p,1,o.tileZoom)}function wo(p,o,h,g){return p.translatePosMatrix(g||o.tileID.projMatrix,o,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const ti=p=>{const o=[];return Hu(p)&&o.push("RENDER_LINE_DASH"),p.paint.get("line-gradient")&&o.push("RENDER_LINE_GRADIENT"),o};function Hu(p){const o=p.paint.get("line-dasharray").value;return o.value||"constant"!==o.kind}const Ai=(p,o,h,g,x)=>{return{u_matrix:p,u_tl_parent:o,u_scale_parent:h,u_buffer_scale:1,u_fade_t:g.mix,u_opacity:g.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(T=x.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(b=x.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:Eo(x.paint.get("raster-hue-rotate"))};var b,T};function Eo(p){p*=Math.PI/180;const o=Math.sin(p),h=Math.cos(p);return[(2*h+1)/3,(-Math.sqrt(3)*o-h+1)/3,(Math.sqrt(3)*o-h+1)/3]}const Hc=(p,o,h,g,x,b,T,A,M,F)=>{const L=x.transform;return{u_is_size_zoom_constant:+("constant"===p||"source"===p),u_is_size_feature_constant:+("constant"===p||"camera"===p),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:L.cameraToCenterDistance,u_pitch:L.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:L.width/L.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:T,u_coord_matrix:A,u_is_text:+M,u_pitch_with_map:+g,u_texsize:F,u_texture:0}},Ul=(p,o,h,g,x,b,T,A,M,F,L)=>{const{cameraToCenterDistance:B,_pitch:U}=x.transform;return d.extend(Hc(p,o,h,g,x,b,T,A,M,F),{u_gamma_scale:g?B*Math.cos(x.terrain?0:U):1,u_device_pixel_ratio:d.exported.devicePixelRatio,u_is_halo:+L})},Gc=(p,o,h,g,x,b,T,A,M,F)=>d.extend(Ul(p,o,h,g,x,b,T,A,!0,M,!0),{u_texsize_icon:F,u_texture_icon:1}),Co=(p,o,h)=>({u_matrix:p,u_opacity:o,u_color:h}),Hf=(p,o,h,g,x,b)=>d.extend(function(T,A,M,F){const L=M.imageManager.getPattern(T.from.toString()),B=M.imageManager.getPattern(T.to.toString()),{width:U,height:$}=M.imageManager.getPixelSize(),K=Math.pow(2,F.tileID.overscaledZ),Y=F.tileSize*Math.pow(2,M.transform.tileZoom)/K,le=Y*(F.tileID.canonical.x+F.tileID.wrap*K),Z=Y*F.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:L.tl,u_pattern_br_a:L.br,u_pattern_tl_b:B.tl,u_pattern_br_b:B.br,u_texsize:[U,$],u_mix:A.t,u_pattern_size_a:L.displaySize,u_pattern_size_b:B.displaySize,u_scale_a:A.fromScale,u_scale_b:A.toScale,u_tile_units_to_pixels:1/Pt(F,1,M.transform.tileZoom),u_pixel_coord_upper:[le>>16,Z>>16],u_pixel_coord_lower:[65535&le,65535&Z]}}(g,b,h,x),{u_matrix:p,u_opacity:o}),ed={fillExtrusion:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_lightpos:new d.Uniform3f(p,o.u_lightpos),u_lightintensity:new d.Uniform1f(p,o.u_lightintensity),u_lightcolor:new d.Uniform3f(p,o.u_lightcolor),u_vertical_gradient:new d.Uniform1f(p,o.u_vertical_gradient),u_opacity:new d.Uniform1f(p,o.u_opacity)}),fillExtrusionPattern:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_lightpos:new d.Uniform3f(p,o.u_lightpos),u_lightintensity:new d.Uniform1f(p,o.u_lightintensity),u_lightcolor:new d.Uniform3f(p,o.u_lightcolor),u_vertical_gradient:new d.Uniform1f(p,o.u_vertical_gradient),u_height_factor:new d.Uniform1f(p,o.u_height_factor),u_image:new d.Uniform1i(p,o.u_image),u_texsize:new d.Uniform2f(p,o.u_texsize),u_pixel_coord_upper:new d.Uniform2f(p,o.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(p,o.u_pixel_coord_lower),u_scale:new d.Uniform3f(p,o.u_scale),u_fade:new d.Uniform1f(p,o.u_fade),u_opacity:new d.Uniform1f(p,o.u_opacity)}),fill:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix)}),fillPattern:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_image:new d.Uniform1i(p,o.u_image),u_texsize:new d.Uniform2f(p,o.u_texsize),u_pixel_coord_upper:new d.Uniform2f(p,o.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(p,o.u_pixel_coord_lower),u_scale:new d.Uniform3f(p,o.u_scale),u_fade:new d.Uniform1f(p,o.u_fade)}),fillOutline:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_world:new d.Uniform2f(p,o.u_world)}),fillOutlinePattern:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_world:new d.Uniform2f(p,o.u_world),u_image:new d.Uniform1i(p,o.u_image),u_texsize:new d.Uniform2f(p,o.u_texsize),u_pixel_coord_upper:new d.Uniform2f(p,o.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(p,o.u_pixel_coord_lower),u_scale:new d.Uniform3f(p,o.u_scale),u_fade:new d.Uniform1f(p,o.u_fade)}),circle:(p,o)=>({u_camera_to_center_distance:new d.Uniform1f(p,o.u_camera_to_center_distance),u_extrude_scale:new d.Uniform2f(p,o.u_extrude_scale),u_device_pixel_ratio:new d.Uniform1f(p,o.u_device_pixel_ratio),u_matrix:new d.UniformMatrix4f(p,o.u_matrix)}),collisionBox:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_camera_to_center_distance:new d.Uniform1f(p,o.u_camera_to_center_distance),u_extrude_scale:new d.Uniform2f(p,o.u_extrude_scale)}),collisionCircle:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_inv_matrix:new d.UniformMatrix4f(p,o.u_inv_matrix),u_camera_to_center_distance:new d.Uniform1f(p,o.u_camera_to_center_distance),u_viewport_size:new d.Uniform2f(p,o.u_viewport_size)}),debug:(p,o)=>({u_color:new d.UniformColor(p,o.u_color),u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_overlay:new d.Uniform1i(p,o.u_overlay),u_overlay_scale:new d.Uniform1f(p,o.u_overlay_scale)}),clippingMask:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix)}),heatmap:(p,o)=>({u_extrude_scale:new d.Uniform1f(p,o.u_extrude_scale),u_intensity:new d.Uniform1f(p,o.u_intensity),u_matrix:new d.UniformMatrix4f(p,o.u_matrix)}),heatmapTexture:(p,o)=>({u_image:new d.Uniform1i(p,o.u_image),u_color_ramp:new d.Uniform1i(p,o.u_color_ramp),u_opacity:new d.Uniform1f(p,o.u_opacity)}),hillshade:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_image:new d.Uniform1i(p,o.u_image),u_latrange:new d.Uniform2f(p,o.u_latrange),u_light:new d.Uniform2f(p,o.u_light),u_shadow:new d.UniformColor(p,o.u_shadow),u_highlight:new d.UniformColor(p,o.u_highlight),u_accent:new d.UniformColor(p,o.u_accent)}),hillshadePrepare:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_image:new d.Uniform1i(p,o.u_image),u_dimension:new d.Uniform2f(p,o.u_dimension),u_zoom:new d.Uniform1f(p,o.u_zoom),u_unpack:new d.Uniform4f(p,o.u_unpack)}),line:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_ratio:new d.Uniform1f(p,o.u_ratio),u_device_pixel_ratio:new d.Uniform1f(p,o.u_device_pixel_ratio),u_units_to_pixels:new d.Uniform2f(p,o.u_units_to_pixels),u_dash_image:new d.Uniform1i(p,o.u_dash_image),u_gradient_image:new d.Uniform1i(p,o.u_gradient_image),u_image_height:new d.Uniform1f(p,o.u_image_height),u_texsize:new d.Uniform2f(p,o.u_texsize),u_scale:new d.Uniform3f(p,o.u_scale),u_mix:new d.Uniform1f(p,o.u_mix)}),linePattern:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_texsize:new d.Uniform2f(p,o.u_texsize),u_ratio:new d.Uniform1f(p,o.u_ratio),u_device_pixel_ratio:new d.Uniform1f(p,o.u_device_pixel_ratio),u_image:new d.Uniform1i(p,o.u_image),u_units_to_pixels:new d.Uniform2f(p,o.u_units_to_pixels),u_scale:new d.Uniform3f(p,o.u_scale),u_fade:new d.Uniform1f(p,o.u_fade)}),raster:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_tl_parent:new d.Uniform2f(p,o.u_tl_parent),u_scale_parent:new d.Uniform1f(p,o.u_scale_parent),u_buffer_scale:new d.Uniform1f(p,o.u_buffer_scale),u_fade_t:new d.Uniform1f(p,o.u_fade_t),u_opacity:new d.Uniform1f(p,o.u_opacity),u_image0:new d.Uniform1i(p,o.u_image0),u_image1:new d.Uniform1i(p,o.u_image1),u_brightness_low:new d.Uniform1f(p,o.u_brightness_low),u_brightness_high:new d.Uniform1f(p,o.u_brightness_high),u_saturation_factor:new d.Uniform1f(p,o.u_saturation_factor),u_contrast_factor:new d.Uniform1f(p,o.u_contrast_factor),u_spin_weights:new d.Uniform3f(p,o.u_spin_weights)}),symbolIcon:(p,o)=>({u_is_size_zoom_constant:new d.Uniform1i(p,o.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(p,o.u_is_size_feature_constant),u_size_t:new d.Uniform1f(p,o.u_size_t),u_size:new d.Uniform1f(p,o.u_size),u_camera_to_center_distance:new d.Uniform1f(p,o.u_camera_to_center_distance),u_pitch:new d.Uniform1f(p,o.u_pitch),u_rotate_symbol:new d.Uniform1i(p,o.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(p,o.u_aspect_ratio),u_fade_change:new d.Uniform1f(p,o.u_fade_change),u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(p,o.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(p,o.u_coord_matrix),u_is_text:new d.Uniform1i(p,o.u_is_text),u_pitch_with_map:new d.Uniform1i(p,o.u_pitch_with_map),u_texsize:new d.Uniform2f(p,o.u_texsize),u_texture:new d.Uniform1i(p,o.u_texture)}),symbolSDF:(p,o)=>({u_is_size_zoom_constant:new d.Uniform1i(p,o.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(p,o.u_is_size_feature_constant),u_size_t:new d.Uniform1f(p,o.u_size_t),u_size:new d.Uniform1f(p,o.u_size),u_camera_to_center_distance:new d.Uniform1f(p,o.u_camera_to_center_distance),u_pitch:new d.Uniform1f(p,o.u_pitch),u_rotate_symbol:new d.Uniform1i(p,o.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(p,o.u_aspect_ratio),u_fade_change:new d.Uniform1f(p,o.u_fade_change),u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(p,o.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(p,o.u_coord_matrix),u_is_text:new d.Uniform1i(p,o.u_is_text),u_pitch_with_map:new d.Uniform1i(p,o.u_pitch_with_map),u_texsize:new d.Uniform2f(p,o.u_texsize),u_texture:new d.Uniform1i(p,o.u_texture),u_gamma_scale:new d.Uniform1f(p,o.u_gamma_scale),u_device_pixel_ratio:new d.Uniform1f(p,o.u_device_pixel_ratio),u_is_halo:new d.Uniform1i(p,o.u_is_halo)}),symbolTextAndIcon:(p,o)=>({u_is_size_zoom_constant:new d.Uniform1i(p,o.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(p,o.u_is_size_feature_constant),u_size_t:new d.Uniform1f(p,o.u_size_t),u_size:new d.Uniform1f(p,o.u_size),u_camera_to_center_distance:new d.Uniform1f(p,o.u_camera_to_center_distance),u_pitch:new d.Uniform1f(p,o.u_pitch),u_rotate_symbol:new d.Uniform1i(p,o.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(p,o.u_aspect_ratio),u_fade_change:new d.Uniform1f(p,o.u_fade_change),u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(p,o.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(p,o.u_coord_matrix),u_is_text:new d.Uniform1i(p,o.u_is_text),u_pitch_with_map:new d.Uniform1i(p,o.u_pitch_with_map),u_texsize:new d.Uniform2f(p,o.u_texsize),u_texsize_icon:new d.Uniform2f(p,o.u_texsize_icon),u_texture:new d.Uniform1i(p,o.u_texture),u_texture_icon:new d.Uniform1i(p,o.u_texture_icon),u_gamma_scale:new d.Uniform1f(p,o.u_gamma_scale),u_device_pixel_ratio:new d.Uniform1f(p,o.u_device_pixel_ratio),u_is_halo:new d.Uniform1i(p,o.u_is_halo)}),background:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_opacity:new d.Uniform1f(p,o.u_opacity),u_color:new d.UniformColor(p,o.u_color)}),backgroundPattern:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_opacity:new d.Uniform1f(p,o.u_opacity),u_image:new d.Uniform1i(p,o.u_image),u_pattern_tl_a:new d.Uniform2f(p,o.u_pattern_tl_a),u_pattern_br_a:new d.Uniform2f(p,o.u_pattern_br_a),u_pattern_tl_b:new d.Uniform2f(p,o.u_pattern_tl_b),u_pattern_br_b:new d.Uniform2f(p,o.u_pattern_br_b),u_texsize:new d.Uniform2f(p,o.u_texsize),u_mix:new d.Uniform1f(p,o.u_mix),u_pattern_size_a:new d.Uniform2f(p,o.u_pattern_size_a),u_pattern_size_b:new d.Uniform2f(p,o.u_pattern_size_b),u_scale_a:new d.Uniform1f(p,o.u_scale_a),u_scale_b:new d.Uniform1f(p,o.u_scale_b),u_pixel_coord_upper:new d.Uniform2f(p,o.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(p,o.u_pixel_coord_lower),u_tile_units_to_pixels:new d.Uniform1f(p,o.u_tile_units_to_pixels)}),terrainRaster:fi,terrainDepth:fi,skybox:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_sun_direction:new d.Uniform3f(p,o.u_sun_direction),u_cubemap:new d.Uniform1i(p,o.u_cubemap),u_opacity:new d.Uniform1f(p,o.u_opacity),u_temporal_offset:new d.Uniform1f(p,o.u_temporal_offset)}),skyboxGradient:(p,o)=>({u_matrix:new d.UniformMatrix4f(p,o.u_matrix),u_color_ramp:new d.Uniform1i(p,o.u_color_ramp),u_center_direction:new d.Uniform3f(p,o.u_center_direction),u_radius:new d.Uniform1f(p,o.u_radius),u_opacity:new d.Uniform1f(p,o.u_opacity),u_temporal_offset:new d.Uniform1f(p,o.u_temporal_offset)}),skyboxCapture:(p,o)=>({u_matrix_3f:new d.UniformMatrix3f(p,o.u_matrix_3f),u_sun_direction:new d.Uniform3f(p,o.u_sun_direction),u_sun_intensity:new d.Uniform1f(p,o.u_sun_intensity),u_color_tint_r:new d.Uniform4f(p,o.u_color_tint_r),u_color_tint_m:new d.Uniform4f(p,o.u_color_tint_m),u_luminance:new d.Uniform1f(p,o.u_luminance)})};let Qa;function ma(p,o,h,g,x,b,T){const A=p.context,M=A.gl,F=p.useProgram("collisionBox"),L=[];let B=0,U=0;for(let ae=0;ae<g.length;ae++){const he=g[ae],ge=o.getTile(he),J=ge.getBucket(h);if(!J)continue;let we=he.projMatrix;0===x[0]&&0===x[1]||(we=p.translatePosMatrix(he.projMatrix,ge,x,b));const $e=T?J.textCollisionBox:J.iconCollisionBox,Xe=J.collisionCircleArray;if(Xe.length>0){const ve=d.create$1(),Ne=we;d.mul$1(ve,J.placementInvProjMatrix,p.transform.glCoordMatrix),d.mul$1(ve,ve,J.placementViewportMatrix),L.push({circleArray:Xe,circleOffset:U,transform:Ne,invTransform:ve}),B+=Xe.length/4,U=B}$e&&(p.terrain&&p.terrain.setupElevationDraw(ge,F),F.draw(A,M.LINES,d.DepthMode.disabled,d.StencilMode.disabled,p.colorModeForRenderPass(),d.CullFaceMode.disabled,jc(we,p.transform,ge),h.id,$e.layoutVertexBuffer,$e.indexBuffer,$e.segments,null,p.transform.zoom,null,$e.collisionVertexBuffer,$e.collisionVertexBufferExt))}if(!T||!L.length)return;const $=p.useProgram("collisionCircle"),K=new d.StructArrayLayout2f1f2i16;K.resize(4*B),K._trim();let Y=0;for(const ae of L)for(let he=0;he<ae.circleArray.length/4;he++){const ge=4*he,J=ae.circleArray[ge+0],we=ae.circleArray[ge+1],$e=ae.circleArray[ge+2],Xe=ae.circleArray[ge+3];K.emplace(Y++,J,we,$e,Xe,0),K.emplace(Y++,J,we,$e,Xe,1),K.emplace(Y++,J,we,$e,Xe,2),K.emplace(Y++,J,we,$e,Xe,3)}(!Qa||Qa.length<2*B)&&(Qa=function(ae){const he=2*ae,ge=new d.StructArrayLayout3ui6;ge.resize(he),ge._trim();for(let J=0;J<he;J++){const we=6*J;ge.uint16[we+0]=4*J+0,ge.uint16[we+1]=4*J+1,ge.uint16[we+2]=4*J+2,ge.uint16[we+3]=4*J+2,ge.uint16[we+4]=4*J+3,ge.uint16[we+5]=4*J+0}return ge}(B));const le=A.createIndexBuffer(Qa,!0),Z=A.createVertexBuffer(K,d.collisionCircleLayout.members,!0);for(const ae of L){const he={u_matrix:ae.transform,u_inv_matrix:ae.invTransform,u_camera_to_center_distance:(Q=p.transform).cameraToCenterDistance,u_viewport_size:[Q.width,Q.height]};$.draw(A,M.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,p.colorModeForRenderPass(),d.CullFaceMode.disabled,he,h.id,Z,le,d.SegmentVector.simpleSegment(0,2*ae.circleOffset,ae.circleArray.length,ae.circleArray.length/2),null,p.transform.zoom,null,null,null)}var Q;Z.destroy(),le.destroy()}const td=d.identity(new Float32Array(16));function Gf(p,o,h,g,x,b){const{horizontalAlign:T,verticalAlign:A}=d.getAnchorAlignment(p),M=-(T-.5)*o,F=-(A-.5)*h,L=d.evaluateVariableOffset(p,g);return new d.pointGeometry((M/x+L[0])*b,(F/x+L[1])*b)}function nd(p,o,h,g,x,b,T,A,M,F,L,B){const U=p.text.placedSymbolArray,$=p.text.dynamicLayoutVertexArray,K=p.icon.dynamicLayoutVertexArray,Y={};$.clear();for(let le=0;le<U.length;le++){const Z=U.get(le),Q=p.allowVerticalPlacement&&!Z.placedOrientation,ae=Z.hidden||!Z.crossTileID||Q?null:g[Z.crossTileID];if(ae){const he=new d.pointGeometry(Z.tileAnchorX,Z.tileAnchorY),ge=B(he),J=$n(he,h?A:T,ge),we=At(b.cameraToCenterDistance,J.signedDistanceFromCamera);let $e=x.evaluateSizeForFeature(p.textSizeData,F,Z)*we/d.ONE_EM;h&&($e*=p.tilePixelRatio/M);const{width:Xe,height:ve,anchor:Ne,textOffset:mt,textScale:vt}=ae,gt=Gf(Ne,Xe,ve,mt,vt,$e),nt=h?$n(he.add(gt),T,ge).point:J.point.add(o?gt.rotate(-b.angle):gt),bt=p.allowVerticalPlacement&&Z.placedOrientation===d.WritingMode.vertical?Math.PI/2:0;for(let Xt=0;Xt<Z.numGlyphs;Xt++)d.addDynamicAttributes($,nt,bt);L&&Z.associatedIconIndex>=0&&(Y[Z.associatedIconIndex]={shiftedAnchor:nt,angle:bt})}else hs(Z.numGlyphs,$)}if(L){K.clear();const le=p.icon.placedSymbolArray;for(let Z=0;Z<le.length;Z++){const Q=le.get(Z);if(Q.hidden)hs(Q.numGlyphs,K);else{const ae=Y[Z];if(ae)for(let he=0;he<Q.numGlyphs;he++)d.addDynamicAttributes(K,ae.shiftedAnchor,ae.angle);else hs(Q.numGlyphs,K)}}p.icon.dynamicLayoutVertexBuffer.updateData(K)}p.text.dynamicLayoutVertexBuffer.updateData($)}function Ja(p,o,h){return h.iconsInText&&o?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function rd(p,o,h,g,x,b,T,A,M,F,L,B){const U=p.context,$=U.gl,K=p.transform,Y="map"===A,le="map"===M,Z=Y&&"point"!==h.layout.get("symbol-placement"),Q=Y&&!le&&!Z,ae=void 0!==h.layout.get("symbol-sort-key").constantOr(1);let he=!1;const ge=p.depthModeForSublayer(0,d.DepthMode.ReadOnly),J=h.layout.get("text-variable-anchor"),we=[],$e=p.terrain&&le?["PITCH_WITH_MAP_TERRAIN"]:null;for(const Xe of g){const ve=o.getTile(Xe),Ne=ve.getBucket(h);if(!Ne)continue;const mt=x?Ne.text:Ne.icon;if(!mt||!mt.segments.get().length)continue;const vt=mt.programConfigurations.get(h.id),gt=x||Ne.sdfIcons,nt=x?Ne.textSizeData:Ne.iconSizeData,bt=le||0!==K.pitch,Xt=p.useProgram(Ja(gt,x,Ne),vt,$e),zt=d.evaluateSizeForZoom(nt,K.zoom);let gr,Yn,Zt,nn,tr=[0,0],ao=null;if(x){if(Yn=ve.glyphAtlasTexture,Zt=$.LINEAR,gr=ve.glyphAtlasTexture.size,Ne.iconsInText){tr=ve.imageAtlasTexture.size,ao=ve.imageAtlasTexture;const ii="composite"===nt.kind||"camera"===nt.kind;nn=bt||p.options.rotating||p.options.zooming||ii?$.LINEAR:$.NEAREST}}else{const ii=1!==h.layout.get("icon-size").constantOr(0)||Ne.iconsNeedLinear;Yn=ve.imageAtlasTexture,Zt=gt||p.options.rotating||p.options.zooming||ii||bt?$.LINEAR:$.NEAREST,gr=ve.imageAtlasTexture.size}const Qo=Pt(ve,1,p.transform.zoom),zr=Qt(Xe.projMatrix,le,Y,p.transform,Qo),Zr=p.terrain&&le&&Z?d.invert(new Float32Array(16),zr):td,Jo=Ho(Xe.projMatrix,le,Y,p.transform,Qo),es=J&&Ne.hasTextData(),Vn="none"!==h.layout.get("icon-text-fit")&&es&&Ne.hasIconData();if(Z){const ii=K.elevation;Fc(Ne,Xe.projMatrix,p,x,zr,Jo,le,F,ii?zi=>ii.getAtTileOffset(Xe,zi.x,zi.y):null)}const qn=p.translatePosMatrix(Xe.projMatrix,ve,b,T),en=Z||x&&J||Vn?td:zr,or=p.translatePosMatrix(Jo,ve,b,T,!0),Wr=gt&&0!==h.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1);let Rn;Rn=gt?Ne.iconsInText?Gc(nt.kind,zt,Q,le,p,qn,en,or,gr,tr):Ul(nt.kind,zt,Q,le,p,qn,en,or,x,gr,!0):Hc(nt.kind,zt,Q,le,p,qn,en,or,x,gr);const vr={program:Xt,buffers:mt,uniformValues:Rn,atlasTexture:Yn,atlasTextureIcon:ao,atlasInterpolation:Zt,atlasInterpolationIcon:nn,isSDF:gt,hasHalo:Wr,tile:ve,labelPlaneMatrixInv:Zr};if(ae&&Ne.canOverlap){he=!0;const ii=mt.segments.get();for(const zi of ii)we.push({segments:new d.SegmentVector([zi]),sortKey:zi.sortKey,state:vr})}else we.push({segments:mt.segments,sortKey:0,state:vr})}he&&we.sort((Xe,ve)=>Xe.sortKey-ve.sortKey);for(const Xe of we){const ve=Xe.state;if(p.terrain&&p.terrain.setupElevationDraw(ve.tile,ve.program,{useDepthForOcclusion:!0,labelPlaneMatrixInv:ve.labelPlaneMatrixInv}),U.activeTexture.set($.TEXTURE0),ve.atlasTexture.bind(ve.atlasInterpolation,$.CLAMP_TO_EDGE),ve.atlasTextureIcon&&(U.activeTexture.set($.TEXTURE1),ve.atlasTextureIcon&&ve.atlasTextureIcon.bind(ve.atlasInterpolationIcon,$.CLAMP_TO_EDGE)),ve.isSDF){const Ne=ve.uniformValues;ve.hasHalo&&(Ne.u_is_halo=1,el(ve.buffers,Xe.segments,h,p,ve.program,ge,L,B,Ne)),Ne.u_is_halo=0}el(ve.buffers,Xe.segments,h,p,ve.program,ge,L,B,ve.uniformValues)}}function el(p,o,h,g,x,b,T,A,M){const F=g.context;x.draw(F,F.gl.TRIANGLES,b,T,A,d.CullFaceMode.disabled,M,h.id,p.layoutVertexBuffer,p.indexBuffer,o,h.paint,g.transform.zoom,p.programConfigurations.get(h.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function tl(p,o,h,g,x,b,T){const A=p.context.gl,M=h.paint.get("fill-pattern"),F=M&&M.constantOr(1),L=h.getCrossfadeParameters();let B,U,$,K,Y;T?(U=F&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=A.LINES):(U=F?"fillPattern":"fill",B=A.TRIANGLES);for(const le of g){const Z=o.getTile(le);if(F&&!Z.patternsLoaded())continue;const Q=Z.getBucket(h);if(!Q)continue;p.prepareDrawTile(le);const ae=Q.programConfigurations.get(h.id),he=p.useProgram(U,ae);F&&(p.context.activeTexture.set(A.TEXTURE0),Z.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),ae.updatePaintBuffers(L));const ge=M.constantOr(null);if(ge&&Z.imageAtlas){const we=Z.imageAtlas,$e=we.patternPositions[ge.to.toString()],Xe=we.patternPositions[ge.from.toString()];$e&&Xe&&ae.setConstantPatternPositions($e,Xe)}const J=p.translatePosMatrix(le.projMatrix,Z,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(T){K=Q.indexBuffer2,Y=Q.segments2;const we=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[A.drawingBufferWidth,A.drawingBufferHeight];$="fillOutlinePattern"===U&&F?qr(J,p,L,Z,we):Xa(J,we)}else K=Q.indexBuffer,Y=Q.segments,$=F?Or(J,p,L,Z):bo(J);p.prepareDrawProgram(p.context,he,le.toUnwrapped()),he.draw(p.context,B,x,p.stencilModeForClipping(le),b,d.CullFaceMode.disabled,$,h.id,Q.layoutVertexBuffer,K,Y,h.paint,p.transform.zoom,ae)}}function Gu(p,o,h,g,x,b,T){const A=p.context,M=A.gl,F=h.paint.get("fill-extrusion-pattern"),L=F.constantOr(1),B=h.getCrossfadeParameters(),U=h.paint.get("fill-extrusion-opacity");for(const $ of g){const K=o.getTile($),Y=K.getBucket(h);if(!Y)continue;const le=Y.programConfigurations.get(h.id),Z=p.useProgram(L?"fillExtrusionPattern":"fillExtrusion",le);if(p.terrain){const J=p.terrain;if(!Y.enableTerrain)continue;if(J.setupElevationDraw(K,Z,{useMeterToDem:!0}),id(A,o,$,Y,h,J),!Y.centroidVertexBuffer){const we=Z.attributes.a_centroid_pos;void 0!==we&&M.vertexAttrib2f(we,0,0)}}L&&(p.context.activeTexture.set(M.TEXTURE0),K.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),le.updatePaintBuffers(B));const Q=F.constantOr(null);if(Q&&K.imageAtlas){const J=K.imageAtlas,we=J.patternPositions[Q.to.toString()],$e=J.patternPositions[Q.from.toString()];we&&$e&&le.setConstantPatternPositions(we,$e)}const ae=p.translatePosMatrix($.projMatrix,K,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),he=h.paint.get("fill-extrusion-vertical-gradient"),ge=L?$u(ae,p,he,U,$,B,K):Os(ae,p,he,U);p.prepareDrawProgram(A,Z,$.toUnwrapped()),Z.draw(A,A.gl.TRIANGLES,x,b,T,d.CullFaceMode.backCCW,ge,h.id,Y.layoutVertexBuffer,Y.indexBuffer,Y.segments,h.paint,p.transform.zoom,le,p.terrain?Y.centroidVertexBuffer:null)}}function id(p,o,h,g,x,b){const T=[Z=>{let Q=Z.canonical.x-1,ae=Z.wrap;return Q<0&&(Q=(1<<Z.canonical.z)-1,ae--),new d.OverscaledTileID(Z.overscaledZ,ae,Z.canonical.z,Q,Z.canonical.y)},Z=>{let Q=Z.canonical.x+1,ae=Z.wrap;return Q===1<<Z.canonical.z&&(Q=0,ae++),new d.OverscaledTileID(Z.overscaledZ,ae,Z.canonical.z,Q,Z.canonical.y)},Z=>new d.OverscaledTileID(Z.overscaledZ,Z.wrap,Z.canonical.z,Z.canonical.x,(0===Z.canonical.y?1<<Z.canonical.z:Z.canonical.y)-1),Z=>new d.OverscaledTileID(Z.overscaledZ,Z.wrap,Z.canonical.z,Z.canonical.x,Z.canonical.y===(1<<Z.canonical.z)-1?0:Z.canonical.y+1)],A=Z=>{const Q=o.getSource().maxzoom,ae=we=>{const $e=o.getTileByID(we);if($e&&$e.hasData())return $e.getBucket(x)};let he,ge,J;return(Z.overscaledZ===Z.canonical.z||Z.overscaledZ>=Q)&&(he=ae(Z.key)),Z.overscaledZ>=Q&&(ge=ae(Z.calculateScaledKey(Z.overscaledZ+1))),Z.overscaledZ>Q&&(J=ae(Z.calculateScaledKey(Z.overscaledZ-1))),he||ge||J},M=[0,0,0],F=(Z,Q)=>(M[0]=Math.min(Z.min.y,Q.min.y),M[1]=Math.max(Z.max.y,Q.max.y),M[2]=d.EXTENT-Q.min.x>Z.max.x?Q.min.x-d.EXTENT:Z.max.x,M),L=(Z,Q)=>(M[0]=Math.min(Z.min.x,Q.min.x),M[1]=Math.max(Z.max.x,Q.max.x),M[2]=d.EXTENT-Q.min.y>Z.max.y?Q.min.y-d.EXTENT:Z.max.y,M),B=[(Z,Q)=>F(Z,Q),(Z,Q)=>F(Q,Z),(Z,Q)=>L(Z,Q),(Z,Q)=>L(Q,Z)],U=new d.pointGeometry(0,0);let $,K,Y;const le=(Z,Q,ae,he,ge)=>{const J=[[he?ae:Z,he?Z:ae,0],[he?ae:Q,he?Q:ae,0]],we=ge<0?d.EXTENT+ge:ge,$e=[he?we:(Z+Q)/2,he?(Z+Q)/2:we,0];return 0===ae&&ge<0||0!==ae&&ge>0?b.getForTilePoints(Y,[$e],!0,K):J.push($e),b.getForTilePoints(h,J,!0,$),Math.max(J[0][2],J[1][2],$e[2])/b.exaggeration()};for(let Z=0;Z<4;Z++){const Q=g.borders[Z];if(0===Q.length&&(g.borderDone[Z]=!0),g.borderDone[Z])continue;const ae=Y=T[Z](h),he=A(ae);if(!(he&&he.enableTerrain&&(K=b.findDEMTileFor(ae),K&&K.dem)))continue;if(!$){const $e=b.findDEMTileFor(h);if(!$e||!$e.dem)return;$=$e}const ge=(Z<2?1:5)-Z,J=he.borders[ge];let we=0;for(let $e=0;$e<Q.length;$e++){const Xe=g.featuresOnBorder[Q[$e]],ve=Xe.borders[Z];let Ne;for(;we<J.length&&(Ne=he.featuresOnBorder[J[we]],!(Ne.borders[ge][1]>ve[0]+3));)he.borderDone[ge]||he.encodeCentroid(void 0,Ne,!1),we++;if(Ne&&we<J.length){const mt=we;let vt=0;for(;!(Ne.borders[ge][0]>ve[1]-3)&&(vt++,++we!==J.length);)Ne=he.featuresOnBorder[J[we]];if(Ne=he.featuresOnBorder[J[mt]],Xe.intersectsCount()>1||Ne.intersectsCount()>1||1!==vt){1!==vt&&(we=mt),g.encodeCentroid(void 0,Xe,!1),he.borderDone[ge]||he.encodeCentroid(void 0,Ne,!1);continue}const gt=B[Z](Xe,Ne),nt=Z%2?d.EXTENT-1:0;U.x=le(gt[0],Math.min(d.EXTENT-1,gt[1]),nt,Z<2,gt[2]),U.y=0,g.encodeCentroid(U,Xe,!1),he.borderDone[ge]||he.encodeCentroid(U,Ne,!1)}else g.encodeCentroid(void 0,Xe,!1)}g.borderDone[Z]=g.needsCentroidUpdate=!0,he.borderDone[ge]||(he.borderDone[ge]=he.needsCentroidUpdate=!0)}(g.needsCentroidUpdate||!g.centroidVertexBuffer&&0!==g.centroidVertexArray.length)&&g.uploadCentroid(p)}const Mn=new d.Color(1,0,0,1),qu=new d.Color(0,1,0,1),Wm=new d.Color(0,0,1,1),qf=new d.Color(1,0,1,1),qc=new d.Color(0,1,1,1);function Zu(p,o,h,g){Wc(p,0,o+h/2,p.transform.width,h,g)}function Zc(p,o,h,g){Wc(p,o-h/2,0,h,p.transform.height,g)}function Wc(p,o,h,g,x,b){const T=p.context,A=T.gl;A.enable(A.SCISSOR_TEST),A.scissor(o*d.exported.devicePixelRatio,h*d.exported.devicePixelRatio,g*d.exported.devicePixelRatio,x*d.exported.devicePixelRatio),T.clear({color:b}),A.disable(A.SCISSOR_TEST)}function Xm(p,o,h){const g=p.context,x=g.gl,b=h.projMatrix,T=p.useProgram("debug"),A=o.getTileByID(h.key);p.terrain&&p.terrain.setupElevationDraw(A,T);const M=d.DepthMode.disabled,F=d.StencilMode.disabled,L=p.colorModeForRenderPass(),B="$debug";g.activeTexture.set(x.TEXTURE0),p.emptyTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),T.draw(g,x.LINE_STRIP,M,F,L,d.CullFaceMode.disabled,$c(b,d.Color.red),B,p.debugBuffer,p.tileBorderIndexBuffer,p.debugSegments);const U=A.latestRawTileData,$=Math.floor((U&&U.byteLength||0)/1024),K=o.getTile(h).tileSize,Y=512/Math.min(K,512)*(h.overscaledZ/p.transform.zoom)*.5;let le=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(le+=` => ${h.overscaledZ}`),function(Z,Q){Z.initDebugOverlayCanvas();const ae=Z.debugOverlayCanvas,he=Z.context.gl,ge=Z.debugOverlayCanvas.getContext("2d");ge.clearRect(0,0,ae.width,ae.height),ge.shadowColor="white",ge.shadowBlur=2,ge.lineWidth=1.5,ge.strokeStyle="white",ge.textBaseline="top",ge.font="bold 36px Open Sans, sans-serif",ge.fillText(Q,5,5),ge.strokeText(Q,5,5),Z.debugOverlayTexture.update(ae),Z.debugOverlayTexture.bind(he.LINEAR,he.CLAMP_TO_EDGE)}(p,`${le} ${$}kb`),T.draw(g,x.TRIANGLES,M,F,d.ColorMode.alphaBlended,d.CullFaceMode.disabled,$c(b,d.Color.transparent,Y),B,p.debugBuffer,p.quadTriangleIndexBuffer,p.debugSegments)}const od=d.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Xo}=od;function so(p,o,h,g){p.emplaceBack(o,h,g)}class Lr{constructor(o){this.vertexArray=new d.StructArrayLayout3f12,this.indices=new d.StructArrayLayout3ui6,so(this.vertexArray,-1,-1,1),so(this.vertexArray,1,-1,1),so(this.vertexArray,-1,1,1),so(this.vertexArray,1,1,1),so(this.vertexArray,-1,-1,-1),so(this.vertexArray,1,-1,-1),so(this.vertexArray,-1,1,-1),so(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,Xo),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=d.SegmentVector.simpleSegment(0,0,36,12)}}function ms(p,o,h,g,x,b){const T=p.gl,A=o.paint.get("sky-atmosphere-color"),M=o.paint.get("sky-atmosphere-halo-color"),F=o.paint.get("sky-atmosphere-sun-intensity"),L={u_matrix_3f:d.fromMat4([],g),u_sun_direction:x,u_sun_intensity:F,u_color_tint_r:[(K=A).r,K.g,K.b,K.a],u_color_tint_m:[(Y=M).r,Y.g,Y.b,Y.a],u_luminance:5e-5};var K,Y;T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+b,o.skyboxTexture,0),h.draw(p,T.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,d.ColorMode.unblended,d.CullFaceMode.frontCW,L,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}const Wu={symbol:function(p,o,h,g,x){if("translucent"!==p.renderPass)return;const b=d.StencilMode.disabled,T=p.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(A,M,F,L,B,U,$){const K=M.transform,Y="map"===B,le="map"===U;for(const Z of A){const Q=L.getTile(Z),ae=Q.getBucket(F);if(!ae||!ae.text||!ae.text.segments.get().length)continue;const he=d.evaluateSizeForZoom(ae.textSizeData,K.zoom),ge=Pt(Q,1,M.transform.zoom),J=Qt(Z.projMatrix,le,Y,M.transform,ge),we="none"!==F.layout.get("icon-text-fit")&&ae.hasIconData();if(he){const $e=Math.pow(2,K.zoom-Q.tileID.overscaledZ),Xe=K.elevation;nd(ae,Y,le,$,d.symbolSize,K,J,Z.projMatrix,$e,he,we,Xe?ve=>Xe.getAtTileOffset(Z,ve.x,ve.y):ve=>0)}}}(g,p,h,o,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),x),0!==h.paint.get("icon-opacity").constantOr(1)&&rd(p,o,h,g,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),b,T),0!==h.paint.get("text-opacity").constantOr(1)&&rd(p,o,h,g,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),b,T),o.map.showCollisionBoxes&&(ma(p,o,h,g,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),ma(p,o,h,g,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(p,o,h,g){if("translucent"!==p.renderPass)return;const x=h.paint.get("circle-opacity"),b=h.paint.get("circle-stroke-width"),T=h.paint.get("circle-stroke-opacity"),A=void 0!==h.layout.get("circle-sort-key").constantOr(1);if(0===x.constantOr(1)&&(0===b.constantOr(1)||0===T.constantOr(1)))return;const M=p.context,F=M.gl,L=p.depthModeForSublayer(0,d.DepthMode.ReadOnly),B=d.StencilMode.disabled,U=p.colorModeForRenderPass(),$=[];for(let K=0;K<g.length;K++){const Y=g[K],le=o.getTile(Y),Z=le.getBucket(h);if(!Z)continue;const Q=Z.programConfigurations.get(h.id),ae=Hn(h),he={programConfiguration:Q,program:p.useProgram("circle",Q,ae),layoutVertexBuffer:Z.layoutVertexBuffer,indexBuffer:Z.indexBuffer,uniformValues:Yi(p,Y,le,h),tile:le};if(A){const ge=Z.segments.get();for(const J of ge)$.push({segments:new d.SegmentVector([J]),sortKey:J.sortKey,state:he})}else $.push({segments:Z.segments,sortKey:0,state:he})}A&&$.sort((K,Y)=>K.sortKey-Y.sortKey);for(const K of $){const{programConfiguration:Y,program:le,layoutVertexBuffer:Z,indexBuffer:Q,uniformValues:ae,tile:he}=K.state,ge=K.segments;p.terrain&&p.terrain.setupElevationDraw(he,le,{useDepthForOcclusion:!0}),p.prepareDrawProgram(M,le,he.tileID.toUnwrapped()),le.draw(M,F.TRIANGLES,L,B,U,d.CullFaceMode.disabled,ae,h.id,Z,Q,ge,h.paint,p.transform.zoom,Y)}},heatmap:function(p,o,h,g){if(0!==h.paint.get("heatmap-opacity"))if("offscreen"===p.renderPass){const x=p.context,b=x.gl,T=d.StencilMode.disabled,A=new d.ColorMode([b.ONE,b.ONE],d.Color.transparent,[!0,!0,!0,!0]);(function(M,F,L){const B=M.gl;M.activeTexture.set(B.TEXTURE1),M.viewport.set([0,0,F.width/4,F.height/4]);let U=L.heatmapFbo;if(U)B.bindTexture(B.TEXTURE_2D,U.colorAttachment.get()),M.bindFramebuffer.set(U.framebuffer);else{const $=B.createTexture();B.bindTexture(B.TEXTURE_2D,$),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MIN_FILTER,B.LINEAR),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MAG_FILTER,B.LINEAR),U=L.heatmapFbo=M.createFramebuffer(F.width/4,F.height/4,!1),function(K,Y,le,Z){const Q=K.gl;Q.texImage2D(Q.TEXTURE_2D,0,Q.RGBA,Y.width/4,Y.height/4,0,Q.RGBA,K.extRenderToTextureHalfFloat?K.extTextureHalfFloat.HALF_FLOAT_OES:Q.UNSIGNED_BYTE,null),Z.colorAttachment.set(le)}(M,F,$,U)}})(x,p,h),x.clear({color:d.Color.transparent});for(let M=0;M<g.length;M++){const F=g[M];if(o.hasRenderableParent(F))continue;const L=o.getTile(F),B=L.getBucket(h);if(!B)continue;const U=B.programConfigurations.get(h.id),$=p.useProgram("heatmap",U),{zoom:K}=p.transform;p.terrain&&p.terrain.setupElevationDraw(L,$),p.prepareDrawProgram(x,$,F.toUnwrapped()),$.draw(x,b.TRIANGLES,d.DepthMode.disabled,T,A,d.CullFaceMode.disabled,Ka(F.projMatrix,L,K,h.paint.get("heatmap-intensity")),h.id,B.layoutVertexBuffer,B.indexBuffer,B.segments,h.paint,p.transform.zoom,U)}x.viewport.set([0,0,p.width,p.height])}else"translucent"===p.renderPass&&(p.context.setColorMode(p.colorModeForRenderPass()),function(x,b){const T=x.context,A=T.gl,M=b.heatmapFbo;if(!M)return;T.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,M.colorAttachment.get()),T.activeTexture.set(A.TEXTURE1);let F=b.colorRampTexture;F||(F=b.colorRampTexture=new d.Texture(T,b.colorRamp,A.RGBA)),F.bind(A.LINEAR,A.CLAMP_TO_EDGE),x.useProgram("heatmapTexture").draw(T,A.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,x.colorModeForRenderPass(),d.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:b.paint.get("heatmap-opacity")},b.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,b.paint,x.transform.zoom)}(p,h))},line:function(p,o,h,g){if("translucent"!==p.renderPass)return;const x=h.paint.get("line-opacity"),b=h.paint.get("line-width");if(0===x.constantOr(1)||0===b.constantOr(1))return;const T=p.depthModeForSublayer(0,d.DepthMode.ReadOnly),A=p.colorModeForRenderPass(),M=h.paint.get("line-dasharray"),F=M.constantOr(1),L=h.layout.get("line-cap"),B=h.paint.get("line-pattern"),U=B.constantOr(1),$=h.paint.get("line-gradient"),K=h.getCrossfadeParameters(),Y=U?"linePattern":"line",le=p.context,Z=le.gl;for(const Q of g){const ae=o.getTile(Q);if(U&&!ae.patternsLoaded())continue;const he=ae.getBucket(h);if(!he)continue;p.prepareDrawTile(Q);const ge=he.programConfigurations.get(h.id),J=ti(h),we=p.useProgram(Y,ge,J),$e=B.constantOr(null);if($e&&ae.imageAtlas){const vt=ae.imageAtlas,gt=vt.patternPositions[$e.to.toString()],nt=vt.patternPositions[$e.from.toString()];gt&&nt&&ge.setConstantPatternPositions(gt,nt)}const Xe=M.constantOr(null),ve=L.constantOr(null);if(!U&&Xe&&ve&&ae.lineAtlas){const vt=ae.lineAtlas,gt=vt.getDash(Xe.to,ve),nt=vt.getDash(Xe.from,ve);gt&&nt&&ge.setConstantPatternPositions(gt,nt)}const Ne=p.terrain?Q.projMatrix:null,mt=U?fa(p,ae,h,K,Ne):Ya(p,ae,h,K,Ne,he.lineClipsArray.length);if($){const vt=he.gradients[h.id];let gt=vt.texture;if(h.gradientVersion!==vt.version){let nt=256;if(h.stepInterpolant){const bt=o.getSource().maxzoom,Xt=Q.canonical.z===bt?Math.ceil(1<<p.transform.maxZoom-Q.canonical.z):1;nt=d.clamp(d.nextPowerOfTwo(he.maxLineLength/d.EXTENT*1024*Xt),256,le.maxTextureSize)}vt.gradient=d.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:nt,image:vt.gradient||void 0,clips:he.lineClipsArray}),vt.texture?vt.texture.update(vt.gradient):vt.texture=new d.Texture(le,vt.gradient,Z.RGBA),vt.version=h.gradientVersion,gt=vt.texture}le.activeTexture.set(Z.TEXTURE1),gt.bind(h.stepInterpolant?Z.NEAREST:Z.LINEAR,Z.CLAMP_TO_EDGE)}F&&(le.activeTexture.set(Z.TEXTURE0),ae.lineAtlasTexture.bind(Z.LINEAR,Z.REPEAT),ge.updatePaintBuffers(K)),U&&(le.activeTexture.set(Z.TEXTURE0),ae.imageAtlasTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),ge.updatePaintBuffers(K)),p.prepareDrawProgram(le,we,Q.toUnwrapped()),we.draw(le,Z.TRIANGLES,T,p.stencilModeForClipping(Q),A,d.CullFaceMode.disabled,mt,h.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,h.paint,p.transform.zoom,ge,he.layoutVertexBuffer2)}},fill:function(p,o,h,g){const x=h.paint.get("fill-color"),b=h.paint.get("fill-opacity");if(0===b.constantOr(1))return;const T=p.colorModeForRenderPass(),A=h.paint.get("fill-pattern"),M=p.opaquePassEnabledForLayer()&&!A.constantOr(1)&&1===x.constantOr(d.Color.transparent).a&&1===b.constantOr(0)?"opaque":"translucent";if(p.renderPass===M){const F=p.depthModeForSublayer(1,"opaque"===p.renderPass?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly);tl(p,o,h,g,F,T,!1)}if("translucent"===p.renderPass&&h.paint.get("fill-antialias")){const F=p.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,d.DepthMode.ReadOnly);tl(p,o,h,g,F,T,!0)}},"fill-extrusion":function(p,o,h,g){const x=h.paint.get("fill-extrusion-opacity");if(0!==x&&"translucent"===p.renderPass){const b=new d.DepthMode(p.context.gl.LEQUAL,d.DepthMode.ReadWrite,p.depthRangeFor3D);if(1!==x||h.paint.get("fill-extrusion-pattern").constantOr(1))Gu(p,o,h,g,b,d.StencilMode.disabled,d.ColorMode.disabled),Gu(p,o,h,g,b,p.stencilModeFor3D(),p.colorModeForRenderPass());else{const T=p.colorModeForRenderPass();Gu(p,o,h,g,b,d.StencilMode.disabled,T)}}},hillshade:function(p,o,h,g){if("offscreen"!==p.renderPass&&"translucent"!==p.renderPass)return;const x=p.context,b=p.depthModeForSublayer(0,d.DepthMode.ReadOnly),T=p.colorModeForRenderPass(),A=p.terrain&&p.terrain.renderingToTexture,[M,F]="translucent"!==p.renderPass||A?[{},g]:p.stencilConfigForOverlap(g);for(const L of F){const B=o.getTile(L);if(B.needsHillshadePrepare&&"offscreen"===p.renderPass)Dn(p,B,h,b,d.StencilMode.disabled,T);else if("translucent"===p.renderPass){const U=A&&p.terrain?p.terrain.stencilModeForRTTOverlap(L):M[L.overscaledZ];Zo(p,L,B,h,b,U,T)}}x.viewport.set([0,0,p.width,p.height])},raster:function(p,o,h,g,x,b){if("translucent"!==p.renderPass||0===h.paint.get("raster-opacity")||!g.length)return;const T=p.context,A=T.gl,M=o.getSource(),F=p.useProgram("raster"),L=p.colorModeForRenderPass(),B=p.terrain&&p.terrain.renderingToTexture,[U,$]=M instanceof X||B?[{},g]:p.stencilConfigForOverlap(g),K=$[$.length-1].overscaledZ,Y=!p.options.moving;for(const le of $){const Z=B?d.DepthMode.disabled:p.depthModeForSublayer(le.overscaledZ-K,1===h.paint.get("raster-opacity")?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly,A.LESS),Q=le.toUnwrapped(),ae=o.getTile(le);if(B&&(!ae||!ae.hasData()))continue;const he=B?le.projMatrix:p.transform.calculateProjMatrix(Q,Y),ge=p.terrain&&B?p.terrain.stencilModeForRTTOverlap(le):U[le.overscaledZ],J=b?0:h.paint.get("raster-fade-duration");ae.registerFadeDuration(J);const we=o.findLoadedParent(le,0),$e=Fr(ae,we,o,p.transform,J);let Xe,ve;p.terrain&&p.terrain.prepareDrawTile(le);const Ne="nearest"===h.paint.get("raster-resampling")?A.NEAREST:A.LINEAR;T.activeTexture.set(A.TEXTURE0),ae.texture.bind(Ne,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),T.activeTexture.set(A.TEXTURE1),we?(we.texture.bind(Ne,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),Xe=Math.pow(2,we.tileID.overscaledZ-ae.tileID.overscaledZ),ve=[ae.tileID.canonical.x*Xe%1,ae.tileID.canonical.y*Xe%1]):ae.texture.bind(Ne,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST);const mt=Ai(he,ve||[0,0],Xe||1,$e,h);p.prepareDrawProgram(T,F,Q),M instanceof X?F.draw(T,A.TRIANGLES,Z,d.StencilMode.disabled,L,d.CullFaceMode.disabled,mt,h.id,M.boundsBuffer,p.quadTriangleIndexBuffer,M.boundsSegments):F.draw(T,A.TRIANGLES,Z,ge,L,d.CullFaceMode.disabled,mt,h.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}},background:function(p,o,h,g){const x=h.paint.get("background-color"),b=h.paint.get("background-opacity");if(0===b)return;const T=p.context,A=T.gl,M=p.transform,F=M.tileSize,L=h.paint.get("background-pattern");if(p.isPatternMissing(L))return;const B=!L&&1===x.a&&1===b&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==B)return;const U=d.StencilMode.disabled,$=p.depthModeForSublayer(0,"opaque"===B?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly),K=p.colorModeForRenderPass(),Y=p.useProgram(L?"backgroundPattern":"background"),le=g||M.coveringTiles({tileSize:F});L&&(T.activeTexture.set(A.TEXTURE0),p.imageManager.bind(p.context));const Z=h.getCrossfadeParameters();for(const Q of le){const ae=Q.toUnwrapped(),he=g?Q.projMatrix:p.transform.calculateProjMatrix(ae);p.prepareDrawTile(Q);const ge=L?Hf(he,b,p,L,{tileID:Q,tileSize:F},Z):Co(he,b,x);p.prepareDrawProgram(T,Y,ae),Y.draw(T,A.TRIANGLES,$,U,K,d.CullFaceMode.disabled,ge,h.id,p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}},sky:function(p,o,h){const g=h.paint.get("sky-opacity");if(0===g)return;const x=p.context,b=h.paint.get("sky-type"),T=new d.DepthMode(x.gl.LEQUAL,d.DepthMode.ReadOnly,[0,1]),A=p.frameCounter/1e3%1;"atmosphere"===b?"offscreen"===p.renderPass?h.needsSkyboxCapture(p)&&(function(M,F,L,B){const U=M.context,$=U.gl;let K=F.skyboxFbo;if(!K){K=F.skyboxFbo=U.createFramebuffer(32,32,!1),F.skyboxGeometry=new Lr(U),F.skyboxTexture=U.gl.createTexture(),$.bindTexture($.TEXTURE_CUBE_MAP,F.skyboxTexture),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_MIN_FILTER,$.LINEAR),$.texParameteri($.TEXTURE_CUBE_MAP,$.TEXTURE_MAG_FILTER,$.LINEAR);for(let Q=0;Q<6;++Q)$.texImage2D($.TEXTURE_CUBE_MAP_POSITIVE_X+Q,0,$.RGBA,32,32,0,$.RGBA,$.UNSIGNED_BYTE,null)}U.bindFramebuffer.set(K.framebuffer),U.viewport.set([0,0,32,32]);const Y=F.getCenter(M,!0),le=M.useProgram("skyboxCapture"),Z=new Float64Array(16);d.identity(Z),d.rotateY(Z,Z,.5*-Math.PI),ms(U,F,le,Z,Y,0),d.identity(Z),d.rotateY(Z,Z,.5*Math.PI),ms(U,F,le,Z,Y,1),d.identity(Z),d.rotateX(Z,Z,.5*-Math.PI),ms(U,F,le,Z,Y,2),d.identity(Z),d.rotateX(Z,Z,.5*Math.PI),ms(U,F,le,Z,Y,3),d.identity(Z),ms(U,F,le,Z,Y,4),d.identity(Z),d.rotateY(Z,Z,Math.PI),ms(U,F,le,Z,Y,5),U.viewport.set([0,0,M.width,M.height])}(p,h),h.markSkyboxValid(p)):"sky"===p.renderPass&&function(M,F,L,B,U){const $=M.context,K=$.gl,Y=M.transform,le=M.useProgram("skybox");$.activeTexture.set(K.TEXTURE0),K.bindTexture(K.TEXTURE_CUBE_MAP,F.skyboxTexture);const Z={u_matrix:Y.skyboxMatrix,u_sun_direction:F.getCenter(M,!1),u_cubemap:0,u_opacity:B,u_temporal_offset:U};M.prepareDrawProgram($,le),le.draw($,K.TRIANGLES,L,d.StencilMode.disabled,M.colorModeForRenderPass(),d.CullFaceMode.backCW,Z,"skybox",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(p,h,T,g,A):"gradient"===b&&"sky"===p.renderPass&&function(M,F,L,B,U){const $=M.context,K=$.gl,Y=M.transform,le=M.useProgram("skyboxGradient");F.skyboxGeometry||(F.skyboxGeometry=new Lr($)),$.activeTexture.set(K.TEXTURE0);let Z=F.colorRampTexture;Z||(Z=F.colorRampTexture=new d.Texture($,F.colorRamp,K.RGBA)),Z.bind(K.LINEAR,K.CLAMP_TO_EDGE);const Q=(ae=Y.skyboxMatrix,he=F.getCenter(M,!1),ge=F.paint.get("sky-gradient-radius"),J=B,we=U,{u_matrix:ae,u_color_ramp:0,u_center_direction:he,u_radius:d.degToRad(ge),u_opacity:J,u_temporal_offset:we});var ae,he,ge,J,we;M.prepareDrawProgram($,le),le.draw($,K.TRIANGLES,L,d.StencilMode.disabled,M.colorModeForRenderPass(),d.CullFaceMode.backCW,Q,"skyboxGradient",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(p,h,T,g,A)},debug:function(p,o,h){for(let g=0;g<h.length;g++)Xm(p,o,h[g])},custom:function(p,o,h){const g=p.context,x=h.implementation;if("offscreen"===p.renderPass){const b=x.prerender;b&&(p.setCustomLayerDefaults(),g.setColorMode(p.colorModeForRenderPass()),b.call(x,g.gl,p.transform.customLayerMatrix()),g.setDirty(),p.setBaseState())}else if("translucent"===p.renderPass){p.setCustomLayerDefaults(),g.setColorMode(p.colorModeForRenderPass()),g.setStencilMode(d.StencilMode.disabled);const b="3d"===x.renderingMode?new d.DepthMode(p.context.gl.LEQUAL,d.DepthMode.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,d.DepthMode.ReadOnly);g.setDepthMode(b),x.render(g.gl,p.transform.customLayerMatrix()),g.setDirty(),p.setBaseState(),g.bindFramebuffer.set(null)}}};class Xc{constructor(o,h){this.context=new mn(o),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=d.SourceCache.maxUnderzooming+d.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ju,this.gpuTimers={},this.frameCounter=0}updateTerrain(o,h){const g=!!o&&!!o.terrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new da(this,o));const x=this._terrain;this.transform.elevation=g?x:null,x.update(o,this.transform,h)}_updateFog(o){const h=o.fog;if(!h||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[g,x]=h.getFovAdjustedRange(this.transform._fov);if(g>x)return void(this.transform.fogCullDistSq=null);const b=g+.78*(x-g);this.transform.fogCullDistSq=b*b}get terrain(){return this._terrain&&this._terrain.enabled?this._terrain:null}resize(o,h){if(this.width=o*d.exported.devicePixelRatio,this.height=h*d.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style.order)this.style._layers[g].resize()}setup(){const o=this.context,h=new d.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(d.EXTENT,0),h.emplaceBack(0,d.EXTENT),h.emplaceBack(d.EXTENT,d.EXTENT),this.tileExtentBuffer=o.createVertexBuffer(h,d.posAttributes.members),this.tileExtentSegments=d.SegmentVector.simpleSegment(0,0,4,2);const g=new d.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(d.EXTENT,0),g.emplaceBack(0,d.EXTENT),g.emplaceBack(d.EXTENT,d.EXTENT),this.debugBuffer=o.createVertexBuffer(g,d.posAttributes.members),this.debugSegments=d.SegmentVector.simpleSegment(0,0,4,5);const x=new d.StructArrayLayout4i8;x.emplaceBack(0,0,0,0),x.emplaceBack(d.EXTENT,0,d.EXTENT,0),x.emplaceBack(0,d.EXTENT,0,d.EXTENT),x.emplaceBack(d.EXTENT,d.EXTENT,d.EXTENT,d.EXTENT),this.rasterBoundsBuffer=o.createVertexBuffer(x,oo.members),this.rasterBoundsSegments=d.SegmentVector.simpleSegment(0,0,4,2);const b=new d.StructArrayLayout2i4;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(-1,1),b.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(b,d.posAttributes.members),this.viewportSegments=d.SegmentVector.simpleSegment(0,0,4,2);const T=new d.StructArrayLayout1ui2;T.emplaceBack(0),T.emplaceBack(1),T.emplaceBack(3),T.emplaceBack(2),T.emplaceBack(0),this.tileBorderIndexBuffer=o.createIndexBuffer(T);const A=new d.StructArrayLayout3ui6;A.emplaceBack(0,1,2),A.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(A),this.emptyTexture=new d.Texture(o,{width:1,height:1,data:new Uint8Array([0,0,0,0])},o.gl.RGBA),this.identityMat=d.create$1();const M=this.context.gl;this.stencilClearMode=new d.StencilMode({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO),this.loadTimeStamps.push(d.window.performance.now())}clearStencil(){const o=this.context,h=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this.useProgram("clippingMask").draw(o,h.TRIANGLES,d.DepthMode.disabled,this.stencilClearMode,d.ColorMode.disabled,d.CullFaceMode.disabled,Wo(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(o,h,g){if(!(h&&this.currentStencilSource!==h.id&&o.isTileClipped()&&g&&g.length))return;this.currentStencilSource=h.id;const x=this.context,b=x.gl;this.nextStencilID+g.length>256&&this.clearStencil(),x.setColorMode(d.ColorMode.disabled),x.setDepthMode(d.DepthMode.disabled);const T=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of g){const M=this._tileClippingMaskIDs[A.key]=this.nextStencilID++;T.draw(x,b.TRIANGLES,d.DepthMode.disabled,new d.StencilMode({func:b.ALWAYS,mask:0},M,255,b.KEEP,b.KEEP,b.REPLACE),d.ColorMode.disabled,d.CullFaceMode.disabled,Wo(A.projMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,h=this.context.gl;return new d.StencilMode({func:h.NOTEQUAL,mask:255},o,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);const h=this.context.gl;return new d.StencilMode({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(o){const h=this.context.gl,g=o.sort((T,A)=>A.overscaledZ-T.overscaledZ),x=g[g.length-1].overscaledZ,b=g[0].overscaledZ-x+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const T={};for(let A=0;A<b;A++)T[A+x]=new d.StencilMode({func:h.GEQUAL,mask:255},A+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=b,[T,g]}return[{[x]:d.StencilMode.disabled},g]}colorModeForRenderPass(){const o=this.context.gl;if(this._showOverdrawInspector){const h=1/8;return new d.ColorMode([o.CONSTANT_COLOR,o.ONE],new d.Color(h,h,h,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?d.ColorMode.unblended:d.ColorMode.alphaBlended}depthModeForSublayer(o,h,g){if(!this.opaquePassEnabledForLayer())return d.DepthMode.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new d.DepthMode(g||this.context.gl.LEQUAL,h,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,h){this.style=o,this.options=h,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(d.exported.now()),this.imageManager.beginFrame();const g=this.style.order,x=this.style._sourceCaches;for(const F in x){const L=x[F];L.used&&L.prepare(this.context)}const b={},T={},A={};for(const F in x){const L=x[F];b[F]=L.getVisibleCoordinates(),T[F]=b[F].slice().reverse(),A[F]=L.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let F=0;F<g.length;F++)if(this.style._layers[g[F]].is3D()){this.opaquePassCutoff=F;break}if(this.terrain&&(this.terrain.updateTileBinding(A),this.opaquePassCutoff=0),!d.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const F of g){const L=this.style._layers[F],B=o._getLayerSourceCache(L);if(!L.hasOffscreenPass()||L.isHidden(this.transform.zoom))continue;const U=B?T[B.id]:void 0;("custom"===L.type||L.isSky()||U&&U.length)&&this.renderLayer(this,B,L,U)}this.depthRangeFor3D=[0,1-(o.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let M=d.Color.transparent;if(this.style.fog&&(M=this.style.fog.properties.get("color")),this.context.clear({color:h.showOverdrawInspector?d.Color.black:M,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){const F=this.style._layers[g[this.currentLayer]],L=o._getLayerSourceCache(F);if(F.isSky())continue;const B=L?T[L.id]:void 0;this._renderTileClippingMasks(F,L,B),this.renderLayer(this,L,F,B)}if(this.renderPass="sky",this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){const F=this.style._layers[g[this.currentLayer]],L=o._getLayerSourceCache(F);F.isSky()&&this.renderLayer(this,L,F,L?T[L.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;){const F=this.style._layers[g[this.currentLayer]],L=o._getLayerSourceCache(F);if(F.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(F)){if(F.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const B=L?("symbol"===F.type?A:T)[L.id]:void 0;this._renderTileClippingMasks(F,L,L?b[L.id]:void 0),this.renderLayer(this,L,F,B),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let F=null;d.values(this.style._layers).forEach(L=>{const B=o._getLayerSourceCache(L);B&&!L.isHidden(this.transform.zoom)&&(!F||F.getSource().maxzoom<B.getSource().maxzoom)&&(F=B)}),F&&this.options.showTileBoundaries&&Wu.debug(this,F,F.getVisibleCoordinates())}this.options.showPadding&&function(F){const L=F.transform.padding;Zu(F,F.transform.height-(L.top||0),3,Mn),Zu(F,L.bottom||0,3,qu),Zc(F,L.left||0,3,Wm),Zc(F,F.transform.width-(L.right||0),3,qf);const B=F.transform.centerPoint;var U,$,K,Y;Wc(U=F,($=B.x)-1,(K=F.transform.height-B.y)-10,2,20,Y=qc),Wc(U,$-10,K-1,20,2,Y)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%d.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(d.window.performance.now()),this.saveCanvasCopy())}renderLayer(o,h,g,x){g.isHidden(this.transform.zoom)||("background"===g.type||"sky"===g.type||"custom"===g.type||x&&x.length)&&(this.id=g.id,this.gpuTimingStart(g),Wu[g.type](o,h,g,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let g=this.gpuTimers[o.id];g||(g=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),g.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,g.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}queryGpuTimers(o){const h={};for(const g in o){const x=o[g],b=this.context.extTimerQuery,T=b.getQueryObjectEXT(x.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(x.query),h[g]=T}return h}translatePosMatrix(o,h,g,x,b){if(!g[0]&&!g[1])return o;const T=b?"map"===x?this.transform.angle:0:"viewport"===x?-this.transform.angle:0;if(T){const F=Math.sin(T),L=Math.cos(T);g=[g[0]*L-g[1]*F,g[0]*F+g[1]*L]}const A=[b?g[0]:Pt(h,g[0],this.transform.zoom),b?g[1]:Pt(h,g[1],this.transform.zoom),0],M=new Float32Array(16);return d.translate(M,o,A),M}saveTileTexture(o){const h=this._tileTextures[o.size[0]];h?h.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const h=this._tileTextures[o];return h&&h.length>0?h.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const h=this.imageManager.getPattern(o.from.toString()),g=this.imageManager.getPattern(o.to.toString());return!h||!g}currentGlobalDefines(){const o=this.terrain&&this.terrain.renderingToTexture,h=this.style&&this.style.fog,g=[];return this.terrain&&!this.terrain.renderingToTexture&&g.push("TERRAIN"),h&&!o&&0!==h.getOpacity(this.transform.pitch)&&g.push("FOG"),o&&g.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&g.push("OVERDRAW_INSPECTOR"),g}useProgram(o,h,g){this.cache=this.cache||{};const x=g||[],b=this.currentGlobalDefines().concat(x),T=Jt.cacheKey(o,b,h);return this.cache[T]||(this.cache[T]=new Jt(this.context,o,Ut[o],h,ed[o],b)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=d.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new d.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(o){this.terrain&&this.terrain.prepareDrawTile(o)}prepareDrawProgram(o,h,g){if(this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const b=x.getOpacity(this.transform.pitch);0!==b&&h.setFogUniformValues(o,((T,A,M,F)=>{const L=A.properties.get("color"),B=T.frameCounter/1e3%1,U=[L.r/L.a,L.g/L.a,L.b/L.a,F];return{u_fog_matrix:M?T.transform.calculateFogTileMatrix(M):T.identityMat,u_fog_range:A.getFovAdjustedRange(T.transform._fov),u_fog_color:U,u_fog_horizon_blend:A.properties.get("horizon-blend"),u_fog_temporal_offset:B}})(this,x,g,b))}}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const o=this.context.gl,h=o.createTexture();return o.bindTexture(o.TEXTURE_2D,h),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const o=this.style&&this.style.fog;return!!o&&0!==o.getOpacity(this.transform.pitch)}}class ga{constructor(o=0,h=0,g=0,x=0){if(isNaN(o)||o<0||isNaN(h)||h<0||isNaN(g)||g<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=h,this.left=g,this.right=x}interpolate(o,h,g){return null!=h.top&&null!=o.top&&(this.top=d.number(o.top,h.top,g)),null!=h.bottom&&null!=o.bottom&&(this.bottom=d.number(o.bottom,h.bottom,g)),null!=h.left&&null!=o.left&&(this.left=d.number(o.left,h.left,g)),null!=h.right&&null!=o.right&&(this.right=d.number(o.right,h.right,g)),this}getCenter(o,h){const g=d.clamp((this.left+o-this.right)/2,0,o),x=d.clamp((this.top+h-this.bottom)/2,0,h);return new d.pointGeometry(g,x)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new ga(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function pi(p,o){return[p[4*o],p[4*o+1],p[4*o+2],p[4*o+3]]}function Xu(p,o,h){p[4*o+0]=h[0],p[4*o+1]=h[1],p[4*o+2]=h[2],p[4*o+3]=h[3]}function nl(p,o){const h=pi(p,3);d.fromQuat(p,o),Xu(p,3,h)}function Ku(p,o){Xu(p,3,[o[0],o[1],o[2],1])}function Nr(p,o){const h=d.identity$1([]);return d.rotateZ$1(h,h,-o),d.rotateX$1(h,h,-p),h}function _a(p,o){const h=[p[0],p[1],0],g=[o[0],o[1],0];if(d.length(h)>=1e-15){const T=d.normalize([],h);d.scale(g,T,d.dot(g,T)),o[0]=g[0],o[1]=g[1]}const x=d.cross([],o,p);if(d.len(x)<1e-15)return null;const b=Math.atan2(-x[1],x[0]);return Nr(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),b)}class jl{constructor(o,h){this.position=o,this.orientation=h}get position(){return this._position}set position(o){this._position=this._renderWorldCopies?function(h){if(!h)return;const g=Array.isArray(h)?new d.MercatorCoordinate(h[0],h[1],h[2]):h;return g.x=d.wrap(g.x,0,1),g}(o):o}lookAtPoint(o,h){if(this.orientation=null,!this.position)return;const g=this._elevation?this._elevation.getAtPointOrZero(d.MercatorCoordinate.fromLngLat(o)):0,x=this.position,b=d.MercatorCoordinate.fromLngLat(o,g),T=[b.x-x.x,b.y-x.y,b.z-x.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=_a(T,h)}setPitchBearing(o,h){this.orientation=Nr(d.degToRad(o),d.degToRad(-h))}}class $l{constructor(o,h){this._transform=d.identity([]),this._orientation=d.identity$1([]),h&&(this._orientation=h,nl(this._transform,this._orientation)),o&&Ku(this._transform,o)}get mercatorPosition(){const o=this.position;return new d.MercatorCoordinate(o[0],o[1],o[2])}get position(){const o=pi(this._transform,3);return[o[0],o[1],o[2]]}set position(o){Ku(this._transform,o)}get orientation(){return this._orientation}set orientation(o){this._orientation=o,nl(this._transform,this._orientation)}getPitchBearing(){const o=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,h){this._orientation=Nr(o,h),nl(this._transform,this._orientation)}forward(){const o=pi(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){const o=pi(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){const o=pi(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,h){const g=new Float64Array(16);return d.invert(g,this.getWorldToCamera(o,h)),g}getWorldToCameraPosition(o,h,g){const x=this.position;d.scale(x,x,-o);const b=new Float64Array(16);return d.fromScaling(b,[g,g,g]),d.translate(b,b,x),b[10]*=h,b}getWorldToCamera(o,h){const g=new Float64Array(16),x=new Float64Array(4),b=this.position;return d.conjugate(x,this._orientation),d.scale(b,b,-o),d.fromQuat(g,x),d.translate(g,g,b),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=h,g[9]*=h,g[10]*=h,g[11]*=h,g}getCameraToClipPerspective(o,h,g,x){const b=new Float64Array(16);return d.perspective(b,o,h,g,x),b}getDistanceToElevation(o){const h=0===o?0:d.mercatorZfromAltitude(o,this.position[1]),g=this.forward();return(h-this.position[2])/g[2]}clone(){return new $l([...this.position],[...this.orientation])}}class rl{constructor(o,h,g,x,b){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===b||b,this._minZoom=o||0,this._maxZoom=h||22,this._minPitch=null==g?0:g,this._maxPitch=null==x?60:x,this.setMaxBounds(),this.width=0,this.height=0,this._center=new d.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ga,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._camera=new $l,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._horizonShift=.1}clone(){const o=new rl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o.tileSize=this.tileSize,o.latRange=this.latRange,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._cameraZoom=this._cameraZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._averageElevation=this._averageElevation,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,o?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(o){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),o&&this._constrainCameraAltitude(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(o){void 0===o?o=!0:null===o&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return d.mercatorZfromAltitude(1,this.center.lat)*this.worldSize}get cameraPixelsPerMeter(){return d.mercatorZfromAltitude(1,this.center.lat)*this.cameraWorldSize}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(o){const h=-d.wrap(o,-180,180)*Math.PI/180;var g,x,b,T,A,M,F,L,B,U;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=(g=new d.ARRAY_TYPE(4),d.ARRAY_TYPE!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g),x=this.rotationMatrix,T=this.angle,A=(b=this.rotationMatrix)[0],M=b[1],F=b[2],L=b[3],B=Math.sin(T),U=Math.cos(T),x[0]=A*U+F*B,x[1]=M*U+L*B,x[2]=A*-B+F*U,x[3]=M*-B+L*U)}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const h=d.clamp(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(o){const h=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const o=this._elevation.getAtPointOrZero(d.MercatorCoordinate.fromLngLat(this.center),-1);return-1===o?(this._cameraZoom=null,!1):(this._centerAltitude=o,!0)}_updateCameraOnTerrain(){const o=this.cameraToCenterDistance/this.worldSize,h=d.mercatorZfromAltitude(this._centerAltitude,this.center.lat);this._cameraZoom=this._zoomFromMercatorZ(h+o)}sampleAverageElevation(){if(!this._elevation)return 0;const o=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop();let x=0,b=0;for(let T=0;T<h.length;T++){const A=new d.pointGeometry(h[T][0]*this.width,g+h[T][1]*(this.height-g)),M=o.pointCoordinate(A);if(!M)continue;const F=1/Math.hypot(M[0]-this._camera.position[0],M[1]-this._camera.position[1]);x+=M[3]*F,b+=F}return 0===b?NaN:x/b}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._cameraZoom||!this._elevation)return;const o=this._cameraZoom,h=this._elevation.getAtPointOrZero(d.MercatorCoordinate.fromLngLat(this.center)),g=d.mercatorZfromAltitude(h,this.center.lat),x=this._mercatorZfromZoom(o),b=this._mercatorZfromZoom(this._maxZoom),T=Math.max(x-g,b);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}computeZoomRelativeTo(o){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude()));let g;g=o.z<this._camera.position[2]?[h.x,h.y,h.z]:[o.x,o.y,o.z];const x=d.length(d.sub([],this._camera.position,g));return d.clamp(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let h=!1;if(o.orientation&&!d.exactEquals(o.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(o.orientation)),o.position){const g=[o.position.x,o.position.y,o.position.z];d.exactEquals$1(g,this._camera.position)||(this._setCameraPosition(g),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const o=this._camera.position,h=new jl;return h.position=new d.MercatorCoordinate(o[0],o[1],o[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this._renderWorldCopies,h}_setCameraOrientation(o){if(!d.length$1(o))return!1;d.normalize$1(o,o);const h=d.transformQuat([],[0,0,-1],o),g=d.transformQuat([],[0,-1,0],o);if(g[2]<0)return!1;const x=_a(h,g);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(o){const h=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;o[2]=d.clamp(o[2],x/g,x/h),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,h,g){this._unmodified=!1,this._edgeInsets.interpolate(o,h,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const h=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(o){const h=[new d.UnwrappedTileID(0,o)];if(this._renderWorldCopies){const g=this.pointCoordinate(new d.pointGeometry(0,0)),x=this.pointCoordinate(new d.pointGeometry(this.width,0)),b=this.pointCoordinate(new d.pointGeometry(this.width,this.height)),T=this.pointCoordinate(new d.pointGeometry(0,this.height)),A=Math.floor(Math.min(g.x,x.x,b.x,T.x)),M=Math.floor(Math.max(g.x,x.x,b.x,T.x)),F=1;for(let L=A-F;L<=M+F;L++)0!==L&&h.push(new d.UnwrappedTileID(L,o))}return h}coveringTiles(o){let h=this.coveringZoomLevel(o);const g=h,x=this.elevation&&!o.isTerrainDEM;if(void 0!==o.minzoom&&h<o.minzoom)return[];void 0!==o.maxzoom&&h>o.maxzoom&&(h=o.maxzoom);const b=d.MercatorCoordinate.fromLngLat(this.center),T=1<<h,A=[T*b.x,T*b.y,0],M=et.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h),F=this.pointCoordinate(this.getCameraPoint()),L=T*d.mercatorZfromAltitude(1,this.center.lat),B=this._camera.position[2]/d.mercatorZfromAltitude(1,this.center.lat),U=[T*F.x,T*F.y,B],$=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),K=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation?h:0,Y=o.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,le=o.isTerrainDEM?-Y:this._elevation?this._elevation.getMinElevationBelowMSL():0,Z=ve=>({aabb:new wt([ve*T,0,le],[(ve+1)*T,T,Y]),zoom:0,x:0,y:0,wrap:ve,fullyVisible:!1}),Q=[];let ae=[];const he=h,ge=o.reparseOverscaled?g:h,J=ve=>{if(!this._elevation||!ve.tileID)return;const Ne=this._elevation.getMinMaxForTile(ve.tileID),mt=ve.aabb;Ne?(mt.min[2]=Ne.min,mt.max[2]=Ne.max,mt.center[2]=(mt.min[2]+mt.max[2])/2):(ve.shouldSplit=Xe(ve),ve.shouldSplit||(mt.min[2]=mt.max[2]=mt.center[2]=this._centerAltitude))},we=ve=>ve*ve,$e=we((B-this._centerAltitude)*L),Xe=ve=>{if(ve.zoom<K)return!0;if(ve.zoom===he)return!1;if(null!=ve.shouldSplit)return ve.shouldSplit;const Ne=ve.aabb.distanceX(U),mt=ve.aabb.distanceY(U);let vt=$e;x&&(vt=we(ve.aabb.distanceZ(U)*L));const gt=Ne*Ne+mt*mt+vt;return gt<we((1<<he-ve.zoom)*$*((nt,bt)=>{if(bt*we(.707)<nt)return 1;const Xt=Math.sqrt(bt/nt);return Xt/(1.4144271570014144+(Math.pow(1.1,Xt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(vt,$e),gt))};if(this._renderWorldCopies)for(let ve=1;ve<=3;ve++)Q.push(Z(-ve)),Q.push(Z(ve));for(Q.push(Z(0));Q.length>0;){const ve=Q.pop(),Ne=ve.x,mt=ve.y;let vt=ve.fullyVisible;if(!vt){const gt=ve.aabb.intersects(M);if(0===gt)continue;vt=2===gt}if(ve.zoom!==he&&Xe(ve))for(let gt=0;gt<4;gt++){const nt=(Ne<<1)+gt%2,bt=(mt<<1)+(gt>>1),Xt={aabb:ve.aabb.quadrant(gt),zoom:ve.zoom+1,x:nt,y:bt,wrap:ve.wrap,fullyVisible:vt,tileID:void 0,shouldSplit:void 0};x&&(Xt.tileID=new d.OverscaledTileID(ve.zoom+1===he?ge:ve.zoom+1,ve.wrap,ve.zoom+1,nt,bt),J(Xt)),Q.push(Xt)}else{const gt=ve.zoom===he?ge:ve.zoom;if(o.minzoom&&o.minzoom>gt)continue;const nt=A[0]-(.5+Ne+(ve.wrap<<ve.zoom))*(1<<h-ve.zoom),bt=A[1]-.5-mt,Xt=ve.tileID?ve.tileID:new d.OverscaledTileID(gt,ve.wrap,ve.zoom,Ne,mt);ae.push({tileID:Xt,distanceSq:nt*nt+bt*bt})}}if(this.fogCullDistSq){const ve=this.fogCullDistSq,Ne=this.horizonLineFromTop();ae=ae.filter(mt=>{const vt=[0,0,0,1],gt=[d.EXTENT,d.EXTENT,0,1],nt=this.calculateFogTileMatrix(mt.tileID.toUnwrapped());d.transformMat4(vt,vt,nt),d.transformMat4(gt,gt,nt);const bt=d.getAABBPointSquareDist(vt,gt);if(0===bt)return!0;let Xt=!1;const zt=this._elevation;if(zt&&bt>ve&&0!==Ne){const gr=this.calculateProjMatrix(mt.tileID.toUnwrapped());let Yn;o.isTerrainDEM||(Yn=zt.getMinMaxForTile(mt.tileID)),Yn||(Yn={min:le,max:Y});const Zt=d.furthestTileCorner(this.bearing),nn=[Zt[0]*d.EXTENT,Zt[1]*d.EXTENT,Yn.max];d.transformMat4$1(nn,nn,gr),Xt=(1-nn[1])*this.height*.5<Ne}return bt<ve||Xt})}return ae.sort((ve,Ne)=>ve.distanceSq-Ne.distanceSq).map(ve=>ve.tileID)}resize(o,h){this.width=o,this.height=h,this.pixelsToGLUnits=[2/o,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const h=d.clamp(o.lat,-this.maxValidLatitude,this.maxValidLatitude);return new d.pointGeometry(d.mercatorXfromLng(o.lng)*this.worldSize,d.mercatorYfromLat(h)*this.worldSize)}unproject(o){return new d.MercatorCoordinate(o.x/this.worldSize,o.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}setLocationAtPoint(o,h){const g=this.pointCoordinate(h),x=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(o),T=new d.MercatorCoordinate(b.x-(g.x-x.x),b.y-(g.y-x.y));this.center=this.coordinateLocation(T),this._renderWorldCopies&&(this.center=this.center.wrap())}setLocation(o){this.center=this.coordinateLocation(o),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(o){return this._coordinatePoint(this.locationCoordinate(o),!1)}locationPoint3D(o){return this._coordinatePoint(this.locationCoordinate(o),!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o){return this.coordinateLocation(this.pointCoordinate3D(o))}locationCoordinate(o){return d.MercatorCoordinate.fromLngLat(o)}coordinateLocation(o){return o.toLngLat()}pointRayIntersection(o,h){const g=null!=h?h:this._centerAltitude,x=[o.x,o.y,0,1],b=[o.x,o.y,1,1];d.transformMat4(x,x,this.pixelMatrixInverse),d.transformMat4(b,b,this.pixelMatrixInverse);const T=b[3];d.scale$2(x,x,1/x[3]),d.scale$2(b,b,1/T);const A=x[2],M=b[2];return{p0:x,p1:b,t:A===M?0:(g-A)/(M-A)}}screenPointToMercatorRay(o){const h=[o.x,o.y,0,1],g=[o.x,o.y,1,1];return d.transformMat4(h,h,this.pixelMatrixInverse),d.transformMat4(g,g,this.pixelMatrixInverse),d.scale$2(h,h,1/h[3]),d.scale$2(g,g,1/g[3]),h[2]=d.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,g[2]=d.mercatorZfromAltitude(g[2],this._center.lat)*this.worldSize,d.scale$2(h,h,1/this.worldSize),d.scale$2(g,g,1/this.worldSize),new Le([h[0],h[1],h[2]],d.normalize([],d.sub([],g,h)))}rayIntersectionCoordinate(o){const{p0:h,p1:g,t:x}=o,b=d.mercatorZfromAltitude(h[2],this._center.lat),T=d.mercatorZfromAltitude(g[2],this._center.lat);return new d.MercatorCoordinate(d.number(h[0],g[0],x)/this.worldSize,d.number(h[1],g[1],x)/this.worldSize,d.number(b,T,x))}pointCoordinate(o,h=this._centerAltitude){const g=this.horizonLineFromTop(!1),x=new d.pointGeometry(o.x,Math.max(g,o.y));return this.rayIntersectionCoordinate(this.pointRayIntersection(x,h))}pointCoordinate3D(o){if(!this.elevation)return this.pointCoordinate(o);const h=this.elevation;let g=this.elevation.pointCoordinate(o);if(g)return new d.MercatorCoordinate(g[0],g[1],g[2]);let x=0,b=this.horizonLineFromTop();if(o.y>b)return this.pointCoordinate(o);const T=.02*b,A=o.clone();for(let M=0;M<10&&b-x>T;M++){A.y=d.number(x,b,.66);const F=h.pointCoordinate(A);F?(b=A.y,g=F):x=A.y}return g?new d.MercatorCoordinate(g[0],g[1],g[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){if(this.elevation)return!this.elevation.pointCoordinate(o);{const h=this.horizonLineFromTop();return o.y<h}}_coordinatePoint(o,h){const g=h&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,x=[o.x*this.worldSize,o.y*this.worldSize,g+o.toAltitude(),1];return d.transformMat4(x,x,this.pixelMatrix),x[3]>0?new d.pointGeometry(x[0]/x[3],x[1]/x[3]):new d.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(o,h){const g=new d.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),x=new d.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),b=new d.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),T=new d.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let A=this.pointCoordinate(g,o),M=this.pointCoordinate(x,o);const F=this.pointCoordinate(b,h),L=this.pointCoordinate(T,h),B=(U,$)=>($.y-U.y)/($.x-U.x);return A.y>1&&M.y>=0?A=new d.MercatorCoordinate((1-L.y)/B(L,A)+L.x,1):A.y<0&&M.y<=1&&(A=new d.MercatorCoordinate(-L.y/B(L,A)+L.x,0)),M.y>1&&A.y>=0?M=new d.MercatorCoordinate((1-F.y)/B(F,M)+F.x,1):M.y<0&&A.y<=1&&(M=new d.MercatorCoordinate(-F.y/B(F,M)+F.x,0)),(new d.LngLatBounds).extend(this.coordinateLocation(A)).extend(this.coordinateLocation(M)).extend(this.coordinateLocation(L)).extend(this.coordinateLocation(F))}_getBounds3D(){const o=this.elevation,h=o.visibleDemTiles.reduce((g,x)=>{if(x.dem){const b=x.dem.tree;g.min=Math.min(g.min,b.minimums[0]),g.max=Math.max(g.max,b.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBounds(h.min*o.exaggeration(),h.max*o.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(o=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,g=this.height/2-h*(1-this._horizonShift);return o?Math.max(0,g):g}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new d.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}setMaxBounds(o){if(o){const h=o.getEast(),g=o.getWest();this.lngRange=[g,h>g?h:h+360],this.latRange=[o.getSouth(),o.getNorth()],this._constrain()}else this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude]}calculatePosMatrix(o,h){const g=o.canonical,x=h/this.zoomScale(g.z),b=g.x+Math.pow(2,g.z)*o.wrap,T=d.identity(new Float64Array(16));return d.translate(T,T,[b*x,g.y*x,0]),d.scale$1(T,T,[x/d.EXTENT,x/d.EXTENT,1]),T}calculateFogTileMatrix(o){const h=o.key,g=this._fogTileMatrixCache;if(g[h])return g[h];const x=this.calculatePosMatrix(o,this.cameraWorldSize);return d.multiply(x,this.worldToFogMatrix,x),g[h]=new Float32Array(x),g[h]}calculateProjMatrix(o,h=!1){const g=o.key,x=h?this._alignedProjMatrixCache:this._projMatrixCache;if(x[g])return x[g];const b=this.calculatePosMatrix(o,this.worldSize);return d.multiply(b,h?this.alignedProjMatrix:this.projMatrix,b),x[g]=new Float32Array(b),x[g]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const o=this._elevation;this._updateCameraState();const h=this._camera.position,g=this._camera.forward();if(h[2]<=0||g[2]>=0)return;const x=d.mercatorZfromAltitude(1,this._center.lat);h[2]/=x,g[2]/=x,d.normalize(g,g);const b=o.raycast(h,g,o.exaggeration());if(b){const T=d.scaleAndAdd([],h,g,b),A=new d.MercatorCoordinate(T[0],T[1],d.mercatorZfromAltitude(T[2],d.latFromMercatorY(T[1]))),M=this._camera.position,F=A.z+d.length([A.x-M[0],A.y-M[1],A.z-M[2]]);this._cameraZoom=this._zoomFromMercatorZ(F),this._centerAltitude=A.toAltitude(),this._center=A.toLngLat(),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const o=this._elevation;this._updateCameraState();const h=o.getAtPointOrZero(this._camera.mercatorPosition),g=this._minimumHeightOverTerrain()*Math.cos(d.degToRad(this._maxPitch)),x=d.mercatorZfromAltitude(h,this._center.lat),b=this._camera.position[2]-x;if(b<g){const T=d.MercatorCoordinate.fromLngLat(this._center,this._centerAltitude),A=this._camera.mercatorPosition,M=[T.x-A.x,T.y-A.y,T.z-A.z],F=d.length(M);M[2]-=g-b;const L=d.length(M);if(0===L)return;d.scale(M,M,F/L),this._camera.position=[T.x-M[0],T.y-M[1],T.z-M[2]],this._camera.orientation=_a(M,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let o,h,g,x,b,T=1/0,A=-1/0;const M=this.size,F=this._unmodified;if(this.latRange){const $=this.latRange;T=d.mercatorYfromLat($[1])*this.worldSize,A=d.mercatorYfromLat($[0])*this.worldSize,g=A-T<M.y?M.y/(A-T):0}if(this.lngRange){const $=this.lngRange;o=d.mercatorXfromLng($[0])*this.worldSize,h=d.mercatorXfromLng($[1])*this.worldSize,x=h-o<M.x?M.x/(h-o):0}const L=this.point,B=Math.max(x||0,g||0);if(B)return this.center=this.unproject(new d.pointGeometry(x?(h+o)/2:L.x,g?(A+T)/2:L.y)),this.zoom+=this.scaleZoom(B),this._unmodified=F,void(this._constraining=!1);if(this.latRange){const $=L.y,K=M.y/2;$-K<T&&(b=T+K),$+K>A&&(b=A-K)}let U=L.x;if(this.lngRange){const $=this.worldSize/2-(o+h)/2;U=(U+$+this.worldSize)%this.worldSize,o+=$,h+=$;const K=M.x/2;U-K<o&&(U=o+K),U+K>h&&(U=h-K),U-=$}U===L.x&&void 0===b||(this.center=this.unproject(new d.pointGeometry(U,void 0!==b?b:L.y))),this._constrainCameraAltitude(),this._unmodified=F,this._constraining=!1}_minZoomForBounds(){const o=(x,b)=>Math.log2(x/(this.tileSize*Math.abs(b[1]-b[0])));let h=0;if(this.latRange){const x=this.latRange;h=o(this.height,[d.mercatorYfromLat(x[0]),d.mercatorYfromLat(x[1])])}let g=0;if(this.lngRange){const x=this.lngRange;g=o(this.width,[d.mercatorXfromLng(x[0]),d.mercatorXfromLng(x[1])])}return Math.max(h,g)}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const o=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const h=this.pixelsPerMeter;this._updateCameraState();const g=Math.PI/2+this._pitch,x=this.fovAboveCenter,b=this.elevation?this.elevation.getMinElevationBelowMSL()*h:0,T=(this._camera.position[2]*this.worldSize-b)/Math.cos(this._pitch),A=Math.sin(x)*T/Math.sin(d.clamp(Math.PI-g-x,.01,Math.PI-.01)),M=this.point,F=M.x,L=M.y,B=Math.cos(Math.PI/2-this._pitch)*A+T,U=Math.min(1.01*B,T*(1/this._horizonShift)),$=this.height/50,K=this._camera.getWorldToCamera(this.worldSize,h),Y=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,$,U);Y[8]=2*-o.x/this.width,Y[9]=2*o.y/this.height;let le=d.mul$1([],Y,K);this.mercatorMatrix=d.scale$1([],le,[this.worldSize,this.worldSize,this.worldSize/h]),this.projMatrix=le,this.invProjMatrix=d.invert(new Float64Array(16),this.projMatrix);const Z=new Float32Array(16);d.identity(Z),d.scale$1(Z,Z,[1,-1,1]),d.rotateX(Z,Z,this._pitch),d.rotateZ(Z,Z,this.angle);const Q=d.perspective(new Float32Array(16),this._fov,this.width/this.height,$,U),ae=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Q[8]=2*-o.x/this.width,Q[9]=2*(o.y+ae)/this.height,this.skyboxMatrix=d.multiply(Z,Q,Z);const he=this.width%2/2,ge=this.height%2/2,J=Math.cos(this.angle),we=Math.sin(this.angle),$e=F-Math.round(F)+J*he+we*ge,Xe=L-Math.round(L)+J*ge+we*he,ve=new Float64Array(le);if(d.translate(ve,ve,[$e>.5?$e-1:$e,Xe>.5?Xe-1:Xe,0]),this.alignedProjMatrix=ve,le=d.create$1(),d.scale$1(le,le,[this.width/2,-this.height/2,1]),d.translate(le,le,[1,-1,0]),this.labelPlaneMatrix=le,le=d.create$1(),d.scale$1(le,le,[1,-1,1]),d.translate(le,le,[-1,-1,0]),d.scale$1(le,le,[2/this.width,2/this.height,1]),this.glCoordMatrix=le,this.pixelMatrix=d.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),le=d.invert(new Float64Array(16),this.pixelMatrix),!le)throw new Error("failed to invert matrix");this.pixelMatrixInverse=le,this._projMatrixCache={},this._alignedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const o=this.cameraWorldSize,h=this.cameraPixelsPerMeter,g=this._camera.position,x=1/this.height,b=[o,o,h];d.scale(b,b,x),d.scale(g,g,-1),d.multiply$1(g,g,b);const T=d.create$1();d.translate(T,T,g),d.scale$1(T,T,b),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,h,x)}_updateCameraState(){if(!this.height)return;this._camera.setPitchBearing(this._pitch,this.angle);const o=this._camera.forward(),h=this.cameraToCenterDistance,g=this.point,x=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)-d.mercatorZfromAltitude(this._centerAltitude,this.center.lat),b=this.cameraToCenterDistance/x;this._camera.position=[g.x/this.worldSize-o[0]*h/b,g.y/this.worldSize-o[1]*h/b,d.mercatorZfromAltitude(this._centerAltitude,this._center.lat)+-o[2]*h/b]}_translateCameraConstrained(o){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=o[2];let x=1;g>0&&(x=Math.min((h-this._camera.position[2])/g,1)),this._camera.position=d.scaleAndAdd([],this._camera.position,o,x),this._updateStateFromCamera()}_updateStateFromCamera(){const o=this._camera.position,h=this._camera.forward(),{pitch:g,bearing:x}=this._camera.getPitchBearing(),b=d.mercatorZfromAltitude(this._centerAltitude,this.center.lat),T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(d.degToRad(this._maxPitch)),A=Math.max((o[2]-b)/Math.cos(g),T),M=this._zoomFromMercatorZ(A);d.scaleAndAdd(o,o,h,A),this._pitch=d.clamp(g,d.degToRad(this.minPitch),d.degToRad(this.maxPitch)),this.angle=d.wrap(x,-Math.PI,Math.PI),this._setZoom(d.clamp(M,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=new d.MercatorCoordinate(o[0],o[1],o[2]).toLngLat(),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){const o=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(o*this.tileSize))}_terrainEnabled(){return!!this._elevation}isCornerOffEdge(o,h){const g=Math.min(o.x,h.x),x=Math.max(o.x,h.x),b=Math.min(o.y,h.y),T=Math.max(o.y,h.y);if(b<this.horizonLineFromTop(!1))return!0;const A=[new d.pointGeometry(g,b),new d.pointGeometry(x,T),new d.pointGeometry(g,T),new d.pointGeometry(x,b)],M=this._renderWorldCopies?-3:0,F=this._renderWorldCopies?4:1;for(const L of A){const B=this.pointRayIntersection(L);if(B.t<0)return!0;const U=this.rayIntersectionCoordinate(B);if(U.x<M||U.y<0||U.x>F||U.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+d.radToDeg(this.fovAboveCenter)>88||this.isCornerOffEdge(new d.pointGeometry(0,0),new d.pointGeometry(this.width,this.height))}zoomDeltaToMovement(o,h){const g=d.length(d.sub([],this._camera.position,o)),x=this._zoomFromMercatorZ(g)+h;return g-this._mercatorZfromZoom(x)}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.pointGeometry(0,o))}}function Kc(p,o){let h=!1,g=null;const x=()=>{g=null,h&&(p(),g=setTimeout(x,o),h=!1)};return()=>(h=!0,g||x(),g)}class Zf{constructor(o){this._hashName=o&&encodeURIComponent(o),d.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Kc(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,d.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return d.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(o){const h=this._map.getCenter(),g=Math.round(100*this._map.getZoom())/100,x=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,x),T=Math.round(h.lng*b)/b,A=Math.round(h.lat*b)/b,M=this._map.getBearing(),F=this._map.getPitch();let L="";if(L+=o?`/${T}/${A}/${g}`:`${g}/${A}/${T}`,(M||F)&&(L+="/"+Math.round(10*M)/10),F&&(L+=`/${Math.round(F)}`),this._hashName){const B=this._hashName;let U=!1;const $=d.window.location.hash.slice(1).split("&").map(K=>{const Y=K.split("=")[0];return Y===B?(U=!0,`${Y}=${L}`):K}).filter(K=>K);return U||$.push(`${B}=${L}`),`#${$.join("&")}`}return`#${L}`}_getCurrentHash(){const o=d.window.location.hash.replace("#","");if(this._hashName){let h;return o.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(h=g)}),(h&&h[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._getCurrentHash();if(o.length>=3&&!o.some(h=>isNaN(h))){const h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:h,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){const o=d.window.location.href.replace(/(#.+)?$/,this.getHashString());d.window.history.replaceState(d.window.history.state,null,o)}}const Zn={linearity:.3,easing:d.bezier(0,0,.3,1)},sd=d.extend({deceleration:2500,maxSpeed:1400},Zn),Yu=d.extend({deceleration:20,maxSpeed:1400},Zn),ad=d.extend({deceleration:1e3,maxSpeed:360},Zn),mr=d.extend({deceleration:1e3,maxSpeed:90},Zn);class Qu{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:d.exported.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,h=d.exported.now();for(;o.length>0&&h-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new d.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)h.zoom+=b.zoomDelta||0,h.bearing+=b.bearingDelta||0,h.pitch+=b.pitchDelta||0,b.panDelta&&h.pan._add(b.panDelta),b.around&&(h.around=b.around),b.pinchAround&&(h.pinchAround=b.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(h.pan.mag()){const b=Ls(h.pan.mag(),g,d.extend({},sd,o||{}));x.offset=h.pan.mult(b.amount/h.pan.mag()),x.center=this._map.transform.center,Yc(x,b)}if(h.zoom){const b=Ls(h.zoom,g,Yu);x.zoom=this._map.transform.zoom+b.amount,Yc(x,b)}if(h.bearing){const b=Ls(h.bearing,g,ad);x.bearing=this._map.transform.bearing+d.clamp(b.amount,-179,179),Yc(x,b)}if(h.pitch){const b=Ls(h.pitch,g,mr);x.pitch=this._map.transform.pitch+b.amount,Yc(x,b)}if(x.zoom||x.bearing){const b=void 0===h.pinchAround?h.around:h.pinchAround;x.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),d.extend(x,{noMoveStart:!0})}}function Yc(p,o){(!p.duration||p.duration<o.duration)&&(p.duration=o.duration,p.easing=o.easing)}function Ls(p,o,h){const{maxSpeed:g,linearity:x,deceleration:b}=h,T=d.clamp(p*x/(o/1e3),-g,g),A=Math.abs(T)/(b*x);return{easing:h.easing,duration:1e3*A,amount:T*(A/2)}}class ir extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,g,x={}){const b=ie.mousePos(h.getCanvasContainer(),g),T=h.unproject(b);super(o,d.extend({point:b,lngLat:T,originalEvent:g},x)),this._defaultPrevented=!1,this.target=h}}class Hl extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,g){const x="touchend"===o?g.changedTouches:g.touches,b=ie.touchPos(h.getCanvasContainer(),x),T=b.map(M=>h.unproject(M)),A=b.reduce((M,F,L,B)=>M.add(F.div(B.length)),new d.pointGeometry(0,0));super(o,{points:b,point:A,lngLats:T,lngLat:h.unproject(A),originalEvent:g}),this._defaultPrevented=!1}}class Qc extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,g){super(o,{originalEvent:g}),this._defaultPrevented=!1}}class To{constructor(o,h){this._map=o,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new Qc(o.type,this._map,o))}mousedown(o,h){return this._mousedownPos=h,this._firePreventable(new ir(o.type,this._map,o))}mouseup(o){this._map.fire(new ir(o.type,this._map,o))}preclick(o){const h=d.extend({},o);h.type="preclick",this._map.fire(new ir(h.type,this._map,h))}click(o,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(o),this._map.fire(new ir(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new ir(o.type,this._map,o))}mouseover(o){this._map.fire(new ir(o.type,this._map,o))}mouseout(o){this._map.fire(new ir(o.type,this._map,o))}touchstart(o){return this._firePreventable(new Hl(o.type,this._map,o))}touchmove(o){this._map.fire(new Hl(o.type,this._map,o))}touchend(o){this._map.fire(new Hl(o.type,this._map,o))}touchcancel(o){this._map.fire(new Hl(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Li{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(o){this._map.fire(new ir(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ir("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new ir(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ju{constructor(o,h){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,h){this.isEnabled()&&o.shiftKey&&0===o.button&&(ie.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(o,h){if(!this._active)return;const g=h;if(this._lastPos.equals(g)||!this._box&&g.dist(this._startPos)<this._clickTolerance)return;const x=this._startPos;this._lastPos=g,this._box||(this._box=ie.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const b=Math.min(x.x,g.x),T=Math.max(x.x,g.x),A=Math.min(x.y,g.y),M=Math.max(x.y,g.y);this._map._requestDomTask(()=>{this._box&&(ie.setTransform(this._box,`translate(${b}px,${A}px)`),this._box.style.width=T-b+"px",this._box.style.height=M-A+"px")})}mouseupWindow(o,h){if(!this._active||0!==o.button)return;const g=this._startPos,x=h;if(this.reset(),ie.suppressClick(),g.x!==x.x||g.y!==x.y)return this._map.fire(new d.Event("boxzoomend",{originalEvent:o})),{cameraAnimation:b=>b.fitScreenCoordinates(g,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&27===o.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(ie.remove(this._box),this._box=null),ie.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,h){return this._map.fire(new d.Event(o,{originalEvent:h}))}}function il(p,o){const h={};for(let g=0;g<p.length;g++)h[p[g].identifier]=o[g];return h}class ld{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,h,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=o.timeStamp),g.length===this.numTouches&&(this.centroid=function(x){const b=new d.pointGeometry(0,0);for(const T of x)b._add(T);return b.div(x.length)}(h),this.touches=il(g,h)))}touchmove(o,h,g){if(this.aborted||!this.centroid)return;const x=il(g,h);for(const b in this.touches){const T=this.touches[b],A=x[b];(!A||A.dist(T)>30)&&(this.aborted=!0)}}touchend(o,h,g){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),0===g.length){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class Do{constructor(o){this.singleTap=new ld(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,h,g){this.singleTap.touchstart(o,h,g)}touchmove(o,h,g){this.singleTap.touchmove(o,h,g)}touchend(o,h,g){const x=this.singleTap.touchend(o,h,g);if(x){const b=o.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(x)<30;if(b&&T||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class eh{constructor(){this._zoomIn=new Do({numTouches:1,numTaps:2}),this._zoomOut=new Do({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,h,g){this._zoomIn.touchstart(o,h,g),this._zoomOut.touchstart(o,h,g)}touchmove(o,h,g){this._zoomIn.touchmove(o,h,g),this._zoomOut.touchmove(o,h,g)}touchend(o,h,g){const x=this._zoomIn.touchend(o,h,g),b=this._zoomOut.touchend(o,h,g);return x?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(x)},{originalEvent:o})}):b?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(b)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const ni={0:1,2:2};class Ht{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(o,h){return!1}_move(o,h){return{}}mousedown(o,h){if(this._lastPoint)return;const g=ie.mouseButton(o);this._correctButton(o,g)&&(this._lastPoint=h,this._eventButton=g)}mousemoveWindow(o,h){const g=this._lastPoint;if(g)if(o.preventDefault(),function(x,b){const T=ni[b];return void 0===x.buttons||(x.buttons&T)!==T}(o,this._eventButton))this.reset();else if(this._moved||!(h.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(g,h)}mouseupWindow(o){this._lastPoint&&ie.mouseButton(o)===this._eventButton&&(this._moved&&ie.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ns extends Ht{mousedown(o,h){super.mousedown(o,h),this._lastPoint&&(this._active=!0)}_correctButton(o,h){return 0===h&&!o.ctrlKey}_move(o,h){return{around:h,panDelta:h.sub(o)}}}class th extends Ht{_correctButton(o,h){return 0===h&&o.ctrlKey||2===h}_move(o,h){const g=.8*(h.x-o.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(o){o.preventDefault()}}class gs extends Ht{_correctButton(o,h){return 0===h&&o.ctrlKey||2===h}_move(o,h){const g=-.5*(h.y-o.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(o){o.preventDefault()}}class ol{constructor(o){this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new d.pointGeometry(0,0)}touchstart(o,h,g){return this._calculateTransform(o,h,g)}touchmove(o,h,g){if(this._active&&!(g.length<this._minTouches))return o.preventDefault(),this._calculateTransform(o,h,g)}touchend(o,h,g){this._calculateTransform(o,h,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,h,g){g.length>0&&(this._active=!0);const x=il(g,h),b=new d.pointGeometry(0,0),T=new d.pointGeometry(0,0);let A=0;for(const F in x){const L=x[F],B=this._touches[F];B&&(b._add(L),T._add(L.sub(B)),A++,x[F]=L)}if(this._touches=x,A<this._minTouches||!T.mag())return;const M=T.div(A);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(A),panDelta:M}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jc{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(o){}_move(o,h,g){return{}}touchstart(o,h,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([h[0],h[1]]))}touchmove(o,h,g){if(!this._firstTwoTouches)return;o.preventDefault();const[x,b]=this._firstTwoTouches,T=eu(g,h,x),A=eu(g,h,b);if(!T||!A)return;const M=this._aroundCenter?null:T.add(A).div(2);return this._move([T,A],M,o)}touchend(o,h,g){if(!this._firstTwoTouches)return;const[x,b]=this._firstTwoTouches,T=eu(g,h,x),A=eu(g,h,b);T&&A||(this._active&&ie.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&"center"===o.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function eu(p,o,h){for(let g=0;g<p.length;g++)if(p[g].identifier===h)return o[g]}function cd(p,o){return Math.log(p/o)/Math.LN2}class tt extends Jc{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,h){const g=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(cd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:cd(this._distance,g),pinchAround:h}}}function xn(p,o){return 180*p.angleWith(o)/Math.PI}class sl extends Jc{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,h){const g=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:xn(this._vector,g),pinchAround:h}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const h=25/(Math.PI*this._minDiameter)*360,g=xn(o,this._startVector);return Math.abs(g)<h}}function zn(p){return Math.abs(p.y)>Math.abs(p.x)}class nh extends Jc{reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(o){this._lastPoints=o,zn(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,h,g){const x=o[0].sub(this._lastPoints[0]),b=o[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(x,b,g.timeStamp),this._valid)return this._lastPoints=o,this._active=!0,{pitchDelta:(x.y+b.y)/2*-.5}}gestureBeginsVertically(o,h,g){if(void 0!==this._valid)return this._valid;const x=o.mag()>=2,b=h.mag()>=2;if(!x&&!b)return;if(!x||!b)return void 0===this._firstMove&&(this._firstMove=g),g-this._firstMove<100&&void 0;const T=o.y>0==h.y>0;return zn(o)&&zn(h)&&T}}const al={panStep:100,bearingStep:15,pitchStep:10};class Ni{constructor(){const o=al;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let h=0,g=0,x=0,b=0,T=0;switch(o.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:o.shiftKey?g=-1:(o.preventDefault(),b=-1);break;case 39:o.shiftKey?g=1:(o.preventDefault(),b=1);break;case 38:o.shiftKey?x=1:(o.preventDefault(),T=-1);break;case 40:o.shiftKey?x=-1:(o.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(g=0,x=0),{cameraAnimation:A=>{const M=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:yt,zoom:h?Math.round(M)+h*(o.shiftKey?2:1):M,bearing:A.getBearing()+g*this._bearingStep,pitch:A.getPitch()+x*this._pitchStep,offset:[-b*this._panStep,-T*this._panStep],center:A.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function yt(p){return p*(2-p)}const Gl=4.000244140625;class Wf{constructor(o,h){this._map=o,this._el=o.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,d.bindAll(["_onTimeout"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=o&&"center"===o.around)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(o){if(!this.isEnabled())return;let h=o.deltaMode===d.window.WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const g=d.exported.now(),x=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,0!==h&&h%Gl==0?this._type="wheel":0!==h&&Math.abs(h)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(x*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),o.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=o,this._delta-=h,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=ie.mousePos(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform,h=()=>o._terrainEnabled()?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(0!==this._delta){const M="wheel"===this._type&&Math.abs(this._delta)>Gl?this._wheelZoomRate:this._defaultZoomRate;let F=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&0!==F&&(F=1/F);const L=h(),B=Math.pow(2,L),U="number"==typeof this._targetZoom?o.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(U*F))),"wheel"===this._type&&(this._startZoom=h(),this._easing=this._smoothOutEasing(200)),this._delta=0}const g="number"==typeof this._targetZoom?this._targetZoom:h(),x=this._startZoom,b=this._easing;let T,A=!1;if("wheel"===this._type&&x&&b){const M=Math.min((d.exported.now()-this._lastWheelEventTime)/200,1),F=b(M);T=d.number(x,g,F),M<1?this._frameId||(this._frameId=!0):A=!0}else T=g,A=!0;return this._active=!0,A&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!A,zoomDelta:T-h(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let h=d.ease;if(this._prevEase){const g=this._prevEase,x=(d.exported.now()-g.start)/g.duration,b=g.easing(x+.01)-g.easing(x),T=.27/Math.sqrt(b*b+1e-4)*.01,A=Math.sqrt(.0729-T*T);h=d.bezier(T,A,.25,1)}return this._prevEase={start:d.exported.now(),duration:o,easing:h},h}blur(){this.reset()}reset(){this._active=!1}}class ql{constructor(o,h){this._clickZoom=o,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class zs{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,h){return o.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(o.shiftKey?-1:1),around:g.unproject(h)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zl{constructor(){this._tap=new Do({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(o,h,g){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=h[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(o,h,g))}touchmove(o,h,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const x=h[0],b=x.y-this._swipePoint.y;return this._swipePoint=x,o.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(o,h,g)}touchend(o,h,g){this._tapTime?this._swipePoint&&0===g.length&&this.reset():this._tap.touchend(o,h,g)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mi{constructor(o,h,g){this._el=o,this._mousePan=h,this._touchPan=g}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class So{constructor(o,h,g){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=h,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class rh{constructor(o,h,g,x){this._el=o,this._touchZoom=h,this._touchRotate=g,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ko=p=>p.zoom||p.drag||p.pitch||p.rotate;class Yo extends d.Event{}class ud{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,h){const g=d.sub([],h,o);this.radius=d.length(g[2]<0?d.div([],g,this.constants):[g[0],g[1],0])}projectRay(o){d.div(o,o,this.constants),d.normalize(o,o),d.mul$2(o,o,this.constants);const h=d.scale([],o,this.radius);if(h[2]>0){const g=d.scale([],[0,0,1],d.dot(h,[0,0,1])),x=d.scale([],d.normalize([],[h[0],h[1],0]),this.radius),b=d.add([],h,d.scale([],d.sub([],d.add([],x,g),h),2));h[0]=b[0],h[1]=b[1]}return h}}function Vs(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class ih{constructor(o,h){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Qu(o),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ud,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),d.bindAll(["handleEvent","handleWindowEvent"],this);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[d.window.document,"mousemove",{capture:!0}],[d.window.document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[d.window,"blur",void 0]];for(const[x,b,T]of this._listeners)ie.addEventListener(x,b,x===d.window.document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(const[o,h,g]of this._listeners)ie.removeEventListener(o,h,o===d.window.document?this.handleWindowEvent:this.handleEvent,g)}_addDefaultHandlers(o){const h=this._map,g=h.getCanvasContainer();this._add("mapEvent",new To(h,o));const x=h.boxZoom=new Ju(h,o);this._add("boxZoom",x);const b=new eh,T=new zs;h.doubleClickZoom=new ql(T,b),this._add("tapZoom",b),this._add("clickZoom",T);const A=new Zl;this._add("tapDragZoom",A);const M=h.touchPitch=new nh;this._add("touchPitch",M);const F=new th(o),L=new gs(o);h.dragRotate=new So(o,F,L),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const B=new Ns(o),U=new ol(o);h.dragPan=new mi(g,B,U),this._add("mousePan",B),this._add("touchPan",U,["touchZoom","touchRotate"]);const $=new sl,K=new tt;h.touchZoomRotate=new rh(g,K,$,A),this._add("touchRotate",$,["touchPan","touchZoom"]),this._add("touchZoom",K,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Li(h));const Y=h.scrollZoom=new Wf(h,this);this._add("scrollZoom",Y,["mousePan"]);const le=h.keyboard=new Ni;this._add("keyboard",le);for(const Z of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[Z]&&h[Z].enable(o[Z])}_add(o,h,g){this._handlers.push({handlerName:o,handler:h,allowed:g}),this._handlersById[o]=h}stop(o){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Ko(this._eventsInProgress))||this.isZooming()}_blockedByActive(o,h,g){for(const x in o)if(x!==g&&(!h||h.indexOf(x)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const h=[];for(const g of o)this._el.contains(g.target)&&h.push(g);return h}handleEvent(o,h){this._updatingCamera=!0;const g="renderFrame"===o.type,x=g?void 0:o,b={needsRenderFrame:!1},T={},A={},M=o.touches?this._getMapTouches(o.touches):void 0,F=M?ie.touchPos(this._el,M):g?void 0:ie.mousePos(this._el,o);for(const{handlerName:U,handler:$,allowed:K}of this._handlers){if(!$.isEnabled())continue;let Y;this._blockedByActive(A,K,U)?$.reset():$[h||o.type]&&(Y=$[h||o.type](o,F,M),this.mergeHandlerResult(b,T,Y,U,x),Y&&Y.needsRenderFrame&&this._triggerRenderFrame()),(Y||$.isActive())&&(A[U]=$)}const L={};for(const U in this._previousActiveHandlers)A[U]||(L[U]=x);this._previousActiveHandlers=A,(Object.keys(L).length||Vs(b))&&(this._changes.push([b,T,L]),this._triggerRenderFrame()),(Object.keys(A).length||Vs(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=b;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))}mergeHandlerResult(o,h,g,x,b){if(!g)return;d.extend(o,g);const T={handlerName:x,originalEvent:g.originalEvent||b};void 0!==g.zoomDelta&&(h.zoom=T),void 0!==g.panDelta&&(h.drag=T),void 0!==g.pitchDelta&&(h.pitch=T),void 0!==g.bearingDelta&&(h.rotate=T)}_applyChanges(){const o={},h={},g={};for(const[x,b,T]of this._changes)x.panDelta&&(o.panDelta=(o.panDelta||new d.pointGeometry(0,0))._add(x.panDelta)),x.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+x.pitchDelta),void 0!==x.around&&(o.around=x.around),void 0!==x.aroundCoord&&(o.aroundCoord=x.aroundCoord),void 0!==x.pinchAround&&(o.pinchAround=x.pinchAround),x.noInertia&&(o.noInertia=x.noInertia),d.extend(h,b),d.extend(g,T);this._updateMapTransform(o,h,g),this._changes=[]}_updateMapTransform(o,h,g){const x=this._map,b=x.transform,T=Q=>[Q.x,Q.y,Q.z];if((Q=>{const ae=this._eventsInProgress.drag;return ae&&!this._handlersById[ae.handlerName].isActive()})()&&!Vs(o)){const Q=b.zoom;b.cameraElevationReference="sea",b.recenterOnTerrain(),b.cameraElevationReference="ground",Q!==b.zoom&&this._map._update(!0)}if(!Vs(o))return this._fireEvents(h,g,!0);let{panDelta:A,zoomDelta:M,bearingDelta:F,pitchDelta:L,around:B,aroundCoord:U,pinchAround:$}=o;void 0!==$&&(B=$),(Q=>h.drag&&!this._eventsInProgress.drag)()&&B&&(this._dragOrigin=T(b.pointCoordinate3D(B)),this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",x._stop(!0),B=B||x.transform.centerPoint,F&&(b.bearing+=F),L&&(b.pitch+=L),b._updateCameraState();const K=[0,0,0];if(A){const Q=b.screenPointToMercatorRay(B),ae=b.screenPointToMercatorRay(B.sub(A)),he=this._trackingEllipsoid.projectRay(Q.dir),ge=this._trackingEllipsoid.projectRay(ae.dir);K[0]=ge[0]-he[0],K[1]=ge[1]-he[1]}const Y=b.zoom,le=[0,0,0];if(M){const Q=T(U||b.pointCoordinate3D(B)),ae={dir:d.normalize([],d.sub([],Q,b._camera.position))},he=b.screenPointToMercatorRay(b.centerPoint);if(ae.dir[2]<0){const ge=d.altitudeFromMercatorZ(Q[2],Q[1]),J=b.rayIntersectionCoordinate(b.pointRayIntersection(b.centerPoint,ge)),we=b.zoomDeltaToMovement(T(J),M)*(he.dir[2]/ae.dir[2]);d.scale(le,ae.dir,we)}else if(b._terrainEnabled()){const ge=b.zoomDeltaToMovement(Q,M);d.scale(le,ae.dir,ge)}}const Z=d.add(K,K,le);b._translateCameraConstrained(Z),M&&Math.abs(b.zoom-Y)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(h,g,!0)}_fireEvents(o,h,g){const x=Ko(this._eventsInProgress),b=Ko(o),T={};for(const L in o){const{originalEvent:B}=o[L];this._eventsInProgress[L]||(T[`${L}start`]=B),this._eventsInProgress[L]=o[L]}!x&&b&&this._fireEvent("movestart",b.originalEvent);for(const L in T)this._fireEvent(L,T[L]);b&&this._fireEvent("move",b.originalEvent);for(const L in o){const{originalEvent:B}=o[L];this._fireEvent(L,B)}const A={};let M;for(const L in this._eventsInProgress){const{handlerName:B,originalEvent:U}=this._eventsInProgress[L];this._handlersById[B].isActive()||(delete this._eventsInProgress[L],M=h[B]||U,A[`${L}end`]=M)}for(const L in A)this._fireEvent(L,A[L]);const F=Ko(this._eventsInProgress);if(g&&(x||b)&&!F){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=U=>0!==U&&-this._bearingSnap<U&&U<this._bearingSnap;L?(B(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:M})):(this._map.fire(new d.Event("moveend",{originalEvent:M})),B(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,h){this._map.fire(new d.Event(o,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{delete this._frameId,this.handleEvent(new Yo("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class tu extends d.Evented{constructor(o,h){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=h.bearingSnap,d.bindAll(["_renderFrameCallback"],this)}getCenter(){return new d.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(o,h){return this.jumpTo({center:o},h)}panBy(o,h,g){return o=d.pointGeometry.convert(o).mult(-1),this.panTo(this.transform.center,d.extend({offset:o},h),g)}panTo(o,h,g){return this.easeTo(d.extend({center:o},h),g)}getZoom(){return this.transform.zoom}setZoom(o,h){return this.jumpTo({zoom:o},h),this}zoomTo(o,h,g){return this.easeTo(d.extend({zoom:o},h),g)}zoomIn(o,h){return this.zoomTo(this.getZoom()+1,o,h),this}zoomOut(o,h){return this.zoomTo(this.getZoom()-1,o,h),this}getBearing(){return this.transform.bearing}setBearing(o,h){return this.jumpTo({bearing:o},h),this}getPadding(){return this.transform.padding}setPadding(o,h){return this.jumpTo({padding:o},h),this}rotateTo(o,h,g){return this.easeTo(d.extend({bearing:o},h),g)}resetNorth(o,h){return this.rotateTo(0,d.extend({duration:1e3},o),h),this}resetNorthPitch(o,h){return this.easeTo(d.extend({bearing:0,pitch:0,duration:1e3},o),h),this}snapToNorth(o,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,h):this}getPitch(){return this.transform.pitch}setPitch(o,h){return this.jumpTo({pitch:o},h),this}cameraForBounds(o,h){o=d.LngLatBounds.convert(o);const g=h&&h.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),g,h)}_extendCameraOptions(o){const h={top:0,bottom:0,right:0,left:0};if("number"==typeof(o=d.extend({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding){const g=o.padding;o.padding={top:g,bottom:g,right:g,left:g}}return o.padding=d.extend(h,o.padding),o}_cameraForBoxAndBearing(o,h,g,x){const b=this._extendCameraOptions(x),T=this.transform,A=T.padding,M=T.project(d.LngLat.convert(o)),F=T.project(d.LngLat.convert(h)),L=M.rotate(-d.degToRad(g)),B=F.rotate(-d.degToRad(g)),U=new d.pointGeometry(Math.max(L.x,B.x),Math.max(L.y,B.y)),$=new d.pointGeometry(Math.min(L.x,B.x),Math.min(L.y,B.y)),K=U.sub($),Y=(T.width-(A.left+A.right+b.padding.left+b.padding.right))/K.x,le=(T.height-(A.top+A.bottom+b.padding.top+b.padding.bottom))/K.y;if(le<0||Y<0)return void d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Z=Math.min(T.scaleZoom(T.scale*Math.min(Y,le)),b.maxZoom),Q="number"==typeof b.offset.x?new d.pointGeometry(b.offset.x,b.offset.y):d.pointGeometry.convert(b.offset),ae=new d.pointGeometry((b.padding.left-b.padding.right)/2,(b.padding.top-b.padding.bottom)/2).rotate(g*Math.PI/180),he=Q.add(ae).mult(T.scale/T.zoomScale(Z));return{center:T.unproject(M.add(F).div(2).sub(he)),zoom:Z,bearing:g}}_cameraForBox(o,h,g,x,b){const T=this._extendCameraOptions(b);g=g||0,x=x||0,o=d.LngLat.convert(o),h=d.LngLat.convert(h);const A=this.transform.clone();A.padding=T.padding;const M=this.getFreeCameraOptions(),F=new d.LngLat(.5*(o.lng+h.lng),.5*(o.lat+h.lat)),L=.5*(g+x);if(A._camera.position[2]<d.mercatorZfromAltitude(L,F.lat))return void d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");M.lookAtPoint(F),A.setFreeCameraOptions(M);const B=d.MercatorCoordinate.fromLngLat(o),U=d.MercatorCoordinate.fromLngLat(h),$=A.pointRayIntersection(A.centerPoint,L),K=[(Y=A.rayIntersectionCoordinate($)).x,Y.y,Y.z];var Y;const le=A.screenPointToMercatorRay(A.centerPoint);let Z,Q=0;do{const ae=Math.floor(A.zoom),he=1<<ae,ge=Math.min(he*B.x,he*U.x),J=Math.min(he*B.y,he*U.y),we=Math.max(he*B.x,he*U.x),$e=Math.max(he*B.y,he*U.y),Xe=new wt([ge,J,g],[we,$e,x]),ve=et.fromInvProjectionMatrix(A.invProjMatrix,A.worldSize,ae);if(2!==Xe.intersects(ve)){Z&&(A._camera.position=d.scaleAndAdd([],A._camera.position,le.dir,-Z),A._updateStateFromCamera());break}const Ne=d.sub([],A._camera.position,K);Z=.5*d.length(Ne),A._camera.position=d.scaleAndAdd([],A._camera.position,le.dir,Z);try{A._updateStateFromCamera()}catch(mt){return void d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++Q<10);return{center:A.center,zoom:A.zoom,bearing:A.bearing,pitch:A.pitch}}fitBounds(o,h,g){return this._fitInternal(this.cameraForBounds(o,h),h,g)}_raycastElevationBox(o,h){const g=this.transform.elevation;if(!g)return;const x=new d.pointGeometry(o.x,h.y),b=new d.pointGeometry(h.x,o.y),T=g.pointCoordinate(o);if(!T)return;const A=g.pointCoordinate(h);if(!A)return;const M=g.pointCoordinate(x);if(!M)return;const F=g.pointCoordinate(b);if(!F)return;const L=new d.MercatorCoordinate(T[0],T[1]).toLngLat(),B=new d.MercatorCoordinate(A[0],A[1]).toLngLat(),U=new d.MercatorCoordinate(M[0],M[1]).toLngLat(),$=new d.MercatorCoordinate(F[0],F[1]).toLngLat(),K=Math.min(L.lng,Math.min(B.lng,Math.min(U.lng,$.lng))),Y=Math.min(L.lat,Math.min(B.lat,Math.min(U.lat,$.lat))),le=Math.max(L.lng,Math.max(B.lng,Math.max(U.lng,$.lng))),Z=Math.max(L.lat,Math.max(B.lat,Math.max(U.lat,$.lat))),Q=Math.min(T[3],Math.min(A[3],Math.min(M[3],F[3]))),ae=Math.max(T[3],Math.max(A[3],Math.max(M[3],F[3])));return{minLngLat:new d.LngLat(K,Y),maxLngLat:new d.LngLat(le,Z),minAltitude:Q,maxAltitude:ae}}fitScreenCoordinates(o,h,g,x,b){let T,A,M,F;const L=d.pointGeometry.convert(o),B=d.pointGeometry.convert(h),U=this._raycastElevationBox(L,B);if(U)T=U.minLngLat,A=U.maxLngLat,M=U.minAltitude,F=U.maxAltitude;else{if(this.transform.isCornerOffEdge(L,B))return this;T=this.transform.pointLocation(L),A=this.transform.pointLocation(B)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(d.pointGeometry.convert(o)),this.transform.pointLocation(d.pointGeometry.convert(h)),g,x):this._cameraForBox(T,A,M,F,x),x,b)}_fitInternal(o,h,g){return o?(delete(h=d.extend(o,h)).padding,h.linear?this.easeTo(h,g):this.flyTo(h,g)):this}jumpTo(o,h){this.stop();const g=this.transform;let x=!1,b=!1,T=!1;return"zoom"in o&&g.zoom!==+o.zoom&&(x=!0,g.zoom=+o.zoom),void 0!==o.center&&(g.center=d.LngLat.convert(o.center)),"bearing"in o&&g.bearing!==+o.bearing&&(b=!0,g.bearing=+o.bearing),"pitch"in o&&g.pitch!==+o.pitch&&(T=!0,g.pitch=+o.pitch),null==o.padding||g.isPaddingEqual(o.padding)||(g.padding=o.padding),this.fire(new d.Event("movestart",h)).fire(new d.Event("move",h)),x&&this.fire(new d.Event("zoomstart",h)).fire(new d.Event("zoom",h)).fire(new d.Event("zoomend",h)),b&&this.fire(new d.Event("rotatestart",h)).fire(new d.Event("rotate",h)).fire(new d.Event("rotateend",h)),T&&this.fire(new d.Event("pitchstart",h)).fire(new d.Event("pitch",h)).fire(new d.Event("pitchend",h)),this.fire(new d.Event("moveend",h))}getFreeCameraOptions(){return this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,h){this.stop();const g=this.transform,x=g.zoom,b=g.pitch,T=g.bearing;g.setFreeCameraOptions(o);const A=x!==g.zoom,M=b!==g.pitch,F=T!==g.bearing;return this.fire(new d.Event("movestart",h)).fire(new d.Event("move",h)),A&&this.fire(new d.Event("zoomstart",h)).fire(new d.Event("zoom",h)).fire(new d.Event("zoomend",h)),F&&this.fire(new d.Event("rotatestart",h)).fire(new d.Event("rotate",h)).fire(new d.Event("rotateend",h)),M&&this.fire(new d.Event("pitchstart",h)).fire(new d.Event("pitch",h)).fire(new d.Event("pitchend",h)),this.fire(new d.Event("moveend",h)),this}easeTo(o,h){this._stop(!1,o.easeId),(!1===(o=d.extend({offset:[0,0],duration:500,easing:d.ease},o)).animate||!o.essential&&d.exported.prefersReducedMotion)&&(o.duration=0);const g=this.transform,x=this.getZoom(),b=this.getBearing(),T=this.getPitch(),A=this.getPadding(),M="zoom"in o?+o.zoom:x,F="bearing"in o?this._normalizeBearing(o.bearing,b):b,L="pitch"in o?+o.pitch:T,B="padding"in o?o.padding:g.padding,U=d.pointGeometry.convert(o.offset);let $=g.centerPoint.add(U);const K=g.pointLocation($),Y=d.LngLat.convert(o.center||K);this._normalizeCenter(Y);const le=g.project(K),Z=g.project(Y).sub(le),Q=g.zoomScale(M-x);let ae,he;o.around&&(ae=d.LngLat.convert(o.around),he=g.locationPoint(ae));const ge={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||M!==x,this._rotating=this._rotating||b!==F,this._pitching=this._pitching||L!==T,this._padding=!g.isPaddingEqual(B),this._easeId=o.easeId,this._prepareEase(h,o.noMoveStart,ge),this._ease(J=>{if(this._zooming&&(g.zoom=d.number(x,M,J)),this._rotating&&(g.bearing=d.number(b,F,J)),this._pitching&&(g.pitch=d.number(T,L,J)),this._padding&&(g.interpolatePadding(A,B,J),$=g.centerPoint.add(U)),ae)g.setLocationAtPoint(ae,he);else{const we=g.zoomScale(g.zoom-x),$e=M>x?Math.min(2,Q):Math.max(.5,Q),Xe=Math.pow($e,1-J),ve=g.unproject(le.add(Z.mult(J*Xe)).mult(we));g.setLocationAtPoint(g.renderWorldCopies?ve.wrap():ve,$)}this._fireMoveEvents(h)},J=>{g.recenterOnTerrain(),this._afterEase(h,J)},o),this}_prepareEase(o,h,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",h||g.moving||this.fire(new d.Event("movestart",o)),this._zooming&&!g.zooming&&this.fire(new d.Event("zoomstart",o)),this._rotating&&!g.rotating&&this.fire(new d.Event("rotatestart",o)),this._pitching&&!g.pitching&&this.fire(new d.Event("pitchstart",o))}_fireMoveEvents(o){this.fire(new d.Event("move",o)),this._zooming&&this.fire(new d.Event("zoom",o)),this._rotating&&this.fire(new d.Event("rotate",o)),this._pitching&&this.fire(new d.Event("pitch",o))}_afterEase(o,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId,this.transform.cameraElevationReference="ground";const g=this._zooming,x=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new d.Event("zoomend",o)),x&&this.fire(new d.Event("rotateend",o)),b&&this.fire(new d.Event("pitchend",o)),this.fire(new d.Event("moveend",o))}flyTo(o,h){if(!o.essential&&d.exported.prefersReducedMotion){const nt=d.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(nt,h)}this.stop(),o=d.extend({offset:[0,0],speed:1.2,curve:1.42,easing:d.ease},o);const g=this.transform,x=this.getZoom(),b=this.getBearing(),T=this.getPitch(),A=this.getPadding(),M="zoom"in o?d.clamp(+o.zoom,g.minZoom,g.maxZoom):x,F="bearing"in o?this._normalizeBearing(o.bearing,b):b,L="pitch"in o?+o.pitch:T,B="padding"in o?o.padding:g.padding,U=g.zoomScale(M-x),$=d.pointGeometry.convert(o.offset);let K=g.centerPoint.add($);const Y=g.pointLocation(K),le=d.LngLat.convert(o.center||Y);this._normalizeCenter(le);const Z=g.project(Y),Q=g.project(le).sub(Z);let ae=o.curve;const he=Math.max(g.width,g.height),ge=he/U,J=Q.mag();if("minZoom"in o){const nt=d.clamp(Math.min(o.minZoom,x,M),g.minZoom,g.maxZoom),bt=he/g.zoomScale(nt-x);ae=Math.sqrt(bt/J*2)}const we=ae*ae;function $e(nt){const bt=(ge*ge-he*he+(nt?-1:1)*we*we*J*J)/(2*(nt?ge:he)*we*J);return Math.log(Math.sqrt(bt*bt+1)-bt)}function Xe(nt){return(Math.exp(nt)-Math.exp(-nt))/2}function ve(nt){return(Math.exp(nt)+Math.exp(-nt))/2}const Ne=$e(0);let mt=function(nt){return ve(Ne)/ve(Ne+ae*nt)},vt=function(nt){return he*((ve(Ne)*(Xe(bt=Ne+ae*nt)/ve(bt))-Xe(Ne))/we)/J;var bt},gt=($e(1)-Ne)/ae;if(Math.abs(J)<1e-6||!isFinite(gt)){if(Math.abs(he-ge)<1e-6)return this.easeTo(o,h);const nt=ge<he?-1:1;gt=Math.abs(Math.log(ge/he))/ae,vt=function(){return 0},mt=function(bt){return Math.exp(nt*ae*bt)}}return o.duration="duration"in o?+o.duration:1e3*gt/("screenSpeed"in o?+o.screenSpeed/ae:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=b!==F,this._pitching=L!==T,this._padding=!g.isPaddingEqual(B),this._prepareEase(h,!1),this._ease(nt=>{const bt=nt*gt,Xt=1/mt(bt);g.zoom=1===nt?M:x+g.scaleZoom(Xt),this._rotating&&(g.bearing=d.number(b,F,nt)),this._pitching&&(g.pitch=d.number(T,L,nt)),this._padding&&(g.interpolatePadding(A,B,nt),K=g.centerPoint.add($));const zt=1===nt?le:g.unproject(Z.add(Q.mult(vt(bt))).mult(Xt));g.setLocationAtPoint(g.renderWorldCopies?zt.wrap():zt,K),g._updateCenterElevation(),this._fireMoveEvents(h)},()=>this._afterEase(h),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const g=this._onEaseEnd;delete this._onEaseEnd,g.call(this,h)}if(!o){const g=this.handlers;g&&g.stop(!1)}return this}_ease(o,h,g){!1===g.animate||0===g.duration?(o(1),h()):(this._easeStart=d.exported.now(),this._easeOptions=g,this._onEaseFrame=o,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((d.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,h){o=d.wrap(o,-180,180);const g=Math.abs(o-h);return Math.abs(o-360-h)<g&&(o-=360),Math.abs(o+360-h)<g&&(o+=360),o}_normalizeCenter(o){const h=this.transform;if(!h.renderWorldCopies||h.lngRange)return;const g=o.lng-h.center.lng;o.lng+=g>180?-360:g<-180?360:0}}class Wl{constructor(o={}){this.options=o,d.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){const h=this.options&&this.options.compact;return this._map=o,this._container=ie.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ie.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ie.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===h&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){ie.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(o,h){const g=this._map._getUIString(`AttributionControl.${h}`);o.title=g,o.setAttribute("aria-label",g)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||d.config.ACCESS_TOKEN}];if(o){const g=h.reduce((x,b,T)=>(b.value&&(x+=`${b.key}=${b.value}${T<h.length-1?"&":""}`),x),"?");o.href=`${d.config.FEEDBACK_URL}/${g}${this._map._hash?this._map._hash.getHashString(!0):""}`,o.rel="noopener nofollow",this._setElementTitle(o,"MapFeedback")}}_updateData(o){!o||"metadata"!==o.sourceDataType&&"visibility"!==o.sourceDataType&&"style"!==o.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=o.concat(this.options.customAttribution.map(x=>"string"!=typeof x?"":x)):"string"==typeof this.options.customAttribution&&o.push(this.options.customAttribution)),this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const h=this._map.style._sourceCaches;for(const x in h){const b=h[x];if(b.used){const T=b.getSource();T.attribution&&o.indexOf(T.attribution)<0&&o.push(T.attribution)}}o.sort((x,b)=>x.length-b.length),o=o.filter((x,b)=>{for(let T=b+1;T<o.length;T++)if(o[T].indexOf(x)>=0)return!1;return!0});const g=o.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,o.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Xl{constructor(){d.bindAll(["_updateLogo"],this),d.bindAll(["_updateCompact"],this)}onAdd(o){this._map=o,this._container=ie.create("div","mapboxgl-ctrl");const h=ie.create("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){ie.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&"metadata"!==o.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const o=this._map.style._sourceCaches;if(0===Object.entries(o).length)return!0;for(const h in o){const g=o[h].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){const o=this._container.children;if(o.length){const h=o[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class nu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const h=++this._id;return this._queue.push({callback:o,id:h,cancelled:!1}),h}remove(o){const h=this._currentlyRunning,g=h?this._queue.concat(h):this._queue;for(const x of g)if(x.id===o)return void(x.cancelled=!0)}run(o=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const g of h)if(!g.cancelled&&(g.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Kl(p,o,h){if(p=new d.LngLat(p.lng,p.lat),o){const g=new d.LngLat(p.lng-360,p.lat),x=new d.LngLat(p.lng+360,p.lat),b=360*Math.ceil(Math.abs(p.lng-h.center.lng)/360),T=h.locationPoint(p).distSqr(o),A=o.x<0||o.y<0||o.x>h.width||o.y>h.height;h.locationPoint(g).distSqr(o)<T&&(A||Math.abs(g.lng-h.center.lng)<b)?p=g:h.locationPoint(x).distSqr(o)<T&&(A||Math.abs(x.lng-h.center.lng)<b)&&(p=x)}for(;Math.abs(p.lng-h.center.lng)>180;){const g=h.locationPoint(p);if(g.x>=0&&g.y>=0&&g.x<=h.width&&g.y<=h.height)break;p.lng>h.center.lng?p.lng-=360:p.lng+=360}return p}const ru={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Yl extends d.Evented{constructor(o,h){if(super(),(o instanceof d.window.HTMLElement||h)&&(o=d.extend({element:o},h)),d.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&"auto"!==o.pitchAlignment?o.pitchAlignment:this._rotationAlignment,o&&o.element)this._element=o.element,this._offset=d.pointGeometry.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=ie.create("div"),this._element.setAttribute("aria-label","Map marker");const x=ie.createNS("http://www.w3.org/2000/svg","svg"),b=41,T=27;x.setAttributeNS(null,"display","block"),x.setAttributeNS(null,"height",`${b}px`),x.setAttributeNS(null,"width",`${T}px`),x.setAttributeNS(null,"viewBox",`0 0 ${T} ${b}`);const A=ie.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"stroke","none"),A.setAttributeNS(null,"stroke-width","1"),A.setAttributeNS(null,"fill","none"),A.setAttributeNS(null,"fill-rule","evenodd");const M=ie.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill-rule","nonzero");const F=ie.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"transform","translate(3.0, 29.0)"),F.setAttributeNS(null,"fill","#000000");const L=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ae of L){const he=ie.createNS("http://www.w3.org/2000/svg","ellipse");he.setAttributeNS(null,"opacity","0.04"),he.setAttributeNS(null,"cx","10.5"),he.setAttributeNS(null,"cy","5.80029008"),he.setAttributeNS(null,"rx",ae.rx),he.setAttributeNS(null,"ry",ae.ry),F.appendChild(he)}const B=ie.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"fill",this._color);const U=ie.createNS("http://www.w3.org/2000/svg","path");U.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),B.appendChild(U);const $=ie.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"opacity","0.25"),$.setAttributeNS(null,"fill","#000000");const K=ie.createNS("http://www.w3.org/2000/svg","path");K.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),$.appendChild(K);const Y=ie.createNS("http://www.w3.org/2000/svg","g");Y.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Y.setAttributeNS(null,"fill","#FFFFFF");const le=ie.createNS("http://www.w3.org/2000/svg","g");le.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Z=ie.createNS("http://www.w3.org/2000/svg","circle");Z.setAttributeNS(null,"fill","#000000"),Z.setAttributeNS(null,"opacity","0.25"),Z.setAttributeNS(null,"cx","5.5"),Z.setAttributeNS(null,"cy","5.5"),Z.setAttributeNS(null,"r","5.4999962");const Q=ie.createNS("http://www.w3.org/2000/svg","circle");Q.setAttributeNS(null,"fill","#FFFFFF"),Q.setAttributeNS(null,"cx","5.5"),Q.setAttributeNS(null,"cy","5.5"),Q.setAttributeNS(null,"r","5.4999962"),le.appendChild(Z),le.appendChild(Q),M.appendChild(F),M.appendChild(B),M.appendChild($),M.appendChild(Y),M.appendChild(le),x.appendChild(M),x.setAttributeNS(null,"height",b*this._scale+"px"),x.setAttributeNS(null,"width",T*this._scale+"px"),this._element.appendChild(x),this._offset=d.pointGeometry.convert(o&&o.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});const g=this._element.classList;for(const x in ru)g.remove(`mapboxgl-marker-anchor-${x}`);g.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(o){return this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),ie.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=d.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const h=38.1,g=13.5,x=Math.sqrt(Math.pow(g,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-h],"bottom-left":[x,-1*(h-g+x)],"bottom-right":[-x,-1*(h-g+x)],left:[g,-1*(h-g)],right:[-g,-1*(h-g)]}:this._offset}this._popup=o,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(o){const h=o.code,g=o.charCode||o.keyCode;"Space"!==h&&"Enter"!==h&&32!==g&&13!==g||this.togglePopup()}_onMapClick(o){const h=o.originalEvent.target,g=this._element;this._popup&&(h===g||g.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?o.remove():o.addTo(this._map),this):this}_evaluateOpacity(){const o=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(o))return void this._clearFadeTimer();const h=this._map.unproject(o);let g=!1;if(this._map.getTerrain()){const b=this._map.getFreeCameraOptions();if(b.position){const T=b.position.toLngLat();g=T.distanceTo(h)<.9*T.distanceTo(this._lngLat)}}const x=(1-this._map._queryFogOpacity(h))*(g?.2:1);this._element.style.opacity=`${x}`,this._popup&&this._popup._setOpacity(`${x}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(o){const h=this._map.transform;return!!o&&o.x>=0&&o.x<h.width&&o.y>=0&&o.y<h.height}_update(o){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Kl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset());let h="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?h=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let g="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?g="rotateX(0deg)":"map"===this._pitchAlignment&&(g=`rotateX(${this._map.getPitch()}deg)`),o&&"moveend"!==o.type||(this._pos=this._pos.round()),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&ie.setTransform(this._element,`${ru[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${g} ${h}`),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})}_transformedOffset(){if(!this._defaultMarker)return this._offset;const o=this._map.transform,h=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&h._rotate(o.angle),"map"===this._pitchAlignment&&(h.y*=Math.cos(o._pitch)),h}getOffset(){return this._offset}setOffset(o){return this._offset=d.pointGeometry.convert(o),this._update(),this}_onMove(o){if(!this._isDragging){const h=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new d.Event("dragstart"))),this.fire(new d.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new d.Event("dragend")),this._state="inactive"}_addDragHandler(o){this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&"auto"!==o?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class Ql{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;const h=d.easeCubicInOut((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,h,g){this._start=this.getValue(h),this._end=o,this._startTime=h,this._endTime=h+g}}const iu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},{HTMLImageElement:ll,HTMLElement:oh,ImageBitmap:Bs}=d.window,Jl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function ec(p){p.parentNode&&p.parentNode.removeChild(p)}const hd={showCompass:!0,showZoom:!0,visualizePitch:!1};class ri{constructor(o,h,g=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new th({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,g&&(this.mousePitch=new gs({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),d.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),ie.addEventListener(h,"mousedown",this.mousedown),ie.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),ie.addEventListener(h,"touchmove",this.touchmove),ie.addEventListener(h,"touchend",this.touchend),ie.addEventListener(h,"touchcancel",this.reset)}down(o,h){this.mouseRotate.mousedown(o,h),this.mousePitch&&this.mousePitch.mousedown(o,h),ie.disableDrag()}move(o,h){const g=this.map,x=this.mouseRotate.mousemoveWindow(o,h);if(x&&x.bearingDelta&&g.setBearing(g.getBearing()+x.bearingDelta),this.mousePitch){const b=this.mousePitch.mousemoveWindow(o,h);b&&b.pitchDelta&&g.setPitch(g.getPitch()+b.pitchDelta)}}off(){const o=this.element;ie.removeEventListener(o,"mousedown",this.mousedown),ie.removeEventListener(o,"touchstart",this.touchstart,{passive:!1}),ie.removeEventListener(o,"touchmove",this.touchmove),ie.removeEventListener(o,"touchend",this.touchend),ie.removeEventListener(o,"touchcancel",this.reset),this.offTemp()}offTemp(){ie.enableDrag(),ie.removeEventListener(d.window,"mousemove",this.mousemove),ie.removeEventListener(d.window,"mouseup",this.mouseup)}mousedown(o){this.down(d.extend({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),ie.mousePos(this.element,o)),ie.addEventListener(d.window,"mousemove",this.mousemove),ie.addEventListener(d.window,"mouseup",this.mouseup)}mousemove(o){this.move(o,ie.mousePos(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){1!==o.targetTouches.length?this.reset():(this._startPos=this._lastPos=ie.touchPos(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){1!==o.targetTouches.length?this.reset():(this._lastPos=ie.touchPos(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){0===o.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const _s={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let Gn,cl=0,ya=!1;const Xf={maxWidth:100,unit:"metric"};function dd(p,o,h){const g=h&&h.maxWidth||100,x=p._container.getBoundingClientRect().height/2,b=p.unproject([0,x]),T=p.unproject([g,x]),A=b.distanceTo(T);if(h&&"imperial"===h.unit){const M=3.2808*A;M>5280?va(o,g,M/5280,p._getUIString("ScaleControl.Miles"),p):va(o,g,M,p._getUIString("ScaleControl.Feet"),p)}else h&&"nautical"===h.unit?va(o,g,A/1852,p._getUIString("ScaleControl.NauticalMiles"),p):A>=1e3?va(o,g,A/1e3,p._getUIString("ScaleControl.Kilometers"),p):va(o,g,A,p._getUIString("ScaleControl.Meters"),p)}function va(p,o,h,g,x){const b=function(A){const M=Math.pow(10,`${Math.floor(A)}`.length-1);let F=A/M;return F=F>=10?10:F>=5?5:F>=3?3:F>=2?2:F>=1?1:function(L){const B=Math.pow(10,Math.ceil(-Math.log(L)/Math.LN10));return Math.round(L*B)/B}(F),M*F}(h),T=b/h;x._requestDomTask(()=>{p.style.width=o*T+"px",p.innerHTML=`${b}&nbsp;${g}`})}const fd={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},tc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),xa={version:d.version,supported:re,setRTLTextPlugin:d.setRTLTextPlugin,getRTLTextPluginStatus:d.getRTLTextPluginStatus,Map:class extends tu{constructor(p){if(null!=(p=d.extend({},Jl,p)).minZoom&&null!=p.maxZoom&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=p.minPitch&&null!=p.maxPitch&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=p.minPitch&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=p.maxPitch&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new rl(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),p),this._interactive=p.interactive,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._optimizeForTerrain=p.optimizeForTerrain,this._renderTaskQueue=new nu,this._domRenderTaskQueue=new nu,this._controls=[],this._markers=[],this._mapId=d.uniqueId(),this._locale=d.extend({},iu,p.locale),this._clickTolerance=p.clickTolerance,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new Ql(0),this._requestManager=new d.RequestManager(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,"string"==typeof p.container){if(this._container=d.window.document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof oh))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(p.maxBounds&&this.setMaxBounds(p.maxBounds),d.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==d.window&&(d.window.addEventListener("online",this._onWindowOnline,!1),d.window.addEventListener("resize",this._onWindowResize,!1),d.window.addEventListener("orientationchange",this._onWindowResize,!1),d.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new ih(this,p),this._hash=p.hash&&new Zf("string"==typeof p.hash&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,d.extend({},p.fitBoundsOptions,{duration:0})))),this.resize(),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,p.style&&this.setStyle(p.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.attributionControl&&this.addControl(new Wl({customAttribution:p.customAttribution})),this._logoControl=new Xl,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update("style"===o.dataType),this.fire(new d.Event(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new d.Event(`${o.dataType}dataloading`,o))})}_getMapId(){return this._mapId}addControl(p,o){if(void 0===o&&(o=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new d.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=p.onAdd(this);this._controls.push(p);const g=this._controlPositions[o];return-1!==o.indexOf("bottom")?g.insertBefore(h,g.firstChild):g.appendChild(h),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new d.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(p);return o>-1&&this._controls.splice(o,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){const[o,h]=this._containerDimensions();if(o===this.transform.width&&h===this.transform.height)return this;this._resizeCanvas(o,h),this.transform.resize(o,h),this.painter.resize(Math.ceil(o),Math.ceil(h));const g=!this._moving;return g&&this.fire(new d.Event("movestart",p)).fire(new d.Event("move",p)),this.fire(new d.Event("resize",p)),g&&this.fire(new d.Event("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(p){return this.transform.setMaxBounds(d.LngLatBounds.convert(p)),this._update()}setMinZoom(p){if((p=null==p?-2:p)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p&&this.setZoom(p),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=null==p?22:p)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p&&this.setZoom(p),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=null==p?0:p)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p&&this.setPitch(p),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=null==p?85:p)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p&&this.setPitch(p),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}project(p){return this.transform.locationPoint3D(d.LngLat.convert(p))}unproject(p){return this.transform.pointLocation3D(d.pointGeometry.convert(p))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(p,o,h){if("mouseenter"===p||"mouseover"===p){let g=!1;return{layer:o,listener:h,delegates:{mousemove:b=>{const T=this.getLayer(o)?this.queryRenderedFeatures(b.point,{layers:[o]}):[];T.length?g||(g=!0,h.call(this,new ir(p,this,b.originalEvent,{features:T}))):g=!1},mouseout:()=>{g=!1}}}}if("mouseleave"===p||"mouseout"===p){let g=!1;return{layer:o,listener:h,delegates:{mousemove:T=>{(this.getLayer(o)?this.queryRenderedFeatures(T.point,{layers:[o]}):[]).length?g=!0:g&&(g=!1,h.call(this,new ir(p,this,T.originalEvent)))},mouseout:T=>{g&&(g=!1,h.call(this,new ir(p,this,T.originalEvent)))}}}}{const g=x=>{const b=this.getLayer(o)?this.queryRenderedFeatures(x.point,{layers:[o]}):[];b.length&&(x.features=b,h.call(this,x),delete x.features)};return{layer:o,listener:h,delegates:{[p]:g}}}}on(p,o,h){if(void 0===h)return super.on(p,o);const g=this._createDelegatedListener(p,o,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(g);for(const x in g.delegates)this.on(x,g.delegates[x]);return this}once(p,o,h){if(void 0===h)return super.once(p,o);const g=this._createDelegatedListener(p,o,h);for(const x in g.delegates)this.once(x,g.delegates[x]);return this}off(p,o,h){return void 0===h?super.off(p,o):(this._delegatedListeners&&this._delegatedListeners[p]&&(g=>{const x=this._delegatedListeners[p];for(let b=0;b<x.length;b++){const T=x[b];if(T.layer===o&&T.listener===h){for(const A in T.delegates)this.off(A,T.delegates[A]);return x.splice(b,1),this}}})(),this)}queryRenderedFeatures(p,o){return this.style?(void 0!==o||void 0===p||p instanceof d.pointGeometry||Array.isArray(p)||(o=p,p=void 0),this.style.queryRenderedFeatures(p=p||[[0,0],[this.transform.width,this.transform.height]],o=o||{},this.transform)):[]}querySourceFeatures(p,o){return this.style.querySourceFeatures(p,o)}queryTerrainElevation(p,o){const h=this.transform.elevation;return h?(o=d.extend({},{exaggerated:!0},o),h.getAtPoint(d.MercatorCoordinate.fromLngLat(p),null,o.exaggerated)):null}setStyle(p,o){return!1!==(o=d.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o)).diff&&o.localIdeographFontFamily===this._localIdeographFontFamily&&o.localFontFamily===this._localFontFamily&&this.style&&p?(this._diffStyle(p,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(p,o))}_getUIString(p){const o=this._locale[p];if(null==o)throw new Error(`Missing UI string '${p}'`);return o}_updateStyle(p,o){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),p&&(this.style=new xo(this,o||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof p?this.style.loadURL(p):this.style.loadJSON(p)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new xo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,o){if("string"==typeof p){const h=this._requestManager.normalizeStyleURL(p),g=this._requestManager.transformRequest(h,d.ResourceType.Style);d.getJSON(g,(x,b)=>{x?this.fire(new d.ErrorEvent(x)):b&&this._updateDiff(b,o)})}else"object"==typeof p&&this._updateDiff(p,o)}_updateDiff(p,o){try{this.style.setState(p)&&this._update(!0)}catch(h){d.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(p,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():d.warnOnce("There is no style added to the map.")}addSource(p,o){return this._lazyInitEmptyStyle(),this.style.addSource(p,o),this._update(!0)}isSourceLoaded(p){const o=this.style&&this.style._getSourceCaches(p);if(0!==o.length)return o.every(h=>h.loaded());this.fire(new d.ErrorEvent(new Error(`There is no source with ID '${p}'`)))}areTilesLoaded(){const p=this.style&&this.style._sourceCaches;for(const o in p){const h=p[o]._tiles;for(const g in h){const x=h[g];if("loaded"!==x.state&&"errored"!==x.state)return!1}}return!0}addSourceType(p,o,h){return this._lazyInitEmptyStyle(),this.style.addSourceType(p,o,h)}removeSource(p){return this.style.removeSource(p),this._updateTerrain(),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,o,{pixelRatio:h=1,sdf:g=!1,stretchX:x,stretchY:b,content:T}={}){if(this._lazyInitEmptyStyle(),o instanceof ll||Bs&&o instanceof Bs){const{width:A,height:M,data:F}=d.exported.getImageData(o);this.style.addImage(p,{data:new d.RGBAImage({width:A,height:M},F),pixelRatio:h,stretchX:x,stretchY:b,content:T,sdf:g,version:0})}else{if(void 0===o.width||void 0===o.height)return this.fire(new d.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:A,height:M,data:F}=o,L=o;this.style.addImage(p,{data:new d.RGBAImage({width:A,height:M},new Uint8Array(F)),pixelRatio:h,stretchX:x,stretchY:b,content:T,sdf:g,version:0,userImage:L}),L.onAdd&&L.onAdd(this,p)}}}updateImage(p,o){const h=this.style.getImage(p);if(!h)return this.fire(new d.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=o instanceof ll||Bs&&o instanceof Bs?d.exported.getImageData(o):o,{width:x,height:b,data:T}=g;return void 0===x||void 0===b?this.fire(new d.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):x!==h.data.width||b!==h.data.height?this.fire(new d.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(h.data.replace(T,!(o instanceof ll||Bs&&o instanceof Bs)),void this.style.updateImage(p,h))}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new d.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,o){d.getImage(this._requestManager.transformRequest(p,d.ResourceType.Image),(h,g)=>{o(h,g instanceof ll?d.exported.getImageData(g):g)})}listImages(){return this.style.listImages()}addLayer(p,o){return this._lazyInitEmptyStyle(),this.style.addLayer(p,o),this._update(!0)}moveLayer(p,o){return this.style.moveLayer(p,o),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}setLayerZoomRange(p,o,h){return this.style.setLayerZoomRange(p,o,h),this._update(!0)}setFilter(p,o,h={}){return this.style.setFilter(p,o,h),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,o,h,g={}){return this.style.setPaintProperty(p,o,h,g),this._update(!0)}getPaintProperty(p,o){return this.style.getPaintProperty(p,o)}setLayoutProperty(p,o,h,g={}){return this.style.setLayoutProperty(p,o,h,g),this._update(!0)}getLayoutProperty(p,o){return this.style.getLayoutProperty(p,o)}setLight(p,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,o),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(p){return this._lazyInitEmptyStyle(),this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(d.LngLat.convert(p),this.transform):0}setFeatureState(p,o){return this.style.setFeatureState(p,o),this._update()}removeFeatureState(p,o){return this.style.removeFeatureState(p,o),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}_containerDimensions(){let p=0,o=0;return this._container&&(p=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300),[p,o]}_detectMissingCSS(){"rgb(250, 128, 114)"!==d.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&d.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=ie.create("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const o=this._canvasContainer=ie.create("div","mapboxgl-canvas-container",p);this._interactive&&o.classList.add("mapboxgl-interactive"),this._canvas=ie.create("canvas","mapboxgl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const h=this._containerDimensions();this._resizeCanvas(h[0],h[1]);const g=this._controlContainer=ie.create("div","mapboxgl-control-container",p),x=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{x[b]=ie.create("div",`mapboxgl-ctrl-${b}`,g)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,o){const h=d.exported.devicePixelRatio||1;this._canvas.width=h*Math.ceil(p),this._canvas.height=h*Math.ceil(o),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${o}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const o=this._markers.indexOf(p);-1!==o&&this._markers.splice(o,1)}_setupPainter(){const p=d.extend({},re.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl",p)||this._canvas.getContext("experimental-webgl",p);o?(d.storeAuthState(o,!0),this.painter=new Xc(o,this.transform),this.on("data",h=>{"source"===h.dataType&&this.painter.setTileLoadedFlag(!0)}),d.exported$1.testSupport(o)):this.fire(new d.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new d.Event("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.resize(),this._update(),this.fire(new d.Event("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.isMoving()&&this.loaded()?p():this._domRenderTaskQueue.add(p)}_render(p){let o;const h=this.painter.context.extTimerQuery,g=d.exported.now();this.listens("gpu-timing-frame")&&(o=h.createQueryEXT(),h.beginQueryEXT(h.TIME_ELAPSED_EXT,o));let x=this._updateAverageElevation(g);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;let b=!1;const T=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const M=this.transform.zoom,F=d.exported.now();this.style.zoomHistory.update(M,F);const L=new d.EvaluationParameters(M,{now:F,fadeDuration:T,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),B=L.crossFadingFactor();1===B&&B===this._crossFadingFactor||(b=!0,this._crossFadingFactor=B),this.style.update(L)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,T,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:T,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new d.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new d.Event("load"))),this.style&&(this.style.hasTransitions()||b)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const M=d.exported.now()-g;h.endQueryEXT(h.TIME_ELAPSED_EXT,o),setTimeout(()=>{const F=h.getQueryObjectEXT(o,h.QUERY_RESULT_EXT)/1e6;h.deleteQueryEXT(o),this.fire(new d.Event("gpu-timing-frame",{cpuTime:M,gpuTime:F}))},50)}if(this.listens("gpu-timing-layer")){const M=this.painter.collectGpuTimers();setTimeout(()=>{const F=this.painter.queryGpuTimers(M);this.fire(new d.Event("gpu-timing-layer",{layerTimes:F}))},50)}const A=this._sourcesDirty||this._styleDirty||this._placementDirty||x;if(A||this._repaint)this.triggerRepaint();else{const M=!this.isMoving()&&this.loaded();if(M&&(x=this._updateAverageElevation(g,!0)),x)this.triggerRepaint();else if(this._triggerFrame(!1),M&&(this.fire(new d.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const F=this._calculateSpeedIndex();this.fire(new d.Event("speedindexcompleted",{speedIndex:F})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const p of this._markers)p._update()}_updateAverageElevation(p,o=!1){const h=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&h(0);if((o||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const g=this.transform.averageElevation;let x=this.transform.sampleAverageElevation();isNaN(x)?x=0:this._averageElevationLastSampledAt=p;const b=Math.abs(g-x);if(b>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(x),h(x);this._averageElevation.easeTo(x,p,300)}else if(b>1e-4)return this._averageElevation.jumpTo(x),h(x)}return!!this._averageElevation.isEasing(p)&&h(this._averageElevation.getValue(p))}_authenticate(){d.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===d.AUTH_ERR_MSG||401===p.status)){const o=this.painter.context.gl;d.storeAuthState(o,!1),this._logoControl instanceof Xl&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new d.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),d.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());const h=this.painter.context.gl,g=h.createFramebuffer();function x(b){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,b,0);const T=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,T),T}return h.bindFramebuffer(h.FRAMEBUFFER,g),this._canvasPixelComparison(x(p),o.canvasCopies.map(x),o.timeStamps)}_canvasPixelComparison(p,o,h){let g=h[1]-h[0];const x=p.length/4;for(let b=0;b<o.length;b++){const T=o[b];let A=0;for(let M=0;M<T.length;M+=4)T[M]===p[M]&&T[M+1]===p[M+1]&&T[M+2]===p[M+2]&&T[M+3]===p[M+3]&&(A+=1);g+=(h[b+2]-h[b+1])*(1-A/x)}return g}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==d.window&&(d.window.removeEventListener("resize",this._onWindowResize,!1),d.window.removeEventListener("orientationchange",this._onWindowResize,!1),d.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),d.window.removeEventListener("online",this._onWindowOnline,!1));const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),ec(this._canvasContainer),ec(this._controlContainer),ec(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),d.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new d.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=d.exported.frame(o=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(o)}))}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}_setCacheLimits(p,o){d.setCacheLimits(p,o)}get version(){return d.version}},NavigationControl:class{constructor(p){this.options=d.extend({},hd,p),this._container=ie.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(d.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>this._map.zoomIn({},{originalEvent:o})),ie.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>this._map.zoomOut({},{originalEvent:o})),ie.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(d.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}),this._compassIcon=ie.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const p=this._map.getZoom(),o=p===this._map.getMaxZoom(),h=p===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const p=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=p)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ri(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){ie.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(p,o){const h=ie.create("button",p,this._container);return h.type="button",h.addEventListener("click",o),h}_setButtonTitle(p,o){const h=this._map._getUIString(`NavigationControl.${o}`);p.title=h,p.setAttribute("aria-label",h)}},GeolocateControl:class extends d.Evented{constructor(p){super(),this.options=d.extend({},_s,p),d.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=Kc(this._updateMarkerRotation,20)}onAdd(p){var o;return this._map=p,this._container=ie.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),o=this._setupUI,void 0!==Gn?o(Gn):void 0!==d.window.navigator.permissions?d.window.navigator.permissions.query({name:"geolocation"}).then(h=>{Gn="denied"!==h.state,o(Gn)}):(Gn=!!d.window.navigator.geolocation,o(Gn)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(d.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ie.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,cl=0,ya=!1}_isOutOfMapMaxBounds(p){const o=this._map.getMaxBounds(),h=p.coords;return o&&(h.longitude<o.getWest()||h.longitude>o.getEast()||h.latitude<o.getSouth()||h.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new d.Event("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(p),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(p),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new d.Event("geolocate",p)),this._finish()}}_updateCamera(p){const o=new d.LngLat(p.coords.longitude,p.coords.latitude),h=p.coords.accuracy,g=this._map.getBearing(),x=d.extend({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(h),x,{geolocateSource:!0})}_updateMarker(p){if(p){const o=new d.LngLat(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map._container.getBoundingClientRect().height/2,o=this._map.unproject([0,p]),h=this._map.unproject([100,p]),g=o.distanceTo(h)/100,x=Math.ceil(2*this._accuracy/g);this._circleElement.style.width=`${x}px`,this._circleElement.style.height=`${x}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(1===p.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===p.code&&ya)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new d.Event("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=ie.create("button","mapboxgl-ctrl-geolocate",this._container),ie.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===p){d.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ie.create("div","mapboxgl-user-location"),this._dotElement.appendChild(ie.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ie.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Yl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ie.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Yl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||"ACTIVE_LOCK"!==this._watchState||o.originalEvent&&"resize"===o.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new d.Event("trackuserlocationend")))})}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:!0===p.absolute&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return d.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":cl--,ya=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new d.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),cl++,cl>1?(p={maximumAge:6e5,timeout:0},ya=!0):(p=this.options.positionOptions,ya=!1),this._geolocationWatchID=d.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else d.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{d.window.addEventListener("ondeviceorientationabsolute"in d.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};void 0!==d.window.DeviceMotionEvent&&"function"==typeof d.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(o=>{"granted"===o&&p()}).catch(console.error):p()}_clearWatch(){d.window.navigator.geolocation.clearWatch(this._geolocationWatchID),d.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),d.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Wl,ScaleControl:class{constructor(p){this.options=d.extend({},Xf,p),d.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){dd(this._map,this._container,this.options)}onAdd(p){return this._map=p,this._container=ie.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){ie.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(p){this.options.unit=p,dd(this._map,this._container,this.options)}},FullscreenControl:class{constructor(p){this._fullscreen=!1,p&&p.container&&(p.container instanceof d.window.HTMLElement?this._container=p.container:d.warnOnce("Full screen control 'container' must be a DOM element.")),d.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in d.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in d.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=ie.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",d.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){ie.remove(this._controlContainer),this._map=null,d.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!d.window.document.fullscreenEnabled&&!d.window.document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=ie.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ie.create("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden",!0),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),d.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.title=p}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(d.window.document.fullscreenElement||d.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?d.window.document.exitFullscreen?d.window.document.exitFullscreen():d.window.document.webkitCancelFullScreen&&d.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends d.Evented{constructor(p){super(),this.options=d.extend(Object.create(fd),p),d.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new d.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&ie.remove(this._content),this._container&&(ie.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new d.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(p){return this._lngLat=d.LngLat.convert(p),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(d.window.document.createTextNode(p))}setHTML(p){const o=d.window.document.createDocumentFragment(),h=d.window.document.createElement("body");let g;for(h.innerHTML=p;g=h.firstChild,g;)o.appendChild(g);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ie.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._container&&this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._container&&this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let o;return this._classList.delete(p)?o=!1:(this._classList.add(p),o=!0),this._container&&this._updateClassList(),o}_createCloseButton(){this.options.closeButton&&(this._closeButton=ie.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(p){this._update(p.point)}_onMouseMove(p){this._update(p.point)}_onDrag(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const o=this._pos,h=this._container.offsetWidth,g=this._container.offsetHeight;let x;return x=o.y+p.bottom.y<g?["top"]:o.y>this._map.transform.height-g?["bottom"]:[],o.x<h/2?x.push("left"):o.x>this._map.transform.width-h/2&&x.push("right"),0===x.length?"bottom":x.join("-")}_updateClassList(){const p=[...this._classList];p.push("mapboxgl-popup"),this._anchor&&p.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&p.push("mapboxgl-popup-track-pointer"),this._container.className=p.join(" ")}_update(p){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=ie.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=ie.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Kl(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||p){const o=this._pos=this._trackPointer&&p?p:this._map.project(this._lngLat),h=function(b){if(b||(b=new d.pointGeometry(0,0)),"number"==typeof b){const T=Math.round(Math.sqrt(.5*Math.pow(b,2)));return{center:new d.pointGeometry(0,0),top:new d.pointGeometry(0,b),"top-left":new d.pointGeometry(T,T),"top-right":new d.pointGeometry(-T,T),bottom:new d.pointGeometry(0,-b),"bottom-left":new d.pointGeometry(T,-T),"bottom-right":new d.pointGeometry(-T,-T),left:new d.pointGeometry(b,0),right:new d.pointGeometry(-b,0)}}if(b instanceof d.pointGeometry||Array.isArray(b)){const T=d.pointGeometry.convert(b);return{center:T,top:T,"top-left":T,"top-right":T,bottom:T,"bottom-left":T,"bottom-right":T,left:T,right:T}}return{center:d.pointGeometry.convert(b.center||[0,0]),top:d.pointGeometry.convert(b.top||[0,0]),"top-left":d.pointGeometry.convert(b["top-left"]||[0,0]),"top-right":d.pointGeometry.convert(b["top-right"]||[0,0]),bottom:d.pointGeometry.convert(b.bottom||[0,0]),"bottom-left":d.pointGeometry.convert(b["bottom-left"]||[0,0]),"bottom-right":d.pointGeometry.convert(b["bottom-right"]||[0,0]),left:d.pointGeometry.convert(b.left||[0,0]),right:d.pointGeometry.convert(b.right||[0,0])}}(this.options.offset),g=this._anchor=this._getAnchor(h),x=o.add(h[g]).round();this._map._requestDomTask(()=>{this._container&&g&&ie.setTransform(this._container,`${ru[g]} translate(${x.x}px,${x.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(tc);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._content&&(this._content.style.opacity=p),this._tip&&(this._tip.style.opacity=p)}},Marker:Yl,Style:xo,LngLat:d.LngLat,LngLatBounds:d.LngLatBounds,Point:d.pointGeometry,MercatorCoordinate:d.MercatorCoordinate,FreeCameraOptions:jl,Evented:d.Evented,config:d.config,prewarm:function(){ht().acquire(oe)},clearPrewarmedResources:function(){const p=Ge;p&&(p.isPreloaded()&&1===p.numActive()?(p.release(oe),Ge=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return d.config.ACCESS_TOKEN},set accessToken(p){d.config.ACCESS_TOKEN=p},get baseApiUrl(){return d.config.API_URL},set baseApiUrl(p){d.config.API_URL=p},get workerCount(){return xe.workerCount},set workerCount(p){xe.workerCount=p},get maxParallelImageRequests(){return d.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){d.config.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){d.clearTileCache(p)},workerUrl:"",workerClass:null,setNow:d.exported.setNow,restoreNow:d.exported.restoreNow};return xa}),Be}()},603:(ut,rt)=>{rt.encode=function(fe){var Be="";for(var Ae in fe)fe.hasOwnProperty(Ae)&&(Be.length&&(Be+="&"),Be+=encodeURIComponent(Ae)+"="+encodeURIComponent(fe[Ae]));return Be},rt.decode=function(fe){for(var Be={},Ae=fe.split("&"),pe=0,d=Ae.length;pe<d;pe++){var re=Ae[pe].split("=");Be[decodeURIComponent(re[0])]=decodeURIComponent(re[1])}return Be}},171:ut=>{var rt=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,fe=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];ut.exports=function(d){var re=d,Ce=d.indexOf("["),Te=d.indexOf("]");-1!=Ce&&-1!=Te&&(d=d.substring(0,Ce)+d.substring(Ce,Te).replace(/:/g,";")+d.substring(Te,d.length));for(var ne=rt.exec(d||""),ie={},Fe=14;Fe--;)ie[fe[Fe]]=ne[Fe]||"";return-1!=Ce&&-1!=Te&&(ie.source=re,ie.host=ie.host.substring(1,ie.host.length-1).replace(/;/g,":"),ie.authority=ie.authority.replace("[","").replace("]","").replace(/;/g,":"),ie.ipv6uri=!0),ie.pathNames=function(pe,d){var Ce=d.replace(/\/{2,9}/g,"/").split("/");return("/"==d.substr(0,1)||0===d.length)&&Ce.splice(0,1),"/"==d.substr(d.length-1,1)&&Ce.splice(Ce.length-1,1),Ce}(0,ie.path),ie.queryKey=function(pe,d){var re={};return d.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(Ce,Te,ne){Te&&(re[Te]=ne)}),re}(0,ie.query),ie}},561:function(ut){var Be;Be=function(){var fe=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function Be(Ce){return Ce.match(fe)||[]}function pe(Ce){return{language:(Ce=Be(Ce))[1]||"",extlang:Ce[2]||"",script:Ce[3]||"",region:Ce[4]||""}}function d(Ce,Te,ne){Object.defineProperty(Ce,Te,{value:ne,enumerable:!0})}function re(Ce,Te,ne){function ie(Fe){return Be(Fe)[Ce]||""}d(ie,"pattern",Te),d(pe,ne,ie)}return re(1,/^[a-zA-Z]{2,3}$/,"language"),re(2,/^[a-zA-Z]{3}$/,"extlang"),re(3,/^[a-zA-Z]{4}$/,"script"),re(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),d(pe,"split",function(Ce){return Be(Ce).filter(function(Te,ne){return Te&&ne})}),pe},ut.exports?ut.exports=Be():this.subtag=Be()},462:(ut,rt,fe)=>{"use strict";var Be=fe(95);ut.exports=Be,"undefined"!=typeof window&&(window.Suggestions=Be)},578:ut=>{"use strict";var rt=function(fe){return this.component=fe,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,fe.el.parentNode.insertBefore(this.wrapper,fe.el.nextSibling),this};rt.prototype.show=function(){this.element.style.display="block"},rt.prototype.hide=function(){this.element.style.display="none"},rt.prototype.add=function(fe){this.items.push(fe)},rt.prototype.clear=function(){this.items=[],this.active=0},rt.prototype.isEmpty=function(){return!this.items.length},rt.prototype.isVisible=function(){return"block"===this.element.style.display},rt.prototype.draw=function(){if(this.element.innerHTML="",0!==this.items.length){for(var fe=0;fe<this.items.length;fe++)this.drawItem(this.items[fe],this.active===fe);this.show()}else this.hide()},rt.prototype.drawItem=function(fe,Be){var Ae=document.createElement("li"),pe=document.createElement("a");Be&&(Ae.className+=" active"),pe.innerHTML=fe.string,Ae.appendChild(pe),this.element.appendChild(Ae),Ae.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),Ae.addEventListener("mouseup",function(){this.handleMouseUp.call(this,fe)}.bind(this))},rt.prototype.handleMouseUp=function(fe){this.selectingListItem=!1,this.component.value(fe.original),this.clear(),this.draw()},rt.prototype.move=function(fe){this.active=fe,this.draw()},rt.prototype.previous=function(){this.move(0===this.active?this.items.length-1:this.active-1)},rt.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)},rt.prototype.drawError=function(fe){var Be=document.createElement("li");Be.innerHTML=fe,this.element.appendChild(Be),this.show()},ut.exports=rt},95:(ut,rt,fe)=>{"use strict";var Be=fe(166),Ae=fe(499),pe=fe(578),d=function(re,Ce,Te){return this.options=Be({minLength:2,limit:5,filter:!0,hideOnBlur:!0},Te=Te||{}),this.el=re,this.data=Ce||[],this.list=new pe(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(ne){this.handleKeyUp(ne.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(ne){this.handleKeyDown(ne)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(ne){this.handlePaste(ne)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};d.prototype.handleKeyUp=function(re){40===re||38===re||27===re||13===re||9===re||this.handleInputChange(this.el.value)},d.prototype.handleKeyDown=function(re){switch(re.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&re.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next()}},d.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},d.prototype.handlePaste=function(re){if(re.clipboardData)this.handleInputChange(re.clipboardData.getData("Text"));else{var Ce=this;setTimeout(function(){Ce.handleInputChange(re.target.value)},100)}},d.prototype.handleInputChange=function(re){this.query=this.normalize(re),this.list.clear(),this.query.length<this.options.minLength?this.list.draw():this.getCandidates(function(Ce){for(var Te=0;Te<Ce.length&&(this.list.add(Ce[Te]),Te!==this.options.limit-1);Te++);this.list.draw()}.bind(this))},d.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},d.prototype.update=function(re){this.data=re,this.handleKeyUp()},d.prototype.clear=function(){this.data=[],this.list.clear()},d.prototype.normalize=function(re){return re.toLowerCase()},d.prototype.match=function(re,Ce){return re.indexOf(Ce)>-1},d.prototype.value=function(re){if(this.selected=re,this.el.value=this.getItemValue(re),document.createEvent){var Ce=document.createEvent("HTMLEvents");Ce.initEvent("change",!0,!1),this.el.dispatchEvent(Ce)}else this.el.fireEvent("onchange")},d.prototype.getCandidates=function(re){var Ce={pre:"<strong>",post:"</strong>",extract:function(ne){return this.getItemValue(ne)}.bind(this)};re(this.options.filter?Ae.filter(this.query,this.data,Ce).map(function(ne){return{original:ne.original,string:this.render(ne.original,ne.string)}}.bind(this)):this.data.map(function(ne){return{original:ne,string:this.render(ne)}}.bind(this)))},d.prototype.getItemValue=function(re){return re},d.prototype.render=function(re,Ce){if(Ce)return Ce;for(var Te=this.getItemValue(re.original?re.original:re),ne=this.normalize(Te),ie=ne.lastIndexOf(this.query);ie>-1;){var Fe=ie+this.query.length;Te=Te.slice(0,ie)+"<strong>"+Te.slice(ie,Fe)+"</strong>"+Te.slice(Fe),ie=ne.slice(0,ie).lastIndexOf(this.query)}return Te},d.prototype.renderError=function(re){this.list.drawError(re)},ut.exports=d},166:ut=>{ut.exports=function(){for(var Be={},Ae=0;Ae<arguments.length;Ae++){var pe=arguments[Ae];for(var d in pe)rt.call(pe,d)&&(Be[d]=pe[d])}return Be};var rt=Object.prototype.hasOwnProperty},391:ut=>{"use strict";var d,rt="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Be={},Ae=0,pe=0;function re(ne){var ie="";do{ie=rt[ne%64]+ie,ne=Math.floor(ne/64)}while(ne>0);return ie}function Te(){var ne=re(+new Date);return ne!==d?(Ae=0,d=ne):ne+"."+re(Ae++)}for(;pe<64;pe++)Be[rt[pe]]=pe;Te.encode=re,Te.decode=function(ne){var ie=0;for(pe=0;pe<ne.length;pe++)ie=64*ie+Be[ne.charAt(pe)];return ie},ut.exports=Te},780:(ut,rt,fe)=>{"use strict";var Be={};fe.r(Be),fe.d(Be,{Decoder:()=>Xx,Encoder:()=>X5,PacketType:()=>Nn,protocol:()=>HS});var Ae={};function pe(t){return"function"==typeof t}fe.r(Ae),fe.d(Ae,{Manager:()=>By,Socket:()=>Kx,connect:()=>Vu,default:()=>Vu,io:()=>Vu,protocol:()=>HS});let d=!1;const re={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){if(t){const e=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+e.stack)}else d&&console.log("RxJS: Back to a better error behavior. Thank you. <3");d=t},get useDeprecatedSynchronousErrorHandling(){return d}};function Ce(t){setTimeout(()=>{throw t},0)}const Te={closed:!0,next(t){},error(t){if(re.useDeprecatedSynchronousErrorHandling)throw t;Ce(t)},complete(){}},ne=Array.isArray||(t=>t&&"number"==typeof t.length);function ie(t){return null!==t&&"object"==typeof t}const Ct=(()=>{function t(e){return Error.call(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((n,r)=>`${r+1}) ${n.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e,this}return t.prototype=Object.create(Error.prototype),t})();class it{constructor(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}unsubscribe(){let e;if(this.closed)return;let{_parentOrParents:n,_ctorUnsubscribe:r,_unsubscribe:s,_subscriptions:u}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof it)n.remove(this);else if(null!==n)for(let m=0;m<n.length;++m)n[m].remove(this);if(pe(s)){r&&(this._unsubscribe=void 0);try{s.call(this)}catch(m){e=m instanceof Ct?me(m.errors):[m]}}if(ne(u)){let m=-1,v=u.length;for(;++m<v;){const E=u[m];if(ie(E))try{E.unsubscribe()}catch(S){e=e||[],S instanceof Ct?e=e.concat(me(S.errors)):e.push(S)}}}if(e)throw new Ct(e)}add(e){let n=e;if(!e)return it.EMPTY;switch(typeof e){case"function":n=new it(e);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof it)){const u=n;n=new it,n._subscriptions=[u]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}let{_parentOrParents:r}=n;if(null===r)n._parentOrParents=this;else if(r instanceof it){if(r===this)return n;n._parentOrParents=[r,this]}else{if(-1!==r.indexOf(this))return n;r.push(this)}const s=this._subscriptions;return null===s?this._subscriptions=[n]:s.push(n),n}remove(e){const n=this._subscriptions;if(n){const r=n.indexOf(e);-1!==r&&n.splice(r,1)}}}var t;function me(t){return t.reduce((e,n)=>e.concat(n instanceof Ct?n.errors:n),[])}it.EMPTY=((t=new it).closed=!0,t);const Pe="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random();class Le extends it{constructor(e,n,r){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=Te;break;case 1:if(!e){this.destination=Te;break}if("object"==typeof e){e instanceof Le?(this.syncErrorThrowable=e.syncErrorThrowable,this.destination=e,e.add(this)):(this.syncErrorThrowable=!0,this.destination=new et(this,e));break}default:this.syncErrorThrowable=!0,this.destination=new et(this,e,n,r)}}[Pe](){return this}static create(e,n,r){const s=new Le(e,n,r);return s.syncErrorThrowable=!1,s}next(e){this.isStopped||this._next(e)}error(e){this.isStopped||(this.isStopped=!0,this._error(e))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(e){this.destination.next(e)}_error(e){this.destination.error(e),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parentOrParents:e}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this}}class et extends Le{constructor(e,n,r,s){super(),this._parentSubscriber=e;let u,m=this;pe(n)?u=n:n&&(u=n.next,r=n.error,s=n.complete,n!==Te&&(m=Object.create(n),pe(m.unsubscribe)&&this.add(m.unsubscribe.bind(m)),m.unsubscribe=this.unsubscribe.bind(this))),this._context=m,this._next=u,this._error=r,this._complete=s}next(e){if(!this.isStopped&&this._next){const{_parentSubscriber:n}=this;re.useDeprecatedSynchronousErrorHandling&&n.syncErrorThrowable?this.__tryOrSetError(n,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}}error(e){if(!this.isStopped){const{_parentSubscriber:n}=this,{useDeprecatedSynchronousErrorHandling:r}=re;if(this._error)r&&n.syncErrorThrowable?(this.__tryOrSetError(n,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(n.syncErrorThrowable)r?(n.syncErrorValue=e,n.syncErrorThrown=!0):Ce(e),this.unsubscribe();else{if(this.unsubscribe(),r)throw e;Ce(e)}}}complete(){if(!this.isStopped){const{_parentSubscriber:e}=this;if(this._complete){const n=()=>this._complete.call(this._context);re.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(e,n){try{e.call(this._context,n)}catch(r){if(this.unsubscribe(),re.useDeprecatedSynchronousErrorHandling)throw r;Ce(r)}}__tryOrSetError(e,n,r){if(!re.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{n.call(this._context,r)}catch(s){return re.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=s,e.syncErrorThrown=!0,!0):(Ce(s),!0)}return!1}_unsubscribe(){const{_parentSubscriber:e}=this;this._context=null,this._parentSubscriber=null,e.unsubscribe()}}const ye="function"==typeof Symbol&&Symbol.observable||"@@observable";function ze(t){return t}let Dt=(()=>{class t{constructor(n){this._isScalar=!1,n&&(this._subscribe=n)}lift(n){const r=new t;return r.source=this,r.operator=n,r}subscribe(n,r,s){const{operator:u}=this,m=function(t,e,n){if(t){if(t instanceof Le)return t;if(t[Pe])return t[Pe]()}return t||e||n?new Le(t,e,n):new Le(Te)}(n,r,s);if(m.add(u?u.call(m,this.source):this.source||re.useDeprecatedSynchronousErrorHandling&&!m.syncErrorThrowable?this._subscribe(m):this._trySubscribe(m)),re.useDeprecatedSynchronousErrorHandling&&m.syncErrorThrowable&&(m.syncErrorThrowable=!1,m.syncErrorThrown))throw m.syncErrorValue;return m}_trySubscribe(n){try{return this._subscribe(n)}catch(r){re.useDeprecatedSynchronousErrorHandling&&(n.syncErrorThrown=!0,n.syncErrorValue=r),function(t){for(;t;){const{closed:e,destination:n,isStopped:r}=t;if(e||r)return!1;t=n&&n instanceof Le?n:null}return!0}(n)?n.error(r):console.warn(r)}}forEach(n,r){return new(r=jt(r))((s,u)=>{let m;m=this.subscribe(v=>{try{n(v)}catch(E){u(E),m&&m.unsubscribe()}},u,s)})}_subscribe(n){const{source:r}=this;return r&&r.subscribe(n)}[ye](){return this}pipe(...n){return 0===n.length?this:function(t){return 0===t.length?ze:1===t.length?t[0]:function(n){return t.reduce((r,s)=>s(r),n)}}(n)(this)}toPromise(n){return new(n=jt(n))((r,s)=>{let u;this.subscribe(m=>u=m,m=>s(m),()=>r(u))})}}return t.create=e=>new t(e),t})();function jt(t){if(t||(t=re.Promise||Promise),!t)throw new Error("no Promise impl found");return t}const Fn=(()=>{function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t})();class kr extends it{constructor(e,n){super(),this.subject=e,this.subscriber=n,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const e=this.subject,n=e.observers;if(this.subject=null,!n||0===n.length||e.isStopped||e.closed)return;const r=n.indexOf(this.subscriber);-1!==r&&n.splice(r,1)}}class di extends Le{constructor(e){super(e),this.destination=e}}let Cr=(()=>{class t extends Dt{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[Pe](){return new di(this)}lift(n){const r=new Wi(this,this);return r.operator=n,r}next(n){if(this.closed)throw new Fn;if(!this.isStopped){const{observers:r}=this,s=r.length,u=r.slice();for(let m=0;m<s;m++)u[m].next(n)}}error(n){if(this.closed)throw new Fn;this.hasError=!0,this.thrownError=n,this.isStopped=!0;const{observers:r}=this,s=r.length,u=r.slice();for(let m=0;m<s;m++)u[m].error(n);this.observers.length=0}complete(){if(this.closed)throw new Fn;this.isStopped=!0;const{observers:n}=this,r=n.length,s=n.slice();for(let u=0;u<r;u++)s[u].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(n){if(this.closed)throw new Fn;return super._trySubscribe(n)}_subscribe(n){if(this.closed)throw new Fn;return this.hasError?(n.error(this.thrownError),it.EMPTY):this.isStopped?(n.complete(),it.EMPTY):(this.observers.push(n),new kr(this,n))}asObservable(){const n=new Dt;return n.source=this,n}}return t.create=(e,n)=>new Wi(e,n),t})();class Wi extends Cr{constructor(e,n){super(),this.destination=e,this.source=n}next(e){const{destination:n}=this;n&&n.next&&n.next(e)}error(e){const{destination:n}=this;n&&n.error&&this.destination.error(e)}complete(){const{destination:e}=this;e&&e.complete&&this.destination.complete()}_subscribe(e){const{source:n}=this;return n?this.source.subscribe(e):it.EMPTY}}function Pr(t){return t&&"function"==typeof t.schedule}function Pt(t,e){return function(r){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return r.lift(new is(t,e))}}class is{constructor(e,n){this.project=e,this.thisArg=n}call(e,n){return n.subscribe(new Qn(e,this.project,this.thisArg))}}class Qn extends Le{constructor(e,n,r){super(e),this.project=n,this.count=0,this.thisArg=r||this}_next(e){let n;try{n=this.project.call(this.thisArg,e,this.count++)}catch(r){return void this.destination.error(r)}this.destination.next(n)}}const Ti=t=>e=>{for(let n=0,r=t.length;n<r&&!e.closed;n++)e.next(t[n]);e.complete()},Xi="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",Di=t=>t&&"number"==typeof t.length&&"function"!=typeof t;function ro(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}const Vo=t=>{if(t&&"function"==typeof t[ye])return(t=>e=>{const n=t[ye]();if("function"!=typeof n.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return n.subscribe(e)})(t);if(Di(t))return Ti(t);if(ro(t))return(t=>e=>(t.then(n=>{e.closed||(e.next(n),e.complete())},n=>e.error(n)).then(null,Ce),e))(t);if(t&&"function"==typeof t[Xi])return(t=>e=>{const n=t[Xi]();for(;;){let r;try{r=n.next()}catch(s){return e.error(s),e}if(r.done){e.complete();break}if(e.next(r.value),e.closed)break}return"function"==typeof n.return&&e.add(()=>{n.return&&n.return()}),e})(t);{const n=`You provided ${ie(t)?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.`;throw new TypeError(n)}};function vn(t,e){return new Dt(n=>{const r=new it;let s=0;return r.add(e.schedule(function(){s!==t.length?(n.next(t[s++]),n.closed||r.add(this.schedule())):n.complete()})),r})}function Ar(t,e){return e?function(t,e){if(null!=t){if(function(t){return t&&"function"==typeof t[ye]}(t))return function(t,e){return new Dt(n=>{const r=new it;return r.add(e.schedule(()=>{const s=t[ye]();r.add(s.subscribe({next(u){r.add(e.schedule(()=>n.next(u)))},error(u){r.add(e.schedule(()=>n.error(u)))},complete(){r.add(e.schedule(()=>n.complete()))}}))})),r})}(t,e);if(ro(t))return function(t,e){return new Dt(n=>{const r=new it;return r.add(e.schedule(()=>t.then(s=>{r.add(e.schedule(()=>{n.next(s),r.add(e.schedule(()=>n.complete()))}))},s=>{r.add(e.schedule(()=>n.error(s)))}))),r})}(t,e);if(Di(t))return vn(t,e);if(function(t){return t&&"function"==typeof t[Xi]}(t)||"string"==typeof t)return function(t,e){if(!t)throw new Error("Iterable cannot be null");return new Dt(n=>{const r=new it;let s;return r.add(()=>{s&&"function"==typeof s.return&&s.return()}),r.add(e.schedule(()=>{s=t[Xi](),r.add(e.schedule(function(){if(n.closed)return;let u,m;try{const v=s.next();u=v.value,m=v.done}catch(v){return void n.error(v)}m?n.complete():(n.next(u),this.schedule())}))})),r})}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}(t,e):t instanceof Dt?t:new Dt(Vo(t))}class Uo extends Le{constructor(e){super(),this.parent=e}_next(e){this.parent.notifyNext(e)}_error(e){this.parent.notifyError(e),this.unsubscribe()}_complete(){this.parent.notifyComplete(),this.unsubscribe()}}class ls extends Le{notifyNext(e){this.destination.next(e)}notifyError(e){this.destination.error(e)}notifyComplete(){this.destination.complete()}}function $o(t,e){if(e.closed)return;if(t instanceof Dt)return t.subscribe(e);let n;try{n=Vo(t)(e)}catch(r){e.error(r)}return n}function Tr(t,e,n=Number.POSITIVE_INFINITY){return"function"==typeof e?r=>r.pipe(Tr((s,u)=>Ar(t(s,u)).pipe(Pt((m,v)=>e(s,m,u,v))),n)):("number"==typeof e&&(n=e),r=>r.lift(new io(t,n)))}class io{constructor(e,n=Number.POSITIVE_INFINITY){this.project=e,this.concurrent=n}call(e,n){return n.subscribe(new Ds(e,this.project,this.concurrent))}}class Ds extends ls{constructor(e,n,r=Number.POSITIVE_INFINITY){super(e),this.project=n,this.concurrent=r,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)}_tryNext(e){let n;const r=this.index++;try{n=this.project(e,r)}catch(s){return void this.destination.error(s)}this.active++,this._innerSub(n)}_innerSub(e){const n=new Uo(this),r=this.destination;r.add(n);const s=$o(e,n);s!==n&&r.add(s)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(e){this.destination.next(e)}notifyComplete(){const e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}function cs(t=Number.POSITIVE_INFINITY){return Tr(ze,t)}function oa(t,e){return e?vn(t,e):new Dt(Ti(t))}function Ss(){return function(e){return e.lift(new kl(e))}}class kl{constructor(e){this.connectable=e}call(e,n){const{connectable:r}=this;r._refCount++;const s=new Rc(e,r),u=n.subscribe(s);return s.closed||(s.connection=r.connect()),u}}class Rc extends Le{constructor(e,n){super(e),this.connectable=n}_unsubscribe(){const{connectable:e}=this;if(!e)return void(this.connection=null);this.connectable=null;const n=e._refCount;if(n<=0)return void(this.connection=null);if(e._refCount=n-1,n>1)return void(this.connection=null);const{connection:r}=this,s=e._connection;this.connection=null,s&&(!r||s===r)&&s.unsubscribe()}}class kc extends Dt{constructor(e,n){super(),this.source=e,this.subjectFactory=n,this._refCount=0,this._isComplete=!1}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}connect(){let e=this._connection;return e||(this._isComplete=!1,e=this._connection=new it,e.add(this.source.subscribe(new Ha(this.getSubject(),this))),e.closed&&(this._connection=null,e=it.EMPTY)),e}refCount(){return Ss()(this)}}const sa=(()=>{const t=kc.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:t._subscribe},_isComplete:{value:t._isComplete,writable:!0},getSubject:{value:t.getSubject},connect:{value:t.connect},refCount:{value:t.refCount}}})();class Ha extends di{constructor(e,n){super(e),this.connectable=n}_error(e){this._unsubscribe(),super._error(e)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const e=this.connectable;if(e){this.connectable=null;const n=e._connection;e._refCount=0,e._subject=null,e._connection=null,n&&n.unsubscribe()}}}function Is(){return new Cr}function Ms(){return t=>Ss()(function(t,e){return function(r){let s;s="function"==typeof t?t:function(){return t};const u=Object.create(r,sa);return u.source=r,u.subjectFactory=s,u}}(Is)(t))}function mn(t){for(let e in t)if(t[e]===mn)return e;throw Error("Could not find renamed property on target object.")}function us(t,e){for(const n in e)e.hasOwnProperty(n)&&!t.hasOwnProperty(n)&&(t[n]=e[n])}function Wt(t){if("string"==typeof t)return t;if(Array.isArray(t))return"["+t.map(Wt).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const e=t.toString();if(null==e)return""+e;const n=e.indexOf("\n");return-1===n?e:e.substring(0,n)}function oo(t,e){return null==t||""===t?null===e?"":e:null==e||""===e?t:t+" "+e}const X=mn({__forward_ref__:mn});function O(t){return t.__forward_ref__=O,t.toString=function(){return Wt(this())},t}function z(t){return W(t)?t():t}function W(t){return"function"==typeof t&&t.hasOwnProperty(X)&&t.__forward_ref__===O}class ce extends Error{constructor(e,n){super(function(t,e){return`${t?`NG0${t}: `:""}${e}`}(e,n)),this.code=e}}function oe(t){return"string"==typeof t?t:null==t?"":String(t)}function xe(t){return"function"==typeof t?t.name||t.toString():"object"==typeof t&&null!=t&&"function"==typeof t.type?t.type.name||t.type.toString():oe(t)}function It(t,e){const n=e?` in ${e}`:"";throw new ce("201",`No provider for ${xe(t)} found${n}`)}function $n(t,e){null==t&&function(t,e,n,r){throw new Error(`ASSERTION ERROR: ${t}`+(null==r?"":` [Expected=> ${n} ${r} ${e} <=Actual]`))}(e,t,null,"!=")}function kt(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function Qr(t){return{providers:t.providers||[],imports:t.imports||[]}}function Oi(t){return aa(t,Gt)||aa(t,Nl)}function aa(t,e){return t.hasOwnProperty(e)?t[e]:null}function Oc(t){return t&&(t.hasOwnProperty(Ll)||t.hasOwnProperty(Hr))?t[Ll]:null}const Gt=mn({\u0275prov:mn}),Ll=mn({\u0275inj:mn}),Nl=mn({ngInjectableDef:mn}),Hr=mn({ngInjectorDef:mn});var Mt=(()=>((Mt=Mt||{})[Mt.Default=0]="Default",Mt[Mt.Host=1]="Host",Mt[Mt.Self=2]="Self",Mt[Mt.SkipSelf=4]="SkipSelf",Mt[Mt.Optional=8]="Optional",Mt))();let Lc;function Kn(t){const e=Lc;return Lc=t,e}function la(t,e,n){const r=Oi(t);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:n&Mt.Optional?null:void 0!==e?e:void It(Wt(t),"Injector")}function hr(t){return{toString:t}.toString()}var Jr=(()=>((Jr=Jr||{})[Jr.OnPush=0]="OnPush",Jr[Jr.Default=1]="Default",Jr))(),yr=(()=>((yr=yr||{})[yr.Emulated=0]="Emulated",yr[yr.None=2]="None",yr[yr.ShadowDom=3]="ShadowDom",yr))();const Bf="undefined"!=typeof globalThis&&globalThis,Ps="undefined"!=typeof window&&window,Uf="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,on=Bf||"undefined"!=typeof global&&global||Ps||Uf,Fs={},On=[],Vc=mn({\u0275cmp:mn}),Uu=mn({\u0275dir:mn}),zl=mn({\u0275pipe:mn}),ju=mn({\u0275mod:mn}),Vl=mn({\u0275loc:mn}),ds=mn({\u0275fac:mn}),qa=mn({__NG_ELEMENT_ID__:mn});let $f=0;function fs(t){return hr(()=>{const n={},r={type:t.type,providersResolver:null,decls:t.decls,vars:t.vars,factory:null,template:t.template||null,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:n,inputs:null,outputs:null,exportAs:t.exportAs||null,onPush:t.changeDetection===Jr.OnPush,directiveDefs:null,pipeDefs:null,selectors:t.selectors||On,viewQuery:t.viewQuery||null,features:t.features||null,data:t.data||{},encapsulation:t.encapsulation||yr.Emulated,id:"c",styles:t.styles||On,_:null,setInput:null,schemas:t.schemas||null,tView:null},s=t.directives,u=t.features,m=t.pipes;return r.id+=$f++,r.inputs=ua(t.inputs,n),r.outputs=ua(t.outputs),u&&u.forEach(v=>v(r)),r.directiveDefs=s?()=>("function"==typeof s?s():s).map(Bc):null,r.pipeDefs=m?()=>("function"==typeof m?m():m).map(Uc):null,r})}function Bc(t){return Gr(t)||function(t){return t[Uu]||null}(t)}function Uc(t){return function(t){return t[zl]||null}(t)}const Za={};function dr(t){return hr(()=>{const e={type:t.type,bootstrap:t.bootstrap||On,declarations:t.declarations||On,imports:t.imports||On,exports:t.exports||On,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null};return null!=t.id&&(Za[t.id]=t.type),e})}function ua(t,e){if(null==t)return Fs;const n={};for(const r in t)if(t.hasOwnProperty(r)){let s=t[r],u=s;Array.isArray(s)&&(u=s[1],s=s[0]),n[s]=r,e&&(e[s]=u)}return n}const Ut=fs;function Gr(t){return t[Vc]||null}function ei(t,e){const n=t[ju]||null;if(!n&&!0===e)throw new Error(`Type ${Wt(t)} does not have '\u0275mod' property.`);return n}function Ai(t){return Array.isArray(t)&&"object"==typeof t[1]}function Eo(t){return Array.isArray(t)&&!0===t[1]}function Hc(t){return 0!=(8&t.flags)}function Ul(t){return 2==(2&t.flags)}function Gc(t){return 1==(1&t.flags)}function Co(t){return null!==t.template}function Hf(t){return 0!=(512&t[2])}function Xo(t,e){return t.hasOwnProperty(ds)?t[ds]:null}class so{constructor(e,n,r){this.previousValue=e,this.currentValue=n,this.firstChange=r}isFirstChange(){return this.firstChange}}function Lr(){return ms}function ms(t){return t.type.prototype.ngOnChanges&&(t.setInput=Xc),Wu}function Wu(){const t=pi(this),e=null==t?void 0:t.current;if(e){const n=t.previous;if(n===Fs)t.previous=e;else for(let r in e)n[r]=e[r];t.current=null,this.ngOnChanges(e)}}function Xc(t,e,n,r){const s=pi(t)||function(t,e){return t[ga]=e}(t,{previous:Fs,current:null}),u=s.current||(s.current={}),m=s.previous,v=this.declaredInputs[n],E=m[v];u[v]=new so(E&&E.currentValue,e,m===Fs),t[r]=e}Lr.ngInherit=!0;const ga="__ngSimpleChanges__";function pi(t){return t[ga]||null}let $l;function Zn(t){return!!t.listen}const Yu={createRenderer:(t,e)=>void 0!==$l?$l:"undefined"!=typeof document?document:void 0};function mr(t){for(;Array.isArray(t);)t=t[0];return t}function Ls(t,e){return mr(e[t])}function ir(t,e){return mr(e[t.index])}function Li(t,e){const n=e[t];return Ai(n)?n:n[0]}function Ju(t){return 4==(4&t[2])}function il(t){return 128==(128&t[2])}function Do(t,e){return null==e?null:t[e]}function eh(t){t[18]=0}function ni(t,e){t[5]+=e;let n=t,r=t[3];for(;null!==r&&(1===e&&1===n[5]||-1===e&&0===n[5]);)r[5]+=e,n=r,r=r[3]}const Ht={lFrame:ll(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function Jc(){return Ht.bindingsEnabled}function tt(){return Ht.lFrame.lView}function xn(){return Ht.lFrame.tView}function zn(){let t=nh();for(;null!==t&&64===t.type;)t=t.parent;return t}function nh(){return Ht.lFrame.currentTNode}function Ni(t,e){const n=Ht.lFrame;n.currentTNode=t,n.isParent=e}function yt(){return Ht.lFrame.isParent}function zs(){return Ht.isInCheckNoChangesMode}function Zl(t){Ht.isInCheckNoChangesMode=t}function ih(t,e){const n=Ht.lFrame;n.bindingIndex=n.bindingRootIndex=t,Wl(e)}function Wl(t){Ht.lFrame.currentDirectiveIndex=t}function nu(){return Ht.lFrame.currentQueryIndex}function Kl(t){Ht.lFrame.currentQueryIndex=t}function ru(t){const e=t[1];return 2===e.type?e.declTNode:1===e.type?t[6]:null}function Yl(t,e,n){if(n&Mt.SkipSelf){let s=e,u=t;for(;!(s=s.parent,null!==s||n&Mt.Host||(s=ru(u),null===s||(u=u[15],10&s.type))););if(null===s)return!1;e=s,t=u}const r=Ht.lFrame=iu();return r.currentTNode=e,r.lView=t,!0}function Ql(t){const e=iu(),n=t[1];Ht.lFrame=e,e.currentTNode=n.firstChild,e.lView=t,e.tView=n,e.contextLView=t,e.bindingIndex=n.bindingStartIndex,e.inI18n=!1}function iu(){const t=Ht.lFrame,e=null===t?null:t.child;return null===e?ll(t):e}function ll(t){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return null!==t&&(t.child=e),e}function oh(){const t=Ht.lFrame;return Ht.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}const Bs=oh;function Jl(){const t=oh();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function ri(){return Ht.lFrame.selectedIndex}function _s(t){Ht.lFrame.selectedIndex=t}function tc(t,e){for(let n=e.directiveStart,r=e.directiveEnd;n<r;n++){const u=t.data[n].type.prototype,{ngAfterContentInit:m,ngAfterContentChecked:v,ngAfterViewInit:E,ngAfterViewChecked:S,ngOnDestroy:P}=u;m&&(t.contentHooks||(t.contentHooks=[])).push(-n,m),v&&((t.contentHooks||(t.contentHooks=[])).push(n,v),(t.contentCheckHooks||(t.contentCheckHooks=[])).push(n,v)),E&&(t.viewHooks||(t.viewHooks=[])).push(-n,E),S&&((t.viewHooks||(t.viewHooks=[])).push(n,S),(t.viewCheckHooks||(t.viewCheckHooks=[])).push(n,S)),null!=P&&(t.destroyHooks||(t.destroyHooks=[])).push(n,P)}}function xa(t,e,n){h(t,e,3,n)}function p(t,e,n,r){(3&t[2])===n&&h(t,e,n,r)}function o(t,e){let n=t[2];(3&n)===e&&(n&=2047,n+=1,t[2]=n)}function h(t,e,n,r){const u=null!=r?r:-1,m=e.length-1;let v=0;for(let E=void 0!==r?65535&t[18]:0;E<m;E++)if("number"==typeof e[E+1]){if(v=e[E],null!=r&&v>=r)break}else e[E]<0&&(t[18]+=65536),(v<u||-1==u)&&(g(t,n,e,E),t[18]=(4294901760&t[18])+E+2),E++}function g(t,e,n,r){const s=n[r]<0,u=n[r+1],v=t[s?-n[r]:n[r]];if(s){if(t[2]>>11<t[18]>>16&&(3&t[2])===e){t[2]+=2048;try{u.call(v)}finally{}}}else try{u.call(v)}finally{}}const x=-1;class b{constructor(e,n,r){this.factory=e,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=r}}function K(t,e,n){const r=Zn(t);let s=0;for(;s<n.length;){const u=n[s];if("number"==typeof u){if(0!==u)break;s++;const m=n[s++],v=n[s++],E=n[s++];r?t.setAttribute(e,v,E,m):e.setAttributeNS(m,v,E)}else{const m=u,v=n[++s];le(m)?r&&t.setProperty(e,m,v):r?t.setAttribute(e,m,v):e.setAttribute(m,v),s++}}return s}function Y(t){return 3===t||4===t||6===t}function le(t){return 64===t.charCodeAt(0)}function Z(t,e){if(null!==e&&0!==e.length)if(null===t||0===t.length)t=e.slice();else{let n=-1;for(let r=0;r<e.length;r++){const s=e[r];"number"==typeof s?n=s:0===n||Q(t,n,s,null,-1===n||2===n?e[++r]:null)}}return t}function Q(t,e,n,r,s){let u=0,m=t.length;if(-1===e)m=-1;else for(;u<t.length;){const v=t[u++];if("number"==typeof v){if(v===e){m=-1;break}if(v>e){m=u-1;break}}}for(;u<t.length;){const v=t[u];if("number"==typeof v)break;if(v===n){if(null===r)return void(null!==s&&(t[u+1]=s));if(r===t[u+1])return void(t[u+2]=s)}u++,null!==r&&u++,null!==s&&u++}-1!==m&&(t.splice(m,0,e),u=m+1),t.splice(u++,0,n),null!==r&&t.splice(u++,0,r),null!==s&&t.splice(u++,0,s)}function ae(t){return t!==x}function he(t){return 32767&t}function J(t,e){let n=function(t){return t>>16}(t),r=e;for(;n>0;)r=r[15],n--;return r}let we=!0;function $e(t){const e=we;return we=t,e}let mt=0;function gt(t,e){const n=bt(t,e);if(-1!==n)return n;const r=e[1];r.firstCreatePass&&(t.injectorIndex=e.length,nt(r.data,t),nt(e,null),nt(r.blueprint,null));const s=Xt(t,e),u=t.injectorIndex;if(ae(s)){const m=he(s),v=J(s,e),E=v[1].data;for(let S=0;S<8;S++)e[u+S]=v[m+S]|E[m+S]}return e[u+8]=s,u}function nt(t,e){t.push(0,0,0,0,0,0,0,0,e)}function bt(t,e){return-1===t.injectorIndex||t.parent&&t.parent.injectorIndex===t.injectorIndex||null===e[t.injectorIndex+8]?-1:t.injectorIndex}function Xt(t,e){if(t.parent&&-1!==t.parent.injectorIndex)return t.parent.injectorIndex;let n=0,r=null,s=e;for(;null!==s;){const u=s[1],m=u.type;if(r=2===m?u.declTNode:1===m?s[6]:null,null===r)return x;if(n++,s=s[15],-1!==r.injectorIndex)return r.injectorIndex|n<<16}return x}function zt(t,e,n){!function(t,e,n){let r;"string"==typeof n?r=n.charCodeAt(0)||0:n.hasOwnProperty(qa)&&(r=n[qa]),null==r&&(r=n[qa]=mt++);const s=255&r;e.data[t+(s>>5)]|=1<<s}(t,e,n)}function Yn(t,e,n){if(n&Mt.Optional)return t;It(e,"NodeInjector")}function Zt(t,e,n,r){if(n&Mt.Optional&&void 0===r&&(r=null),0==(n&(Mt.Self|Mt.Host))){const s=t[9],u=Kn(void 0);try{return s?s.get(e,r,n&Mt.Optional):la(e,r,n&Mt.Optional)}finally{Kn(u)}}return Yn(r,e,n)}function nn(t,e,n,r=Mt.Default,s){if(null!==t){const u=function(t){if("string"==typeof t)return t.charCodeAt(0)||0;const e=t.hasOwnProperty(qa)?t[qa]:void 0;return"number"==typeof e?e>=0?255&e:ao:e}(n);if("function"==typeof u){if(!Yl(e,t,r))return r&Mt.Host?Yn(s,n,r):Zt(e,n,r,s);try{const m=u(r);if(null!=m||r&Mt.Optional)return m;It(n)}finally{Bs()}}else if("number"==typeof u){let m=null,v=bt(t,e),E=x,S=r&Mt.Host?e[16][6]:null;for((-1===v||r&Mt.SkipSelf)&&(E=-1===v?Xt(t,e):e[v+8],E!==x&&Vn(r,!1)?(m=e[1],v=he(E),e=J(E,e)):v=-1);-1!==v;){const P=e[1];if(es(u,v,P.data)){const V=Qo(v,e,n,m,r,S);if(V!==tr)return V}E=e[v+8],E!==x&&Vn(r,e[1].data[v+8]===S)&&es(u,v,e)?(m=P,v=he(E),e=J(E,e)):v=-1}}}return Zt(e,n,r,s)}const tr={};function ao(){return new qn(zn(),tt())}function Qo(t,e,n,r,s,u){const m=e[1],v=m.data[t+8],P=zr(v,m,n,null==r?Ul(v)&&we:r!=m&&0!=(3&v.type),s&Mt.Host&&u===v);return null!==P?Zr(e,m,P,v):tr}function zr(t,e,n,r,s){const u=t.providerIndexes,m=e.data,v=1048575&u,E=t.directiveStart,P=u>>20,j=s?v+P:t.directiveEnd;for(let G=r?v:v+P;G<j;G++){const se=m[G];if(G<E&&n===se||G>=E&&se.type===n)return G}if(s){const G=m[E];if(G&&Co(G)&&G.type===n)return E}return null}function Zr(t,e,n,r){let s=t[n];const u=e.data;if(function(t){return t instanceof b}(s)){const m=s;m.resolving&&function(t,e){throw new ce("200",`Circular dependency in DI detected for ${t}`)}(xe(u[n]));const v=$e(m.canSeeViewProviders);m.resolving=!0;const E=m.injectImpl?Kn(m.injectImpl):null;Yl(t,r,Mt.Default);try{s=t[n]=m.factory(void 0,u,t,r),e.firstCreatePass&&n>=r.directiveStart&&function(t,e,n){const{ngOnChanges:r,ngOnInit:s,ngDoCheck:u}=e.type.prototype;if(r){const m=ms(e);(n.preOrderHooks||(n.preOrderHooks=[])).push(t,m),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(t,m)}s&&(n.preOrderHooks||(n.preOrderHooks=[])).push(0-t,s),u&&((n.preOrderHooks||(n.preOrderHooks=[])).push(t,u),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(t,u))}(n,u[n],e)}finally{null!==E&&Kn(E),$e(v),m.resolving=!1,Bs()}}return s}function es(t,e,n){return!!(n[e+(t>>5)]&1<<t)}function Vn(t,e){return!(t&Mt.Self||t&Mt.Host&&e)}class qn{constructor(e,n){this._tNode=e,this._lView=n}get(e,n){return nn(this._tNode,this._lView,e,void 0,n)}}function en(t){return hr(()=>{const e=t.prototype.constructor,n=e[ds]||or(e),r=Object.prototype;let s=Object.getPrototypeOf(t.prototype).constructor;for(;s&&s!==r;){const u=s[ds]||or(s);if(u&&u!==n)return u;s=Object.getPrototypeOf(s)}return u=>new u})}function or(t){return W(t)?()=>{const e=or(z(t));return e&&e()}:Xo(t)}const vr="__parameters__";function ys(t,e,n){return hr(()=>{const r=function(t){return function(...n){if(t){const r=t(...n);for(const s in r)this[s]=r[s]}}}(e);function s(...u){if(this instanceof s)return r.apply(this,u),this;const m=new s(...u);return v.annotation=m,v;function v(E,S,P){const V=E.hasOwnProperty(vr)?E[vr]:Object.defineProperty(E,vr,{value:[]})[vr];for(;V.length<=P;)V.push(null);return(V[P]=V[P]||[]).push(m),E}}return n&&(s.prototype=Object.create(n.prototype)),s.prototype.ngMetadataName=t,s.annotationCls=s,s})}class un{constructor(e,n){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=kt({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}toString(){return`InjectionToken ${this._desc}`}}const Km=new un("AnalyzeForEntryComponents"),au=Function;function Ao(t,e){void 0===e&&(e=t);for(let n=0;n<t.length;n++){let r=t[n];Array.isArray(r)?(e===t&&(e=t.slice(0,n)),Ao(r,e)):e!==t&&e.push(r)}return e}function vs(t,e){t.forEach(n=>Array.isArray(n)?vs(n,e):e(n))}function _d(t,e,n){e>=t.length?t.push(n):t.splice(e,0,n)}function ic(t,e){return e>=t.length-1?t.pop():t.splice(e,1)[0]}function oi(t,e,n){let r=uu(t,e);return r>=0?t[1|r]=n:(r=~r,function(t,e,n,r){let s=t.length;if(s==e)t.push(n,r);else if(1===s)t.push(r,t[0]),t[0]=n;else{for(s--,t.push(t[s-1],t[s]);s>e;)t[s]=t[s-2],s--;t[e]=n,t[e+1]=r}}(t,r,e,n)),r}function Qf(t,e){const n=uu(t,e);if(n>=0)return t[1|n]}function uu(t,e){return function(t,e,n){let r=0,s=t.length>>n;for(;s!==r;){const u=r+(s-r>>1),m=t[u<<n];if(e===m)return u<<n;m>e?s=u:r=u+1}return~(s<<n)}(t,e,1)}const bs={},wa="__NG_DI_FLAG__",Ea="ngTempTokenPath",Jm=/\n/gm,vd="__source",lh=mn({provide:String,useValue:mn});let ch;function dl(t){const e=ch;return ch=t,e}function eg(t,e=Mt.Default){if(void 0===ch)throw new Error("inject() must be called from an injection context");return null===ch?la(t,void 0,e):ch.get(t,e&Mt.Optional?null:void 0,e)}function _t(t,e=Mt.Default){return(Lc||eg)(z(t),e)}function ac(t){const e=[];for(let n=0;n<t.length;n++){const r=z(t[n]);if(Array.isArray(r)){if(0===r.length)throw new Error("Arguments array must have arguments.");let s,u=Mt.Default;for(let m=0;m<r.length;m++){const v=r[m],E=xd(v);"number"==typeof E?-1===E?s=v.token:u|=E:s=v}e.push(_t(s,u))}else e.push(_t(r))}return e}function Hs(t,e){return t[wa]=e,t.prototype[wa]=e,t}function xd(t){return t[wa]}function ep(t,e,n,r){const s=t[Ea];throw e[vd]&&s.unshift(e[vd]),t.message=function(t,e,n,r=null){t=t&&"\n"===t.charAt(0)&&"\u0275"==t.charAt(1)?t.substr(2):t;let s=Wt(e);if(Array.isArray(e))s=e.map(Wt).join(" -> ");else if("object"==typeof e){let u=[];for(let m in e)if(e.hasOwnProperty(m)){let v=e[m];u.push(m+":"+("string"==typeof v?JSON.stringify(v):Wt(v)))}s=`{${u.join(", ")}}`}return`${n}${r?"("+r+")":""}[${s}]: ${t.replace(Jm,"\n  ")}`}("\n"+t.message,s,n,r),t.ngTokenPath=s,t[Ea]=null,t}const du=Hs(ys("Inject",t=>({token:t})),-1),sr=Hs(ys("Optional"),8),Gs=Hs(ys("SkipSelf"),4);const yg="__ngContext__";function Vi(t,e){t[yg]=e}function Ad(t){const e=function(t){return t[yg]||null}(t);return e?Array.isArray(e)?e:e.lView:null}function Md(t){return t.ngOriginalError}function Sv(t,...e){t.error(...e)}class xr{constructor(){this._console=console}handleError(e){const n=this._findOriginalError(e),r=this._findContext(e),s=function(t){return t&&t.ngErrorLogger||Sv}(e);s(this._console,"ERROR",e),n&&s(this._console,"ORIGINAL ERROR",n),r&&s(this._console,"ERROR CONTEXT",r)}_findContext(e){return e?function(t){return t.ngDebugContext}(e)||this._findContext(Md(e)):null}_findOriginalError(e){let n=e&&Md(e);for(;n&&Md(n);)n=Md(n);return n||null}}const Un=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(on))();function Ji(t){return t instanceof Function?t():t}var Io=(()=>((Io=Io||{})[Io.Important=1]="Important",Io[Io.DashCase=2]="DashCase",Io))();function gp(t,e){return undefined(t,e)}function Eh(t){const e=t[3];return Eo(e)?e[3]:e}function Fd(t){return Rg(t[13])}function _p(t){return Rg(t[4])}function Rg(t){for(;null!==t&&!Eo(t);)t=t[4];return t}function gl(t,e,n,r,s){if(null!=r){let u,m=!1;Eo(r)?u=r:Ai(r)&&(m=!0,r=r[0]);const v=mr(r);0===t&&null!==n?null==s?Ep(e,n,v):co(e,n,v,s||null,!0):1===t&&null!==n?co(e,n,v,s||null,!0):2===t?function(t,e,n){const r=Sh(t,e);r&&function(t,e,n,r){Zn(t)?t.removeChild(e,n,r):e.removeChild(n)}(t,r,e,n)}(e,v,m):3===t&&e.destroyNode(v),null!=u&&function(t,e,n,r,s){const u=n[7];u!==mr(n)&&gl(e,t,r,u,s);for(let v=10;v<n.length;v++){const E=n[v];_l(E[1],E,t,e,r,u)}}(e,t,u,n,s)}}function dc(t,e,n){return Zn(t)?t.createElement(e,n):null===n?t.createElement(e):t.createElementNS(n,e)}function Fg(t,e){const n=t[9],r=n.indexOf(e),s=e[3];1024&e[2]&&(e[2]&=-1025,ni(s,-1)),n.splice(r,1)}function Ld(t,e){if(t.length<=10)return;const n=10+e,r=t[n];if(r){const s=r[17];null!==s&&s!==t&&Fg(s,r),e>0&&(t[n-1][4]=r[4]);const u=ic(t,10+e);!function(t,e){_l(t,e,e[11],2,null,null),e[0]=null,e[6]=null}(r[1],r);const m=u[19];null!==m&&m.detachView(u[1]),r[3]=null,r[4]=null,r[2]&=-129}return r}function xp(t,e){if(!(256&e[2])){const n=e[11];Zn(n)&&n.destroyNode&&_l(t,e,n,3,null,null),function(t){let e=t[13];if(!e)return Dh(t[1],t);for(;e;){let n=null;if(Ai(e))n=e[13];else{const r=e[10];r&&(n=r)}if(!n){for(;e&&!e[4]&&e!==t;)Ai(e)&&Dh(e[1],e),e=e[3];null===e&&(e=t),Ai(e)&&Dh(e[1],e),n=e&&e[4]}e=n}}(e)}}function Dh(t,e){if(!(256&e[2])){e[2]&=-129,e[2]|=256,function(t,e){let n;if(null!=t&&null!=(n=t.destroyHooks))for(let r=0;r<n.length;r+=2){const s=e[n[r]];if(!(s instanceof b)){const u=n[r+1];if(Array.isArray(u))for(let m=0;m<u.length;m+=2){const v=s[u[m]],E=u[m+1];try{E.call(v)}finally{}}else try{u.call(s)}finally{}}}}(t,e),function(t,e){const n=t.cleanup,r=e[7];let s=-1;if(null!==n)for(let u=0;u<n.length-1;u+=2)if("string"==typeof n[u]){const m=n[u+1],v="function"==typeof m?m(e):mr(e[m]),E=r[s=n[u+2]],S=n[u+3];"boolean"==typeof S?v.removeEventListener(n[u],E,S):S>=0?r[s=S]():r[s=-S].unsubscribe(),u+=2}else{const m=r[s=n[u+1]];n[u].call(m)}if(null!==r){for(let u=s+1;u<r.length;u++)r[u]();e[7]=null}}(t,e),1===e[1].type&&Zn(e[11])&&e[11].destroy();const n=e[17];if(null!==n&&Eo(e[3])){n!==e[3]&&Fg(n,e);const r=e[19];null!==r&&r.detachView(t)}}}function Lg(t,e,n){return function(t,e,n){let r=e;for(;null!==r&&40&r.type;)r=(e=r).parent;if(null===r)return n[0];if(2&r.flags){const s=t.data[r.directiveStart].encapsulation;if(s===yr.None||s===yr.Emulated)return null}return ir(r,n)}(t,e.parent,n)}function co(t,e,n,r,s){Zn(t)?t.insertBefore(e,n,r,s):e.insertBefore(n,r,s)}function Ep(t,e,n){Zn(t)?t.appendChild(e,n):e.appendChild(n)}function Cp(t,e,n,r,s){null!==r?co(t,e,n,r,s):Ep(t,e,n)}function Sh(t,e){return Zn(t)?t.parentNode(e):e.parentNode}let Dp=function(t,e,n){return 40&t.type?ir(t,n):null};function Ah(t,e,n,r){const s=Lg(t,r,e),u=e[11],v=function(t,e,n){return Dp(t,e,n)}(r.parent||e[6],r,e);if(null!=s)if(Array.isArray(n))for(let E=0;E<n.length;E++)Cp(u,s,n[E],v,!1);else Cp(u,s,n,v,!1)}function bu(t,e){if(null!==e){const n=e.type;if(3&n)return ir(e,t);if(4&n)return Nd(-1,t[e.index]);if(8&n){const r=e.child;if(null!==r)return bu(t,r);{const s=t[e.index];return Eo(s)?Nd(-1,s):mr(s)}}if(32&n)return gp(e,t)()||mr(t[e.index]);{const r=pc(t,e);return null!==r?Array.isArray(r)?r[0]:bu(Eh(t[16]),r):bu(t,e.next)}}return null}function pc(t,e){return null!==e?t[16][6].projection[e.projection]:null}function Nd(t,e){const n=10+t+1;if(n<e.length){const r=e[n],s=r[1].firstChild;if(null!==s)return bu(r,s)}return e[7]}function zd(t,e,n,r,s,u,m){for(;null!=n;){const v=r[n.index],E=n.type;if(m&&0===e&&(v&&Vi(mr(v),r),n.flags|=4),64!=(64&n.flags))if(8&E)zd(t,e,n.child,r,s,u,!1),gl(e,t,s,v,u);else if(32&E){const S=gp(n,r);let P;for(;P=S();)gl(e,t,s,P,u);gl(e,t,s,v,u)}else 16&E?Vg(t,e,r,n,s,u):gl(e,t,s,v,u);n=m?n.projectionNext:n.next}}function _l(t,e,n,r,s,u){zd(n,r,t.firstChild,e,s,u,!1)}function Vg(t,e,n,r,s,u){const m=n[16],E=m[6].projection[r.projection];if(Array.isArray(E))for(let S=0;S<E.length;S++)gl(e,t,s,E[S],u);else zd(t,e,E,m[3],s,u,!0)}function Bg(t,e,n){Zn(t)?t.setAttribute(e,"style",n):e.style.cssText=n}function Ap(t,e,n){Zn(t)?""===n?t.removeAttribute(e,"class"):t.setAttribute(e,"class",n):e.className=n}function mc(t,e,n){let r=t.length;for(;;){const s=t.indexOf(e,n);if(-1===s)return s;if(0===s||t.charCodeAt(s-1)<=32){const u=e.length;if(s+u===r||t.charCodeAt(s+u)<=32)return s}n=s+1}}const jg="ng-template";function $g(t,e,n){let r=0;for(;r<t.length;){let s=t[r++];if(n&&"class"===s){if(s=t[r],-1!==mc(s.toLowerCase(),e,0))return!0}else if(1===s){for(;r<t.length&&"string"==typeof(s=t[r++]);)if(s.toLowerCase()===e)return!0;return!1}}return!1}function Hg(t){return 4===t.type&&t.value!==jg}function Ip(t,e,n){return e===(4!==t.type||n?t.value:jg)}function Lv(t,e,n){let r=4;const s=t.attrs||[],u=function(t){for(let e=0;e<t.length;e++)if(Y(t[e]))return e;return t.length}(s);let m=!1;for(let v=0;v<e.length;v++){const E=e[v];if("number"!=typeof E){if(!m)if(4&r){if(r=2|1&r,""!==E&&!Ip(t,E,n)||""===E&&1===e.length){if(gi(r))return!1;m=!0}}else{const S=8&r?E:e[++v];if(8&r&&null!==t.attrs){if(!$g(t.attrs,S,n)){if(gi(r))return!1;m=!0}continue}const V=Gg(8&r?"class":E,s,Hg(t),n);if(-1===V){if(gi(r))return!1;m=!0;continue}if(""!==S){let j;j=V>u?"":s[V+1].toLowerCase();const G=8&r?j:null;if(G&&-1!==mc(G,S,0)||2&r&&S!==j){if(gi(r))return!1;m=!0}}}}else{if(!m&&!gi(r)&&!gi(E))return!1;if(m&&gi(E))continue;m=!1,r=E|1&r}}return gi(r)||m}function gi(t){return 0==(1&t)}function Gg(t,e,n,r){if(null===e)return-1;let s=0;if(r||!n){let u=!1;for(;s<e.length;){const m=e[s];if(m===t)return s;if(3===m||6===m)u=!0;else{if(1===m||2===m){let v=e[++s];for(;"string"==typeof v;)v=e[++s];continue}if(4===m)break;if(0===m){s+=4;continue}}s+=u?1:2}return-1}return function(t,e){let n=t.indexOf(4);if(n>-1)for(n++;n<t.length;){const r=t[n];if("number"==typeof r)return-1;if(r===e)return n;n++}return-1}(e,t)}function Mp(t,e,n=!1){for(let r=0;r<e.length;r++)if(Lv(t,e[r],n))return!0;return!1}function qg(t,e){return t?":not("+e.trim()+")":e}function Ud(t){let e=t[0],n=1,r=2,s="",u=!1;for(;n<t.length;){let m=t[n];if("string"==typeof m)if(2&r){const v=t[++n];s+="["+m+(v.length>0?'="'+v+'"':"")+"]"}else 8&r?s+="."+m:4&r&&(s+=" "+m);else""!==s&&!gi(m)&&(e+=qg(u,s),s=""),r=m,u=u||!gi(r);n++}return""!==s&&(e+=qg(u,s)),e}const Kt={};function Da(t,e,n,r){if(!r)if(3==(3&e[2])){const u=t.preOrderCheckHooks;null!==u&&xa(e,u,n)}else{const u=t.preOrderHooks;null!==u&&p(e,u,0,n)}_s(n)}function $d(t,e){return t<<17|e<<2}function Ro(t){return t>>17&32767}function Fp(t){return 2|t}function Sa(t){return(131068&t)>>2}function Op(t,e){return-131069&t|e<<2}function Mh(t){return 1|t}function Fh(t,e){const n=t.contentQueries;if(null!==n)for(let r=0;r<n.length;r+=2){const s=n[r],u=n[r+1];if(-1!==u){const m=t.data[u];Kl(s),m.contentQueries(2,e[u],u)}}}function _c(t,e,n,r,s,u,m,v,E,S){const P=e.blueprint.slice();return P[0]=s,P[2]=140|r,eh(P),P[3]=P[15]=t,P[8]=n,P[10]=m||t&&t[10],P[11]=v||t&&t[11],P[12]=E||t&&t[12]||null,P[9]=S||t&&t[9]||null,P[6]=u,P[16]=2==e.type?t[16]:P,P}function yl(t,e,n,r,s){let u=t.data[e];if(null===u)u=function(t,e,n,r,s){const u=nh(),m=yt(),E=t.data[e]=function(t,e,n,r,s,u){return{type:n,index:r,insertBeforeIndex:null,injectorIndex:e?e.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:s,attrs:u,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,m?u:u&&u.parent,n,e,r,s);return null===t.firstChild&&(t.firstChild=E),null!==u&&(m?null==u.child&&null!==E.parent&&(u.child=E):null===u.next&&(u.next=E)),E}(t,e,n,r,s),Ht.lFrame.inI18n&&(u.flags|=64);else if(64&u.type){u.type=n,u.value=r,u.attrs=s;const m=function(){const t=Ht.lFrame,e=t.currentTNode;return t.isParent?e:e.parent}();u.injectorIndex=null===m?-1:m.injectorIndex}return Ni(u,!0),u}function vl(t,e,n,r){if(0===n)return-1;const s=e.length;for(let u=0;u<n;u++)e.push(r),t.blueprint.push(r),t.data.push(null);return s}function yc(t,e,n){Ql(e);try{const r=t.viewQuery;null!==r&&kn(1,r,n);const s=t.template;null!==s&&jp(t,e,s,1,n),t.firstCreatePass&&(t.firstCreatePass=!1),t.staticContentQueries&&Fh(t,e),t.staticViewQueries&&kn(2,t.viewQuery,n);const u=t.components;null!==u&&function(t,e){for(let n=0;n<e.length;n++)dn(t,e[n])}(e,u)}catch(r){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),r}finally{e[2]&=-5,Jl()}}function Ui(t,e,n,r){const s=e[2];if(256==(256&s))return;Ql(e);const u=zs();try{eh(e),function(t){Ht.lFrame.bindingIndex=t}(t.bindingStartIndex),null!==n&&jp(t,e,n,2,r);const m=3==(3&s);if(!u)if(m){const S=t.preOrderCheckHooks;null!==S&&xa(e,S,null)}else{const S=t.preOrderHooks;null!==S&&p(e,S,0,null),o(e,0)}if(function(t){for(let e=Fd(t);null!==e;e=_p(e)){if(!e[2])continue;const n=e[9];for(let r=0;r<n.length;r++){const s=n[r],u=s[3];0==(1024&s[2])&&ni(u,1),s[2]|=1024}}}(e),function(t){for(let e=Fd(t);null!==e;e=_p(e))for(let n=10;n<e.length;n++){const r=e[n],s=r[1];il(r)&&Ui(s,r,s.template,r[8])}}(e),null!==t.contentQueries&&Fh(t,e),!u)if(m){const S=t.contentCheckHooks;null!==S&&xa(e,S)}else{const S=t.contentHooks;null!==S&&p(e,S,1),o(e,1)}!function(t,e){const n=t.hostBindingOpCodes;if(null!==n)try{for(let r=0;r<n.length;r++){const s=n[r];if(s<0)_s(~s);else{const u=s,m=n[++r],v=n[++r];ih(m,u),v(2,e[u])}}}finally{_s(-1)}}(t,e);const v=t.components;null!==v&&function(t,e){for(let n=0;n<e.length;n++)An(t,e[n])}(e,v);const E=t.viewQuery;if(null!==E&&kn(2,E,r),!u)if(m){const S=t.viewCheckHooks;null!==S&&xa(e,S)}else{const S=t.viewHooks;null!==S&&p(e,S,2),o(e,2)}!0===t.firstUpdatePass&&(t.firstUpdatePass=!1),u||(e[2]&=-73),1024&e[2]&&(e[2]&=-1025,ni(e[3],-1))}finally{Jl()}}function vc(t,e,n,r){const s=e[10],u=!zs(),m=Ju(e);try{u&&!m&&s.begin&&s.begin(),m&&yc(t,e,r),Ui(t,e,n,r)}finally{u&&!m&&s.end&&s.end()}}function jp(t,e,n,r,s){const u=ri(),m=2&r;try{_s(-1),m&&e.length>20&&Da(t,e,20,zs()),n(r,s)}finally{_s(u)}}function Hp(t){const e=t.tView;return null===e||e.incompleteFirstPass?t.tView=Yd(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts):e}function Yd(t,e,n,r,s,u,m,v,E,S){const P=20+r,V=P+s,j=function(t,e){const n=[];for(let r=0;r<e;r++)n.push(r<t?null:Kt);return n}(P,V),G="function"==typeof S?S():S;return j[1]={type:t,blueprint:j,template:n,queries:null,viewQuery:v,declTNode:e,data:j.slice().fill(null,P),bindingStartIndex:P,expandoStartIndex:V,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof u?u():u,pipeRegistry:"function"==typeof m?m():m,firstChild:null,schemas:E,consts:G,incompleteFirstPass:!1}}function qp(t,e,n,r){const s=Kr(e);null===n?s.push(r):(s.push(n),t.firstCreatePass&&Ur(t).push(r,s.length-1))}function i(t,e,n){for(let r in t)if(t.hasOwnProperty(r)){const s=t[r];(n=null===n?{}:n).hasOwnProperty(r)?n[r].push(e,s):n[r]=[e,s]}return n}function N(t,e,n,r,s,u){const m=u.hostBindings;if(m){let v=t.hostBindingOpCodes;null===v&&(v=t.hostBindingOpCodes=[]);const E=~e.index;(function(t){let e=t.length;for(;e>0;){const n=t[--e];if("number"==typeof n&&n<0)return n}return 0})(v)!=E&&v.push(E),v.push(r,s,m)}}function de(t,e){null!==t.hostBindings&&t.hostBindings(1,e)}function Se(t,e){e.flags|=2,(t.components||(t.components=[])).push(e.index)}function Me(t,e,n){if(n){if(e.exportAs)for(let r=0;r<e.exportAs.length;r++)n[e.exportAs[r]]=t;Co(e)&&(n[""]=t)}}function ke(t,e,n){t.flags|=1,t.directiveStart=e,t.directiveEnd=e+n,t.providerIndexes=e}function He(t,e,n,r,s){t.data[r]=s;const u=s.factory||(s.factory=Xo(s.type)),m=new b(u,Co(s),null);t.blueprint[r]=m,n[r]=m,N(t,e,0,r,vl(t,n,s.hostVars,Kt),s)}function Je(t,e,n){const r=ir(e,t),s=Hp(n),u=t[10],m=Lt(t,_c(t,s,null,n.onPush?64:16,r,e,u,u.createRenderer(r,n),null,null));t[e.index]=m}function Ze(t,e,n,r,s,u){const m=u[e];if(null!==m){const v=r.setInput;for(let E=0;E<m.length;){const S=m[E++],P=m[E++],V=m[E++];null!==v?r.setInput(n,V,S,P):n[P]=V}}}function Ye(t,e){let n=null,r=0;for(;r<e.length;){const s=e[r];if(0!==s)if(5!==s){if("number"==typeof s)break;t.hasOwnProperty(s)&&(null===n&&(n=[]),n.push(s,t[s],e[r+1])),r+=2}else r+=2;else r+=4}return n}function An(t,e){const n=Li(e,t);if(il(n)){const r=n[1];80&n[2]?Ui(r,n,r.template,n[8]):n[5]>0&&Ot(n)}}function Ot(t){for(let r=Fd(t);null!==r;r=_p(r))for(let s=10;s<r.length;s++){const u=r[s];if(1024&u[2]){const m=u[1];Ui(m,u,m.template,u[8])}else u[5]>0&&Ot(u)}const n=t[1].components;if(null!==n)for(let r=0;r<n.length;r++){const s=Li(n[r],t);il(s)&&s[5]>0&&Ot(s)}}function dn(t,e){const n=Li(e,t),r=n[1];(function(t,e){for(let n=e.length;n<t.blueprint.length;n++)e.push(t.blueprint[n])})(r,n),yc(r,n,n[8])}function Lt(t,e){return t[13]?t[14][4]=e:t[13]=e,t[14]=e,e}function fn(t){for(;t;){t[2]|=64;const e=Eh(t);if(Hf(t)&&!e)return t;t=e}return null}function Ir(t,e,n){const r=e[10];r.begin&&r.begin();try{Ui(t,e,t.template,n)}catch(s){throw Ii(e,s),s}finally{r.end&&r.end()}}function Br(t){!function(t){for(let e=0;e<t.components.length;e++){const n=t.components[e],r=Ad(n),s=r[1];vc(s,r,s.template,n)}}(t[8])}function kn(t,e,n){Kl(0),e(t,n)}const wr=(()=>Promise.resolve(null))();function Kr(t){return t[7]||(t[7]=[])}function Ur(t){return t.cleanup||(t.cleanup=[])}function Ii(t,e){const n=t[9],r=n?n.get(xr,null):null;r&&r.handleError(e)}function En(t,e,n){const r=Ls(e,t);!function(t,e,n){Zn(t)?t.setValue(e,n):e.textContent=n}(t[11],r,n)}function cr(t,e,n){let r=n?t.styles:null,s=n?t.classes:null,u=0;if(null!==e)for(let m=0;m<e.length;m++){const v=e[m];"number"==typeof v?u=v:1==u?s=oo(s,v):2==u&&(r=oo(r,v+": "+e[++m]+";"))}n?t.styles=r:t.stylesWithoutHost=r,n?t.classes=s:t.classesWithoutHost=s}const pn=new un("INJECTOR",-1);class Mi{get(e,n=bs){if(n===bs){const r=new Error(`NullInjectorError: No provider for ${Wt(e)}!`);throw r.name="NullInjectorError",r}return n}}const yi=new un("Set Injector scope."),eo={},ns={};let ko;function ws(){return void 0===ko&&(ko=new Mi),ko}function Es(t,e=null,n=null,r){return new xc(t,n,e||ws(),r)}class xc{constructor(e,n,r,s=null){this.parent=r,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const u=[];n&&vs(n,v=>this.processProvider(v,e,n)),vs([e],v=>this.processInjectorType(v,[],u)),this.records.set(pn,Po(void 0,this));const m=this.records.get(yi);this.scope=null!=m?m.value:null,this.source=s||("object"==typeof e?null:Wt(e))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(e=>e.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(e,n=bs,r=Mt.Default){this.assertNotDestroyed();const s=dl(this),u=Kn(void 0);try{if(!(r&Mt.SkipSelf)){let v=this.records.get(e);if(void 0===v){const E=function(t){return"function"==typeof t||"object"==typeof t&&t instanceof un}(e)&&Oi(e);v=E&&this.injectableDefInScope(E)?Po(to(e),eo):null,this.records.set(e,v)}if(null!=v)return this.hydrate(e,v)}return(r&Mt.Self?ws():this.parent).get(e,n=r&Mt.Optional&&n===bs?null:n)}catch(m){if("NullInjectorError"===m.name){if((m[Ea]=m[Ea]||[]).unshift(Wt(e)),s)throw m;return ep(m,e,"R3InjectorError",this.source)}throw m}finally{Kn(u),dl(s)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(e=>this.get(e))}toString(){const e=[];return this.records.forEach((r,s)=>e.push(Wt(s))),`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Error("Injector has already been destroyed.")}processInjectorType(e,n,r){if(!(e=z(e)))return!1;let s=Oc(e);const u=null==s&&e.ngModule||void 0,m=void 0===u?e:u,v=-1!==r.indexOf(m);if(void 0!==u&&(s=Oc(u)),null==s)return!1;if(null!=s.imports&&!v){let P;r.push(m);try{vs(s.imports,V=>{this.processInjectorType(V,n,r)&&(void 0===P&&(P=[]),P.push(V))})}finally{}if(void 0!==P)for(let V=0;V<P.length;V++){const{ngModule:j,providers:G}=P[V];vs(G,se=>this.processProvider(se,j,G||On))}}this.injectorDefTypes.add(m);const E=Xo(m)||(()=>new m);this.records.set(m,Po(E,eo));const S=s.providers;if(null!=S&&!v){const P=e;vs(S,V=>this.processProvider(V,P,S))}return void 0!==u&&void 0!==e.providers}processProvider(e,n,r){let s=ui(e=z(e))?e:z(e&&e.provide);const u=function(t,e,n){return Jd(t)?Po(void 0,t.useValue):Po(Qd(t),eo)}(e);if(ui(e)||!0!==e.multi)this.records.get(s);else{let m=this.records.get(s);m||(m=Po(void 0,eo,!0),m.factory=()=>ac(m.multi),this.records.set(s,m)),s=e,m.multi.push(e)}this.records.set(s,u)}hydrate(e,n){return n.value===eo&&(n.value=ns,n.value=n.factory()),"object"==typeof n.value&&n.value&&function(t){return null!==t&&"object"==typeof t&&"function"==typeof t.ngOnDestroy}(n.value)&&this.onDestroy.add(n.value),n.value}injectableDefInScope(e){if(!e.providedIn)return!1;const n=z(e.providedIn);return"string"==typeof n?"any"===n||n===this.scope:this.injectorDefTypes.has(n)}}function to(t){const e=Oi(t),n=null!==e?e.factory:Xo(t);if(null!==n)return n;if(t instanceof un)throw new Error(`Token ${Wt(t)} is missing a \u0275prov definition.`);if(t instanceof Function)return function(t){const e=t.length;if(e>0){const r=function(t,e){const n=[];for(let r=0;r<t;r++)n.push(e);return n}(e,"?");throw new Error(`Can't resolve all parameters for ${Wt(t)}: (${r.join(", ")}).`)}const n=function(t){const e=t&&(t[Gt]||t[Nl]);if(e){const n=function(t){if(t.hasOwnProperty("name"))return t.name;const e=(""+t).match(/^function\s*([^\s(]+)/);return null===e?"":e[1]}(t);return console.warn(`DEPRECATED: DI is instantiating a token "${n}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${n}" class.`),e}return null}(t);return null!==n?()=>n.factory(t):()=>new t}(t);throw new Error("unreachable")}function Qd(t,e,n){let r;if(ui(t)){const s=z(t);return Xo(s)||to(s)}if(Jd(t))r=()=>z(t.useValue);else if(function(t){return!(!t||!t.useFactory)}(t))r=()=>t.useFactory(...ac(t.deps||[]));else if(function(t){return!(!t||!t.useExisting)}(t))r=()=>_t(z(t.useExisting));else{const s=z(t&&(t.useClass||t.provide));if(!function(t){return!!t.deps}(t))return Xo(s)||to(s);r=()=>new s(...ac(t.deps))}return r}function Po(t,e,n=!1){return{factory:t,value:e,multi:n?[]:void 0}}function Jd(t){return null!==t&&"object"==typeof t&&lh in t}function ui(t){return"function"==typeof t}const xb=function(t,e,n){return function(t,e=null,n=null,r){const s=Es(t,e,n,r);return s._resolveInjectorDefTypes(),s}({name:n},e,t,n)};let nr=(()=>{class t{static create(n,r){return Array.isArray(n)?xb(n,r,""):xb(n.providers,n.parent,n.name||"")}}return t.THROW_IF_NOT_FOUND=bs,t.NULL=new Mi,t.\u0275prov=kt({token:t,providedIn:"any",factory:()=>_t(pn)}),t.__NG_ELEMENT_ID__=-1,t})();function oA(t,e){tc(Ad(t)[1],zn())}function Dr(t){let e=function(t){return Object.getPrototypeOf(t.prototype).constructor}(t.type),n=!0;const r=[t];for(;e;){let s;if(Co(t))s=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new Error("Directives cannot inherit Components");s=e.\u0275dir}if(s){if(n){r.push(s);const m=t;m.inputs=t0(t.inputs),m.declaredInputs=t0(t.declaredInputs),m.outputs=t0(t.outputs);const v=s.hostBindings;v&&cA(t,v);const E=s.viewQuery,S=s.contentQueries;if(E&&aA(t,E),S&&lA(t,S),us(t.inputs,s.inputs),us(t.declaredInputs,s.declaredInputs),us(t.outputs,s.outputs),Co(s)&&s.data.animation){const P=t.data;P.animation=(P.animation||[]).concat(s.data.animation)}}const u=s.features;if(u)for(let m=0;m<u.length;m++){const v=u[m];v&&v.ngInherit&&v(t),v===Dr&&(n=!1)}}e=Object.getPrototypeOf(e)}!function(t){let e=0,n=null;for(let r=t.length-1;r>=0;r--){const s=t[r];s.hostVars=e+=s.hostVars,s.hostAttrs=Z(s.hostAttrs,n=Z(n,s.hostAttrs))}}(r)}function t0(t){return t===Fs?{}:t===On?[]:t}function aA(t,e){const n=t.viewQuery;t.viewQuery=n?(r,s)=>{e(r,s),n(r,s)}:e}function lA(t,e){const n=t.contentQueries;t.contentQueries=n?(r,s,u)=>{e(r,s,u),n(r,s,u)}:e}function cA(t,e){const n=t.hostBindings;t.hostBindings=n?(r,s)=>{e(r,s),n(r,s)}:e}let o_=null;function ef(){if(!o_){const t=on.Symbol;if(t&&t.iterator)o_=t.iterator;else{const e=Object.getOwnPropertyNames(Map.prototype);for(let n=0;n<e.length;++n){const r=e[n];"entries"!==r&&"size"!==r&&Map.prototype[r]===Map.prototype.entries&&(o_=r)}}}return o_}function Kp(t){return!!n0(t)&&(Array.isArray(t)||!(t instanceof Map)&&ef()in t)}function n0(t){return null!==t&&("function"==typeof t||"object"==typeof t)}function fo(t,e,n){return!Object.is(t[e],n)&&(t[e]=n,!0)}function nf(t,e,n,r){return fo(t,Ht.lFrame.bindingIndex++,n)?e+oe(n)+r:Kt}function ot(t,e=Mt.Default){const n=tt();return null===n?_t(t,e):nn(zn(),n,z(t),e)}function a0(t,e,n,r,s){const m=s?"class":"style";!function(t,e,n,r,s){for(let u=0;u<n.length;){const m=n[u++],v=n[u++],E=e[m],S=t.data[m];null!==S.setInput?S.setInput(E,s,r,v):E[v]=s}}(t,n,e.inputs[m],m,r)}function at(t,e,n,r){const s=tt(),u=xn(),m=20+t,v=s[11],E=s[m]=dc(v,e,Ht.lFrame.currentNamespace),S=u.firstCreatePass?function(t,e,n,r,s,u,m){const v=e.consts,S=yl(e,t,2,s,Do(v,u));return function(t,e,n,r){let s=!1;if(Jc()){const u=function(t,e,n){const r=t.directiveRegistry;let s=null;if(r)for(let u=0;u<r.length;u++){const m=r[u];Mp(n,m.selectors,!1)&&(s||(s=[]),zt(gt(n,e),t,m.type),Co(m)?(Se(t,n),s.unshift(m)):s.push(m))}return s}(t,e,n),m=null===r?null:{"":-1};if(null!==u){s=!0,ke(n,t.data.length,u.length);for(let P=0;P<u.length;P++){const V=u[P];V.providersResolver&&V.providersResolver(V)}let v=!1,E=!1,S=vl(t,e,u.length,null);for(let P=0;P<u.length;P++){const V=u[P];n.mergedAttrs=Z(n.mergedAttrs,V.hostAttrs),He(t,n,e,S,V),Me(S,V,m),null!==V.contentQueries&&(n.flags|=8),(null!==V.hostBindings||null!==V.hostAttrs||0!==V.hostVars)&&(n.flags|=128);const j=V.type.prototype;!v&&(j.ngOnChanges||j.ngOnInit||j.ngDoCheck)&&((t.preOrderHooks||(t.preOrderHooks=[])).push(n.index),v=!0),!E&&(j.ngOnChanges||j.ngDoCheck)&&((t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n.index),E=!0),S++}!function(t,e){const r=e.directiveEnd,s=t.data,u=e.attrs,m=[];let v=null,E=null;for(let S=e.directiveStart;S<r;S++){const P=s[S],V=P.inputs,j=null===u||Hg(e)?null:Ye(V,u);m.push(j),v=i(V,S,v),E=i(P.outputs,S,E)}null!==v&&(v.hasOwnProperty("class")&&(e.flags|=16),v.hasOwnProperty("style")&&(e.flags|=32)),e.initialInputs=m,e.inputs=v,e.outputs=E}(t,n)}m&&function(t,e,n){if(e){const r=t.localNames=[];for(let s=0;s<e.length;s+=2){const u=n[e[s+1]];if(null==u)throw new ce("301",`Export of name '${e[s+1]}' not found!`);r.push(e[s],u)}}}(n,r,m)}n.mergedAttrs=Z(n.mergedAttrs,n.attrs)}(e,n,S,Do(v,m)),null!==S.attrs&&cr(S,S.attrs,!1),null!==S.mergedAttrs&&cr(S,S.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,S),S}(m,u,s,0,e,n,r):u.data[m];Ni(S,!0);const P=S.mergedAttrs;null!==P&&K(v,E,P);const V=S.classes;null!==V&&Ap(v,E,V);const j=S.styles;null!==j&&Bg(v,E,j),64!=(64&S.flags)&&Ah(u,s,E,S),0===Ht.lFrame.elementDepthCount&&Vi(E,s),Ht.lFrame.elementDepthCount++,Gc(S)&&(function(t,e,n){!Jc()||(function(t,e,n,r){const s=n.directiveStart,u=n.directiveEnd;t.firstCreatePass||gt(n,e),Vi(r,e);const m=n.initialInputs;for(let v=s;v<u;v++){const E=t.data[v],S=Co(E);S&&Je(e,n,E);const P=Zr(e,t,v,n);Vi(P,e),null!==m&&Ze(0,v-s,P,E,0,m),S&&(Li(n.index,e)[8]=P)}}(t,e,n,ir(n,e)),128==(128&n.flags)&&function(t,e,n){const r=n.directiveStart,s=n.directiveEnd,m=n.index,v=Ht.lFrame.currentDirectiveIndex;try{_s(m);for(let E=r;E<s;E++){const S=t.data[E],P=e[E];Wl(E),(null!==S.hostBindings||0!==S.hostVars||null!==S.hostAttrs)&&de(S,P)}}finally{_s(-1),Wl(v)}}(t,e,n))}(u,s,S),function(t,e,n){if(Hc(e)){const s=e.directiveEnd;for(let u=e.directiveStart;u<s;u++){const m=t.data[u];m.contentQueries&&m.contentQueries(1,n[u],u)}}}(u,S,s)),null!==r&&function(t,e,n=ir){const r=e.localNames;if(null!==r){let s=e.index+1;for(let u=0;u<r.length;u+=2){const m=r[u+1],v=-1===m?n(e,t):t[m];t[s++]=v}}}(s,S)}function lt(){let t=zn();yt()?Ht.lFrame.isParent=!1:(t=t.parent,Ni(t,!1));const e=t;Ht.lFrame.elementDepthCount--;const n=xn();n.firstCreatePass&&(tc(n,t),Hc(t)&&n.queries.elementEnd(t)),null!=e.classesWithoutHost&&function(t){return 0!=(16&t.flags)}(e)&&a0(n,e,tt(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function(t){return 0!=(32&t.flags)}(e)&&a0(n,e,tt(),e.stylesWithoutHost,!1)}function _n(t,e,n,r){at(t,e,n,r),lt()}function Qp(t){return!!t&&"function"==typeof t.then}const l_=function(t){return!!t&&"function"==typeof t.subscribe};function vi(t,e,n,r){const s=tt(),u=xn(),m=zn();return function(t,e,n,r,s,u,m,v){const E=Gc(r),P=t.firstCreatePass&&Ur(t),V=e[8],j=Kr(e);let G=!0;if(3&r.type||v){const be=ir(r,e),qe=v?v(be):be,Ue=j.length,Tt=v?Nt=>v(mr(Nt[r.index])):r.index;if(Zn(n)){let Nt=null;if(!v&&E&&(Nt=function(t,e,n,r){const s=t.cleanup;if(null!=s)for(let u=0;u<s.length-1;u+=2){const m=s[u];if(m===n&&s[u+1]===r){const v=e[7],E=s[u+2];return v.length>E?v[E]:null}"string"==typeof m&&(u+=2)}return null}(t,e,s,r.index)),null!==Nt)(Nt.__ngLastListenerFn__||Nt).__ngNextListenerFn__=u,Nt.__ngLastListenerFn__=u,G=!1;else{u=l0(r,e,V,u,!1);const wn=n.listen(qe,s,u);j.push(u,wn),P&&P.push(s,Tt,Ue,Ue+1)}}else u=l0(r,e,V,u,!0),qe.addEventListener(s,u,m),j.push(u),P&&P.push(s,Tt,Ue,m)}else u=l0(r,e,V,u,!1);const se=r.outputs;let Re;if(G&&null!==se&&(Re=se[s])){const be=Re.length;if(be)for(let qe=0;qe<be;qe+=2){const Fi=e[Re[qe]][Re[qe+1]].subscribe(u),ra=j.length;j.push(u,Fi),P&&P.push(s,r.index,ra,-(ra+1))}}}(u,s,s[11],m,t,e,!!n,r),vi}function dw(t,e,n,r){try{return!1!==n(r)}catch(s){return Ii(t,s),!1}}function l0(t,e,n,r,s){return function u(m){if(m===Function)return r;const v=2&t.flags?Li(t.index,e):e;0==(32&e[2])&&fn(v);let E=dw(e,0,r,m),S=u.__ngNextListenerFn__;for(;S;)E=dw(e,0,S,m)&&E,S=S.__ngNextListenerFn__;return s&&!1===E&&(m.preventDefault(),m.returnValue=!1),E}}function ww(t,e,n,r,s){const u=t[n+1],m=null===e;let v=r?Ro(u):Sa(u),E=!1;for(;0!==v&&(!1===E||m);){const P=t[v+1];YA(t[v],e)&&(E=!0,t[v+1]=r?Mh(P):Fp(P)),v=r?Ro(P):Sa(P)}E&&(t[n+1]=r?Fp(u):Mh(u))}function YA(t,e){return null===t||null==e||(Array.isArray(t)?t[1]:t)===e||!(!Array.isArray(t)||"string"!=typeof e)&&uu(t,e)>=0}function c_(t,e){return function(t,e,n,r){const s=tt(),u=xn(),m=function(t){const e=Ht.lFrame,n=e.bindingIndex;return e.bindingIndex=e.bindingIndex+t,n}(2);u.firstUpdatePass&&function(t,e,n,r){const s=t.data;if(null===s[n+1]){const u=s[ri()],m=function(t,e){return e>=t.expandoStartIndex}(t,n);(function(t,e){return 0!=(t.flags&(e?16:32))})(u,r)&&null===e&&!m&&(e=!1),e=function(t,e,n,r){const s=function(t){const e=Ht.lFrame.currentDirectiveIndex;return-1===e?null:t[e]}(t);let u=r?e.residualClasses:e.residualStyles;if(null===s)0===(r?e.classBindings:e.styleBindings)&&(n=Jp(n=u0(null,t,e,n,r),e.attrs,r),u=null);else{const m=e.directiveStylingLast;if(-1===m||t[m]!==s)if(n=u0(s,t,e,n,r),null===u){let E=function(t,e,n){const r=n?e.classBindings:e.styleBindings;if(0!==Sa(r))return t[Ro(r)]}(t,e,r);void 0!==E&&Array.isArray(E)&&(E=u0(null,t,e,E[1],r),E=Jp(E,e.attrs,r),function(t,e,n,r){t[Ro(n?e.classBindings:e.styleBindings)]=r}(t,e,r,E))}else u=function(t,e,n){let r;const s=e.directiveEnd;for(let u=1+e.directiveStylingLast;u<s;u++)r=Jp(r,t[u].hostAttrs,n);return Jp(r,e.attrs,n)}(t,e,r)}return void 0!==u&&(r?e.residualClasses=u:e.residualStyles=u),n}(s,u,e,r),function(t,e,n,r,s,u){let m=u?e.classBindings:e.styleBindings,v=Ro(m),E=Sa(m);t[r]=n;let P,S=!1;if(Array.isArray(n)){const V=n;P=V[1],(null===P||uu(V,P)>0)&&(S=!0)}else P=n;if(s)if(0!==E){const j=Ro(t[v+1]);t[r+1]=$d(j,v),0!==j&&(t[j+1]=Op(t[j+1],r)),t[v+1]=function(t,e){return 131071&t|e<<17}(t[v+1],r)}else t[r+1]=$d(v,0),0!==v&&(t[v+1]=Op(t[v+1],r)),v=r;else t[r+1]=$d(E,0),0===v?v=r:t[E+1]=Op(t[E+1],r),E=r;S&&(t[r+1]=Fp(t[r+1])),ww(t,P,r,!0),ww(t,P,r,!1),function(t,e,n,r,s){const u=s?t.residualClasses:t.residualStyles;null!=u&&"string"==typeof e&&uu(u,e)>=0&&(n[r+1]=Mh(n[r+1]))}(e,P,t,r,u),m=$d(v,E),u?e.classBindings=m:e.styleBindings=m}(s,u,e,n,m,r)}}(u,t,m,r),e!==Kt&&fo(s,m,e)&&function(t,e,n,r,s,u,m,v){if(!(3&e.type))return;const E=t.data,S=E[v+1];u_(function(t){return 1==(1&t)}(S)?Fw(E,e,n,s,Sa(S),m):void 0)||(u_(u)||function(t){return 2==(2&t)}(S)&&(u=Fw(E,null,n,s,v,m)),function(t,e,n,r,s){const u=Zn(t);if(e)s?u?t.addClass(n,r):n.classList.add(r):u?t.removeClass(n,r):n.classList.remove(r);else{let m=-1===r.indexOf("-")?void 0:Io.DashCase;if(null==s)u?t.removeStyle(n,r,m):n.style.removeProperty(r);else{const v="string"==typeof s&&s.endsWith("!important");v&&(s=s.slice(0,-10),m|=Io.Important),u?t.setStyle(n,r,s,m):n.style.setProperty(r,s,v?"important":"")}}}(r,m,Ls(ri(),n),s,u))}(u,u.data[ri()],s,s[11],t,s[m+1]=function(t,e){return null==t||("string"==typeof e?t+=e:"object"==typeof t&&(t=Wt(function(t){return t instanceof class{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}?t.changingThisBreaksApplicationSecurity:t}(t)))),t}(e,n),r,m)}(t,e,null,!0),c_}function u0(t,e,n,r,s){let u=null;const m=n.directiveEnd;let v=n.directiveStylingLast;for(-1===v?v=n.directiveStart:v++;v<m&&(u=e[v],r=Jp(r,u.hostAttrs,s),u!==t);)v++;return null!==t&&(n.directiveStylingLast=v),r}function Jp(t,e,n){const r=n?1:2;let s=-1;if(null!==e)for(let u=0;u<e.length;u++){const m=e[u];"number"==typeof m?s=m:s===r&&(Array.isArray(t)||(t=void 0===t?[]:["",t]),oi(t,m,!!n||e[++u]))}return void 0===t?null:t}function Fw(t,e,n,r,s,u){const m=null===e;let v;for(;s>0;){const E=t[s],S=Array.isArray(E),P=S?E[1]:E,V=null===P;let j=n[s+1];j===Kt&&(j=V?On:void 0);let G=V?Qf(j,r):P===r?j:void 0;if(S&&!u_(G)&&(G=Qf(E,r)),u_(G)&&(v=G,m))return v;const se=t[s+1];s=m?Ro(se):Sa(se)}if(null!==e){let E=u?e.residualClasses:e.residualStyles;null!=E&&(v=Qf(E,r))}return v}function u_(t){return void 0!==t}function bn(t,e=""){const n=tt(),r=xn(),s=t+20,u=r.firstCreatePass?yl(r,s,1,e,null):r.data[s],m=n[s]=function(t,e){return Zn(t)?t.createText(e):t.createTextNode(e)}(n[11],e);Ah(r,n,m,u),Ni(u,!1)}function h_(t,e,n){const r=tt(),s=nf(r,t,e,n);return s!==Kt&&En(r,ri(),s),h_}const zh=void 0;var kI=["en",[["a","p"],["AM","PM"],zh],[["AM","PM"],zh,zh],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],zh,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],zh,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",zh,"{1} 'at' {0}",zh],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function(t){const e=Math.floor(Math.abs(t)),n=t.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===n?1:5}];let ff={};function nE(t){return t in ff||(ff[t]=on.ng&&on.ng.common&&on.ng.common.locales&&on.ng.common.locales[t]),ff[t]}var St=(()=>((St=St||{})[St.LocaleId=0]="LocaleId",St[St.DayPeriodsFormat=1]="DayPeriodsFormat",St[St.DayPeriodsStandalone=2]="DayPeriodsStandalone",St[St.DaysFormat=3]="DaysFormat",St[St.DaysStandalone=4]="DaysStandalone",St[St.MonthsFormat=5]="MonthsFormat",St[St.MonthsStandalone=6]="MonthsStandalone",St[St.Eras=7]="Eras",St[St.FirstDayOfWeek=8]="FirstDayOfWeek",St[St.WeekendRange=9]="WeekendRange",St[St.DateFormat=10]="DateFormat",St[St.TimeFormat=11]="TimeFormat",St[St.DateTimeFormat=12]="DateTimeFormat",St[St.NumberSymbols=13]="NumberSymbols",St[St.NumberFormats=14]="NumberFormats",St[St.CurrencyCode=15]="CurrencyCode",St[St.CurrencySymbol=16]="CurrencySymbol",St[St.CurrencyName=17]="CurrencyName",St[St.Currencies=18]="Currencies",St[St.Directionality=19]="Directionality",St[St.PluralCase=20]="PluralCase",St[St.ExtraData=21]="ExtraData",St))();const d_="en-US";let rE=d_;function d0(t){$n(t,"Expected localeId to be defined"),"string"==typeof t&&(rE=t.toLowerCase().replace(/_/g,"-"))}function m0(t,e,n,r,s){if(t=z(t),Array.isArray(t))for(let u=0;u<t.length;u++)m0(t[u],e,n,r,s);else{const u=xn(),m=tt();let v=ui(t)?t:z(t.provide),E=Qd(t);const S=zn(),P=1048575&S.providerIndexes,V=S.directiveStart,j=S.providerIndexes>>20;if(ui(t)||!t.multi){const G=new b(E,s,ot),se=_0(v,e,s?P:P+j,V);-1===se?(zt(gt(S,m),u,v),g0(u,t,e.length),e.push(v),S.directiveStart++,S.directiveEnd++,s&&(S.providerIndexes+=1048576),n.push(G),m.push(G)):(n[se]=G,m[se]=G)}else{const G=_0(v,e,P+j,V),se=_0(v,e,P,P+j),Re=G>=0&&n[G],be=se>=0&&n[se];if(s&&!be||!s&&!Re){zt(gt(S,m),u,v);const qe=function(t,e,n,r,s){const u=new b(t,n,ot);return u.multi=[],u.index=e,u.componentProviders=0,SE(u,s,r&&!n),u}(s?IM:AM,n.length,s,r,E);!s&&be&&(n[se].providerFactory=qe),g0(u,t,e.length,0),e.push(v),S.directiveStart++,S.directiveEnd++,s&&(S.providerIndexes+=1048576),n.push(qe),m.push(qe)}else g0(u,t,G>-1?G:se,SE(n[s?se:G],E,!s&&r));!s&&r&&be&&n[se].componentProviders++}}}function g0(t,e,n,r){const s=ui(e);if(s||function(t){return!!t.useClass}(e)){const m=(e.useClass||e).prototype.ngOnDestroy;if(m){const v=t.destroyHooks||(t.destroyHooks=[]);if(!s&&e.multi){const E=v.indexOf(n);-1===E?v.push(n,[r,m]):v[E+1].push(r,m)}else v.push(n,m)}}}function SE(t,e,n){return n&&t.componentProviders++,t.multi.push(e)-1}function _0(t,e,n,r){for(let s=n;s<r;s++)if(e[s]===t)return s;return-1}function AM(t,e,n,r){return y0(this.multi,[])}function IM(t,e,n,r){const s=this.multi;let u;if(this.providerFactory){const m=this.providerFactory.componentProviders,v=Zr(n,n[1],this.providerFactory.index,r);u=v.slice(0,m),y0(s,u);for(let E=m;E<v.length;E++)u.push(v[E])}else u=[],y0(s,u);return u}function y0(t,e){for(let n=0;n<t.length;n++)e.push((0,t[n])());return e}function Rr(t,e=[]){return n=>{n.providersResolver=(r,s)=>function(t,e,n){const r=xn();if(r.firstCreatePass){const s=Co(t);m0(n,r.data,r.blueprint,s,!0),m0(e,r.data,r.blueprint,s,!1)}}(r,s?s(t):t,e)}}class AE{}const ME="ngComponent";class kM{resolveComponentFactory(e){throw function(t){const e=Error(`No component factory found for ${Wt(t)}. Did you add it to @NgModule.entryComponents?`);return e[ME]=t,e}(e)}}let Vh=(()=>{class t{}return t.NULL=new kM,t})();function __(...t){}function mf(t,e){return new $i(ir(t,e))}const OM=function(){return mf(zn(),tt())};let $i=(()=>{class t{constructor(n){this.nativeElement=n}}return t.__NG_ELEMENT_ID__=OM,t})();function RE(t){return t instanceof $i?t.nativeElement:t}class y_{}let Cl=(()=>{class t{}return t.__NG_ELEMENT_ID__=()=>NM(),t})();const NM=function(){const t=tt(),n=Li(zn().index,t);return function(t){return t[11]}(Ai(n)?n:t)};let x0=(()=>{class t{}return t.\u0275prov=kt({token:t,providedIn:"root",factory:()=>null}),t})();class im{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const kE=new im("12.2.11");class PE{constructor(){}supports(e){return Kp(e)}create(e){return new UM(e)}}const BM=(t,e)=>e;class UM{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||BM}forEachItem(e){let n;for(n=this._itHead;null!==n;n=n._next)e(n)}forEachOperation(e){let n=this._itHead,r=this._removalsHead,s=0,u=null;for(;n||r;){const m=!r||n&&n.currentIndex<OE(r,s,u)?n:r,v=OE(m,s,u),E=m.currentIndex;if(m===r)s--,r=r._nextRemoved;else if(n=n._next,null==m.previousIndex)s++;else{u||(u=[]);const S=v-s,P=E-s;if(S!=P){for(let j=0;j<S;j++){const G=j<u.length?u[j]:u[j]=0,se=G+j;P<=se&&se<S&&(u[j]=G+1)}u[m.previousIndex]=P-S}}v!==E&&e(m,v,E)}}forEachPreviousItem(e){let n;for(n=this._previousItHead;null!==n;n=n._nextPrevious)e(n)}forEachAddedItem(e){let n;for(n=this._additionsHead;null!==n;n=n._nextAdded)e(n)}forEachMovedItem(e){let n;for(n=this._movesHead;null!==n;n=n._nextMoved)e(n)}forEachRemovedItem(e){let n;for(n=this._removalsHead;null!==n;n=n._nextRemoved)e(n)}forEachIdentityChange(e){let n;for(n=this._identityChangesHead;null!==n;n=n._nextIdentityChange)e(n)}diff(e){if(null==e&&(e=[]),!Kp(e))throw new Error(`Error trying to diff '${Wt(e)}'. Only arrays and iterables are allowed`);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let s,u,m,n=this._itHead,r=!1;if(Array.isArray(e)){this.length=e.length;for(let v=0;v<this.length;v++)u=e[v],m=this._trackByFn(v,u),null!==n&&Object.is(n.trackById,m)?(r&&(n=this._verifyReinsertion(n,u,m,v)),Object.is(n.item,u)||this._addIdentityChange(n,u)):(n=this._mismatch(n,u,m,v),r=!0),n=n._next}else s=0,function(t,e){if(Array.isArray(t))for(let n=0;n<t.length;n++)e(t[n]);else{const n=t[ef()]();let r;for(;!(r=n.next()).done;)e(r.value)}}(e,v=>{m=this._trackByFn(s,v),null!==n&&Object.is(n.trackById,m)?(r&&(n=this._verifyReinsertion(n,v,m,s)),Object.is(n.item,v)||this._addIdentityChange(n,v)):(n=this._mismatch(n,v,m,s),r=!0),n=n._next,s++}),this.length=s;return this._truncate(n),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,n,r,s){let u;return null===e?u=this._itTail:(u=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null))?(Object.is(e.item,n)||this._addIdentityChange(e,n),this._reinsertAfter(e,u,s)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(r,s))?(Object.is(e.item,n)||this._addIdentityChange(e,n),this._moveAfter(e,u,s)):e=this._addAfter(new jM(n,r),u,s),e}_verifyReinsertion(e,n,r,s){let u=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null);return null!==u?e=this._reinsertAfter(u,e._prev,s):e.currentIndex!=s&&(e.currentIndex=s,this._addToMoves(e,s)),e}_truncate(e){for(;null!==e;){const n=e._next;this._addToRemovals(this._unlink(e)),e=n}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,n,r){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const s=e._prevRemoved,u=e._nextRemoved;return null===s?this._removalsHead=u:s._nextRemoved=u,null===u?this._removalsTail=s:u._prevRemoved=s,this._insertAfter(e,n,r),this._addToMoves(e,r),e}_moveAfter(e,n,r){return this._unlink(e),this._insertAfter(e,n,r),this._addToMoves(e,r),e}_addAfter(e,n,r){return this._insertAfter(e,n,r),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,n,r){const s=null===n?this._itHead:n._next;return e._next=s,e._prev=n,null===s?this._itTail=e:s._prev=e,null===n?this._itHead=e:n._next=e,null===this._linkedRecords&&(this._linkedRecords=new FE),this._linkedRecords.put(e),e.currentIndex=r,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const n=e._prev,r=e._next;return null===n?this._itHead=r:n._next=r,null===r?this._itTail=n:r._prev=n,e}_addToMoves(e,n){return e.previousIndex===n||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new FE),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,n){return e.item=n,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class jM{constructor(e,n){this.item=e,this.trackById=n,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class $M{constructor(){this._head=null,this._tail=null}add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,n){let r;for(r=this._head;null!==r;r=r._nextDup)if((null===n||n<=r.currentIndex)&&Object.is(r.trackById,e))return r;return null}remove(e){const n=e._prevDup,r=e._nextDup;return null===n?this._head=r:n._nextDup=r,null===r?this._tail=n:r._prevDup=n,null===this._head}}class FE{constructor(){this.map=new Map}put(e){const n=e.trackById;let r=this.map.get(n);r||(r=new $M,this.map.set(n,r)),r.add(e)}get(e,n){const s=this.map.get(e);return s?s.get(e,n):null}remove(e){const n=e.trackById;return this.map.get(n).remove(e)&&this.map.delete(n),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function OE(t,e,n){const r=t.previousIndex;if(null===r)return r;let s=0;return n&&r<n.length&&(s=n[r]),r+e+s}class LE{constructor(){}supports(e){return e instanceof Map||n0(e)}create(){return new HM}}class HM{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(e){let n;for(n=this._mapHead;null!==n;n=n._next)e(n)}forEachPreviousItem(e){let n;for(n=this._previousMapHead;null!==n;n=n._nextPrevious)e(n)}forEachChangedItem(e){let n;for(n=this._changesHead;null!==n;n=n._nextChanged)e(n)}forEachAddedItem(e){let n;for(n=this._additionsHead;null!==n;n=n._nextAdded)e(n)}forEachRemovedItem(e){let n;for(n=this._removalsHead;null!==n;n=n._nextRemoved)e(n)}diff(e){if(e){if(!(e instanceof Map||n0(e)))throw new Error(`Error trying to diff '${Wt(e)}'. Only maps and objects are allowed`)}else e=new Map;return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let n=this._mapHead;if(this._appendAfter=null,this._forEach(e,(r,s)=>{if(n&&n.key===s)this._maybeAddToChanges(n,r),this._appendAfter=n,n=n._next;else{const u=this._getOrCreateRecordForKey(s,r);n=this._insertBeforeOrAppend(n,u)}}),n){n._prev&&(n._prev._next=null),this._removalsHead=n;for(let r=n;null!==r;r=r._nextRemoved)r===this._mapHead&&(this._mapHead=null),this._records.delete(r.key),r._nextRemoved=r._next,r.previousValue=r.currentValue,r.currentValue=null,r._prev=null,r._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(e,n){if(e){const r=e._prev;return n._next=e,n._prev=r,e._prev=n,r&&(r._next=n),e===this._mapHead&&(this._mapHead=n),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=n,n._prev=this._appendAfter):this._mapHead=n,this._appendAfter=n,null}_getOrCreateRecordForKey(e,n){if(this._records.has(e)){const s=this._records.get(e);this._maybeAddToChanges(s,n);const u=s._prev,m=s._next;return u&&(u._next=m),m&&(m._prev=u),s._next=null,s._prev=null,s}const r=new GM(e);return this._records.set(e,r),r.currentValue=n,this._addToAdditions(r),r}_reset(){if(this.isDirty){let e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(e,n){Object.is(n,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=n,this._addToChanges(e))}_addToAdditions(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}_addToChanges(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}_forEach(e,n){e instanceof Map?e.forEach(n):Object.keys(e).forEach(r=>n(e[r],r))}}class GM{constructor(e){this.key=e,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function NE(){return new om([new PE])}let om=(()=>{class t{constructor(n){this.factories=n}static create(n,r){if(null!=r){const s=r.factories.slice();n=n.concat(s)}return new t(n)}static extend(n){return{provide:t,useFactory:r=>t.create(n,r||NE()),deps:[[t,new Gs,new sr]]}}find(n){const r=this.factories.find(s=>s.supports(n));if(null!=r)return r;throw new Error(`Cannot find a differ supporting object '${n}' of type '${function(t){return t.name||typeof t}(n)}'`)}}return t.\u0275prov=kt({token:t,providedIn:"root",factory:NE}),t})();function zE(){return new gf([new LE])}let gf=(()=>{class t{constructor(n){this.factories=n}static create(n,r){if(r){const s=r.factories.slice();n=n.concat(s)}return new t(n)}static extend(n){return{provide:t,useFactory:r=>t.create(n,r||zE()),deps:[[t,new Gs,new sr]]}}find(n){const r=this.factories.find(s=>s.supports(n));if(r)return r;throw new Error(`Cannot find a differ supporting object '${n}'`)}}return t.\u0275prov=kt({token:t,providedIn:"root",factory:zE}),t})();function v_(t,e,n,r,s=!1){for(;null!==n;){const u=e[n.index];if(null!==u&&r.push(mr(u)),Eo(u))for(let v=10;v<u.length;v++){const E=u[v],S=E[1].firstChild;null!==S&&v_(E[1],E,S,r)}const m=n.type;if(8&m)v_(t,e,n.child,r);else if(32&m){const v=gp(n,e);let E;for(;E=v();)r.push(E)}else if(16&m){const v=pc(e,n);if(Array.isArray(v))r.push(...v);else{const E=Eh(e[16]);v_(E[1],E,v,r,!0)}}n=s?n.projectionNext:n.next}return r}class sm{constructor(e,n){this._lView=e,this._cdRefInjectingView=n,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const e=this._lView,n=e[1];return v_(n,e,n.firstChild,[])}get context(){return this._lView[8]}set context(e){this._lView[8]=e}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[3];if(Eo(e)){const n=e[8],r=n?n.indexOf(this):-1;r>-1&&(Ld(e,r),ic(n,r))}this._attachedToViewContainer=!1}xp(this._lView[1],this._lView)}onDestroy(e){qp(this._lView[1],this._lView,null,e)}markForCheck(){fn(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){Ir(this._lView[1],this._lView,this.context)}checkNoChanges(){!function(t,e,n){Zl(!0);try{Ir(t,e,n)}finally{Zl(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function(t,e){_l(t,e,e[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new Error("This view is already attached to a ViewContainer!");this._appRef=e}}class ZM extends sm{constructor(e){super(e),this._view=e}detectChanges(){Br(this._view)}checkNoChanges(){!function(t){Zl(!0);try{Br(t)}finally{Zl(!1)}}(this._view)}get context(){return null}}const XM=function(t){return function(t,e,n){if(Ul(t)&&!n){const r=Li(t.index,e);return new sm(r,r)}return 47&t.type?new sm(e[16],e):null}(zn(),tt(),16==(16&t))};let b0=(()=>{class t{}return t.__NG_ELEMENT_ID__=XM,t})();const QM=[new LE],eR=new om([new PE]),tR=new gf(QM),rR=function(){return x_(zn(),tt())};let Ec=(()=>{class t{}return t.__NG_ELEMENT_ID__=rR,t})();const iR=Ec,oR=class extends iR{constructor(e,n,r){super(),this._declarationLView=e,this._declarationTContainer=n,this.elementRef=r}createEmbeddedView(e){const n=this._declarationTContainer.tViews,r=_c(this._declarationLView,n,e,16,null,n.declTNode,null,null,null,null);r[17]=this._declarationLView[this._declarationTContainer.index];const u=this._declarationLView[19];return null!==u&&(r[19]=u.createEmbeddedView(n)),yc(n,r,e),new sm(r)}};function x_(t,e){return 4&t.type?new oR(e,t,mf(t,e)):null}class Tl{}class VE{}const lR=function(){return jE(zn(),tt())};let Fa=(()=>{class t{}return t.__NG_ELEMENT_ID__=lR,t})();const uR=Fa,BE=class extends uR{constructor(e,n,r){super(),this._lContainer=e,this._hostTNode=n,this._hostLView=r}get element(){return mf(this._hostTNode,this._hostLView)}get injector(){return new qn(this._hostTNode,this._hostLView)}get parentInjector(){const e=Xt(this._hostTNode,this._hostLView);if(ae(e)){const n=J(e,this._hostLView),r=he(e);return new qn(n[1].data[r+8],n)}return new qn(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const n=UE(this._lContainer);return null!==n&&n[e]||null}get length(){return this._lContainer.length-10}createEmbeddedView(e,n,r){const s=e.createEmbeddedView(n||{});return this.insert(s,r),s}createComponent(e,n,r,s,u){const m=r||this.parentInjector;if(!u&&null==e.ngModule&&m){const E=m.get(Tl,null);E&&(u=E)}const v=e.create(m,s,void 0,u);return this.insert(v.hostView,n),v}insert(e,n){const r=e._lView,s=r[1];if(function(t){return Eo(t[3])}(r)){const P=this.indexOf(e);if(-1!==P)this.detach(P);else{const V=r[3],j=new BE(V,V[6],V[3]);j.detach(j.indexOf(e))}}const u=this._adjustIndex(n),m=this._lContainer;!function(t,e,n,r){const s=10+r,u=n.length;r>0&&(n[s-1][4]=e),r<u-10?(e[4]=n[s],_d(n,10+r,e)):(n.push(e),e[4]=null),e[3]=n;const m=e[17];null!==m&&n!==m&&function(t,e){const n=t[9];e[16]!==e[3][3][16]&&(t[2]=!0),null===n?t[9]=[e]:n.push(e)}(m,e);const v=e[19];null!==v&&v.insertView(t),e[2]|=128}(s,r,m,u);const v=Nd(u,m),E=r[11],S=Sh(E,m[7]);return null!==S&&function(t,e,n,r,s,u){r[0]=s,r[6]=e,_l(t,r,n,1,s,u)}(s,m[6],E,r,S,v),e.attachToViewContainerRef(),_d(w0(m),u,e),e}move(e,n){return this.insert(e,n)}indexOf(e){const n=UE(this._lContainer);return null!==n?n.indexOf(e):-1}remove(e){const n=this._adjustIndex(e,-1),r=Ld(this._lContainer,n);r&&(ic(w0(this._lContainer),n),xp(r[1],r))}detach(e){const n=this._adjustIndex(e,-1),r=Ld(this._lContainer,n);return r&&null!=ic(w0(this._lContainer),n)?new sm(r):null}_adjustIndex(e,n=0){return null==e?this.length+n:e}};function UE(t){return t[8]}function w0(t){return t[8]||(t[8]=[])}function jE(t,e){let n;const r=e[t.index];if(Eo(r))n=r;else{let s;if(8&t.type)s=mr(r);else{const u=e[11];s=u.createComment("");const m=ir(t,e);co(u,Sh(u,m),s,function(t,e){return Zn(t)?t.nextSibling(e):e.nextSibling}(u,m),!1)}e[t.index]=n=function(t,e,n,r){return new Array(t,!0,!1,e,null,0,r,n,null,null)}(r,e,s,t),Lt(e,n)}return new BE(n,t,e)}const xf={};class lC extends Vh{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const n=Gr(e);return new uC(n,this.ngModule)}}function cC(t){const e=[];for(let n in t)t.hasOwnProperty(n)&&e.push({propName:t[n],templateName:n});return e}const sk=new un("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>Un});class uC extends AE{constructor(e,n){super(),this.componentDef=e,this.ngModule=n,this.componentType=e.type,this.selector=function(t){return t.map(Ud).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!n}get inputs(){return cC(this.componentDef.inputs)}get outputs(){return cC(this.componentDef.outputs)}create(e,n,r,s){const u=(s=s||this.ngModule)?function(t,e){return{get:(n,r,s)=>{const u=t.get(n,xf,s);return u!==xf||r===xf?u:e.get(n,r,s)}}}(e,s.injector):e,m=u.get(y_,Yu),v=u.get(x0,null),E=m.createRenderer(null,this.componentDef),S=this.componentDef.selectors[0][0]||"div",P=r?function(t,e,n){if(Zn(t))return t.selectRootElement(e,n===yr.ShadowDom);let r="string"==typeof e?t.querySelector(e):e;return r.textContent="",r}(E,r,this.componentDef.encapsulation):dc(m.createRenderer(null,this.componentDef),S,function(t){const e=t.toLowerCase();return"svg"===e?"http://www.w3.org/2000/svg":"math"===e?"http://www.w3.org/1998/MathML/":null}(S)),V=this.componentDef.onPush?576:528,j=function(t,e){return{components:[],scheduler:t||Un,clean:wr,playerHandler:e||null,flags:0}}(),G=Yd(0,null,null,1,0,null,null,null,null,null),se=_c(null,G,j,V,null,null,m,E,v,u);let Re,be;Ql(se);try{const qe=function(t,e,n,r,s,u){const m=n[1];n[20]=t;const E=yl(m,20,2,"#host",null),S=E.mergedAttrs=e.hostAttrs;null!==S&&(cr(E,S,!0),null!==t&&(K(s,t,S),null!==E.classes&&Ap(s,t,E.classes),null!==E.styles&&Bg(s,t,E.styles)));const P=r.createRenderer(t,e),V=_c(n,Hp(e),null,e.onPush?64:16,n[20],E,r,P,u||null,null);return m.firstCreatePass&&(zt(gt(E,n),m,e.type),Se(m,E),ke(E,n.length,1)),Lt(n,V),n[20]=V}(P,this.componentDef,se,m,E);if(P)if(r)K(E,P,["ng-version",kE.full]);else{const{attrs:Ue,classes:Tt}=function(t){const e=[],n=[];let r=1,s=2;for(;r<t.length;){let u=t[r];if("string"==typeof u)2===s?""!==u&&e.push(u,t[++r]):8===s&&n.push(u);else{if(!gi(s))break;s=u}r++}return{attrs:e,classes:n}}(this.componentDef.selectors[0]);Ue&&K(E,P,Ue),Tt&&Tt.length>0&&Ap(E,P,Tt.join(" "))}if(be=function(t,e){return t.data[e]}(G,20),void 0!==n){const Ue=be.projection=[];for(let Tt=0;Tt<this.ngContentSelectors.length;Tt++){const Nt=n[Tt];Ue.push(null!=Nt?Array.from(Nt):null)}}Re=function(t,e,n,r,s){const u=n[1],m=function(t,e,n){const r=zn();t.firstCreatePass&&(n.providersResolver&&n.providersResolver(n),He(t,r,e,vl(t,e,1,null),n));const s=Zr(e,t,r.directiveStart,r);Vi(s,e);const u=ir(r,e);return u&&Vi(u,e),s}(u,n,e);if(r.components.push(m),t[8]=m,s&&s.forEach(E=>E(m,e)),e.contentQueries){const E=zn();e.contentQueries(1,m,E.directiveStart)}const v=zn();return!u.firstCreatePass||null===e.hostBindings&&null===e.hostAttrs||(_s(v.index),N(n[1],v,0,v.directiveStart,v.directiveEnd,e),de(e,m)),m}(qe,this.componentDef,se,j,[oA]),yc(G,se,null)}finally{Jl()}return new ck(this.componentType,Re,mf(be,se),se,be)}}class ck extends class{}{constructor(e,n,r,s,u){super(),this.location=r,this._rootLView=s,this._tNode=u,this.instance=n,this.hostView=this.changeDetectorRef=new ZM(s),this.componentType=e}get injector(){return new qn(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}const bf=new Map;class dk extends Tl{constructor(e,n){super(),this._parent=n,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new lC(this);const r=ei(e),s=function(t){return t[Vl]||null}(e);s&&d0(s),this._bootstrapComponents=Ji(r.bootstrap),this._r3Injector=Es(e,n,[{provide:Tl,useValue:this},{provide:Vh,useValue:this.componentFactoryResolver}],Wt(e)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(e)}get(e,n=nr.THROW_IF_NOT_FOUND,r=Mt.Default){return e===nr||e===Tl||e===pn?this:this._r3Injector.get(e,n,r)}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(n=>n()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class O0 extends VE{constructor(e){super(),this.moduleType=e,null!==ei(e)&&function(t){const e=new Set;!function n(r){const s=ei(r,!0),u=s.id;null!==u&&(function(t,e,n){if(e&&e!==n)throw new Error(`Duplicate module registered for ${t} - ${Wt(e)} vs ${Wt(e.name)}`)}(u,bf.get(u),r),bf.set(u,r));const m=Ji(s.imports);for(const v of m)e.has(v)||(e.add(v),n(v))}(t)}(e)}create(e){return new dk(this.moduleType,e)}}function L0(t){return e=>{setTimeout(t,void 0,e)}}const xi=class extends Cr{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,n,r){var s,u,m;let v=e,E=n||(()=>null),S=r;if(e&&"object"==typeof e){const V=e;v=null===(s=V.next)||void 0===s?void 0:s.bind(V),E=null===(u=V.error)||void 0===u?void 0:u.bind(V),S=null===(m=V.complete)||void 0===m?void 0:m.bind(V)}this.__isAsync&&(E=L0(E),v&&(v=L0(v)),S&&(S=L0(S)));const P=super.subscribe({next:v,error:E,complete:S});return e instanceof it&&e.add(P),P}};function Rk(){return this._results[ef()]()}class T_{constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const n=ef(),r=T_.prototype;r[n]||(r[n]=Rk)}get changes(){return this._changes||(this._changes=new xi)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,n){return this._results.reduce(e,n)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,n){const r=this;r.dirty=!1;const s=Ao(e);(this._changesDetected=!function(t,e,n){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++){let s=t[r],u=e[r];if(n&&(s=n(s),u=n(u)),u!==s)return!1}return!0}(r._results,s,n))&&(r._results=s,r.length=s.length,r.last=s[this.length-1],r.first=s[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;class N0{constructor(e){this.queryList=e,this.matches=null}clone(){return new N0(this.queryList)}setDirty(){this.queryList.setDirty()}}class z0{constructor(e=[]){this.queries=e}createEmbeddedView(e){const n=e.queries;if(null!==n){const r=null!==e.contentQueries?e.contentQueries[0]:n.length,s=[];for(let u=0;u<r;u++){const m=n.getByIndex(u);s.push(this.queries[m.indexInDeclarationView].clone())}return new z0(s)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let n=0;n<this.queries.length;n++)null!==EC(e,n).matches&&this.queries[n].setDirty()}}class yC{constructor(e,n,r=null){this.predicate=e,this.flags=n,this.read=r}}class V0{constructor(e=[]){this.queries=e}elementStart(e,n){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(e,n)}elementEnd(e){for(let n=0;n<this.queries.length;n++)this.queries[n].elementEnd(e)}embeddedTView(e){let n=null;for(let r=0;r<this.length;r++){const s=null!==n?n.length:0,u=this.getByIndex(r).embeddedTView(e,s);u&&(u.indexInDeclarationView=r,null!==n?n.push(u):n=[u])}return null!==n?new V0(n):null}template(e,n){for(let r=0;r<this.queries.length;r++)this.queries[r].template(e,n)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class B0{constructor(e,n=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=n}elementStart(e,n){this.isApplyingToNode(n)&&this.matchTNode(e,n)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,n){this.elementStart(e,n)}embeddedTView(e,n){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,n),new B0(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const n=this._declarationNodeIndex;let r=e.parent;for(;null!==r&&8&r.type&&r.index!==n;)r=r.parent;return n===(null!==r?r.index:-1)}return this._appliesToNextNode}matchTNode(e,n){const r=this.metadata.predicate;if(Array.isArray(r))for(let s=0;s<r.length;s++){const u=r[s];this.matchTNodeWithReadOption(e,n,Fk(n,u)),this.matchTNodeWithReadOption(e,n,zr(n,e,u,!1,!1))}else r===Ec?4&n.type&&this.matchTNodeWithReadOption(e,n,-1):this.matchTNodeWithReadOption(e,n,zr(n,e,r,!1,!1))}matchTNodeWithReadOption(e,n,r){if(null!==r){const s=this.metadata.read;if(null!==s)if(s===$i||s===Fa||s===Ec&&4&n.type)this.addMatch(n.index,-2);else{const u=zr(n,e,s,!1,!1);null!==u&&this.addMatch(n.index,u)}else this.addMatch(n.index,r)}}addMatch(e,n){null===this.matches?this.matches=[e,n]:this.matches.push(e,n)}}function Fk(t,e){const n=t.localNames;if(null!==n)for(let r=0;r<n.length;r+=2)if(n[r]===e)return n[r+1];return null}function Lk(t,e,n,r){return-1===n?function(t,e){return 11&t.type?mf(t,e):4&t.type?x_(t,e):null}(e,t):-2===n?function(t,e,n){return n===$i?mf(e,t):n===Ec?x_(e,t):n===Fa?jE(e,t):void 0}(t,e,r):Zr(t,t[1],n,e)}function vC(t,e,n,r){const s=e[19].queries[r];if(null===s.matches){const u=t.data,m=n.matches,v=[];for(let E=0;E<m.length;E+=2){const S=m[E];v.push(S<0?null:Lk(e,u[S],m[E+1],n.metadata.read))}s.matches=v}return s.matches}function U0(t,e,n,r){const s=t.queries.getByIndex(n),u=s.matches;if(null!==u){const m=vC(t,e,s,n);for(let v=0;v<u.length;v+=2){const E=u[v];if(E>0)r.push(m[v/2]);else{const S=u[v+1],P=e[-E];for(let V=10;V<P.length;V++){const j=P[V];j[17]===j[3]&&U0(j[1],j,S,r)}if(null!==P[9]){const V=P[9];for(let j=0;j<V.length;j++){const G=V[j];U0(G[1],G,S,r)}}}}}return r}function D_(t){const e=tt(),n=xn(),r=nu();Kl(r+1);const s=EC(n,r);if(t.dirty&&Ju(e)===(2==(2&s.metadata.flags))){if(null===s.matches)t.reset([]);else{const u=s.crossesNgTemplate?U0(n,e,r,[]):vC(n,e,s,r);t.reset(u,RE),t.notifyOnChanges()}return!0}return!1}function xC(t,e,n){const r=xn();r.firstCreatePass&&(function(t,e,n){null===t.queries&&(t.queries=new V0),t.queries.track(new B0(e,n))}(r,new yC(t,e,n),-1),2==(2&e)&&(r.staticViewQueries=!0)),function(t,e,n){const r=new T_(4==(4&n));qp(t,e,r,r.destroy),null===e[19]&&(e[19]=new z0),e[19].queries.push(new N0(r))}(r,tt(),e)}function EC(t,e){return t.queries.getByIndex(e)}const ym=new un("Application Initializer");let Ef=(()=>{class t{constructor(n){this.appInits=n,this.resolve=__,this.reject=__,this.initialized=!1,this.done=!1,this.donePromise=new Promise((r,s)=>{this.resolve=r,this.reject=s})}runInitializers(){if(this.initialized)return;const n=[],r=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let s=0;s<this.appInits.length;s++){const u=this.appInits[s]();if(Qp(u))n.push(u);else if(l_(u)){const m=new Promise((v,E)=>{u.subscribe({complete:v,error:E})});n.push(m)}}Promise.all(n).then(()=>{r()}).catch(s=>{this.reject(s)}),0===n.length&&r(),this.initialized=!0}}return t.\u0275fac=function(n){return new(n||t)(_t(ym,8))},t.\u0275prov=kt({token:t,factory:t.\u0275fac}),t})();const vm=new un("AppId"),fP={provide:vm,useFactory:function(){return`${W0()}${W0()}${W0()}`},deps:[]};function W0(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const UC=new un("Platform Initializer"),M_=new un("Platform ID"),jC=new un("appBootstrapListener");let R_=(()=>{class t{log(n){console.log(n)}warn(n){console.warn(n)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=kt({token:t,factory:t.\u0275fac}),t})();const Su=new un("LocaleId"),$C=new un("DefaultCurrencyCode");class mP{constructor(e,n){this.ngModuleFactory=e,this.componentFactories=n}}const X0=function(t){return new O0(t)},gP=X0,_P=function(t){return Promise.resolve(X0(t))},HC=function(t){const e=X0(t),r=Ji(ei(t).declarations).reduce((s,u)=>{const m=Gr(u);return m&&s.push(new uC(m)),s},[]);return new mP(e,r)},yP=HC,vP=function(t){return Promise.resolve(HC(t))};let jh=(()=>{class t{constructor(){this.compileModuleSync=gP,this.compileModuleAsync=_P,this.compileModuleAndAllComponentsSync=yP,this.compileModuleAndAllComponentsAsync=vP}clearCache(){}clearCacheFor(n){}getModuleId(n){}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=kt({token:t,factory:t.\u0275fac}),t})();const wP=(()=>Promise.resolve(0))();function K0(t){"undefined"==typeof Zone?wP.then(()=>{t&&t.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",t)}class bi{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new xi(!1),this.onMicrotaskEmpty=new xi(!1),this.onStable=new xi(!1),this.onError=new xi(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const s=this;s._nesting=0,s._outer=s._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(s._inner=s._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(s._inner=s._inner.fork(Zone.longStackTraceZoneSpec)),s.shouldCoalesceEventChangeDetection=!r&&n,s.shouldCoalesceRunChangeDetection=r,s.lastRequestAnimationFrameId=-1,s.nativeRequestAnimationFrame=function(){let t=on.requestAnimationFrame,e=on.cancelAnimationFrame;if("undefined"!=typeof Zone&&t&&e){const n=t[Zone.__symbol__("OriginalDelegate")];n&&(t=n);const r=e[Zone.__symbol__("OriginalDelegate")];r&&(e=r)}return{nativeRequestAnimationFrame:t,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function(t){const e=()=>{!function(t){t.isCheckStableRunning||-1!==t.lastRequestAnimationFrameId||(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call(on,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,Q0(t),t.isCheckStableRunning=!0,Y0(t),t.isCheckStableRunning=!1},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),Q0(t))}(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,r,s,u,m,v)=>{try{return GC(t),n.invokeTask(s,u,m,v)}finally{(t.shouldCoalesceEventChangeDetection&&"eventTask"===u.type||t.shouldCoalesceRunChangeDetection)&&e(),qC(t)}},onInvoke:(n,r,s,u,m,v,E)=>{try{return GC(t),n.invoke(s,u,m,v,E)}finally{t.shouldCoalesceRunChangeDetection&&e(),qC(t)}},onHasTask:(n,r,s,u)=>{n.hasTask(s,u),r===s&&("microTask"==u.change?(t._hasPendingMicrotasks=u.microTask,Q0(t),Y0(t)):"macroTask"==u.change&&(t.hasPendingMacrotasks=u.macroTask))},onHandleError:(n,r,s,u)=>(n.handleError(s,u),t.runOutsideAngular(()=>t.onError.emit(u)),!1)})}(s)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!bi.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(bi.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(e,n,r){return this._inner.run(e,n,r)}runTask(e,n,r,s){const u=this._inner,m=u.scheduleEventTask("NgZoneEvent: "+s,e,CP,__,__);try{return u.runTask(m,n,r)}finally{u.cancelTask(m)}}runGuarded(e,n,r){return this._inner.runGuarded(e,n,r)}runOutsideAngular(e){return this._outer.run(e)}}const CP={};function Y0(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function Q0(t){t.hasPendingMicrotasks=!!(t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&-1!==t.lastRequestAnimationFrameId)}function GC(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function qC(t){t._nesting--,Y0(t)}class SP{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new xi,this.onMicrotaskEmpty=new xi,this.onStable=new xi,this.onError=new xi}run(e,n,r){return e.apply(n,r)}runGuarded(e,n,r){return e.apply(n,r)}runOutsideAngular(e){return e()}runTask(e,n,r,s){return e.apply(n,r)}}let J0=(()=>{class t{constructor(n){this._ngZone=n,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),n.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{bi.assertNotInAngularZone(),K0(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())K0(()=>{for(;0!==this._callbacks.length;){let n=this._callbacks.pop();clearTimeout(n.timeoutId),n.doneCb(this._didWork)}this._didWork=!1});else{let n=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(n)||(clearTimeout(r.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(n=>({source:n.source,creationLocation:n.creationLocation,data:n.data})):[]}addCallback(n,r,s){let u=-1;r&&r>0&&(u=setTimeout(()=>{this._callbacks=this._callbacks.filter(m=>m.timeoutId!==u),n(this._didWork,this.getPendingTasks())},r)),this._callbacks.push({doneCb:n,timeoutId:u,updateCb:s})}whenStable(n,r,s){if(s&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(n,r,s),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(n,r,s){return[]}}return t.\u0275fac=function(n){return new(n||t)(_t(bi))},t.\u0275prov=kt({token:t,factory:t.\u0275fac}),t})(),ZC=(()=>{class t{constructor(){this._applications=new Map,e1.addToWindow(this)}registerApplication(n,r){this._applications.set(n,r)}unregisterApplication(n){this._applications.delete(n)}unregisterAllApplications(){this._applications.clear()}getTestability(n){return this._applications.get(n)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(n,r=!0){return e1.findTestabilityInTree(this,n,r)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=kt({token:t,factory:t.\u0275fac}),t})();class AP{addToWindow(e){}findTestabilityInTree(e,n,r){return null}}let e1=new AP,WC=!0,XC=!1;let Na;const YC=new un("AllowMultipleToken");class t1{constructor(e,n){this.name=e,this.token=n}}function QC(t,e,n=[]){const r=`Platform: ${e}`,s=new un(r);return(u=[])=>{let m=JC();if(!m||m.injector.get(YC,!1))if(t)t(n.concat(u).concat({provide:s,useValue:!0}));else{const v=n.concat(u).concat({provide:s,useValue:!0},{provide:yi,useValue:"platform"});!function(t){if(Na&&!Na.destroyed&&!Na.injector.get(YC,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");Na=t.get(e2);const e=t.get(UC,null);e&&e.forEach(n=>n())}(nr.create({providers:v,name:r}))}return function(t){const e=JC();if(!e)throw new Error("No platform exists!");if(!e.injector.get(t,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return e}(s)}}function JC(){return Na&&!Na.destroyed?Na:null}let e2=(()=>{class t{constructor(n){this._injector=n,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(n,r){const v=function(t,e){let n;return n="noop"===t?new SP:("zone.js"===t?void 0:t)||new bi({enableLongStackTrace:(XC=!0,WC),shouldCoalesceEventChangeDetection:!!(null==e?void 0:e.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==e?void 0:e.ngZoneRunCoalescing)}),n}(r?r.ngZone:void 0,{ngZoneEventCoalescing:r&&r.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:r&&r.ngZoneRunCoalescing||!1}),E=[{provide:bi,useValue:v}];return v.run(()=>{const S=nr.create({providers:E,parent:this.injector,name:n.moduleType.name}),P=n.create(S),V=P.injector.get(xr,null);if(!V)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return v.runOutsideAngular(()=>{const j=v.onError.subscribe({next:G=>{V.handleError(G)}});P.onDestroy(()=>{n1(this._modules,P),j.unsubscribe()})}),function(t,e,n){try{const r=n();return Qp(r)?r.catch(s=>{throw e.runOutsideAngular(()=>t.handleError(s)),s}):r}catch(r){throw e.runOutsideAngular(()=>t.handleError(r)),r}}(V,v,()=>{const j=P.injector.get(Ef);return j.runInitializers(),j.donePromise.then(()=>(d0(P.injector.get(Su,d_)||d_),this._moduleDoBootstrap(P),P))})})}bootstrapModule(n,r=[]){const s=t2({},r);return function(t,e,n){const r=new O0(n);return Promise.resolve(r)}(0,0,n).then(u=>this.bootstrapModuleFactory(u,s))}_moduleDoBootstrap(n){const r=n.injector.get(Cf);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(s=>r.bootstrap(s));else{if(!n.instance.ngDoBootstrap)throw new Error(`The module ${Wt(n.instance.constructor)} was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.`);n.instance.ngDoBootstrap(r)}this._modules.push(n)}onDestroy(n){this._destroyListeners.push(n)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(n=>n.destroy()),this._destroyListeners.forEach(n=>n()),this._destroyed=!0}get destroyed(){return this._destroyed}}return t.\u0275fac=function(n){return new(n||t)(_t(nr))},t.\u0275prov=kt({token:t,factory:t.\u0275fac}),t})();function t2(t,e){return Array.isArray(e)?e.reduce(t2,t):Object.assign(Object.assign({},t),e)}let Cf=(()=>{class t{constructor(n,r,s,u,m){this._zone=n,this._injector=r,this._exceptionHandler=s,this._componentFactoryResolver=u,this._initStatus=m,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const v=new Dt(S=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{S.next(this._stable),S.complete()})}),E=new Dt(S=>{let P;this._zone.runOutsideAngular(()=>{P=this._zone.onStable.subscribe(()=>{bi.assertNotInAngularZone(),K0(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,S.next(!0))})})});const V=this._zone.onUnstable.subscribe(()=>{bi.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{S.next(!1)}))});return()=>{P.unsubscribe(),V.unsubscribe()}});this.isStable=function(...t){let e=Number.POSITIVE_INFINITY,n=null,r=t[t.length-1];return Pr(r)?(n=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(e=t.pop())):"number"==typeof r&&(e=t.pop()),null===n&&1===t.length&&t[0]instanceof Dt?t[0]:cs(e)(oa(t,n))}(v,E.pipe(Ms()))}bootstrap(n,r){if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");let s;s=n instanceof AE?n:this._componentFactoryResolver.resolveComponentFactory(n),this.componentTypes.push(s.componentType);const u=function(t){return t.isBoundToModule}(s)?void 0:this._injector.get(Tl),v=s.create(nr.NULL,[],r||s.selector,u),E=v.location.nativeElement,S=v.injector.get(J0,null),P=S&&v.injector.get(ZC);return S&&P&&P.registerApplication(E,S),v.onDestroy(()=>{this.detachView(v.hostView),n1(this.components,v),P&&P.unregisterApplication(E)}),this._loadComponent(v),v}tick(){if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");try{this._runningTick=!0;for(let n of this._views)n.detectChanges()}catch(n){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(n))}finally{this._runningTick=!1}}attachView(n){const r=n;this._views.push(r),r.attachToAppRef(this)}detachView(n){const r=n;n1(this._views,r),r.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n),this._injector.get(jC,[]).concat(this._bootstrapListeners).forEach(s=>s(n))}ngOnDestroy(){this._views.slice().forEach(n=>n.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return t.\u0275fac=function(n){return new(n||t)(_t(bi),_t(nr),_t(xr),_t(Vh),_t(Ef))},t.\u0275prov=kt({token:t,factory:t.\u0275fac}),t})();function n1(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}class P_{}class $P{}const HP={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"};let GP=(()=>{class t{constructor(n,r){this._compiler=n,this._config=r||HP}load(n){return this.loadAndCompile(n)}loadAndCompile(n){let[r,s]=n.split("#");return void 0===s&&(s="default"),fe(255)(r).then(u=>u[s]).then(u=>o2(u,r,s)).then(u=>this._compiler.compileModuleAsync(u))}loadFactory(n){let[r,s]=n.split("#"),u="NgFactory";return void 0===s&&(s="default",u=""),fe(255)(this._config.factoryPathPrefix+r+this._config.factoryPathSuffix).then(m=>m[s+u]).then(m=>o2(m,r,s))}}return t.\u0275fac=function(n){return new(n||t)(_t(jh),_t($P,8))},t.\u0275prov=kt({token:t,factory:t.\u0275fac}),t})();function o2(t,e,n){if(!t)throw new Error(`Cannot find '${n}' in '${e}'`);return t}const t8=QC(null,"core",[{provide:M_,useValue:"unknown"},{provide:e2,deps:[nr]},{provide:ZC,deps:[]},{provide:R_,deps:[]}]),s8=[{provide:Cf,useClass:Cf,deps:[bi,nr,xr,Vh,Ef]},{provide:sk,deps:[bi],useFactory:function(t){let e=[];return t.onStable.subscribe(()=>{for(;e.length;)e.pop()()}),function(n){e.push(n)}}},{provide:Ef,useClass:Ef,deps:[[new sr,ym]]},{provide:jh,useClass:jh,deps:[]},fP,{provide:om,useFactory:function(){return eR},deps:[]},{provide:gf,useFactory:function(){return tR},deps:[]},{provide:Su,useFactory:function(t){return d0(t=t||"undefined"!=typeof $localize&&$localize.locale||d_),t},deps:[[new du(Su),new sr,new Gs]]},{provide:$C,useValue:"USD"}];let l8=(()=>{class t{constructor(n){}}return t.\u0275fac=function(n){return new(n||t)(_t(Cf))},t.\u0275mod=dr({type:t}),t.\u0275inj=Qr({providers:s8}),t})(),$_=null;function Dl(){return $_}const qi=new un("DocumentToken");let Gh=(()=>{class t{historyGo(n){throw new Error("Not implemented")}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=kt({factory:a4,token:t,providedIn:"platform"}),t})();function a4(){return _t(I2)}const l4=new un("Location Initialized");let I2=(()=>{class t extends Gh{constructor(n){super(),this._doc=n,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Dl().getBaseHref(this._doc)}onPopState(n){const r=Dl().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",n,!1),()=>r.removeEventListener("popstate",n)}onHashChange(n){const r=Dl().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",n,!1),()=>r.removeEventListener("hashchange",n)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(n){this.location.pathname=n}pushState(n,r,s){M2()?this._history.pushState(n,r,s):this.location.hash=s}replaceState(n,r,s){M2()?this._history.replaceState(n,r,s):this.location.hash=s}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}}return t.\u0275fac=function(n){return new(n||t)(_t(qi))},t.\u0275prov=kt({factory:c4,token:t,providedIn:"platform"}),t})();function M2(){return!!window.history.pushState}function c4(){return new I2(_t(qi))}function _1(t,e){if(0==t.length)return e;if(0==e.length)return t;let n=0;return t.endsWith("/")&&n++,e.startsWith("/")&&n++,2==n?t+e.substring(1):1==n?t+e:t+"/"+e}function R2(t){const e=t.match(/#|\?|$/),n=e&&e.index||t.length;return t.slice(0,n-("/"===t[n-1]?1:0))+t.slice(n)}function Tc(t){return t&&"?"!==t[0]?"?"+t:t}let Sf=(()=>{class t{historyGo(n){throw new Error("Not implemented")}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=kt({factory:u4,token:t,providedIn:"root"}),t})();function u4(t){const e=_t(qi).location;return new k2(_t(Gh),e&&e.origin||"")}const y1=new un("appBaseHref");let k2=(()=>{class t extends Sf{constructor(n,r){if(super(),this._platformLocation=n,this._removeListenerFns=[],null==r&&(r=this._platformLocation.getBaseHrefFromDOM()),null==r)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=r}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return _1(this._baseHref,n)}path(n=!1){const r=this._platformLocation.pathname+Tc(this._platformLocation.search),s=this._platformLocation.hash;return s&&n?`${r}${s}`:r}pushState(n,r,s,u){const m=this.prepareExternalUrl(s+Tc(u));this._platformLocation.pushState(n,r,m)}replaceState(n,r,s,u){const m=this.prepareExternalUrl(s+Tc(u));this._platformLocation.replaceState(n,r,m)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(n=0){var r,s;null===(s=(r=this._platformLocation).historyGo)||void 0===s||s.call(r,n)}}return t.\u0275fac=function(n){return new(n||t)(_t(Gh),_t(y1,8))},t.\u0275prov=kt({token:t,factory:t.\u0275fac}),t})(),h4=(()=>{class t extends Sf{constructor(n,r){super(),this._platformLocation=n,this._baseHref="",this._removeListenerFns=[],null!=r&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}path(n=!1){let r=this._platformLocation.hash;return null==r&&(r="#"),r.length>0?r.substring(1):r}prepareExternalUrl(n){const r=_1(this._baseHref,n);return r.length>0?"#"+r:r}pushState(n,r,s,u){let m=this.prepareExternalUrl(s+Tc(u));0==m.length&&(m=this._platformLocation.pathname),this._platformLocation.pushState(n,r,m)}replaceState(n,r,s,u){let m=this.prepareExternalUrl(s+Tc(u));0==m.length&&(m=this._platformLocation.pathname),this._platformLocation.replaceState(n,r,m)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(n=0){var r,s;null===(s=(r=this._platformLocation).historyGo)||void 0===s||s.call(r,n)}}return t.\u0275fac=function(n){return new(n||t)(_t(Gh),_t(y1,8))},t.\u0275prov=kt({token:t,factory:t.\u0275fac}),t})(),H_=(()=>{class t{constructor(n,r){this._subject=new xi,this._urlChangeListeners=[],this._platformStrategy=n;const s=this._platformStrategy.getBaseHref();this._platformLocation=r,this._baseHref=R2(P2(s)),this._platformStrategy.onPopState(u=>{this._subject.emit({url:this.path(!0),pop:!0,state:u.state,type:u.type})})}path(n=!1){return this.normalize(this._platformStrategy.path(n))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(n,r=""){return this.path()==this.normalize(n+Tc(r))}normalize(n){return t.stripTrailingSlash(function(t,e){return t&&e.startsWith(t)?e.substring(t.length):e}(this._baseHref,P2(n)))}prepareExternalUrl(n){return n&&"/"!==n[0]&&(n="/"+n),this._platformStrategy.prepareExternalUrl(n)}go(n,r="",s=null){this._platformStrategy.pushState(s,"",n,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Tc(r)),s)}replaceState(n,r="",s=null){this._platformStrategy.replaceState(s,"",n,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Tc(r)),s)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(n=0){var r,s;null===(s=(r=this._platformStrategy).historyGo)||void 0===s||s.call(r,n)}onUrlChange(n){this._urlChangeListeners.push(n),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)}))}_notifyUrlChangeListeners(n="",r){this._urlChangeListeners.forEach(s=>s(n,r))}subscribe(n,r,s){return this._subject.subscribe({next:n,error:r,complete:s})}}return t.\u0275fac=function(n){return new(n||t)(_t(Sf),_t(Gh))},t.normalizeQueryParams=Tc,t.joinWithSlash=_1,t.stripTrailingSlash=R2,t.\u0275prov=kt({factory:d4,token:t,providedIn:"root"}),t})();function d4(){return new H_(_t(Sf),_t(Gh))}function P2(t){return t.replace(/\/index.html$/,"")}var wi=(()=>((wi=wi||{})[wi.Zero=0]="Zero",wi[wi.One=1]="One",wi[wi.Two=2]="Two",wi[wi.Few=3]="Few",wi[wi.Many=4]="Many",wi[wi.Other=5]="Other",wi))();const x4=function(t){return function(t){const e=function(t){return t.toLowerCase().replace(/_/g,"-")}(t);let n=nE(e);if(n)return n;const r=e.split("-")[0];if(n=nE(r),n)return n;if("en"===r)return kI;throw new Error(`Missing locale data for the locale "${t}".`)}(t)[St.PluralCase]};class ey{}let X4=(()=>{class t extends ey{constructor(n){super(),this.locale=n}getPluralCategory(n,r){switch(x4(r||this.locale)(n)){case wi.Zero:return"zero";case wi.One:return"one";case wi.Two:return"two";case wi.Few:return"few";case wi.Many:return"many";default:return"other"}}}return t.\u0275fac=function(n){return new(n||t)(_t(Su))},t.\u0275prov=kt({token:t,factory:t.\u0275fac}),t})();function j2(t,e){e=encodeURIComponent(e);for(const n of t.split(";")){const r=n.indexOf("="),[s,u]=-1==r?[n,""]:[n.slice(0,r),n.slice(r+1)];if(s.trim()===e)return decodeURIComponent(u)}return null}let A3=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=dr({type:t}),t.\u0275inj=Qr({providers:[{provide:ey,useClass:X4}]}),t})();let W2=(()=>{class t{}return t.\u0275prov=kt({token:t,providedIn:"root",factory:()=>new k3(_t(qi),window)}),t})();class k3{constructor(e,n){this.document=e,this.window=n,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){if(!this.supportsScrolling())return;const n=function(t,e){const n=t.getElementById(e)||t.getElementsByName(e)[0];if(n)return n;if("function"==typeof t.createTreeWalker&&t.body&&(t.body.createShadowRoot||t.body.attachShadow)){const r=t.createTreeWalker(t.body,NodeFilter.SHOW_ELEMENT);let s=r.currentNode;for(;s;){const u=s.shadowRoot;if(u){const m=u.getElementById(e)||u.querySelector(`[name="${e}"]`);if(m)return m}s=r.nextNode()}}return null}(this.document,e);n&&(this.scrollToElement(n),this.attemptFocus(n))}setHistoryScrollRestoration(e){if(this.supportScrollRestoration()){const n=this.window.history;n&&n.scrollRestoration&&(n.scrollRestoration=e)}}scrollToElement(e){const n=e.getBoundingClientRect(),r=n.left+this.window.pageXOffset,s=n.top+this.window.pageYOffset,u=this.offset();this.window.scrollTo(r-u[0],s-u[1])}attemptFocus(e){return e.focus(),this.document.activeElement===e}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const e=X2(this.window.history)||X2(Object.getPrototypeOf(this.window.history));return!(!e||!e.writable&&!e.set)}catch(e){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(e){return!1}}}function X2(t){return Object.getOwnPropertyDescriptor(t,"scrollRestoration")}class K2{}class R1 extends class extends class{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function(t){$_||($_=t)}(new R1)}onAndCancel(e,n,r){return e.addEventListener(n,r,!1),()=>{e.removeEventListener(n,r,!1)}}dispatchEvent(e,n){e.dispatchEvent(n)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,n){return(n=n||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,n){return"window"===n?window:"document"===n?e:"body"===n?e.body:null}getBaseHref(e){const n=(Dm=Dm||document.querySelector("base"),Dm?Dm.getAttribute("href"):null);return null==n?null:function(t){ty=ty||document.createElement("a"),ty.setAttribute("href",t);const e=ty.pathname;return"/"===e.charAt(0)?e:`/${e}`}(n)}resetBaseElement(){Dm=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return j2(document.cookie,e)}}let ty,Dm=null;const Y2=new un("TRANSITION_ID"),z3=[{provide:ym,useFactory:function(t,e,n){return()=>{n.get(Ef).donePromise.then(()=>{const r=Dl(),s=e.querySelectorAll(`style[ng-transition="${t}"]`);for(let u=0;u<s.length;u++)r.remove(s[u])})}},deps:[Y2,qi,nr],multi:!0}];class k1{static init(){!function(t){e1=t}(new k1)}addToWindow(e){on.getAngularTestability=(r,s=!0)=>{const u=e.findTestabilityInTree(r,s);if(null==u)throw new Error("Could not find testability for element.");return u},on.getAllAngularTestabilities=()=>e.getAllTestabilities(),on.getAllAngularRootElements=()=>e.getAllRootElements(),on.frameworkStabilizers||(on.frameworkStabilizers=[]),on.frameworkStabilizers.push(r=>{const s=on.getAllAngularTestabilities();let u=s.length,m=!1;const v=function(E){m=m||E,u--,0==u&&r(m)};s.forEach(function(E){E.whenStable(v)})})}findTestabilityInTree(e,n,r){if(null==n)return null;const s=e.getTestability(n);return null!=s?s:r?Dl().isShadowRoot(n)?this.findTestabilityInTree(e,n.host,!0):this.findTestabilityInTree(e,n.parentElement,!0):null}}let V3=(()=>{class t{build(){return new XMLHttpRequest}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=kt({token:t,factory:t.\u0275fac}),t})();const Sm=new un("EventManagerPlugins");let ry=(()=>{class t{constructor(n,r){this._zone=r,this._eventNameToPlugin=new Map,n.forEach(s=>s.manager=this),this._plugins=n.slice().reverse()}addEventListener(n,r,s){return this._findPluginFor(r).addEventListener(n,r,s)}addGlobalEventListener(n,r,s){return this._findPluginFor(r).addGlobalEventListener(n,r,s)}getZone(){return this._zone}_findPluginFor(n){const r=this._eventNameToPlugin.get(n);if(r)return r;const s=this._plugins;for(let u=0;u<s.length;u++){const m=s[u];if(m.supports(n))return this._eventNameToPlugin.set(n,m),m}throw new Error(`No event manager plugin found for event ${n}`)}}return t.\u0275fac=function(n){return new(n||t)(_t(Sm),_t(bi))},t.\u0275prov=kt({token:t,factory:t.\u0275fac}),t})();class P1{constructor(e){this._doc=e}addGlobalEventListener(e,n,r){const s=Dl().getGlobalEventTarget(this._doc,e);if(!s)throw new Error(`Unsupported event target ${s} for event ${n}`);return this.addEventListener(s,n,r)}}let J2=(()=>{class t{constructor(){this._stylesSet=new Set}addStyles(n){const r=new Set;n.forEach(s=>{this._stylesSet.has(s)||(this._stylesSet.add(s),r.add(s))}),this.onStylesAdded(r)}onStylesAdded(n){}getAllStyles(){return Array.from(this._stylesSet)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=kt({token:t,factory:t.\u0275fac}),t})(),Am=(()=>{class t extends J2{constructor(n){super(),this._doc=n,this._hostNodes=new Map,this._hostNodes.set(n.head,[])}_addStylesToHost(n,r,s){n.forEach(u=>{const m=this._doc.createElement("style");m.textContent=u,s.push(r.appendChild(m))})}addHost(n){const r=[];this._addStylesToHost(this._stylesSet,n,r),this._hostNodes.set(n,r)}removeHost(n){const r=this._hostNodes.get(n);r&&r.forEach(eT),this._hostNodes.delete(n)}onStylesAdded(n){this._hostNodes.forEach((r,s)=>{this._addStylesToHost(n,s,r)})}ngOnDestroy(){this._hostNodes.forEach(n=>n.forEach(eT))}}return t.\u0275fac=function(n){return new(n||t)(_t(qi))},t.\u0275prov=kt({token:t,factory:t.\u0275fac}),t})();function eT(t){Dl().remove(t)}const F1={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},O1=/%COMP%/g;function iy(t,e,n){for(let r=0;r<e.length;r++){let s=e[r];Array.isArray(s)?iy(t,s,n):(s=s.replace(O1,t),n.push(s))}return n}function rT(t){return e=>{if("__ngUnwrap__"===e)return t;!1===t(e)&&(e.preventDefault(),e.returnValue=!1)}}let L1=(()=>{class t{constructor(n,r,s){this.eventManager=n,this.sharedStylesHost=r,this.appId=s,this.rendererByCompId=new Map,this.defaultRenderer=new N1(n)}createRenderer(n,r){if(!n||!r)return this.defaultRenderer;switch(r.encapsulation){case yr.Emulated:{let s=this.rendererByCompId.get(r.id);return s||(s=new eF(this.eventManager,this.sharedStylesHost,r,this.appId),this.rendererByCompId.set(r.id,s)),s.applyToHost(n),s}case 1:case yr.ShadowDom:return new tF(this.eventManager,this.sharedStylesHost,n,r);default:if(!this.rendererByCompId.has(r.id)){const s=iy(r.id,r.styles,[]);this.sharedStylesHost.addStyles(s),this.rendererByCompId.set(r.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return t.\u0275fac=function(n){return new(n||t)(_t(ry),_t(Am),_t(vm))},t.\u0275prov=kt({token:t,factory:t.\u0275fac}),t})();class N1{constructor(e){this.eventManager=e,this.data=Object.create(null)}destroy(){}createElement(e,n){return n?document.createElementNS(F1[n]||n,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,n){e.appendChild(n)}insertBefore(e,n,r){e&&e.insertBefore(n,r)}removeChild(e,n){e&&e.removeChild(n)}selectRootElement(e,n){let r="string"==typeof e?document.querySelector(e):e;if(!r)throw new Error(`The selector "${e}" did not match any elements`);return n||(r.textContent=""),r}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,n,r,s){if(s){n=s+":"+n;const u=F1[s];u?e.setAttributeNS(u,n,r):e.setAttribute(n,r)}else e.setAttribute(n,r)}removeAttribute(e,n,r){if(r){const s=F1[r];s?e.removeAttributeNS(s,n):e.removeAttribute(`${r}:${n}`)}else e.removeAttribute(n)}addClass(e,n){e.classList.add(n)}removeClass(e,n){e.classList.remove(n)}setStyle(e,n,r,s){s&(Io.DashCase|Io.Important)?e.style.setProperty(n,r,s&Io.Important?"important":""):e.style[n]=r}removeStyle(e,n,r){r&Io.DashCase?e.style.removeProperty(n):e.style[n]=""}setProperty(e,n,r){e[n]=r}setValue(e,n){e.nodeValue=n}listen(e,n,r){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,n,rT(r)):this.eventManager.addEventListener(e,n,rT(r))}}class eF extends N1{constructor(e,n,r,s){super(e),this.component=r;const u=iy(s+"-"+r.id,r.styles,[]);n.addStyles(u),this.contentAttr=function(t){return"_ngcontent-%COMP%".replace(O1,t)}(s+"-"+r.id),this.hostAttr=function(t){return"_nghost-%COMP%".replace(O1,t)}(s+"-"+r.id)}applyToHost(e){super.setAttribute(e,this.hostAttr,"")}createElement(e,n){const r=super.createElement(e,n);return super.setAttribute(r,this.contentAttr,""),r}}class tF extends N1{constructor(e,n,r,s){super(e),this.sharedStylesHost=n,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const u=iy(s.id,s.styles,[]);for(let m=0;m<u.length;m++){const v=document.createElement("style");v.textContent=u[m],this.shadowRoot.appendChild(v)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(e,n){return super.appendChild(this.nodeOrShadowRoot(e),n)}insertBefore(e,n,r){return super.insertBefore(this.nodeOrShadowRoot(e),n,r)}removeChild(e,n){return super.removeChild(this.nodeOrShadowRoot(e),n)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}}let nF=(()=>{class t extends P1{constructor(n){super(n)}supports(n){return!0}addEventListener(n,r,s){return n.addEventListener(r,s,!1),()=>this.removeEventListener(n,r,s)}removeEventListener(n,r,s){return n.removeEventListener(r,s)}}return t.\u0275fac=function(n){return new(n||t)(_t(qi))},t.\u0275prov=kt({token:t,factory:t.\u0275fac}),t})();const sT=["alt","control","meta","shift"],cF={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},aT={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},uF={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey};let hF=(()=>{class t extends P1{constructor(n){super(n)}supports(n){return null!=t.parseEventName(n)}addEventListener(n,r,s){const u=t.parseEventName(r),m=t.eventCallback(u.fullKey,s,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Dl().onAndCancel(n,u.domEventName,m))}static parseEventName(n){const r=n.toLowerCase().split("."),s=r.shift();if(0===r.length||"keydown"!==s&&"keyup"!==s)return null;const u=t._normalizeKey(r.pop());let m="";if(sT.forEach(E=>{const S=r.indexOf(E);S>-1&&(r.splice(S,1),m+=E+".")}),m+=u,0!=r.length||0===u.length)return null;const v={};return v.domEventName=s,v.fullKey=m,v}static getEventFullKey(n){let r="",s=function(t){let e=t.key;if(null==e){if(e=t.keyIdentifier,null==e)return"Unidentified";e.startsWith("U+")&&(e=String.fromCharCode(parseInt(e.substring(2),16)),3===t.location&&aT.hasOwnProperty(e)&&(e=aT[e]))}return cF[e]||e}(n);return s=s.toLowerCase()," "===s?s="space":"."===s&&(s="dot"),sT.forEach(u=>{u!=s&&uF[u](n)&&(r+=u+".")}),r+=s,r}static eventCallback(n,r,s){return u=>{t.getEventFullKey(u)===n&&s.runGuarded(()=>r(u))}}static _normalizeKey(n){switch(n){case"esc":return"escape";default:return n}}}return t.\u0275fac=function(n){return new(n||t)(_t(qi))},t.\u0275prov=kt({token:t,factory:t.\u0275fac}),t})();const vF=QC(t8,"browser",[{provide:M_,useValue:"browser"},{provide:UC,useValue:function(){R1.makeCurrent(),k1.init()},multi:!0},{provide:qi,useFactory:function(){return function(t){$l=t}(document),document},deps:[]}]),xF=[[],{provide:yi,useValue:"root"},{provide:xr,useFactory:function(){return new xr},deps:[]},{provide:Sm,useClass:nF,multi:!0,deps:[qi,bi,M_]},{provide:Sm,useClass:hF,multi:!0,deps:[qi]},[],{provide:L1,useClass:L1,deps:[ry,Am,vm]},{provide:y_,useExisting:L1},{provide:J2,useExisting:Am},{provide:Am,useClass:Am,deps:[qi]},{provide:J0,useClass:J0,deps:[bi]},{provide:ry,useClass:ry,deps:[Sm,bi]},{provide:K2,useClass:V3,deps:[]},[]];let bF=(()=>{class t{constructor(n){if(n)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(n){return{ngModule:t,providers:[{provide:vm,useValue:n.appId},{provide:Y2,useExisting:vm},z3]}}}return t.\u0275fac=function(n){return new(n||t)(_t(t,12))},t.\u0275mod=dr({type:t}),t.\u0275inj=Qr({providers:xF,imports:[A3,l8]}),t})();function hn(...t){let e=t[t.length-1];return Pr(e)?(t.pop(),vn(t,e)):oa(t)}"undefined"!=typeof window&&window;class ja extends Cr{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const n=super._subscribe(e);return n&&!n.closed&&e.next(this._value),n}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new Fn;return this._value}next(e){super.next(this._value=e)}}class IF extends Le{notifyNext(e,n,r,s,u){this.destination.next(n)}notifyError(e,n){this.destination.error(e)}notifyComplete(e){this.destination.complete()}}class MF extends Le{constructor(e,n,r){super(),this.parent=e,this.outerValue=n,this.outerIndex=r,this.index=0}_next(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)}_error(e){this.parent.notifyError(e,this),this.unsubscribe()}_complete(){this.parent.notifyComplete(this),this.unsubscribe()}}function RF(t,e,n,r,s=new MF(t,n,r)){if(!s.closed)return e instanceof Dt?e.subscribe(s):Vo(e)(s)}const cT={};class PF{constructor(e){this.resultSelector=e}call(e,n){return n.subscribe(new FF(e,this.resultSelector))}}class FF extends IF{constructor(e,n){super(e),this.resultSelector=n,this.active=0,this.values=[],this.observables=[]}_next(e){this.values.push(cT),this.observables.push(e)}_complete(){const e=this.observables,n=e.length;if(0===n)this.destination.complete();else{this.active=n,this.toRespond=n;for(let r=0;r<n;r++)this.add(RF(this,e[r],void 0,r))}}notifyComplete(e){0==(this.active-=1)&&this.destination.complete()}notifyNext(e,n,r){const s=this.values,m=this.toRespond?s[r]===cT?--this.toRespond:this.toRespond:0;s[r]=n,0===m&&(this.resultSelector?this._tryResultSelector(s):this.destination.next(s.slice()))}_tryResultSelector(e){let n;try{n=this.resultSelector.apply(this,e)}catch(r){return void this.destination.error(r)}this.destination.next(n)}}const oy=(()=>{function t(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return t.prototype=Object.create(Error.prototype),t})();function j1(...t){return cs(1)(hn(...t))}const Af=new Dt(t=>t.complete());function $1(t){return t?function(t){return new Dt(e=>t.schedule(()=>e.complete()))}(t):Af}function uT(t){return new Dt(e=>{let n;try{n=t()}catch(s){return void e.error(s)}return(n?Ar(n):$1()).subscribe(e)})}function Mu(t,e){return"function"==typeof e?n=>n.pipe(Mu((r,s)=>Ar(t(r,s)).pipe(Pt((u,m)=>e(r,u,s,m))))):n=>n.lift(new NF(t))}class NF{constructor(e){this.project=e}call(e,n){return n.subscribe(new zF(e,this.project))}}class zF extends ls{constructor(e,n){super(e),this.project=n,this.index=0}_next(e){let n;const r=this.index++;try{n=this.project(e,r)}catch(s){return void this.destination.error(s)}this._innerSub(n)}_innerSub(e){const n=this.innerSubscription;n&&n.unsubscribe();const r=new Uo(this),s=this.destination;s.add(r),this.innerSubscription=$o(e,r),this.innerSubscription!==r&&s.add(this.innerSubscription)}_complete(){const{innerSubscription:e}=this;(!e||e.closed)&&super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=void 0}notifyComplete(){this.innerSubscription=void 0,this.isStopped&&super._complete()}notifyNext(e){this.destination.next(e)}}const hT=(()=>{function t(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return t.prototype=Object.create(Error.prototype),t})();function H1(t){return e=>0===t?$1():e.lift(new VF(t))}class VF{constructor(e){if(this.total=e,this.total<0)throw new hT}call(e,n){return n.subscribe(new BF(e,this.total))}}class BF extends Le{constructor(e,n){super(e),this.total=n,this.count=0}_next(e){const n=this.total,r=++this.count;r<=n&&(this.destination.next(e),r===n&&(this.destination.complete(),this.unsubscribe()))}}function dT(t,e){let n=!1;return arguments.length>=2&&(n=!0),function(s){return s.lift(new jF(t,e,n))}}class jF{constructor(e,n,r=!1){this.accumulator=e,this.seed=n,this.hasSeed=r}call(e,n){return n.subscribe(new $F(e,this.accumulator,this.seed,this.hasSeed))}}class $F extends Le{constructor(e,n,r,s){super(e),this.accumulator=n,this._seed=r,this.hasSeed=s,this.index=0}get seed(){return this._seed}set seed(e){this.hasSeed=!0,this._seed=e}_next(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)}_tryNext(e){const n=this.index++;let r;try{r=this.accumulator(this.seed,e,n)}catch(s){this.destination.error(s)}this.seed=r,this.destination.next(r)}}function qh(t,e){return function(r){return r.lift(new HF(t,e))}}class HF{constructor(e,n){this.predicate=e,this.thisArg=n}call(e,n){return n.subscribe(new GF(e,this.predicate,this.thisArg))}}class GF extends Le{constructor(e,n,r){super(e),this.predicate=n,this.thisArg=r,this.count=0}_next(e){let n;try{n=this.predicate.call(this.thisArg,e,this.count++)}catch(r){return void this.destination.error(r)}n&&this.destination.next(e)}}function Zh(t){return function(n){const r=new qF(t),s=n.lift(r);return r.caught=s}}class qF{constructor(e){this.selector=e}call(e,n){return n.subscribe(new ZF(e,this.selector,this.caught))}}class ZF extends ls{constructor(e,n,r){super(e),this.selector=n,this.caught=r}error(e){if(!this.isStopped){let n;try{n=this.selector(e,this.caught)}catch(u){return void super.error(u)}this._unsubscribeAndRecycle();const r=new Uo(this);this.add(r);const s=$o(n,r);s!==r&&this.add(s)}}}function If(t,e){return Tr(t,e,1)}function G1(t){return function(n){return 0===t?$1():n.lift(new WF(t))}}class WF{constructor(e){if(this.total=e,this.total<0)throw new hT}call(e,n){return n.subscribe(new XF(e,this.total))}}class XF extends Le{constructor(e,n){super(e),this.total=n,this.ring=new Array,this.count=0}_next(e){const n=this.ring,r=this.total,s=this.count++;n.length<r?n.push(e):n[s%r]=e}_complete(){const e=this.destination;let n=this.count;if(n>0){const r=this.count>=this.total?this.total:this.count,s=this.ring;for(let u=0;u<r;u++){const m=n++%r;e.next(s[m])}}e.complete()}}function fT(t=QF){return e=>e.lift(new KF(t))}class KF{constructor(e){this.errorFactory=e}call(e,n){return n.subscribe(new YF(e,this.errorFactory))}}class YF extends Le{constructor(e,n){super(e),this.errorFactory=n,this.hasValue=!1}_next(e){this.hasValue=!0,this.destination.next(e)}_complete(){if(this.hasValue)return this.destination.complete();{let e;try{e=this.errorFactory()}catch(n){e=n}this.destination.error(e)}}}function QF(){return new oy}function pT(t=null){return e=>e.lift(new JF(t))}class JF{constructor(e){this.defaultValue=e}call(e,n){return n.subscribe(new eO(e,this.defaultValue))}}class eO extends Le{constructor(e,n){super(e),this.defaultValue=n,this.isEmpty=!0}_next(e){this.isEmpty=!1,this.destination.next(e)}_complete(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}function Mf(t,e){const n=arguments.length>=2;return r=>r.pipe(t?qh((s,u)=>t(s,u,r)):ze,H1(1),n?pT(e):fT(()=>new oy))}function Ru(){}function Cs(t,e,n){return function(s){return s.lift(new nO(t,e,n))}}class nO{constructor(e,n,r){this.nextOrObserver=e,this.error=n,this.complete=r}call(e,n){return n.subscribe(new rO(e,this.nextOrObserver,this.error,this.complete))}}class rO extends Le{constructor(e,n,r,s){super(e),this._tapNext=Ru,this._tapError=Ru,this._tapComplete=Ru,this._tapError=r||Ru,this._tapComplete=s||Ru,pe(n)?(this._context=this,this._tapNext=n):n&&(this._context=n,this._tapNext=n.next||Ru,this._tapError=n.error||Ru,this._tapComplete=n.complete||Ru)}_next(e){try{this._tapNext.call(this._context,e)}catch(n){return void this.destination.error(n)}this.destination.next(e)}_error(e){try{this._tapError.call(this._context,e)}catch(n){return void this.destination.error(n)}this.destination.error(e)}_complete(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()}}class oO{constructor(e){this.callback=e}call(e,n){return n.subscribe(new sO(e,this.callback))}}class sO extends Le{constructor(e,n){super(e),this.add(new it(n))}}class Sc{constructor(e,n){this.id=e,this.url=n}}class q1 extends Sc{constructor(e,n,r="imperative",s=null){super(e,n),this.navigationTrigger=r,this.restoredState=s}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Im extends Sc{constructor(e,n,r){super(e,n),this.urlAfterRedirects=r}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class mT extends Sc{constructor(e,n,r){super(e,n),this.reason=r}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class aO extends Sc{constructor(e,n,r){super(e,n),this.error=r}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class lO extends Sc{constructor(e,n,r,s){super(e,n),this.urlAfterRedirects=r,this.state=s}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class cO extends Sc{constructor(e,n,r,s){super(e,n),this.urlAfterRedirects=r,this.state=s}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class uO extends Sc{constructor(e,n,r,s,u){super(e,n),this.urlAfterRedirects=r,this.state=s,this.shouldActivate=u}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class hO extends Sc{constructor(e,n,r,s){super(e,n),this.urlAfterRedirects=r,this.state=s}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class dO extends Sc{constructor(e,n,r,s){super(e,n),this.urlAfterRedirects=r,this.state=s}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class gT{constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class _T{constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class fO{constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class pO{constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class mO{constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class gO{constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class yT{constructor(e,n,r){this.routerEvent=e,this.position=n,this.anchor=r}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const Cn="primary";class _O{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const n=this.params[e];return Array.isArray(n)?n[0]:n}return null}getAll(e){if(this.has(e)){const n=this.params[e];return Array.isArray(n)?n:[n]}return[]}get keys(){return Object.keys(this.params)}}function Rf(t){return new _O(t)}const vT="ngNavigationCancelingError";function Z1(t){const e=Error("NavigationCancelingError: "+t);return e[vT]=!0,e}function vO(t,e,n){const r=n.path.split("/");if(r.length>t.length||"full"===n.pathMatch&&(e.hasChildren()||r.length<t.length))return null;const s={};for(let u=0;u<r.length;u++){const m=r[u],v=t[u];if(m.startsWith(":"))s[m.substring(1)]=v;else if(m!==v.path)return null}return{consumed:t.slice(0,r.length),posParams:s}}function Sl(t,e){const n=t?Object.keys(t):void 0,r=e?Object.keys(e):void 0;if(!n||!r||n.length!=r.length)return!1;let s;for(let u=0;u<n.length;u++)if(s=n[u],!xT(t[s],e[s]))return!1;return!0}function xT(t,e){if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;const n=[...t].sort(),r=[...e].sort();return n.every((s,u)=>r[u]===s)}return t===e}function bT(t){return Array.prototype.concat.apply([],t)}function wT(t){return t.length>0?t[t.length-1]:null}function no(t,e){for(const n in t)t.hasOwnProperty(n)&&e(t[n],n)}function Al(t){return l_(t)?t:Qp(t)?Ar(Promise.resolve(t)):hn(t)}const wO={exact:function TT(t,e,n){if(!Xh(t.segments,e.segments)||!sy(t.segments,e.segments,n)||t.numberOfChildren!==e.numberOfChildren)return!1;for(const r in e.children)if(!t.children[r]||!TT(t.children[r],e.children[r],n))return!1;return!0},subset:DT},ET={exact:function(t,e){return Sl(t,e)},subset:function(t,e){return Object.keys(e).length<=Object.keys(t).length&&Object.keys(e).every(n=>xT(t[n],e[n]))},ignored:()=>!0};function CT(t,e,n){return wO[n.paths](t.root,e.root,n.matrixParams)&&ET[n.queryParams](t.queryParams,e.queryParams)&&!("exact"===n.fragment&&t.fragment!==e.fragment)}function DT(t,e,n){return ST(t,e,e.segments,n)}function ST(t,e,n,r){if(t.segments.length>n.length){const s=t.segments.slice(0,n.length);return!(!Xh(s,n)||e.hasChildren()||!sy(s,n,r))}if(t.segments.length===n.length){if(!Xh(t.segments,n)||!sy(t.segments,n,r))return!1;for(const s in e.children)if(!t.children[s]||!DT(t.children[s],e.children[s],r))return!1;return!0}{const s=n.slice(0,t.segments.length),u=n.slice(t.segments.length);return!!(Xh(t.segments,s)&&sy(t.segments,s,r)&&t.children[Cn])&&ST(t.children[Cn],e,u,r)}}function sy(t,e,n){return e.every((r,s)=>ET[n](t[s].parameters,r.parameters))}class Wh{constructor(e,n,r){this.root=e,this.queryParams=n,this.fragment=r}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Rf(this.queryParams)),this._queryParamMap}toString(){return SO.serialize(this)}}class Pn{constructor(e,n){this.segments=e,this.children=n,this.parent=null,no(n,(r,s)=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return ay(this)}}class Mm{constructor(e,n){this.path=e,this.parameters=n}get parameterMap(){return this._parameterMap||(this._parameterMap=Rf(this.parameters)),this._parameterMap}toString(){return RT(this)}}function Xh(t,e){return t.length===e.length&&t.every((n,r)=>n.path===e[r].path)}class W1{}class AT{parse(e){const n=new LO(e);return new Wh(n.parseRootSegment(),n.parseQueryParams(),n.parseFragment())}serialize(e){return`${`/${Rm(e.root,!0)}`}${function(t){const e=Object.keys(t).map(n=>{const r=t[n];return Array.isArray(r)?r.map(s=>`${ly(n)}=${ly(s)}`).join("&"):`${ly(n)}=${ly(r)}`}).filter(n=>!!n);return e.length?`?${e.join("&")}`:""}(e.queryParams)}${"string"==typeof e.fragment?`#${function(t){return encodeURI(t)}(e.fragment)}`:""}`}}const SO=new AT;function ay(t){return t.segments.map(e=>RT(e)).join("/")}function Rm(t,e){if(!t.hasChildren())return ay(t);if(e){const n=t.children[Cn]?Rm(t.children[Cn],!1):"",r=[];return no(t.children,(s,u)=>{u!==Cn&&r.push(`${u}:${Rm(s,!1)}`)}),r.length>0?`${n}(${r.join("//")})`:n}{const n=function(t,e){let n=[];return no(t.children,(r,s)=>{s===Cn&&(n=n.concat(e(r,s)))}),no(t.children,(r,s)=>{s!==Cn&&(n=n.concat(e(r,s)))}),n}(t,(r,s)=>s===Cn?[Rm(t.children[Cn],!1)]:[`${s}:${Rm(r,!1)}`]);return 1===Object.keys(t.children).length&&null!=t.children[Cn]?`${ay(t)}/${n[0]}`:`${ay(t)}/(${n.join("//")})`}}function IT(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function ly(t){return IT(t).replace(/%3B/gi,";")}function X1(t){return IT(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function cy(t){return decodeURIComponent(t)}function MT(t){return cy(t.replace(/\+/g,"%20"))}function RT(t){return`${X1(t.path)}${function(t){return Object.keys(t).map(e=>`;${X1(e)}=${X1(t[e])}`).join("")}(t.parameters)}`}const RO=/^[^\/()?;=#]+/;function uy(t){const e=t.match(RO);return e?e[0]:""}const kO=/^[^=?&#]+/,FO=/^[^?&#]+/;class LO{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Pn([],{}):new Pn([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let n={};this.peekStartsWith("/(")&&(this.capture("/"),n=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(e.length>0||Object.keys(n).length>0)&&(r[Cn]=new Pn(e,n)),r}parseSegment(){const e=uy(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(e),new Mm(cy(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const n=uy(this.remaining);if(!n)return;this.capture(n);let r="";if(this.consumeOptional("=")){const s=uy(this.remaining);s&&(r=s,this.capture(r))}e[cy(n)]=cy(r)}parseQueryParam(e){const n=function(t){const e=t.match(kO);return e?e[0]:""}(this.remaining);if(!n)return;this.capture(n);let r="";if(this.consumeOptional("=")){const m=function(t){const e=t.match(FO);return e?e[0]:""}(this.remaining);m&&(r=m,this.capture(r))}const s=MT(n),u=MT(r);if(e.hasOwnProperty(s)){let m=e[s];Array.isArray(m)||(m=[m],e[s]=m),m.push(u)}else e[s]=u}parseParens(e){const n={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=uy(this.remaining),s=this.remaining[r.length];if("/"!==s&&")"!==s&&";"!==s)throw new Error(`Cannot parse url '${this.url}'`);let u;r.indexOf(":")>-1?(u=r.substr(0,r.indexOf(":")),this.capture(u),this.capture(":")):e&&(u=Cn);const m=this.parseChildren();n[u]=1===Object.keys(m).length?m[Cn]:new Pn([],m),this.consumeOptional("//")}return n}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new Error(`Expected "${e}".`)}}class kT{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const n=this.pathFromRoot(e);return n.length>1?n[n.length-2]:null}children(e){const n=K1(e,this._root);return n?n.children.map(r=>r.value):[]}firstChild(e){const n=K1(e,this._root);return n&&n.children.length>0?n.children[0].value:null}siblings(e){const n=Y1(e,this._root);return n.length<2?[]:n[n.length-2].children.map(s=>s.value).filter(s=>s!==e)}pathFromRoot(e){return Y1(e,this._root).map(n=>n.value)}}function K1(t,e){if(t===e.value)return e;for(const n of e.children){const r=K1(t,n);if(r)return r}return null}function Y1(t,e){if(t===e.value)return[e];for(const n of e.children){const r=Y1(t,n);if(r.length)return r.unshift(e),r}return[]}class Ac{constructor(e,n){this.value=e,this.children=n}toString(){return`TreeNode(${this.value})`}}function km(t){const e={};return t&&t.children.forEach(n=>e[n.value.outlet]=n),e}class PT extends kT{constructor(e,n){super(e),this.snapshot=n,Q1(this,e)}toString(){return this.snapshot.toString()}}function FT(t,e){const n=function(t,e){const m=new hy([],{},{},"",{},Cn,e,null,t.root,-1,{});return new LT("",new Ac(m,[]))}(t,e),r=new ja([new Mm("",{})]),s=new ja({}),u=new ja({}),m=new ja({}),v=new ja(""),E=new Kh(r,s,m,v,u,Cn,e,n.root);return E.snapshot=n.root,new PT(new Ac(E,[]),n)}class Kh{constructor(e,n,r,s,u,m,v,E){this.url=e,this.params=n,this.queryParams=r,this.fragment=s,this.data=u,this.outlet=m,this.component=v,this._futureSnapshot=E}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Pt(e=>Rf(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Pt(e=>Rf(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function OT(t,e="emptyOnly"){const n=t.pathFromRoot;let r=0;if("always"!==e)for(r=n.length-1;r>=1;){const s=n[r],u=n[r-1];if(s.routeConfig&&""===s.routeConfig.path)r--;else{if(u.component)break;r--}}return function(t){return t.reduce((e,n)=>({params:Object.assign(Object.assign({},e.params),n.params),data:Object.assign(Object.assign({},e.data),n.data),resolve:Object.assign(Object.assign({},e.resolve),n._resolvedData)}),{params:{},data:{},resolve:{}})}(n.slice(r))}class hy{constructor(e,n,r,s,u,m,v,E,S,P,V){this.url=e,this.params=n,this.queryParams=r,this.fragment=s,this.data=u,this.outlet=m,this.component=v,this.routeConfig=E,this._urlSegment=S,this._lastPathIndex=P,this._resolve=V}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Rf(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Rf(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(r=>r.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class LT extends kT{constructor(e,n){super(n),this.url=e,Q1(this,n)}toString(){return NT(this._root)}}function Q1(t,e){e.value._routerState=t,e.children.forEach(n=>Q1(t,n))}function NT(t){const e=t.children.length>0?` { ${t.children.map(NT).join(", ")} } `:"";return`${t.value}${e}`}function J1(t){if(t.snapshot){const e=t.snapshot,n=t._futureSnapshot;t.snapshot=n,Sl(e.queryParams,n.queryParams)||t.queryParams.next(n.queryParams),e.fragment!==n.fragment&&t.fragment.next(n.fragment),Sl(e.params,n.params)||t.params.next(n.params),function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!Sl(t[n],e[n]))return!1;return!0}(e.url,n.url)||t.url.next(n.url),Sl(e.data,n.data)||t.data.next(n.data)}else t.snapshot=t._futureSnapshot,t.data.next(t._futureSnapshot.data)}function ex(t,e){return Sl(t.params,e.params)&&function(t,e){return Xh(t,e)&&t.every((n,r)=>Sl(n.parameters,e[r].parameters))}(t.url,e.url)&&!(!t.parent!=!e.parent)&&(!t.parent||ex(t.parent,e.parent))}function dy(t,e,n){if(n&&t.shouldReuseRoute(e.value,n.value.snapshot)){const r=n.value;r._futureSnapshot=e.value;const s=function(t,e,n){return e.children.map(r=>{for(const s of n.children)if(t.shouldReuseRoute(r.value,s.value.snapshot))return dy(t,r,s);return dy(t,r)})}(t,e,n);return new Ac(r,s)}{if(t.shouldAttach(e.value)){const u=t.retrieve(e.value);if(null!==u){const m=u.route;return zT(e,m),m}}const r=function(t){return new Kh(new ja(t.url),new ja(t.params),new ja(t.queryParams),new ja(t.fragment),new ja(t.data),t.outlet,t.component,t)}(e.value),s=e.children.map(u=>dy(t,u));return new Ac(r,s)}}function zT(t,e){if(t.value.routeConfig!==e.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(t.children.length!==e.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");e.value._futureSnapshot=t.value;for(let n=0;n<t.children.length;++n)zT(t.children[n],e.children[n])}function fy(t){return"object"==typeof t&&null!=t&&!t.outlets&&!t.segmentPath}function Pm(t){return"object"==typeof t&&null!=t&&t.outlets}function tx(t,e,n,r,s){let u={};return r&&no(r,(m,v)=>{u[v]=Array.isArray(m)?m.map(E=>`${E}`):`${m}`}),new Wh(n.root===t?e:VT(n.root,t,e),u,s)}function VT(t,e,n){const r={};return no(t.children,(s,u)=>{r[u]=s===e?n:VT(s,e,n)}),new Pn(t.segments,r)}class BT{constructor(e,n,r){if(this.isAbsolute=e,this.numberOfDoubleDots=n,this.commands=r,e&&r.length>0&&fy(r[0]))throw new Error("Root segment cannot have matrix parameters");const s=r.find(Pm);if(s&&s!==wT(r))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class nx{constructor(e,n,r){this.segmentGroup=e,this.processChildren=n,this.index=r}}function UT(t,e,n){if(t||(t=new Pn([],{})),0===t.segments.length&&t.hasChildren())return py(t,e,n);const r=function(t,e,n){let r=0,s=e;const u={match:!1,pathIndex:0,commandIndex:0};for(;s<t.segments.length;){if(r>=n.length)return u;const m=t.segments[s],v=n[r];if(Pm(v))break;const E=`${v}`,S=r<n.length-1?n[r+1]:null;if(s>0&&void 0===E)break;if(E&&S&&"object"==typeof S&&void 0===S.outlets){if(!$T(E,S,m))return u;r+=2}else{if(!$T(E,{},m))return u;r++}s++}return{match:!0,pathIndex:s,commandIndex:r}}(t,e,n),s=n.slice(r.commandIndex);if(r.match&&r.pathIndex<t.segments.length){const u=new Pn(t.segments.slice(0,r.pathIndex),{});return u.children[Cn]=new Pn(t.segments.slice(r.pathIndex),t.children),py(u,0,s)}return r.match&&0===s.length?new Pn(t.segments,{}):r.match&&!t.hasChildren()?rx(t,e,n):r.match?py(t,0,s):rx(t,e,n)}function py(t,e,n){if(0===n.length)return new Pn(t.segments,{});{const r=function(t){return Pm(t[0])?t[0].outlets:{[Cn]:t}}(n),s={};return no(r,(u,m)=>{"string"==typeof u&&(u=[u]),null!==u&&(s[m]=UT(t.children[m],e,u))}),no(t.children,(u,m)=>{void 0===r[m]&&(s[m]=u)}),new Pn(t.segments,s)}}function rx(t,e,n){const r=t.segments.slice(0,e);let s=0;for(;s<n.length;){const u=n[s];if(Pm(u)){const E=WO(u.outlets);return new Pn(r,E)}if(0===s&&fy(n[0])){r.push(new Mm(t.segments[e].path,jT(n[0]))),s++;continue}const m=Pm(u)?u.outlets[Cn]:`${u}`,v=s<n.length-1?n[s+1]:null;m&&v&&fy(v)?(r.push(new Mm(m,jT(v))),s+=2):(r.push(new Mm(m,{})),s++)}return new Pn(r,{})}function WO(t){const e={};return no(t,(n,r)=>{"string"==typeof n&&(n=[n]),null!==n&&(e[r]=rx(new Pn([],{}),0,n))}),e}function jT(t){const e={};return no(t,(n,r)=>e[r]=`${n}`),e}function $T(t,e,n){return t==n.path&&Sl(e,n.parameters)}class KO{constructor(e,n,r,s){this.routeReuseStrategy=e,this.futureState=n,this.currState=r,this.forwardEvent=s}activate(e){const n=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(n,r,e),J1(this.futureState.root),this.activateChildRoutes(n,r,e)}deactivateChildRoutes(e,n,r){const s=km(n);e.children.forEach(u=>{const m=u.value.outlet;this.deactivateRoutes(u,s[m],r),delete s[m]}),no(s,(u,m)=>{this.deactivateRouteAndItsChildren(u,r)})}deactivateRoutes(e,n,r){const s=e.value,u=n?n.value:null;if(s===u)if(s.component){const m=r.getContext(s.outlet);m&&this.deactivateChildRoutes(e,n,m.children)}else this.deactivateChildRoutes(e,n,r);else u&&this.deactivateRouteAndItsChildren(n,r)}deactivateRouteAndItsChildren(e,n){this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,n):this.deactivateRouteAndOutlet(e,n)}detachAndStoreRouteSubtree(e,n){const r=n.getContext(e.value.outlet);if(r&&r.outlet){const s=r.outlet.detach(),u=r.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:s,route:e,contexts:u})}}deactivateRouteAndOutlet(e,n){const r=n.getContext(e.value.outlet),s=r&&e.value.component?r.children:n,u=km(e);for(const m of Object.keys(u))this.deactivateRouteAndItsChildren(u[m],s);r&&r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated(),r.attachRef=null,r.resolver=null,r.route=null)}activateChildRoutes(e,n,r){const s=km(n);e.children.forEach(u=>{this.activateRoutes(u,s[u.value.outlet],r),this.forwardEvent(new gO(u.value.snapshot))}),e.children.length&&this.forwardEvent(new pO(e.value.snapshot))}activateRoutes(e,n,r){const s=e.value,u=n?n.value:null;if(J1(s),s===u)if(s.component){const m=r.getOrCreateContext(s.outlet);this.activateChildRoutes(e,n,m.children)}else this.activateChildRoutes(e,n,r);else if(s.component){const m=r.getOrCreateContext(s.outlet);if(this.routeReuseStrategy.shouldAttach(s.snapshot)){const v=this.routeReuseStrategy.retrieve(s.snapshot);this.routeReuseStrategy.store(s.snapshot,null),m.children.onOutletReAttached(v.contexts),m.attachRef=v.componentRef,m.route=v.route.value,m.outlet&&m.outlet.attach(v.componentRef,v.route.value),HT(v.route)}else{const v=function(t){for(let e=t.parent;e;e=e.parent){const n=e.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig;if(n&&n.component)return null}return null}(s.snapshot),E=v?v.module.componentFactoryResolver:null;m.attachRef=null,m.route=s,m.resolver=E,m.outlet&&m.outlet.activateWith(s,E),this.activateChildRoutes(e,null,m.children)}}else this.activateChildRoutes(e,null,r)}}function HT(t){J1(t.value),t.children.forEach(HT)}class ix{constructor(e,n){this.routes=e,this.module=n}}function ku(t){return"function"==typeof t}function Yh(t){return t instanceof Wh}const Fm=Symbol("INITIAL_VALUE");function Om(){return Mu(t=>function(...t){let e,n;return Pr(t[t.length-1])&&(n=t.pop()),"function"==typeof t[t.length-1]&&(e=t.pop()),1===t.length&&ne(t[0])&&(t=t[0]),oa(t,n).lift(new PF(e))}(t.map(e=>e.pipe(H1(1),function(...t){const e=t[t.length-1];return Pr(e)?(t.pop(),n=>j1(t,n,e)):n=>j1(t,n)}(Fm)))).pipe(dT((e,n)=>{let r=!1;return n.reduce((s,u,m)=>s!==Fm?s:(u===Fm&&(r=!0),r||!1!==u&&m!==n.length-1&&!Yh(u)?s:u),e)},Fm),qh(e=>e!==Fm),Pt(e=>Yh(e)?e:!0===e),H1(1)))}let GT=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=fs({type:t,selectors:[["ng-component"]],decls:1,vars:0,template:function(n,r){1&n&&_n(0,"router-outlet")},directives:function(){return[hx]},encapsulation:2}),t})();function qT(t,e=""){for(let n=0;n<t.length;n++){const r=t[n];rL(r,iL(e,r))}}function rL(t,e){t.children&&qT(t.children,e)}function iL(t,e){return e?t||e.path?t&&!e.path?`${t}/`:!t&&e.path?e.path:`${t}/${e.path}`:"":t}function ox(t){const e=t.children&&t.children.map(ox),n=e?Object.assign(Object.assign({},t),{children:e}):Object.assign({},t);return!n.component&&(e||n.loadChildren)&&n.outlet&&n.outlet!==Cn&&(n.component=GT),n}function na(t){return t.outlet||Cn}function ZT(t,e){const n=t.filter(r=>na(r)===e);return n.push(...t.filter(r=>na(r)!==e)),n}const WT={matched:!1,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};function my(t,e,n){var r;if(""===e.path)return"full"===e.pathMatch&&(t.hasChildren()||n.length>0)?Object.assign({},WT):{matched:!0,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};const u=(e.matcher||vO)(n,t,e);if(!u)return Object.assign({},WT);const m={};no(u.posParams,(E,S)=>{m[S]=E.path});const v=u.consumed.length>0?Object.assign(Object.assign({},m),u.consumed[u.consumed.length-1].parameters):m;return{matched:!0,consumedSegments:u.consumed,lastChild:u.consumed.length,parameters:v,positionalParamSegments:null!==(r=u.posParams)&&void 0!==r?r:{}}}function gy(t,e,n,r,s="corrected"){if(n.length>0&&function(t,e,n){return n.some(r=>_y(t,e,r)&&na(r)!==Cn)}(t,n,r)){const m=new Pn(e,function(t,e,n,r){const s={};s[Cn]=r,r._sourceSegment=t,r._segmentIndexShift=e.length;for(const u of n)if(""===u.path&&na(u)!==Cn){const m=new Pn([],{});m._sourceSegment=t,m._segmentIndexShift=e.length,s[na(u)]=m}return s}(t,e,r,new Pn(n,t.children)));return m._sourceSegment=t,m._segmentIndexShift=e.length,{segmentGroup:m,slicedSegments:[]}}if(0===n.length&&function(t,e,n){return n.some(r=>_y(t,e,r))}(t,n,r)){const m=new Pn(t.segments,function(t,e,n,r,s,u){const m={};for(const v of r)if(_y(t,n,v)&&!s[na(v)]){const E=new Pn([],{});E._sourceSegment=t,E._segmentIndexShift="legacy"===u?t.segments.length:e.length,m[na(v)]=E}return Object.assign(Object.assign({},s),m)}(t,e,n,r,t.children,s));return m._sourceSegment=t,m._segmentIndexShift=e.length,{segmentGroup:m,slicedSegments:n}}const u=new Pn(t.segments,t.children);return u._sourceSegment=t,u._segmentIndexShift=e.length,{segmentGroup:u,slicedSegments:n}}function _y(t,e,n){return(!(t.hasChildren()||e.length>0)||"full"!==n.pathMatch)&&""===n.path}function XT(t,e,n,r){return!!(na(t)===r||r!==Cn&&_y(e,n,t))&&("**"===t.path||my(e,t,n).matched)}function KT(t,e,n){return 0===e.length&&!t.children[n]}class Lm{constructor(e){this.segmentGroup=e||null}}class YT{constructor(e){this.urlTree=e}}function yy(t){return new Dt(e=>e.error(new Lm(t)))}function QT(t){return new Dt(e=>e.error(new YT(t)))}function cL(t){return new Dt(e=>e.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${t}'`)))}class dL{constructor(e,n,r,s,u){this.configLoader=n,this.urlSerializer=r,this.urlTree=s,this.config=u,this.allowRedirects=!0,this.ngModule=e.get(Tl)}apply(){const e=gy(this.urlTree.root,[],[],this.config).segmentGroup,n=new Pn(e.segments,e.children);return this.expandSegmentGroup(this.ngModule,this.config,n,Cn).pipe(Pt(u=>this.createUrlTree(sx(u),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Zh(u=>{if(u instanceof YT)return this.allowRedirects=!1,this.match(u.urlTree);throw u instanceof Lm?this.noMatchError(u):u}))}match(e){return this.expandSegmentGroup(this.ngModule,this.config,e.root,Cn).pipe(Pt(s=>this.createUrlTree(sx(s),e.queryParams,e.fragment))).pipe(Zh(s=>{throw s instanceof Lm?this.noMatchError(s):s}))}noMatchError(e){return new Error(`Cannot match any routes. URL Segment: '${e.segmentGroup}'`)}createUrlTree(e,n,r){const s=e.segments.length>0?new Pn([],{[Cn]:e}):e;return new Wh(s,n,r)}expandSegmentGroup(e,n,r,s){return 0===r.segments.length&&r.hasChildren()?this.expandChildren(e,n,r).pipe(Pt(u=>new Pn([],u))):this.expandSegment(e,r,n,r.segments,s,!0)}expandChildren(e,n,r){const s=[];for(const u of Object.keys(r.children))"primary"===u?s.unshift(u):s.push(u);return Ar(s).pipe(If(u=>{const m=r.children[u],v=ZT(n,u);return this.expandSegmentGroup(e,v,m,u).pipe(Pt(E=>({segment:E,outlet:u})))}),dT((u,m)=>(u[m.outlet]=m.segment,u),{}),function(t,e){const n=arguments.length>=2;return r=>r.pipe(t?qh((s,u)=>t(s,u,r)):ze,G1(1),n?pT(e):fT(()=>new oy))}())}expandSegment(e,n,r,s,u,m){return Ar(r).pipe(If(v=>this.expandSegmentAgainstRoute(e,n,r,v,s,u,m).pipe(Zh(S=>{if(S instanceof Lm)return hn(null);throw S}))),Mf(v=>!!v),Zh((v,E)=>{if(v instanceof oy||"EmptyError"===v.name){if(KT(n,s,u))return hn(new Pn([],{}));throw new Lm(n)}throw v}))}expandSegmentAgainstRoute(e,n,r,s,u,m,v){return XT(s,n,u,m)?void 0===s.redirectTo?this.matchSegmentAgainstRoute(e,n,s,u,m):v&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,n,r,s,u,m):yy(n):yy(n)}expandSegmentAgainstRouteUsingRedirect(e,n,r,s,u,m){return"**"===s.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,r,s,m):this.expandRegularSegmentAgainstRouteUsingRedirect(e,n,r,s,u,m)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,n,r,s){const u=this.applyRedirectCommands([],r.redirectTo,{});return r.redirectTo.startsWith("/")?QT(u):this.lineralizeSegments(r,u).pipe(Tr(m=>{const v=new Pn(m,{});return this.expandSegment(e,v,n,m,s,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,n,r,s,u,m){const{matched:v,consumedSegments:E,lastChild:S,positionalParamSegments:P}=my(n,s,u);if(!v)return yy(n);const V=this.applyRedirectCommands(E,s.redirectTo,P);return s.redirectTo.startsWith("/")?QT(V):this.lineralizeSegments(s,V).pipe(Tr(j=>this.expandSegment(e,n,r,j.concat(u.slice(S)),m,!1)))}matchSegmentAgainstRoute(e,n,r,s,u){if("**"===r.path)return r.loadChildren?(r._loadedConfig?hn(r._loadedConfig):this.configLoader.load(e.injector,r)).pipe(Pt(j=>(r._loadedConfig=j,new Pn(s,{})))):hn(new Pn(s,{}));const{matched:m,consumedSegments:v,lastChild:E}=my(n,r,s);if(!m)return yy(n);const S=s.slice(E);return this.getChildConfig(e,r,s).pipe(Tr(V=>{const j=V.module,G=V.routes,{segmentGroup:se,slicedSegments:Re}=gy(n,v,S,G),be=new Pn(se.segments,se.children);if(0===Re.length&&be.hasChildren())return this.expandChildren(j,G,be).pipe(Pt(Nt=>new Pn(v,Nt)));if(0===G.length&&0===Re.length)return hn(new Pn(v,{}));const qe=na(r)===u;return this.expandSegment(j,be,G,Re,qe?Cn:u,!0).pipe(Pt(Tt=>new Pn(v.concat(Tt.segments),Tt.children)))}))}getChildConfig(e,n,r){return n.children?hn(new ix(n.children,e)):n.loadChildren?void 0!==n._loadedConfig?hn(n._loadedConfig):this.runCanLoadGuards(e.injector,n,r).pipe(Tr(s=>s?this.configLoader.load(e.injector,n).pipe(Pt(u=>(n._loadedConfig=u,u))):function(t){return new Dt(e=>e.error(Z1(`Cannot load children because the guard of the route "path: '${t.path}'" returned false`)))}(n))):hn(new ix([],e))}runCanLoadGuards(e,n,r){const s=n.canLoad;return s&&0!==s.length?hn(s.map(m=>{const v=e.get(m);let E;if(function(t){return t&&ku(t.canLoad)}(v))E=v.canLoad(n,r);else{if(!ku(v))throw new Error("Invalid CanLoad guard");E=v(n,r)}return Al(E)})).pipe(Om(),Cs(m=>{if(!Yh(m))return;const v=Z1(`Redirecting to "${this.urlSerializer.serialize(m)}"`);throw v.url=m,v}),Pt(m=>!0===m)):hn(!0)}lineralizeSegments(e,n){let r=[],s=n.root;for(;;){if(r=r.concat(s.segments),0===s.numberOfChildren)return hn(r);if(s.numberOfChildren>1||!s.children[Cn])return cL(e.redirectTo);s=s.children[Cn]}}applyRedirectCommands(e,n,r){return this.applyRedirectCreatreUrlTree(n,this.urlSerializer.parse(n),e,r)}applyRedirectCreatreUrlTree(e,n,r,s){const u=this.createSegmentGroup(e,n.root,r,s);return new Wh(u,this.createQueryParams(n.queryParams,this.urlTree.queryParams),n.fragment)}createQueryParams(e,n){const r={};return no(e,(s,u)=>{if("string"==typeof s&&s.startsWith(":")){const v=s.substring(1);r[u]=n[v]}else r[u]=s}),r}createSegmentGroup(e,n,r,s){const u=this.createSegments(e,n.segments,r,s);let m={};return no(n.children,(v,E)=>{m[E]=this.createSegmentGroup(e,v,r,s)}),new Pn(u,m)}createSegments(e,n,r,s){return n.map(u=>u.path.startsWith(":")?this.findPosParam(e,u,s):this.findOrReturn(u,r))}findPosParam(e,n,r){const s=r[n.path.substring(1)];if(!s)throw new Error(`Cannot redirect to '${e}'. Cannot find '${n.path}'.`);return s}findOrReturn(e,n){let r=0;for(const s of n){if(s.path===e.path)return n.splice(r),s;r++}return e}}function sx(t){const e={};for(const r of Object.keys(t.children)){const u=sx(t.children[r]);(u.segments.length>0||u.hasChildren())&&(e[r]=u)}return function(t){if(1===t.numberOfChildren&&t.children[Cn]){const e=t.children[Cn];return new Pn(t.segments.concat(e.segments),e.children)}return t}(new Pn(t.segments,e))}class JT{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class vy{constructor(e,n){this.component=e,this.route=n}}function mL(t,e,n){const r=t._root;return Nm(r,e?e._root:null,n,[r.value])}function xy(t,e,n){const r=function(t){if(!t)return null;for(let e=t.parent;e;e=e.parent){const n=e.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig}return null}(e);return(r?r.module.injector:n).get(t)}function Nm(t,e,n,r,s={canDeactivateChecks:[],canActivateChecks:[]}){const u=km(e);return t.children.forEach(m=>{(function(t,e,n,r,s={canDeactivateChecks:[],canActivateChecks:[]}){const u=t.value,m=e?e.value:null,v=n?n.getContext(t.value.outlet):null;if(m&&u.routeConfig===m.routeConfig){const E=function(t,e,n){if("function"==typeof n)return n(t,e);switch(n){case"pathParamsChange":return!Xh(t.url,e.url);case"pathParamsOrQueryParamsChange":return!Xh(t.url,e.url)||!Sl(t.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!ex(t,e)||!Sl(t.queryParams,e.queryParams);case"paramsChange":default:return!ex(t,e)}}(m,u,u.routeConfig.runGuardsAndResolvers);E?s.canActivateChecks.push(new JT(r)):(u.data=m.data,u._resolvedData=m._resolvedData),Nm(t,e,u.component?v?v.children:null:n,r,s),E&&v&&v.outlet&&v.outlet.isActivated&&s.canDeactivateChecks.push(new vy(v.outlet.component,m))}else m&&zm(e,v,s),s.canActivateChecks.push(new JT(r)),Nm(t,null,u.component?v?v.children:null:n,r,s)})(m,u[m.value.outlet],n,r.concat([m.value]),s),delete u[m.value.outlet]}),no(u,(m,v)=>zm(m,n.getContext(v),s)),s}function zm(t,e,n){const r=km(t),s=t.value;no(r,(u,m)=>{zm(u,s.component?e?e.children.getContext(m):null:e,n)}),n.canDeactivateChecks.push(new vy(s.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,s))}class AL{}function eD(t){return new Dt(e=>e.error(t))}class ML{constructor(e,n,r,s,u,m){this.rootComponentType=e,this.config=n,this.urlTree=r,this.url=s,this.paramsInheritanceStrategy=u,this.relativeLinkResolution=m}recognize(){const e=gy(this.urlTree.root,[],[],this.config.filter(m=>void 0===m.redirectTo),this.relativeLinkResolution).segmentGroup,n=this.processSegmentGroup(this.config,e,Cn);if(null===n)return null;const r=new hy([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},Cn,this.rootComponentType,null,this.urlTree.root,-1,{}),s=new Ac(r,n),u=new LT(this.url,s);return this.inheritParamsAndData(u._root),u}inheritParamsAndData(e){const n=e.value,r=OT(n,this.paramsInheritanceStrategy);n.params=Object.freeze(r.params),n.data=Object.freeze(r.data),e.children.forEach(s=>this.inheritParamsAndData(s))}processSegmentGroup(e,n,r){return 0===n.segments.length&&n.hasChildren()?this.processChildren(e,n):this.processSegment(e,n,n.segments,r)}processChildren(e,n){const r=[];for(const u of Object.keys(n.children)){const m=n.children[u],v=ZT(e,u),E=this.processSegmentGroup(v,m,u);if(null===E)return null;r.push(...E)}const s=tD(r);return function(t){t.sort((e,n)=>e.value.outlet===Cn?-1:n.value.outlet===Cn?1:e.value.outlet.localeCompare(n.value.outlet))}(s),s}processSegment(e,n,r,s){for(const u of e){const m=this.processSegmentAgainstRoute(u,n,r,s);if(null!==m)return m}return KT(n,r,s)?[]:null}processSegmentAgainstRoute(e,n,r,s){if(e.redirectTo||!XT(e,n,r,s))return null;let u,m=[],v=[];if("**"===e.path){const G=r.length>0?wT(r).parameters:{};u=new hy(r,G,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,iD(e),na(e),e.component,e,nD(n),rD(n)+r.length,oD(e))}else{const G=my(n,e,r);if(!G.matched)return null;m=G.consumedSegments,v=r.slice(G.lastChild),u=new hy(m,G.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,iD(e),na(e),e.component,e,nD(n),rD(n)+m.length,oD(e))}const E=function(t){return t.children?t.children:t.loadChildren?t._loadedConfig.routes:[]}(e),{segmentGroup:S,slicedSegments:P}=gy(n,m,v,E.filter(G=>void 0===G.redirectTo),this.relativeLinkResolution);if(0===P.length&&S.hasChildren()){const G=this.processChildren(E,S);return null===G?null:[new Ac(u,G)]}if(0===E.length&&0===P.length)return[new Ac(u,[])];const V=na(e)===s,j=this.processSegment(E,S,P,V?Cn:s);return null===j?null:[new Ac(u,j)]}}function PL(t){const e=t.value.routeConfig;return e&&""===e.path&&void 0===e.redirectTo}function tD(t){const e=[],n=new Set;for(const r of t){if(!PL(r)){e.push(r);continue}const s=e.find(u=>r.value.routeConfig===u.value.routeConfig);void 0!==s?(s.children.push(...r.children),n.add(s)):e.push(r)}for(const r of n){const s=tD(r.children);e.push(new Ac(r.value,s))}return e.filter(r=>!n.has(r))}function nD(t){let e=t;for(;e._sourceSegment;)e=e._sourceSegment;return e}function rD(t){let e=t,n=e._segmentIndexShift?e._segmentIndexShift:0;for(;e._sourceSegment;)e=e._sourceSegment,n+=e._segmentIndexShift?e._segmentIndexShift:0;return n-1}function iD(t){return t.data||{}}function oD(t){return t.resolve||{}}function ax(t){return Mu(e=>{const n=t(e);return n?Ar(n).pipe(Pt(()=>e)):hn(e)})}class UL extends class{shouldDetach(e){return!1}store(e,n){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,n){return e.routeConfig===n.routeConfig}}{}const lx=new un("ROUTES");class sD{constructor(e,n,r,s){this.loader=e,this.compiler=n,this.onLoadStartListener=r,this.onLoadEndListener=s}load(e,n){if(n._loader$)return n._loader$;this.onLoadStartListener&&this.onLoadStartListener(n);const s=this.loadModuleFactory(n.loadChildren).pipe(Pt(u=>{this.onLoadEndListener&&this.onLoadEndListener(n);const m=u.create(e);return new ix(bT(m.injector.get(lx,void 0,Mt.Self|Mt.Optional)).map(ox),m)}),Zh(u=>{throw n._loader$=void 0,u}));return n._loader$=new kc(s,()=>new Cr).pipe(Ss()),n._loader$}loadModuleFactory(e){return"string"==typeof e?Ar(this.loader.load(e)):Al(e()).pipe(Tr(n=>n instanceof VE?hn(n):Ar(this.compiler.compileModuleAsync(n))))}}class jL{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new kf,this.attachRef=null}}class kf{constructor(){this.contexts=new Map}onChildOutletCreated(e,n){const r=this.getOrCreateContext(e);r.outlet=n,this.contexts.set(e,r)}onChildOutletDestroyed(e){const n=this.getContext(e);n&&(n.outlet=null,n.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let n=this.getContext(e);return n||(n=new jL,this.contexts.set(e,n)),n}getContext(e){return this.contexts.get(e)||null}}class HL{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,n){return e}}function GL(t){throw t}function qL(t,e,n){return e.parse("/")}function aD(t,e){return hn(null)}const ZL={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},WL={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Zi=(()=>{class t{constructor(n,r,s,u,m,v,E,S){this.rootComponentType=n,this.urlSerializer=r,this.rootContexts=s,this.location=u,this.config=S,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.lastLocationChangeInfo=null,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new Cr,this.errorHandler=GL,this.malformedUriErrorHandler=qL,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:aD,afterPreactivation:aD},this.urlHandlingStrategy=new HL,this.routeReuseStrategy=new UL,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=m.get(Tl),this.console=m.get(R_);const j=m.get(bi);this.isNgZoneEnabled=j instanceof bi&&bi.isInAngularZone(),this.resetConfig(S),this.currentUrlTree=new Wh(new Pn([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new sD(v,E,G=>this.triggerEvent(new gT(G)),G=>this.triggerEvent(new _T(G))),this.routerState=FT(this.currentUrlTree,this.rootComponentType),this.transitions=new ja({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var n;return null===(n=this.location.getState())||void 0===n?void 0:n.\u0275routerPageId}setupNavigations(n){const r=this.events;return n.pipe(qh(s=>0!==s.id),Pt(s=>Object.assign(Object.assign({},s),{extractedUrl:this.urlHandlingStrategy.extract(s.rawUrl)})),Mu(s=>{let u=!1,m=!1;return hn(s).pipe(Cs(v=>{this.currentNavigation={id:v.id,initialUrl:v.currentRawUrl,extractedUrl:v.extractedUrl,trigger:v.source,extras:v.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),Mu(v=>{const E=this.browserUrlTree.toString(),S=!this.navigated||v.extractedUrl.toString()!==E||E!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||S)&&this.urlHandlingStrategy.shouldProcessUrl(v.rawUrl))return by(v.source)&&(this.browserUrlTree=v.extractedUrl),hn(v).pipe(Mu(V=>{const j=this.transitions.getValue();return r.next(new q1(V.id,this.serializeUrl(V.extractedUrl),V.source,V.restoredState)),j!==this.transitions.getValue()?Af:Promise.resolve(V)}),function(t,e,n,r){return Mu(s=>function(t,e,n,r,s){return new dL(t,e,n,r,s).apply()}(t,e,n,s.extractedUrl,r).pipe(Pt(u=>Object.assign(Object.assign({},s),{urlAfterRedirects:u}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Cs(V=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:V.urlAfterRedirects})}),function(t,e,n,r,s){return Tr(u=>function(t,e,n,r,s="emptyOnly",u="legacy"){try{const m=new ML(t,e,n,r,s,u).recognize();return null===m?eD(new AL):hn(m)}catch(m){return eD(m)}}(t,e,u.urlAfterRedirects,n(u.urlAfterRedirects),r,s).pipe(Pt(m=>Object.assign(Object.assign({},u),{targetSnapshot:m}))))}(this.rootComponentType,this.config,V=>this.serializeUrl(V),this.paramsInheritanceStrategy,this.relativeLinkResolution),Cs(V=>{"eager"===this.urlUpdateStrategy&&(V.extras.skipLocationChange||this.setBrowserUrl(V.urlAfterRedirects,V),this.browserUrlTree=V.urlAfterRedirects);const j=new lO(V.id,this.serializeUrl(V.extractedUrl),this.serializeUrl(V.urlAfterRedirects),V.targetSnapshot);r.next(j)}));if(S&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:j,extractedUrl:G,source:se,restoredState:Re,extras:be}=v,qe=new q1(j,this.serializeUrl(G),se,Re);r.next(qe);const Ue=FT(G,this.rootComponentType).snapshot;return hn(Object.assign(Object.assign({},v),{targetSnapshot:Ue,urlAfterRedirects:G,extras:Object.assign(Object.assign({},be),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=v.rawUrl,this.browserUrlTree=v.urlAfterRedirects,v.resolve(null),Af}),ax(v=>{const{targetSnapshot:E,id:S,extractedUrl:P,rawUrl:V,extras:{skipLocationChange:j,replaceUrl:G}}=v;return this.hooks.beforePreactivation(E,{navigationId:S,appliedUrlTree:P,rawUrlTree:V,skipLocationChange:!!j,replaceUrl:!!G})}),Cs(v=>{const E=new cO(v.id,this.serializeUrl(v.extractedUrl),this.serializeUrl(v.urlAfterRedirects),v.targetSnapshot);this.triggerEvent(E)}),Pt(v=>Object.assign(Object.assign({},v),{guards:mL(v.targetSnapshot,v.currentSnapshot,this.rootContexts)})),function(t,e){return Tr(n=>{const{targetSnapshot:r,currentSnapshot:s,guards:{canActivateChecks:u,canDeactivateChecks:m}}=n;return 0===m.length&&0===u.length?hn(Object.assign(Object.assign({},n),{guardsResult:!0})):function(t,e,n,r){return Ar(t).pipe(Tr(s=>function(t,e,n,r,s){const u=e&&e.routeConfig?e.routeConfig.canDeactivate:null;return u&&0!==u.length?hn(u.map(v=>{const E=xy(v,e,s);let S;if(function(t){return t&&ku(t.canDeactivate)}(E))S=Al(E.canDeactivate(t,e,n,r));else{if(!ku(E))throw new Error("Invalid CanDeactivate guard");S=Al(E(t,e,n,r))}return S.pipe(Mf())})).pipe(Om()):hn(!0)}(s.component,s.route,n,e,r)),Mf(s=>!0!==s,!0))}(m,r,s,t).pipe(Tr(v=>v&&function(t){return"boolean"==typeof t}(v)?function(t,e,n,r){return Ar(e).pipe(If(s=>j1(function(t,e){return null!==t&&e&&e(new fO(t)),hn(!0)}(s.route.parent,r),function(t,e){return null!==t&&e&&e(new mO(t)),hn(!0)}(s.route,r),function(t,e,n){const r=e[e.length-1],u=e.slice(0,e.length-1).reverse().map(m=>function(t){const e=t.routeConfig?t.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:t,guards:e}:null}(m)).filter(m=>null!==m).map(m=>uT(()=>hn(m.guards.map(E=>{const S=xy(E,m.node,n);let P;if(function(t){return t&&ku(t.canActivateChild)}(S))P=Al(S.canActivateChild(r,t));else{if(!ku(S))throw new Error("Invalid CanActivateChild guard");P=Al(S(r,t))}return P.pipe(Mf())})).pipe(Om())));return hn(u).pipe(Om())}(t,s.path,n),function(t,e,n){const r=e.routeConfig?e.routeConfig.canActivate:null;return r&&0!==r.length?hn(r.map(u=>uT(()=>{const m=xy(u,e,n);let v;if(function(t){return t&&ku(t.canActivate)}(m))v=Al(m.canActivate(e,t));else{if(!ku(m))throw new Error("Invalid CanActivate guard");v=Al(m(e,t))}return v.pipe(Mf())}))).pipe(Om()):hn(!0)}(t,s.route,n))),Mf(s=>!0!==s,!0))}(r,u,t,e):hn(v)),Pt(v=>Object.assign(Object.assign({},n),{guardsResult:v})))})}(this.ngModule.injector,v=>this.triggerEvent(v)),Cs(v=>{if(Yh(v.guardsResult)){const S=Z1(`Redirecting to "${this.serializeUrl(v.guardsResult)}"`);throw S.url=v.guardsResult,S}const E=new uO(v.id,this.serializeUrl(v.extractedUrl),this.serializeUrl(v.urlAfterRedirects),v.targetSnapshot,!!v.guardsResult);this.triggerEvent(E)}),qh(v=>!!v.guardsResult||(this.restoreHistory(v),this.cancelNavigationTransition(v,""),!1)),ax(v=>{if(v.guards.canActivateChecks.length)return hn(v).pipe(Cs(E=>{const S=new hO(E.id,this.serializeUrl(E.extractedUrl),this.serializeUrl(E.urlAfterRedirects),E.targetSnapshot);this.triggerEvent(S)}),Mu(E=>{let S=!1;return hn(E).pipe(function(t,e){return Tr(n=>{const{targetSnapshot:r,guards:{canActivateChecks:s}}=n;if(!s.length)return hn(n);let u=0;return Ar(s).pipe(If(m=>function(t,e,n,r){return function(t,e,n,r){const s=Object.keys(t);if(0===s.length)return hn({});const u={};return Ar(s).pipe(Tr(m=>function(t,e,n,r){const s=xy(t,e,r);return Al(s.resolve?s.resolve(e,n):s(e,n))}(t[m],e,n,r).pipe(Cs(v=>{u[m]=v}))),G1(1),Tr(()=>Object.keys(u).length===s.length?hn(u):Af))}(t._resolve,t,e,r).pipe(Pt(u=>(t._resolvedData=u,t.data=Object.assign(Object.assign({},t.data),OT(t,n).resolve),null)))}(m.route,r,t,e)),Cs(()=>u++),G1(1),Tr(m=>u===s.length?hn(n):Af))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Cs({next:()=>S=!0,complete:()=>{S||(this.restoreHistory(E),this.cancelNavigationTransition(E,"At least one route resolver didn't emit any value."))}}))}),Cs(E=>{const S=new dO(E.id,this.serializeUrl(E.extractedUrl),this.serializeUrl(E.urlAfterRedirects),E.targetSnapshot);this.triggerEvent(S)}))}),ax(v=>{const{targetSnapshot:E,id:S,extractedUrl:P,rawUrl:V,extras:{skipLocationChange:j,replaceUrl:G}}=v;return this.hooks.afterPreactivation(E,{navigationId:S,appliedUrlTree:P,rawUrlTree:V,skipLocationChange:!!j,replaceUrl:!!G})}),Pt(v=>{const E=function(t,e,n){const r=dy(t,e._root,n?n._root:void 0);return new PT(r,e)}(this.routeReuseStrategy,v.targetSnapshot,v.currentRouterState);return Object.assign(Object.assign({},v),{targetRouterState:E})}),Cs(v=>{this.currentUrlTree=v.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(v.urlAfterRedirects,v.rawUrl),this.routerState=v.targetRouterState,"deferred"===this.urlUpdateStrategy&&(v.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,v),this.browserUrlTree=v.urlAfterRedirects)}),((t,e,n)=>Pt(r=>(new KO(e,r.targetRouterState,r.currentRouterState,n).activate(t),r)))(this.rootContexts,this.routeReuseStrategy,v=>this.triggerEvent(v)),Cs({next(){u=!0},complete(){u=!0}}),function(t){return e=>e.lift(new oO(t))}(()=>{var v;if(!u&&!m){const E=`Navigation ID ${s.id} is not equal to the current navigation id ${this.navigationId}`;"replace"===this.canceledNavigationResolution?(this.restoreHistory(s),this.cancelNavigationTransition(s,E)):this.cancelNavigationTransition(s,E)}(null===(v=this.currentNavigation)||void 0===v?void 0:v.id)===s.id&&(this.currentNavigation=null)}),Zh(v=>{if(m=!0,function(t){return t&&t[vT]}(v)){const E=Yh(v.url);E||(this.navigated=!0,this.restoreHistory(s,!0));const S=new mT(s.id,this.serializeUrl(s.extractedUrl),v.message);r.next(S),E?setTimeout(()=>{const P=this.urlHandlingStrategy.merge(v.url,this.rawUrlTree),V={skipLocationChange:s.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||by(s.source)};this.scheduleNavigation(P,"imperative",null,V,{resolve:s.resolve,reject:s.reject,promise:s.promise})},0):s.resolve(!1)}else{this.restoreHistory(s,!0);const E=new aO(s.id,this.serializeUrl(s.extractedUrl),v);r.next(E);try{s.resolve(this.errorHandler(v))}catch(S){s.reject(S)}}return Af}))}))}resetRootComponentType(n){this.rootComponentType=n,this.routerState.root.component=this.rootComponentType}getTransition(){const n=this.transitions.value;return n.urlAfterRedirects=this.browserUrlTree,n}setTransition(n){this.transitions.next(Object.assign(Object.assign({},this.getTransition()),n))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(n=>{const r=this.extractLocationChangeInfoFromEvent(n);this.shouldScheduleNavigation(this.lastLocationChangeInfo,r)&&setTimeout(()=>{const{source:s,state:u,urlTree:m}=r,v={replaceUrl:!0};if(u){const E=Object.assign({},u);delete E.navigationId,delete E.\u0275routerPageId,0!==Object.keys(E).length&&(v.state=E)}this.scheduleNavigation(m,s,u,v)},0),this.lastLocationChangeInfo=r}))}extractLocationChangeInfoFromEvent(n){var r;return{source:"popstate"===n.type?"popstate":"hashchange",urlTree:this.parseUrl(n.url),state:(null===(r=n.state)||void 0===r?void 0:r.navigationId)?n.state:null,transitionId:this.getTransition().id}}shouldScheduleNavigation(n,r){if(!n)return!0;const s=r.urlTree.toString()===n.urlTree.toString();return r.transitionId!==n.transitionId||!s||!("hashchange"===r.source&&"popstate"===n.source||"popstate"===r.source&&"hashchange"===n.source)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(n){this.events.next(n)}resetConfig(n){qT(n),this.config=n.map(ox),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(n,r={}){const{relativeTo:s,queryParams:u,fragment:m,queryParamsHandling:v,preserveFragment:E}=r,S=s||this.routerState.root,P=E?this.currentUrlTree.fragment:m;let V=null;switch(v){case"merge":V=Object.assign(Object.assign({},this.currentUrlTree.queryParams),u);break;case"preserve":V=this.currentUrlTree.queryParams;break;default:V=u||null}return null!==V&&(V=this.removeEmptyProps(V)),function(t,e,n,r,s){if(0===n.length)return tx(e.root,e.root,e,r,s);const u=function(t){if("string"==typeof t[0]&&1===t.length&&"/"===t[0])return new BT(!0,0,t);let e=0,n=!1;const r=t.reduce((s,u,m)=>{if("object"==typeof u&&null!=u){if(u.outlets){const v={};return no(u.outlets,(E,S)=>{v[S]="string"==typeof E?E.split("/"):E}),[...s,{outlets:v}]}if(u.segmentPath)return[...s,u.segmentPath]}return"string"!=typeof u?[...s,u]:0===m?(u.split("/").forEach((v,E)=>{0==E&&"."===v||(0==E&&""===v?n=!0:".."===v?e++:""!=v&&s.push(v))}),s):[...s,u]},[]);return new BT(n,e,r)}(n);if(u.toRoot())return tx(e.root,new Pn([],{}),e,r,s);const m=function(t,e,n){if(t.isAbsolute)return new nx(e.root,!0,0);if(-1===n.snapshot._lastPathIndex){const u=n.snapshot._urlSegment;return new nx(u,u===e.root,0)}const r=fy(t.commands[0])?0:1;return function(t,e,n){let r=t,s=e,u=n;for(;u>s;){if(u-=s,r=r.parent,!r)throw new Error("Invalid number of '../'");s=r.segments.length}return new nx(r,!1,s-u)}(n.snapshot._urlSegment,n.snapshot._lastPathIndex+r,t.numberOfDoubleDots)}(u,e,t),v=m.processChildren?py(m.segmentGroup,m.index,u.commands):UT(m.segmentGroup,m.index,u.commands);return tx(m.segmentGroup,v,e,r,s)}(S,this.currentUrlTree,n,V,null!=P?P:null)}navigateByUrl(n,r={skipLocationChange:!1}){const s=Yh(n)?n:this.parseUrl(n),u=this.urlHandlingStrategy.merge(s,this.rawUrlTree);return this.scheduleNavigation(u,"imperative",null,r)}navigate(n,r={skipLocationChange:!1}){return function(t){for(let e=0;e<t.length;e++){const n=t[e];if(null==n)throw new Error(`The requested path contains ${n} segment at index ${e}`)}}(n),this.navigateByUrl(this.createUrlTree(n,r),r)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){let r;try{r=this.urlSerializer.parse(n)}catch(s){r=this.malformedUriErrorHandler(s,this.urlSerializer,n)}return r}isActive(n,r){let s;if(s=!0===r?Object.assign({},ZL):!1===r?Object.assign({},WL):r,Yh(n))return CT(this.currentUrlTree,n,s);const u=this.parseUrl(n);return CT(this.currentUrlTree,u,s)}removeEmptyProps(n){return Object.keys(n).reduce((r,s)=>{const u=n[s];return null!=u&&(r[s]=u),r},{})}processNavigations(){this.navigations.subscribe(n=>{this.navigated=!0,this.lastSuccessfulId=n.id,this.currentPageId=n.targetPageId,this.events.next(new Im(n.id,this.serializeUrl(n.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,n.resolve(!0)},n=>{this.console.warn(`Unhandled Navigation Error: ${n}`)})}scheduleNavigation(n,r,s,u,m){var v,E;if(this.disposed)return Promise.resolve(!1);const S=this.getTransition(),P=by(r)&&S&&!by(S.source),G=(this.lastSuccessfulId===S.id||this.currentNavigation?S.rawUrl:S.urlAfterRedirects).toString()===n.toString();if(P&&G)return Promise.resolve(!0);let se,Re,be;m?(se=m.resolve,Re=m.reject,be=m.promise):be=new Promise((Tt,Nt)=>{se=Tt,Re=Nt});const qe=++this.navigationId;let Ue;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(s=this.location.getState()),Ue=s&&s.\u0275routerPageId?s.\u0275routerPageId:u.replaceUrl||u.skipLocationChange?null!==(v=this.browserPageId)&&void 0!==v?v:0:(null!==(E=this.browserPageId)&&void 0!==E?E:0)+1):Ue=0,this.setTransition({id:qe,targetPageId:Ue,source:r,restoredState:s,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:n,extras:u,resolve:se,reject:Re,promise:be,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),be.catch(Tt=>Promise.reject(Tt))}setBrowserUrl(n,r){const s=this.urlSerializer.serialize(n),u=Object.assign(Object.assign({},r.extras.state),this.generateNgRouterState(r.id,r.targetPageId));this.location.isCurrentPathEqualTo(s)||r.extras.replaceUrl?this.location.replaceState(s,"",u):this.location.go(s,"",u)}restoreHistory(n,r=!1){var s,u;if("computed"===this.canceledNavigationResolution){const m=this.currentPageId-n.targetPageId;"popstate"!==n.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(s=this.currentNavigation)||void 0===s?void 0:s.finalUrl)||0===m?this.currentUrlTree===(null===(u=this.currentNavigation)||void 0===u?void 0:u.finalUrl)&&0===m&&(this.resetState(n),this.browserUrlTree=n.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(m)}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=n.currentRouterState,this.currentUrlTree=n.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(n,r){const s=new mT(n.id,this.serializeUrl(n.extractedUrl),r);this.triggerEvent(s),n.resolve(!1)}generateNgRouterState(n,r){return"computed"===this.canceledNavigationResolution?{navigationId:n,\u0275routerPageId:r}:{navigationId:n}}}return t.\u0275fac=function(n){return new(n||t)(_t(au),_t(W1),_t(kf),_t(H_),_t(nr),_t(P_),_t(jh),_t(void 0))},t.\u0275prov=kt({token:t,factory:t.\u0275fac}),t})();function by(t){return"imperative"!==t}let hx=(()=>{class t{constructor(n,r,s,u,m){this.parentContexts=n,this.location=r,this.resolver=s,this.changeDetector=m,this.activated=null,this._activatedRoute=null,this.activateEvents=new xi,this.deactivateEvents=new xi,this.name=u||Cn,n.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const n=this.parentContexts.getContext(this.name);n&&n.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const n=this.activated;return this.activated=null,this._activatedRoute=null,n}attach(n,r){this.activated=n,this._activatedRoute=r,this.location.insert(n.hostView)}deactivate(){if(this.activated){const n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,r){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=n;const m=(r=r||this.resolver).resolveComponentFactory(n._futureSnapshot.routeConfig.component),v=this.parentContexts.getOrCreateContext(this.name).children,E=new QL(n,v,this.location.injector);this.activated=this.location.createComponent(m,this.location.length,E),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return t.\u0275fac=function(n){return new(n||t)(ot(kf),ot(Fa),ot(Vh),function(t){return function(t,e){if("class"===e)return t.classes;if("style"===e)return t.styles;const n=t.attrs;if(n){const r=n.length;let s=0;for(;s<r;){const u=n[s];if(Y(u))break;if(0===u)s+=2;else if("number"==typeof u)for(s++;s<r&&"string"==typeof n[s];)s++;else{if(u===e)return n[s+1];s+=2}}}return null}(zn(),t)}("name"),ot(b0))},t.\u0275dir=Ut({type:t,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]}),t})();class QL{constructor(e,n,r){this.route=e,this.childContexts=n,this.parent=r}get(e,n){return e===Kh?this.route:e===kf?this.childContexts:this.parent.get(e,n)}}class lD{}class cD{preload(e,n){return hn(null)}}let uD=(()=>{class t{constructor(n,r,s,u,m){this.router=n,this.injector=u,this.preloadingStrategy=m,this.loader=new sD(r,s,S=>n.triggerEvent(new gT(S)),S=>n.triggerEvent(new _T(S)))}setUpPreloading(){this.subscription=this.router.events.pipe(qh(n=>n instanceof Im),If(()=>this.preload())).subscribe(()=>{})}preload(){const n=this.injector.get(Tl);return this.processRoutes(n,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(n,r){const s=[];for(const u of r)if(u.loadChildren&&!u.canLoad&&u._loadedConfig){const m=u._loadedConfig;s.push(this.processRoutes(m.module,m.routes))}else u.loadChildren&&!u.canLoad?s.push(this.preloadConfig(n,u)):u.children&&s.push(this.processRoutes(n,u.children));return Ar(s).pipe(cs(),Pt(u=>{}))}preloadConfig(n,r){return this.preloadingStrategy.preload(r,()=>(r._loadedConfig?hn(r._loadedConfig):this.loader.load(n.injector,r)).pipe(Tr(u=>(r._loadedConfig=u,this.processRoutes(u.module,u.routes)))))}}return t.\u0275fac=function(n){return new(n||t)(_t(Zi),_t(P_),_t(jh),_t(nr),_t(lD))},t.\u0275prov=kt({token:t,factory:t.\u0275fac}),t})(),dx=(()=>{class t{constructor(n,r,s={}){this.router=n,this.viewportScroller=r,this.options=s,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},s.scrollPositionRestoration=s.scrollPositionRestoration||"disabled",s.anchorScrolling=s.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(n=>{n instanceof q1?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=n.navigationTrigger,this.restoredId=n.restoredState?n.restoredState.navigationId:0):n instanceof Im&&(this.lastId=n.id,this.scheduleScrollEvent(n,this.router.parseUrl(n.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(n=>{n instanceof yT&&(n.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(n.position):n.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(n.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(n,r){this.router.triggerEvent(new yT(n,"popstate"===this.lastSource?this.store[this.restoredId]:null,r))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return t.\u0275fac=function(n){return new(n||t)(_t(Zi),_t(W2),_t(void 0))},t.\u0275prov=kt({token:t,factory:t.\u0275fac}),t})();const Qh=new un("ROUTER_CONFIGURATION"),hD=new un("ROUTER_FORROOT_GUARD"),e9=[H_,{provide:W1,useClass:AT},{provide:Zi,useFactory:function(t,e,n,r,s,u,m,v={},E,S){const P=new Zi(null,t,e,n,r,s,u,bT(m));return E&&(P.urlHandlingStrategy=E),S&&(P.routeReuseStrategy=S),function(t,e){t.errorHandler&&(e.errorHandler=t.errorHandler),t.malformedUriErrorHandler&&(e.malformedUriErrorHandler=t.malformedUriErrorHandler),t.onSameUrlNavigation&&(e.onSameUrlNavigation=t.onSameUrlNavigation),t.paramsInheritanceStrategy&&(e.paramsInheritanceStrategy=t.paramsInheritanceStrategy),t.relativeLinkResolution&&(e.relativeLinkResolution=t.relativeLinkResolution),t.urlUpdateStrategy&&(e.urlUpdateStrategy=t.urlUpdateStrategy)}(v,P),v.enableTracing&&P.events.subscribe(V=>{var j,G;null===(j=console.group)||void 0===j||j.call(console,`Router Event: ${V.constructor.name}`),console.log(V.toString()),console.log(V),null===(G=console.groupEnd)||void 0===G||G.call(console)}),P},deps:[W1,kf,H_,nr,P_,jh,lx,Qh,[class{},new sr],[class{},new sr]]},kf,{provide:Kh,useFactory:function(t){return t.routerState.root},deps:[Zi]},{provide:P_,useClass:GP},uD,cD,class{preload(e,n){return n().pipe(Zh(()=>hn(null)))}},{provide:Qh,useValue:{enableTracing:!1}}];function t9(){return new t1("Router",Zi)}let dD=(()=>{class t{constructor(n,r){}static forRoot(n,r){return{ngModule:t,providers:[e9,fD(n),{provide:hD,useFactory:i9,deps:[[Zi,new sr,new Gs]]},{provide:Qh,useValue:r||{}},{provide:Sf,useFactory:r9,deps:[Gh,[new du(y1),new sr],Qh]},{provide:dx,useFactory:n9,deps:[Zi,W2,Qh]},{provide:lD,useExisting:r&&r.preloadingStrategy?r.preloadingStrategy:cD},{provide:t1,multi:!0,useFactory:t9},[fx,{provide:ym,multi:!0,useFactory:l9,deps:[fx]},{provide:pD,useFactory:c9,deps:[fx]},{provide:jC,multi:!0,useExisting:pD}]]}}static forChild(n){return{ngModule:t,providers:[fD(n)]}}}return t.\u0275fac=function(n){return new(n||t)(_t(hD,8),_t(Zi,8))},t.\u0275mod=dr({type:t}),t.\u0275inj=Qr({}),t})();function n9(t,e,n){return n.scrollOffset&&e.setOffset(n.scrollOffset),new dx(t,e,n)}function r9(t,e,n={}){return n.useHash?new h4(t,e):new k2(t,e)}function i9(t){return"guarded"}function fD(t){return[{provide:Km,multi:!0,useValue:t},{provide:lx,multi:!0,useValue:t}]}let fx=(()=>{class t{constructor(n){this.injector=n,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new Cr}appInitializer(){return this.injector.get(l4,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let r=null;const s=new Promise(v=>r=v),u=this.injector.get(Zi),m=this.injector.get(Qh);return"disabled"===m.initialNavigation?(u.setUpLocationChangeListener(),r(!0)):"enabled"===m.initialNavigation||"enabledBlocking"===m.initialNavigation?(u.hooks.afterPreactivation=()=>this.initNavigation?hn(null):(this.initNavigation=!0,r(!0),this.resultOfPreactivationDone),u.initialNavigation()):r(!0),s})}bootstrapListener(n){const r=this.injector.get(Qh),s=this.injector.get(uD),u=this.injector.get(dx),m=this.injector.get(Zi),v=this.injector.get(Cf);n===v.components[0]&&(("enabledNonBlocking"===r.initialNavigation||void 0===r.initialNavigation)&&m.initialNavigation(),s.setUpPreloading(),u.init(),m.resetRootComponentType(v.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return t.\u0275fac=function(n){return new(n||t)(_t(nr))},t.\u0275prov=kt({token:t,factory:t.\u0275fac}),t})();function l9(t){return t.appInitializer.bind(t)}function c9(t){return t.bootstrapListener.bind(t)}const pD=new un("Router Initializer");let px=(()=>{class t{constructor(n){this.router=n}canActivate(n,r){return null!==localStorage.getItem("email")||(this.router.navigate(["/login"]),!1)}}return t.\u0275fac=function(n){return new(n||t)(_t(Zi))},t.\u0275prov=kt({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function wy(t,e){return new Dt(n=>{const r=t.length;if(0===r)return void n.complete();const s=new Array(r);let u=0,m=0;for(let v=0;v<r;v++){const E=Ar(t[v]);let S=!1;n.add(E.subscribe({next:P=>{S||(S=!0,m++),s[v]=P},error:P=>n.error(P),complete:()=>{u++,(u===r||!S)&&(m===r&&n.next(e?e.reduce((P,V,j)=>(P[V]=s[j],P),{}):s),n.complete())}}))}})}let mD=(()=>{class t{constructor(n,r){this._renderer=n,this._elementRef=r,this.onChange=s=>{},this.onTouched=()=>{}}setProperty(n,r){this._renderer.setProperty(this._elementRef.nativeElement,n,r)}registerOnTouched(n){this.onTouched=n}registerOnChange(n){this.onChange=n}setDisabledState(n){this.setProperty("disabled",n)}}return t.\u0275fac=function(n){return new(n||t)(ot(Cl),ot($i))},t.\u0275dir=Ut({type:t}),t})(),Jh=(()=>{class t extends mD{}return t.\u0275fac=function(){let e;return function(r){return(e||(e=en(t)))(r||t)}}(),t.\u0275dir=Ut({type:t,features:[Dr]}),t})();const Il=new un("NgValueAccessor"),f9={provide:Il,useExisting:O(()=>Ey),multi:!0},m9=new un("CompositionEventMode");let Ey=(()=>{class t extends mD{constructor(n,r,s){super(n,r),this._compositionMode=s,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function(){const t=Dl()?Dl().getUserAgent():"";return/android (\d+)/.test(t.toLowerCase())}())}writeValue(n){this.setProperty("value",null==n?"":n)}_handleInput(n){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(n)}_compositionStart(){this._composing=!0}_compositionEnd(n){this._composing=!1,this._compositionMode&&this.onChange(n)}}return t.\u0275fac=function(n){return new(n||t)(ot(Cl),ot($i),ot(m9,8))},t.\u0275dir=Ut({type:t,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(n,r){1&n&&vi("input",function(u){return r._handleInput(u.target.value)})("blur",function(){return r.onTouched()})("compositionstart",function(){return r._compositionStart()})("compositionend",function(u){return r._compositionEnd(u.target.value)})},features:[Rr([f9]),Dr]}),t})();const go=new un("NgValidators"),Fu=new un("NgAsyncValidators");function DD(t){return null!=t}function SD(t){const e=Qp(t)?Ar(t):t;return l_(e),e}function AD(t){let e={};return t.forEach(n=>{e=null!=n?Object.assign(Object.assign({},e),n):e}),0===Object.keys(e).length?null:e}function ID(t,e){return e.map(n=>n(t))}function MD(t){return t.map(e=>function(t){return!t.validate}(e)?e:n=>e.validate(n))}function mx(t){return null!=t?function(t){if(!t)return null;const e=t.filter(DD);return 0==e.length?null:function(n){return AD(ID(n,e))}}(MD(t)):null}function gx(t){return null!=t?function(t){if(!t)return null;const e=t.filter(DD);return 0==e.length?null:function(n){return function(...t){if(1===t.length){const e=t[0];if(ne(e))return wy(e,null);if(ie(e)&&Object.getPrototypeOf(e)===Object.prototype){const n=Object.keys(e);return wy(n.map(r=>e[r]),n)}}if("function"==typeof t[t.length-1]){const e=t.pop();return wy(t=1===t.length&&ne(t[0])?t[0]:t,null).pipe(Pt(n=>e(...n)))}return wy(t,null)}(ID(n,e).map(SD)).pipe(Pt(AD))}}(MD(t)):null}function PD(t,e){return null===t?[e]:Array.isArray(t)?[...t,e]:[t,e]}function _x(t){return t?Array.isArray(t)?t:[t]:[]}function Cy(t,e){return Array.isArray(t)?t.includes(e):t===e}function LD(t,e){const n=_x(e);return _x(t).forEach(s=>{Cy(n,s)||n.push(s)}),n}function ND(t,e){return _x(e).filter(n=>!Cy(t,n))}let zD=(()=>{class t{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(n){this._rawValidators=n||[],this._composedValidatorFn=mx(this._rawValidators)}_setAsyncValidators(n){this._rawAsyncValidators=n||[],this._composedAsyncValidatorFn=gx(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(n){this._onDestroyCallbacks.push(n)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(n=>n()),this._onDestroyCallbacks=[]}reset(n){this.control&&this.control.reset(n)}hasError(n,r){return!!this.control&&this.control.hasError(n,r)}getError(n,r){return this.control?this.control.getError(n,r):null}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275dir=Ut({type:t}),t})(),No=(()=>{class t extends zD{get formDirective(){return null}get path(){return null}}return t.\u0275fac=function(){let e;return function(r){return(e||(e=en(t)))(r||t)}}(),t.\u0275dir=Ut({type:t,features:[Dr]}),t})();class Lu extends zD{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class VD{constructor(e){this._cd=e}is(e){var n,r,s;return"submitted"===e?!!(null===(n=this._cd)||void 0===n?void 0:n.submitted):!!(null===(s=null===(r=this._cd)||void 0===r?void 0:r.control)||void 0===s?void 0:s[e])}}let BD=(()=>{class t extends VD{constructor(n){super(n)}}return t.\u0275fac=function(n){return new(n||t)(ot(Lu,2))},t.\u0275dir=Ut({type:t,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(n,r){2&n&&c_("ng-untouched",r.is("untouched"))("ng-touched",r.is("touched"))("ng-pristine",r.is("pristine"))("ng-dirty",r.is("dirty"))("ng-valid",r.is("valid"))("ng-invalid",r.is("invalid"))("ng-pending",r.is("pending"))},features:[Dr]}),t})(),UD=(()=>{class t extends VD{constructor(n){super(n)}}return t.\u0275fac=function(n){return new(n||t)(ot(No,10))},t.\u0275dir=Ut({type:t,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(n,r){2&n&&c_("ng-untouched",r.is("untouched"))("ng-touched",r.is("touched"))("ng-pristine",r.is("pristine"))("ng-dirty",r.is("dirty"))("ng-valid",r.is("valid"))("ng-invalid",r.is("invalid"))("ng-pending",r.is("pending"))("ng-submitted",r.is("submitted"))},features:[Dr]}),t})();function Vm(t,e){xx(t,e),e.valueAccessor.writeValue(t.value),function(t,e){e.valueAccessor.registerOnChange(n=>{t._pendingValue=n,t._pendingChange=!0,t._pendingDirty=!0,"change"===t.updateOn&&jD(t,e)})}(t,e),function(t,e){const n=(r,s)=>{e.valueAccessor.writeValue(r),s&&e.viewToModelUpdate(r)};t.registerOnChange(n),e._registerOnDestroy(()=>{t._unregisterOnChange(n)})}(t,e),function(t,e){e.valueAccessor.registerOnTouched(()=>{t._pendingTouched=!0,"blur"===t.updateOn&&t._pendingChange&&jD(t,e),"submit"!==t.updateOn&&t.markAsTouched()})}(t,e),function(t,e){if(e.valueAccessor.setDisabledState){const n=r=>{e.valueAccessor.setDisabledState(r)};t.registerOnDisabledChange(n),e._registerOnDestroy(()=>{t._unregisterOnDisabledChange(n)})}}(t,e)}function Ay(t,e){t.forEach(n=>{n.registerOnValidatorChange&&n.registerOnValidatorChange(e)})}function xx(t,e){const n=function(t){return t._rawValidators}(t);null!==e.validator?t.setValidators(PD(n,e.validator)):"function"==typeof n&&t.setValidators([n]);const r=function(t){return t._rawAsyncValidators}(t);null!==e.asyncValidator?t.setAsyncValidators(PD(r,e.asyncValidator)):"function"==typeof r&&t.setAsyncValidators([r]);const s=()=>t.updateValueAndValidity();Ay(e._rawValidators,s),Ay(e._rawAsyncValidators,s)}function jD(t,e){t._pendingDirty&&t.markAsDirty(),t.setValue(t._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(t._pendingValue),t._pendingChange=!1}function My(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}const Bm="VALID",Ry="INVALID",Ff="PENDING",Um="DISABLED";function Ex(t){return(Tx(t)?t.validators:t)||null}function GD(t){return Array.isArray(t)?mx(t):t||null}function Cx(t,e){return(Tx(e)?e.asyncValidators:t)||null}function qD(t){return Array.isArray(t)?gx(t):t||null}function Tx(t){return null!=t&&!Array.isArray(t)&&"object"==typeof t}class Dx{constructor(e,n){this._hasOwnPendingAsyncValidator=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=e,this._rawAsyncValidators=n,this._composedValidatorFn=GD(this._rawValidators),this._composedAsyncValidatorFn=qD(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===Bm}get invalid(){return this.status===Ry}get pending(){return this.status==Ff}get disabled(){return this.status===Um}get enabled(){return this.status!==Um}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._rawValidators=e,this._composedValidatorFn=GD(e)}setAsyncValidators(e){this._rawAsyncValidators=e,this._composedAsyncValidatorFn=qD(e)}addValidators(e){this.setValidators(LD(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(LD(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(ND(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(ND(e,this._rawAsyncValidators))}hasValidator(e){return Cy(this._rawValidators,e)}hasAsyncValidator(e){return Cy(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(n=>{n.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(n=>{n.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=Ff,!1!==e.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){const n=this._parentMarkedDirty(e.onlySelf);this.status=Um,this.errors=null,this._forEachChild(r=>{r.disable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this._updateValue(),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:n})),this._onDisabledChange.forEach(r=>r(!0))}enable(e={}){const n=this._parentMarkedDirty(e.onlySelf);this.status=Bm,this._forEachChild(r=>{r.enable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:n})),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Bm||this.status===Ff)&&this._runAsyncValidator(e.emitEvent)),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(n=>n._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Um:Bm}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=Ff,this._hasOwnPendingAsyncValidator=!0;const n=SD(this.asyncValidator(this));this._asyncValidationSubscription=n.subscribe(r=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(r,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,n={}){this.errors=e,this._updateControlsErrors(!1!==n.emitEvent)}get(e){return function(t,e,n){if(null==e||(Array.isArray(e)||(e=e.split(".")),Array.isArray(e)&&0===e.length))return null;let r=t;return e.forEach(s=>{r=r instanceof Sx?r.controls.hasOwnProperty(s)?r.controls[s]:null:r instanceof I9&&r.at(s)||null}),r}(this,e)}getError(e,n){const r=n?this.get(n):this;return r&&r.errors?r.errors[e]:null}hasError(e,n){return!!this.getError(e,n)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new xi,this.statusChanges=new xi}_calculateStatus(){return this._allControlsDisabled()?Um:this.errors?Ry:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Ff)?Ff:this._anyControlsHaveStatus(Ry)?Ry:Bm}_anyControlsHaveStatus(e){return this._anyControls(n=>n.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_isBoxedValue(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){Tx(e)&&null!=e.updateOn&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){return!e&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class ky extends Dx{constructor(e=null,n,r){super(Ex(n),Cx(r,n)),this._onChange=[],this._applyFormState(e),this._setUpdateStrategy(n),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}setValue(e,n={}){this.value=this._pendingValue=e,this._onChange.length&&!1!==n.emitModelToViewChange&&this._onChange.forEach(r=>r(this.value,!1!==n.emitViewToModelChange)),this.updateValueAndValidity(n)}patchValue(e,n={}){this.setValue(e,n)}reset(e=null,n={}){this._applyFormState(e),this.markAsPristine(n),this.markAsUntouched(n),this.setValue(this.value,n),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){My(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){My(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(e){this._isBoxedValue(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}}class Sx extends Dx{constructor(e,n,r){super(Ex(n),Cx(r,n)),this.controls=e,this._initObservables(),this._setUpdateStrategy(n),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,n){return this.controls[e]?this.controls[e]:(this.controls[e]=n,n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange),n)}addControl(e,n,r={}){this.registerControl(e,n),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(e,n={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}setControl(e,n,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],n&&this.registerControl(e,n),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,n={}){this._checkAllValuesPresent(e),Object.keys(e).forEach(r=>{this._throwIfControlMissing(r),this.controls[r].setValue(e[r],{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n)}patchValue(e,n={}){null!=e&&(Object.keys(e).forEach(r=>{this.controls[r]&&this.controls[r].patchValue(e[r],{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n))}reset(e={},n={}){this._forEachChild((r,s)=>{r.reset(e[s],{onlySelf:!0,emitEvent:n.emitEvent})}),this._updatePristine(n),this._updateTouched(n),this.updateValueAndValidity(n)}getRawValue(){return this._reduceChildren({},(e,n,r)=>(e[r]=n instanceof ky?n.value:n.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(n,r)=>!!r._syncPendingControls()||n);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_throwIfControlMissing(e){if(!Object.keys(this.controls).length)throw new Error("\n        There are no form controls registered with this group yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.controls[e])throw new Error(`Cannot find form control with name: ${e}.`)}_forEachChild(e){Object.keys(this.controls).forEach(n=>{const r=this.controls[n];r&&e(r,n)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(const n of Object.keys(this.controls)){const r=this.controls[n];if(this.contains(n)&&e(r))return!0}return!1}_reduceValue(){return this._reduceChildren({},(e,n,r)=>((n.enabled||this.disabled)&&(e[r]=n.value),e))}_reduceChildren(e,n){let r=e;return this._forEachChild((s,u)=>{r=n(r,s,u)}),r}_allControlsDisabled(){for(const e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_checkAllValuesPresent(e){this._forEachChild((n,r)=>{if(void 0===e[r])throw new Error(`Must supply a value for form control with name: '${r}'.`)})}}class I9 extends Dx{constructor(e,n,r){super(Ex(n),Cx(r,n)),this.controls=e,this._initObservables(),this._setUpdateStrategy(n),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(e){return this.controls[e]}push(e,n={}){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}insert(e,n,r={}){this.controls.splice(e,0,n),this._registerControl(n),this.updateValueAndValidity({emitEvent:r.emitEvent})}removeAt(e,n={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),this.updateValueAndValidity({emitEvent:n.emitEvent})}setControl(e,n,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),n&&(this.controls.splice(e,0,n),this._registerControl(n)),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,n={}){this._checkAllValuesPresent(e),e.forEach((r,s)=>{this._throwIfControlMissing(s),this.at(s).setValue(r,{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n)}patchValue(e,n={}){null!=e&&(e.forEach((r,s)=>{this.at(s)&&this.at(s).patchValue(r,{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n))}reset(e=[],n={}){this._forEachChild((r,s)=>{r.reset(e[s],{onlySelf:!0,emitEvent:n.emitEvent})}),this._updatePristine(n),this._updateTouched(n),this.updateValueAndValidity(n)}getRawValue(){return this.controls.map(e=>e instanceof ky?e.value:e.getRawValue())}clear(e={}){this.controls.length<1||(this._forEachChild(n=>n._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_syncPendingControls(){let e=this.controls.reduce((n,r)=>!!r._syncPendingControls()||n,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_throwIfControlMissing(e){if(!this.controls.length)throw new Error("\n        There are no form controls registered with this array yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.at(e))throw new Error(`Cannot find form control at index ${e}`)}_forEachChild(e){this.controls.forEach((n,r)=>{e(n,r)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(n=>n.enabled&&e(n))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_checkAllValuesPresent(e){this._forEachChild((n,r)=>{if(void 0===e[r])throw new Error(`Must supply a value for form control at index: ${r}.`)})}_allControlsDisabled(){for(const e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}}const M9={provide:No,useExisting:O(()=>Py)},jm=(()=>Promise.resolve(null))();let Py=(()=>{class t extends No{constructor(n,r){super(),this.submitted=!1,this._directives=[],this.ngSubmit=new xi,this.form=new Sx({},mx(n),gx(r))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(n){jm.then(()=>{const r=this._findContainer(n.path);n.control=r.registerControl(n.name,n.control),Vm(n.control,n),n.control.updateValueAndValidity({emitEvent:!1}),this._directives.push(n)})}getControl(n){return this.form.get(n.path)}removeControl(n){jm.then(()=>{const r=this._findContainer(n.path);r&&r.removeControl(n.name),My(this._directives,n)})}addFormGroup(n){jm.then(()=>{const r=this._findContainer(n.path),s=new Sx({});(function(t,e){xx(t,e)})(s,n),r.registerControl(n.name,s),s.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(n){jm.then(()=>{const r=this._findContainer(n.path);r&&r.removeControl(n.name)})}getFormGroup(n){return this.form.get(n.path)}updateModel(n,r){jm.then(()=>{this.form.get(n.path).setValue(r)})}setValue(n){this.control.setValue(n)}onSubmit(n){return this.submitted=!0,function(t,e){t._syncPendingControls(),e.forEach(n=>{const r=n.control;"submit"===r.updateOn&&r._pendingChange&&(n.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}(this.form,this._directives),this.ngSubmit.emit(n),!1}onReset(){this.resetForm()}resetForm(n){this.form.reset(n),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(n){return n.pop(),n.length?this.form.get(n):this.form}}return t.\u0275fac=function(n){return new(n||t)(ot(go,10),ot(Fu,10))},t.\u0275dir=Ut({type:t,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(n,r){1&n&&vi("submit",function(u){return r.onSubmit(u)})("reset",function(){return r.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Rr([M9]),Dr]}),t})();const k9={provide:Lu,useExisting:O(()=>Ax)},XD=(()=>Promise.resolve(null))();let Ax=(()=>{class t extends Lu{constructor(n,r,s,u){super(),this.control=new ky,this._registered=!1,this.update=new xi,this._parent=n,this._setValidators(r),this._setAsyncValidators(s),this.valueAccessor=function(t,e){if(!e)return null;let n,r,s;return Array.isArray(e),e.forEach(u=>{u.constructor===Ey?n=u:function(t){return Object.getPrototypeOf(t.constructor)===Jh}(u)?r=u:s=u}),s||r||n||null}(0,u)}ngOnChanges(n){this._checkForErrors(),this._registered||this._setUpControl(),"isDisabled"in n&&this._updateDisabled(n),function(t,e){if(!t.hasOwnProperty("model"))return!1;const n=t.model;return!!n.isFirstChange()||!Object.is(e,n.currentValue)}(n,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._parent?function(t,e){return[...e.path,t]}(this.name,this._parent):[this.name]}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(n){this.viewModel=n,this.update.emit(n)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){Vm(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(n){XD.then(()=>{this.control.setValue(n,{emitViewToModelChange:!1})})}_updateDisabled(n){const r=n.isDisabled.currentValue,s=""===r||r&&"false"!==r;XD.then(()=>{s&&!this.control.disabled?this.control.disable():!s&&this.control.disabled&&this.control.enable()})}}return t.\u0275fac=function(n){return new(n||t)(ot(No,9),ot(go,10),ot(Fu,10),ot(Il,10))},t.\u0275dir=Ut({type:t,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Rr([k9]),Dr,Lr]}),t})(),KD=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275dir=Ut({type:t,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]}),t})(),QD=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=dr({type:t}),t.\u0275inj=Qr({}),t})(),mS=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=dr({type:t}),t.\u0275inj=Qr({imports:[[QD]]}),t})(),n5=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=dr({type:t}),t.\u0275inj=Qr({imports:[mS]}),t})(),r5=(()=>{class t{constructor(n){this.router=n}ngOnInit(){}login(n){console.log(n.value),"sudo"===n.value.email&&"22001"===n.value.contrasena&&(localStorage.setItem("email",n.value.email),this.router.navigate(["/unidades"]))}}return t.\u0275fac=function(n){return new(n||t)(ot(Zi))},t.\u0275cmp=fs({type:t,selectors:[["app-login"]],decls:25,vars:0,consts:[["href","https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css","rel","stylesheet","integrity","sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3","crossorigin","anonymous"],["href","//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css","rel","stylesheet","id","bootstrap-css"],[1,"sidenav"],[1,"login-main-text"],[1,"main"],[1,"col-md-6","col-sm-12"],[1,"login-form"],[3,"ngSubmit"],["loginform","ngForm"],[1,"form-group"],["type","text","name","email","id","email","placeholder","email","ngModel","",1,"form-control"],["type","password","name","contrasena","id","password","placeholder","Password","ngModel","",1,"form-control"],["type","submit",1,"btn","btn-black"]],template:function(n,r){if(1&n){const s=tt();_n(0,"link",0),_n(1,"link",1),at(2,"div",2),at(3,"div",3),at(4,"h2"),bn(5,"Gestiona"),_n(6,"br"),bn(7,"Tu tiempo"),lt(),at(8,"p"),bn(9,"Sistema de Geolocalizacion en buses Urbanos de Jutiapa"),lt(),lt(),lt(),at(10,"div",4),at(11,"div",5),at(12,"div",6),at(13,"form",7,8),vi("ngSubmit",function(){!function(t){Ht.lFrame.contextLView=t}(s);const m=function(t){return function(t,e){return t[e]}(Ht.lFrame.contextLView,20+t)}(14);return r.login(m)}),at(15,"div",9),at(16,"label"),bn(17,"Usurio"),lt(),_n(18,"input",10),lt(),at(19,"div",9),at(20,"label"),bn(21,"Contrase\xf1a"),lt(),_n(22,"input",11),lt(),at(23,"button",12),bn(24,"Aceptar"),lt(),lt(),lt(),lt(),lt()}},directives:[KD,UD,Py,Ey,BD,Ax],styles:['body[_ngcontent-%COMP%]{font-family:"Lato",sans-serif}.main-head[_ngcontent-%COMP%]{height:150px;background:#FFF}.sidenav[_ngcontent-%COMP%]{height:100%;background-color:#000;overflow-x:hidden;padding-top:20px}.main[_ngcontent-%COMP%]{padding:0 10px}@media screen and (max-height: 450px){.sidenav[_ngcontent-%COMP%]{padding-top:15px}}@media screen and (max-width: 450px){.login-form[_ngcontent-%COMP%]{margin-top:10%}.register-form[_ngcontent-%COMP%]{margin-top:10%}}@media screen and (min-width: 768px){.main[_ngcontent-%COMP%]{margin-left:40%}.sidenav[_ngcontent-%COMP%]{width:40%;position:fixed;z-index:1;top:0;left:0}.login-form[_ngcontent-%COMP%]{margin-top:80%}.register-form[_ngcontent-%COMP%]{margin-top:20%}}.login-main-text[_ngcontent-%COMP%]{margin-top:20%;padding:60px;color:#fff}.login-main-text[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-weight:300}']}),t})();var Sr=fe(958),i5=fe(763),o5=fe.n(i5);class _S{}class yS{}class Ic{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?this.lazyInit="string"==typeof e?()=>{this.headers=new Map,e.split("\n").forEach(n=>{const r=n.indexOf(":");if(r>0){const s=n.slice(0,r),u=s.toLowerCase(),m=n.slice(r+1).trim();this.maybeSetNormalizedName(s,u),this.headers.has(u)?this.headers.get(u).push(m):this.headers.set(u,[m])}})}:()=>{this.headers=new Map,Object.keys(e).forEach(n=>{let r=e[n];const s=n.toLowerCase();"string"==typeof r&&(r=[r]),r.length>0&&(this.headers.set(s,r),this.maybeSetNormalizedName(n,s))})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();const n=this.headers.get(e.toLowerCase());return n&&n.length>0?n[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,n){return this.clone({name:e,value:n,op:"a"})}set(e,n){return this.clone({name:e,value:n,op:"s"})}delete(e,n){return this.clone({name:e,value:n,op:"d"})}maybeSetNormalizedName(e,n){this.normalizedNames.has(n)||this.normalizedNames.set(n,e)}init(){this.lazyInit&&(this.lazyInit instanceof Ic?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(n=>{this.headers.set(n,e.headers.get(n)),this.normalizedNames.set(n,e.normalizedNames.get(n))})}clone(e){const n=new Ic;return n.lazyInit=this.lazyInit&&this.lazyInit instanceof Ic?this.lazyInit:this,n.lazyUpdate=(this.lazyUpdate||[]).concat([e]),n}applyUpdate(e){const n=e.name.toLowerCase();switch(e.op){case"a":case"s":let r=e.value;if("string"==typeof r&&(r=[r]),0===r.length)return;this.maybeSetNormalizedName(e.name,n);const s=("a"===e.op?this.headers.get(n):void 0)||[];s.push(...r),this.headers.set(n,s);break;case"d":const u=e.value;if(u){let m=this.headers.get(n);if(!m)return;m=m.filter(v=>-1===u.indexOf(v)),0===m.length?(this.headers.delete(n),this.normalizedNames.delete(n)):this.headers.set(n,m)}else this.headers.delete(n),this.normalizedNames.delete(n)}}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(n=>e(this.normalizedNames.get(n),this.headers.get(n)))}}class s5{encodeKey(e){return vS(e)}encodeValue(e){return vS(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}}const l5=/%(\d[a-f0-9])/gi,c5={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function vS(t){return encodeURIComponent(t).replace(l5,(e,n)=>{var r;return null!==(r=c5[n])&&void 0!==r?r:e})}function xS(t){return`${t}`}class Nu{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new s5,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function(t,e){const n=new Map;return t.length>0&&t.replace(/^\?/,"").split("&").forEach(s=>{const u=s.indexOf("="),[m,v]=-1==u?[e.decodeKey(s),""]:[e.decodeKey(s.slice(0,u)),e.decodeValue(s.slice(u+1))],E=n.get(m)||[];E.push(v),n.set(m,E)}),n}(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(n=>{const r=e.fromObject[n];this.map.set(n,Array.isArray(r)?r:[r])})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();const n=this.map.get(e);return n?n[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,n){return this.clone({param:e,value:n,op:"a"})}appendAll(e){const n=[];return Object.keys(e).forEach(r=>{const s=e[r];Array.isArray(s)?s.forEach(u=>{n.push({param:r,value:u,op:"a"})}):n.push({param:r,value:s,op:"a"})}),this.clone(n)}set(e,n){return this.clone({param:e,value:n,op:"s"})}delete(e,n){return this.clone({param:e,value:n,op:"d"})}toString(){return this.init(),this.keys().map(e=>{const n=this.encoder.encodeKey(e);return this.map.get(e).map(r=>n+"="+this.encoder.encodeValue(r)).join("&")}).filter(e=>""!==e).join("&")}clone(e){const n=new Nu({encoder:this.encoder});return n.cloneFrom=this.cloneFrom||this,n.updates=(this.updates||[]).concat(e),n}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":const n=("a"===e.op?this.map.get(e.param):void 0)||[];n.push(xS(e.value)),this.map.set(e.param,n);break;case"d":if(void 0===e.value){this.map.delete(e.param);break}{let r=this.map.get(e.param)||[];const s=r.indexOf(xS(e.value));-1!==s&&r.splice(s,1),r.length>0?this.map.set(e.param,r):this.map.delete(e.param)}}}),this.cloneFrom=this.updates=null)}}class u5{constructor(){this.map=new Map}set(e,n){return this.map.set(e,n),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}keys(){return this.map.keys()}}function bS(t){return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer}function wS(t){return"undefined"!=typeof Blob&&t instanceof Blob}function ES(t){return"undefined"!=typeof FormData&&t instanceof FormData}class $m{constructor(e,n,r,s){let u;if(this.url=n,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase(),function(t){switch(t){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||s?(this.body=void 0!==r?r:null,u=s):u=r,u&&(this.reportProgress=!!u.reportProgress,this.withCredentials=!!u.withCredentials,u.responseType&&(this.responseType=u.responseType),u.headers&&(this.headers=u.headers),u.context&&(this.context=u.context),u.params&&(this.params=u.params)),this.headers||(this.headers=new Ic),this.context||(this.context=new u5),this.params){const m=this.params.toString();if(0===m.length)this.urlWithParams=n;else{const v=n.indexOf("?");this.urlWithParams=n+(-1===v?"?":v<n.length-1?"&":"")+m}}else this.params=new Nu,this.urlWithParams=n}serializeBody(){return null===this.body?null:bS(this.body)||wS(this.body)||ES(this.body)||function(t){return"undefined"!=typeof URLSearchParams&&t instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Nu?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||ES(this.body)?null:wS(this.body)?this.body.type||null:bS(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Nu?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(e={}){var n;const r=e.method||this.method,s=e.url||this.url,u=e.responseType||this.responseType,m=void 0!==e.body?e.body:this.body,v=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,E=void 0!==e.reportProgress?e.reportProgress:this.reportProgress;let S=e.headers||this.headers,P=e.params||this.params;const V=null!==(n=e.context)&&void 0!==n?n:this.context;return void 0!==e.setHeaders&&(S=Object.keys(e.setHeaders).reduce((j,G)=>j.set(G,e.setHeaders[G]),S)),e.setParams&&(P=Object.keys(e.setParams).reduce((j,G)=>j.set(G,e.setParams[G]),P)),new $m(r,s,m,{params:P,headers:S,context:V,reportProgress:E,responseType:u,withCredentials:v})}}var Ci=(()=>((Ci=Ci||{})[Ci.Sent=0]="Sent",Ci[Ci.UploadProgress=1]="UploadProgress",Ci[Ci.ResponseHeader=2]="ResponseHeader",Ci[Ci.DownloadProgress=3]="DownloadProgress",Ci[Ci.Response=4]="Response",Ci[Ci.User=5]="User",Ci))();class Lx{constructor(e,n=200,r="OK"){this.headers=e.headers||new Ic,this.status=void 0!==e.status?e.status:n,this.statusText=e.statusText||r,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}}class Nx extends Lx{constructor(e={}){super(e),this.type=Ci.ResponseHeader}clone(e={}){return new Nx({headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class Fy extends Lx{constructor(e={}){super(e),this.type=Ci.Response,this.body=void 0!==e.body?e.body:null}clone(e={}){return new Fy({body:void 0!==e.body?e.body:this.body,headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class CS extends Lx{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${e.url||"(unknown url)"}`:`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}}function zx(t,e){return{body:e,headers:t.headers,context:t.context,observe:t.observe,params:t.params,reportProgress:t.reportProgress,responseType:t.responseType,withCredentials:t.withCredentials}}let TS=(()=>{class t{constructor(n){this.handler=n}request(n,r,s={}){let u;if(n instanceof $m)u=n;else{let E,S;E=s.headers instanceof Ic?s.headers:new Ic(s.headers),s.params&&(S=s.params instanceof Nu?s.params:new Nu({fromObject:s.params})),u=new $m(n,r,void 0!==s.body?s.body:null,{headers:E,context:s.context,params:S,reportProgress:s.reportProgress,responseType:s.responseType||"json",withCredentials:s.withCredentials})}const m=hn(u).pipe(If(E=>this.handler.handle(E)));if(n instanceof $m||"events"===s.observe)return m;const v=m.pipe(qh(E=>E instanceof Fy));switch(s.observe||"body"){case"body":switch(u.responseType){case"arraybuffer":return v.pipe(Pt(E=>{if(null!==E.body&&!(E.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return E.body}));case"blob":return v.pipe(Pt(E=>{if(null!==E.body&&!(E.body instanceof Blob))throw new Error("Response is not a Blob.");return E.body}));case"text":return v.pipe(Pt(E=>{if(null!==E.body&&"string"!=typeof E.body)throw new Error("Response is not a string.");return E.body}));case"json":default:return v.pipe(Pt(E=>E.body))}case"response":return v;default:throw new Error(`Unreachable: unhandled observe type ${s.observe}}`)}}delete(n,r={}){return this.request("DELETE",n,r)}get(n,r={}){return this.request("GET",n,r)}head(n,r={}){return this.request("HEAD",n,r)}jsonp(n,r){return this.request("JSONP",n,{params:(new Nu).append(r,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(n,r={}){return this.request("OPTIONS",n,r)}patch(n,r,s={}){return this.request("PATCH",n,zx(s,r))}post(n,r,s={}){return this.request("POST",n,zx(s,r))}put(n,r,s={}){return this.request("PUT",n,zx(s,r))}}return t.\u0275fac=function(n){return new(n||t)(_t(_S))},t.\u0275prov=kt({token:t,factory:t.\u0275fac}),t})();class DS{constructor(e,n){this.next=e,this.interceptor=n}handle(e){return this.interceptor.intercept(e,this.next)}}const SS=new un("HTTP_INTERCEPTORS");let f5=(()=>{class t{intercept(n,r){return r.handle(n)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=kt({token:t,factory:t.\u0275fac}),t})();const p5=/^\)\]\}',?\n/;let AS=(()=>{class t{constructor(n){this.xhrFactory=n}handle(n){if("JSONP"===n.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new Dt(r=>{const s=this.xhrFactory.build();if(s.open(n.method,n.urlWithParams),n.withCredentials&&(s.withCredentials=!0),n.headers.forEach((G,se)=>s.setRequestHeader(G,se.join(","))),n.headers.has("Accept")||s.setRequestHeader("Accept","application/json, text/plain, */*"),!n.headers.has("Content-Type")){const G=n.detectContentTypeHeader();null!==G&&s.setRequestHeader("Content-Type",G)}if(n.responseType){const G=n.responseType.toLowerCase();s.responseType="json"!==G?G:"text"}const u=n.serializeBody();let m=null;const v=()=>{if(null!==m)return m;const G=1223===s.status?204:s.status,se=s.statusText||"OK",Re=new Ic(s.getAllResponseHeaders()),be=function(t){return"responseURL"in t&&t.responseURL?t.responseURL:/^X-Request-URL:/m.test(t.getAllResponseHeaders())?t.getResponseHeader("X-Request-URL"):null}(s)||n.url;return m=new Nx({headers:Re,status:G,statusText:se,url:be}),m},E=()=>{let{headers:G,status:se,statusText:Re,url:be}=v(),qe=null;204!==se&&(qe=void 0===s.response?s.responseText:s.response),0===se&&(se=qe?200:0);let Ue=se>=200&&se<300;if("json"===n.responseType&&"string"==typeof qe){const Tt=qe;qe=qe.replace(p5,"");try{qe=""!==qe?JSON.parse(qe):null}catch(Nt){qe=Tt,Ue&&(Ue=!1,qe={error:Nt,text:qe})}}Ue?(r.next(new Fy({body:qe,headers:G,status:se,statusText:Re,url:be||void 0})),r.complete()):r.error(new CS({error:qe,headers:G,status:se,statusText:Re,url:be||void 0}))},S=G=>{const{url:se}=v(),Re=new CS({error:G,status:s.status||0,statusText:s.statusText||"Unknown Error",url:se||void 0});r.error(Re)};let P=!1;const V=G=>{P||(r.next(v()),P=!0);let se={type:Ci.DownloadProgress,loaded:G.loaded};G.lengthComputable&&(se.total=G.total),"text"===n.responseType&&!!s.responseText&&(se.partialText=s.responseText),r.next(se)},j=G=>{let se={type:Ci.UploadProgress,loaded:G.loaded};G.lengthComputable&&(se.total=G.total),r.next(se)};return s.addEventListener("load",E),s.addEventListener("error",S),s.addEventListener("timeout",S),s.addEventListener("abort",S),n.reportProgress&&(s.addEventListener("progress",V),null!==u&&s.upload&&s.upload.addEventListener("progress",j)),s.send(u),r.next({type:Ci.Sent}),()=>{s.removeEventListener("error",S),s.removeEventListener("abort",S),s.removeEventListener("load",E),s.removeEventListener("timeout",S),n.reportProgress&&(s.removeEventListener("progress",V),null!==u&&s.upload&&s.upload.removeEventListener("progress",j)),s.readyState!==s.DONE&&s.abort()}})}}return t.\u0275fac=function(n){return new(n||t)(_t(K2))},t.\u0275prov=kt({token:t,factory:t.\u0275fac}),t})();const Vx=new un("XSRF_COOKIE_NAME"),Bx=new un("XSRF_HEADER_NAME");class IS{}let g5=(()=>{class t{constructor(n,r,s){this.doc=n,this.platform=r,this.cookieName=s,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const n=this.doc.cookie||"";return n!==this.lastCookieString&&(this.parseCount++,this.lastToken=j2(n,this.cookieName),this.lastCookieString=n),this.lastToken}}return t.\u0275fac=function(n){return new(n||t)(_t(qi),_t(M_),_t(Vx))},t.\u0275prov=kt({token:t,factory:t.\u0275fac}),t})(),Ux=(()=>{class t{constructor(n,r){this.tokenService=n,this.headerName=r}intercept(n,r){const s=n.url.toLowerCase();if("GET"===n.method||"HEAD"===n.method||s.startsWith("http://")||s.startsWith("https://"))return r.handle(n);const u=this.tokenService.getToken();return null!==u&&!n.headers.has(this.headerName)&&(n=n.clone({headers:n.headers.set(this.headerName,u)})),r.handle(n)}}return t.\u0275fac=function(n){return new(n||t)(_t(IS),_t(Bx))},t.\u0275prov=kt({token:t,factory:t.\u0275fac}),t})(),_5=(()=>{class t{constructor(n,r){this.backend=n,this.injector=r,this.chain=null}handle(n){if(null===this.chain){const r=this.injector.get(SS,[]);this.chain=r.reduceRight((s,u)=>new DS(s,u),this.backend)}return this.chain.handle(n)}}return t.\u0275fac=function(n){return new(n||t)(_t(yS),_t(nr))},t.\u0275prov=kt({token:t,factory:t.\u0275fac}),t})(),y5=(()=>{class t{static disable(){return{ngModule:t,providers:[{provide:Ux,useClass:f5}]}}static withOptions(n={}){return{ngModule:t,providers:[n.cookieName?{provide:Vx,useValue:n.cookieName}:[],n.headerName?{provide:Bx,useValue:n.headerName}:[]]}}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=dr({type:t}),t.\u0275inj=Qr({providers:[Ux,{provide:SS,useExisting:Ux,multi:!0},{provide:IS,useClass:g5},{provide:Vx,useValue:"XSRF-TOKEN"},{provide:Bx,useValue:"X-XSRF-TOKEN"}]}),t})(),v5=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=dr({type:t}),t.\u0275inj=Qr({providers:[TS,{provide:_S,useClass:_5},AS,{provide:yS,useExisting:AS}],imports:[[y5.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),t})();var jx=fe(171),b5=fe(966);const zu="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function MS(t){const e=t.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!e||b5))return new XMLHttpRequest}catch(n){}if(!e)try{return new(zu[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(n){}}function RS(t,...e){return e.reduce((n,r)=>(t.hasOwnProperty(r)&&(n[r]=t[r]),n),{})}const w5=setTimeout,E5=clearTimeout;function Oy(t,e){e.useNativeTimers?(t.setTimeoutFn=w5.bind(zu),t.clearTimeoutFn=E5.bind(zu)):(t.setTimeoutFn=setTimeout.bind(zu),t.clearTimeoutFn=clearTimeout.bind(zu))}var Of=fe(573);const Ml=Object.create(null);Ml.open="0",Ml.close="1",Ml.ping="2",Ml.pong="3",Ml.message="4",Ml.upgrade="5",Ml.noop="6";const Ly=Object.create(null);Object.keys(Ml).forEach(t=>{Ly[Ml[t]]=t});const C5={type:"error",data:"parser error"},T5="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),D5="function"==typeof ArrayBuffer,kS=(t,e)=>{const n=new FileReader;return n.onload=function(){const r=n.result.split(",")[1];e("b"+r)},n.readAsDataURL(t)},PS=({type:t,data:e},n,r)=>T5&&e instanceof Blob?n?r(e):kS(e,r):D5&&(e instanceof ArrayBuffer||(t=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer)(e))?n?r(e):kS(new Blob([e]),r):r(Ml[t]+(e||""));for(var Lf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Hm="undefined"==typeof Uint8Array?[]:new Uint8Array(256),Ny=0;Ny<Lf.length;Ny++)Hm[Lf.charCodeAt(Ny)]=Ny;const M5="function"==typeof ArrayBuffer,k5=(t,e)=>{if(M5){const n=function(t){var r,u,m,v,E,e=.75*t.length,n=t.length,s=0;"="===t[t.length-1]&&(e--,"="===t[t.length-2]&&e--);var S=new ArrayBuffer(e),P=new Uint8Array(S);for(r=0;r<n;r+=4)u=Hm[t.charCodeAt(r)],m=Hm[t.charCodeAt(r+1)],v=Hm[t.charCodeAt(r+2)],E=Hm[t.charCodeAt(r+3)],P[s++]=u<<2|m>>4,P[s++]=(15&m)<<4|v>>2,P[s++]=(3&v)<<6|63&E;return S}(t);return FS(n,e)}return{base64:!0,data:t}},FS=(t,e)=>{switch(e){case"blob":return t instanceof ArrayBuffer?new Blob([t]):t;case"arraybuffer":default:return t}},OS=(t,e)=>{if("string"!=typeof t)return{type:"message",data:FS(t,e)};const n=t.charAt(0);return"b"===n?{type:"message",data:k5(t.substring(1),e)}:Ly[n]?t.length>1?{type:Ly[n],data:t.substring(1)}:{type:Ly[n]}:C5},LS=String.fromCharCode(30);class zS extends Of.Q{constructor(e){super(),this.writable=!1,Oy(this,e),this.opts=e,this.query=e.query,this.readyState="",this.socket=e.socket}onError(e,n){const r=new Error(e);return r.type="TransportError",r.description=n,super.emit("error",r),this}open(){return("closed"===this.readyState||""===this.readyState)&&(this.readyState="opening",this.doOpen()),this}close(){return("opening"===this.readyState||"open"===this.readyState)&&(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emit("open")}onData(e){const n=OS(e,this.socket.binaryType);this.onPacket(n)}onPacket(e){super.emit("packet",e)}onClose(){this.readyState="closed",super.emit("close")}}var VS=fe(391),$x=fe(603);class O5 extends zS{constructor(){super(...arguments),this.polling=!1}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const n=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let r=0;this.polling&&(r++,this.once("pollComplete",function(){--r||n()})),this.writable||(r++,this.once("drain",function(){--r||n()}))}else n()}poll(){this.polling=!0,this.doPoll(),this.emit("poll")}onData(e){((t,e)=>{const n=t.split(LS),r=[];for(let s=0;s<n.length;s++){const u=OS(n[s],e);if(r.push(u),"error"===u.type)break}return r})(e,this.socket.binaryType).forEach(r=>{if("opening"===this.readyState&&"open"===r.type&&this.onOpen(),"close"===r.type)return this.onClose(),!1;this.onPacket(r)}),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((t,e)=>{const n=t.length,r=new Array(n);let s=0;t.forEach((u,m)=>{PS(u,!1,v=>{r[m]=v,++s===n&&e(r.join(LS))})})})(e,n=>{this.doWrite(n,()=>{this.writable=!0,this.emit("drain")})})}uri(){let e=this.query||{};const n=this.opts.secure?"https":"http";let r="";!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=VS()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.opts.port&&("https"===n&&443!==Number(this.opts.port)||"http"===n&&80!==Number(this.opts.port))&&(r=":"+this.opts.port);const s=$x.encode(e);return n+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(s.length?"?"+s:"")}}function L5(){}const N5=null!=new MS({xdomain:!1}).responseType;let zy=(()=>{class t extends Of.Q{constructor(n,r){super(),Oy(this,r),this.opts=r,this.method=r.method||"GET",this.uri=n,this.async=!1!==r.async,this.data=void 0!==r.data?r.data:null,this.create()}create(){const n=RS(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this.opts.xd,n.xscheme=!!this.opts.xs;const r=this.xhr=new MS(n);try{r.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let s in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(s)&&r.setRequestHeader(s,this.opts.extraHeaders[s])}}catch(s){}if("POST"===this.method)try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(s){}try{r.setRequestHeader("Accept","*/*")}catch(s){}"withCredentials"in r&&(r.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(r.timeout=this.opts.requestTimeout),r.onreadystatechange=()=>{4===r.readyState&&(200===r.status||1223===r.status?this.onLoad():this.setTimeoutFn(()=>{this.onError("number"==typeof r.status?r.status:0)},0))},r.send(this.data)}catch(s){return void this.setTimeoutFn(()=>{this.onError(s)},0)}"undefined"!=typeof document&&(this.index=t.requestsCount++,t.requests[this.index]=this)}onSuccess(){this.emit("success"),this.cleanup()}onData(n){this.emit("data",n),this.onSuccess()}onError(n){this.emit("error",n),this.cleanup(!0)}cleanup(n){if(null!=this.xhr){if(this.xhr.onreadystatechange=L5,n)try{this.xhr.abort()}catch(r){}"undefined"!=typeof document&&delete t.requests[this.index],this.xhr=null}}onLoad(){const n=this.xhr.responseText;null!==n&&this.onData(n)}abort(){this.cleanup()}}return t.requestsCount=0,t.requests={},t})();function BS(){for(let t in zy.requests)zy.requests.hasOwnProperty(t)&&zy.requests[t].abort()}"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",BS):"function"==typeof addEventListener&&addEventListener("onpagehide"in zu?"pagehide":"unload",BS,!1));const V5="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,n)=>n(e,0),Gm=zu.WebSocket||zu.MozWebSocket,US="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class Gx extends zS{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),n=this.opts.protocols,r=US?{}:RS(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=US?new Gm(e,n,r):n?new Gm(e,n):new Gm(e)}catch(s){return this.emit("error",s)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=this.onClose.bind(this),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let n=0;n<e.length;n++){const s=n===e.length-1;PS(e[n],this.supportsBinary,u=>{try{this.ws.send(u)}catch(v){}s&&V5(()=>{this.writable=!0,this.emit("drain")},this.setTimeoutFn)})}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const n=this.opts.secure?"wss":"ws";let r="";this.opts.port&&("wss"===n&&443!==Number(this.opts.port)||"ws"===n&&80!==Number(this.opts.port))&&(r=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=VS()),this.supportsBinary||(e.b64=1);const s=$x.encode(e);return n+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+r+this.opts.path+(s.length?"?"+s:"")}check(){return!(!Gm||"__initialize"in Gm&&this.name===Gx.prototype.name)}}const U5={websocket:Gx,polling:class extends O5{constructor(e){if(super(e),"undefined"!=typeof location){const r="https:"===location.protocol;let s=location.port;s||(s=r?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||s!==e.port,this.xs=e.secure!==r}this.supportsBinary=N5&&!(e&&e.forceBase64)}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new zy(this.uri(),e)}doWrite(e,n){const r=this.request({method:"POST",data:e});r.on("success",n),r.on("error",s=>{this.onError("xhr post error",s)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",n=>{this.onError("xhr poll error",n)}),this.pollXhr=e}}};let jS=(()=>{class t extends Of.Q{constructor(n,r={}){super(),n&&"object"==typeof n&&(r=n,n=null),n?(n=jx(n),r.hostname=n.host,r.secure="https"===n.protocol||"wss"===n.protocol,r.port=n.port,n.query&&(r.query=n.query)):r.host&&(r.hostname=jx(r.host).host),Oy(this,r),this.secure=null!=r.secure?r.secure:"undefined"!=typeof location&&"https:"===location.protocol,r.hostname&&!r.port&&(r.port=this.secure?"443":"80"),this.hostname=r.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=r.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=r.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},r),this.opts.path=this.opts.path.replace(/\/$/,"")+"/","string"==typeof this.opts.query&&(this.opts.query=$x.decode(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&addEventListener("beforeunload",()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},!1),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close")},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(n){const r=function(t){const e={};for(let n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}(this.opts.query);r.EIO=4,r.transport=n,this.id&&(r.sid=this.id);const s=Object.assign({},this.opts.transportOptions[n],this.opts,{query:r,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new U5[n](s)}open(){let n;if(this.opts.rememberUpgrade&&t.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))n="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);n=this.transports[0]}this.readyState="opening";try{n=this.createTransport(n)}catch(r){return this.transports.shift(),void this.open()}n.open(),this.setTransport(n)}setTransport(n){this.transport&&this.transport.removeAllListeners(),this.transport=n,n.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",()=>{this.onClose("transport close")})}probe(n){let r=this.createTransport(n),s=!1;t.priorWebsocketSuccess=!1;const u=()=>{s||(r.send([{type:"ping",data:"probe"}]),r.once("packet",j=>{if(!s)if("pong"===j.type&&"probe"===j.data){if(this.upgrading=!0,this.emitReserved("upgrading",r),!r)return;t.priorWebsocketSuccess="websocket"===r.name,this.transport.pause(()=>{s||"closed"!==this.readyState&&(V(),this.setTransport(r),r.send([{type:"upgrade"}]),this.emitReserved("upgrade",r),r=null,this.upgrading=!1,this.flush())})}else{const G=new Error("probe error");G.transport=r.name,this.emitReserved("upgradeError",G)}}))};function m(){s||(s=!0,V(),r.close(),r=null)}const v=j=>{const G=new Error("probe error: "+j);G.transport=r.name,m(),this.emitReserved("upgradeError",G)};function E(){v("transport closed")}function S(){v("socket closed")}function P(j){r&&j.name!==r.name&&m()}const V=()=>{r.removeListener("open",u),r.removeListener("error",v),r.removeListener("close",E),this.off("close",S),this.off("upgrading",P)};r.once("open",u),r.once("error",v),r.once("close",E),this.once("close",S),this.once("upgrading",P),r.open()}onOpen(){if(this.readyState="open",t.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause){let n=0;const r=this.upgrades.length;for(;n<r;n++)this.probe(this.upgrades[n])}}onPacket(n){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",n),this.emitReserved("heartbeat"),n.type){case"open":this.onHandshake(JSON.parse(n.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const r=new Error("server error");r.code=n.data,this.onError(r);break;case"message":this.emitReserved("data",n.data),this.emitReserved("message",n.data)}}onHandshake(n){this.emitReserved("handshake",n),this.id=n.sid,this.transport.query.sid=n.sid,this.upgrades=this.filterUpgrades(n.upgrades),this.pingInterval=n.pingInterval,this.pingTimeout=n.pingTimeout,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emitReserved("flush"))}write(n,r,s){return this.sendPacket("message",n,r,s),this}send(n,r,s){return this.sendPacket("message",n,r,s),this}sendPacket(n,r,s,u){if("function"==typeof r&&(u=r,r=void 0),"function"==typeof s&&(u=s,s=null),"closing"===this.readyState||"closed"===this.readyState)return;(s=s||{}).compress=!1!==s.compress;const m={type:n,data:r,options:s};this.emitReserved("packetCreate",m),this.writeBuffer.push(m),u&&this.once("flush",u),this.flush()}close(){const n=()=>{this.onClose("forced close"),this.transport.close()},r=()=>{this.off("upgrade",r),this.off("upgradeError",r),n()},s=()=>{this.once("upgrade",r),this.once("upgradeError",r)};return("opening"===this.readyState||"open"===this.readyState)&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?s():n()}):this.upgrading?s():n()),this}onError(n){t.priorWebsocketSuccess=!1,this.emitReserved("error",n),this.onClose("transport error",n)}onClose(n,r){("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emitReserved("close",n,r),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(n){const r=[];let s=0;const u=n.length;for(;s<u;s++)~this.transports.indexOf(n[s])&&r.push(n[s]);return r}}return t.protocol=4,t})();const $5="function"==typeof ArrayBuffer,$S=Object.prototype.toString,G5="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===$S.call(Blob),q5="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===$S.call(File);function qx(t){return $5&&(t instanceof ArrayBuffer||(t=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer)(t))||G5&&t instanceof Blob||q5&&t instanceof File}function Vy(t,e){if(!t||"object"!=typeof t)return!1;if(Array.isArray(t)){for(let n=0,r=t.length;n<r;n++)if(Vy(t[n]))return!0;return!1}if(qx(t))return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return Vy(t.toJSON(),!0);for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&Vy(t[n]))return!0;return!1}function Z5(t){const e=[],r=t;return r.data=Zx(t.data,e),r.attachments=e.length,{packet:r,buffers:e}}function Zx(t,e){if(!t)return t;if(qx(t)){const n={_placeholder:!0,num:e.length};return e.push(t),n}if(Array.isArray(t)){const n=new Array(t.length);for(let r=0;r<t.length;r++)n[r]=Zx(t[r],e);return n}if("object"==typeof t&&!(t instanceof Date)){const n={};for(const r in t)t.hasOwnProperty(r)&&(n[r]=Zx(t[r],e));return n}return t}function W5(t,e){return t.data=Wx(t.data,e),t.attachments=void 0,t}function Wx(t,e){if(!t)return t;if(t&&t._placeholder)return e[t.num];if(Array.isArray(t))for(let n=0;n<t.length;n++)t[n]=Wx(t[n],e);else if("object"==typeof t)for(const n in t)t.hasOwnProperty(n)&&(t[n]=Wx(t[n],e));return t}const HS=5;var Nn=(()=>(function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"}(Nn||(Nn={})),Nn))();class X5{encode(e){return e.type!==Nn.EVENT&&e.type!==Nn.ACK||!Vy(e)?[this.encodeAsString(e)]:(e.type=e.type===Nn.EVENT?Nn.BINARY_EVENT:Nn.BINARY_ACK,this.encodeAsBinary(e))}encodeAsString(e){let n=""+e.type;return(e.type===Nn.BINARY_EVENT||e.type===Nn.BINARY_ACK)&&(n+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(n+=e.nsp+","),null!=e.id&&(n+=e.id),null!=e.data&&(n+=JSON.stringify(e.data)),n}encodeAsBinary(e){const n=Z5(e),r=this.encodeAsString(n.packet),s=n.buffers;return s.unshift(r),s}}class Xx extends Of.Q{constructor(){super()}add(e){let n;if("string"==typeof e)n=this.decodeString(e),n.type===Nn.BINARY_EVENT||n.type===Nn.BINARY_ACK?(this.reconstructor=new Y5(n),0===n.attachments&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n);else{if(!qx(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");n=this.reconstructor.takeBinaryData(e),n&&(this.reconstructor=null,super.emitReserved("decoded",n))}}decodeString(e){let n=0;const r={type:Number(e.charAt(0))};if(void 0===Nn[r.type])throw new Error("unknown packet type "+r.type);if(r.type===Nn.BINARY_EVENT||r.type===Nn.BINARY_ACK){const u=n+1;for(;"-"!==e.charAt(++n)&&n!=e.length;);const m=e.substring(u,n);if(m!=Number(m)||"-"!==e.charAt(n))throw new Error("Illegal attachments");r.attachments=Number(m)}if("/"===e.charAt(n+1)){const u=n+1;for(;++n&&","!==e.charAt(n)&&n!==e.length;);r.nsp=e.substring(u,n)}else r.nsp="/";const s=e.charAt(n+1);if(""!==s&&Number(s)==s){const u=n+1;for(;++n;){const m=e.charAt(n);if(null==m||Number(m)!=m){--n;break}if(n===e.length)break}r.id=Number(e.substring(u,n+1))}if(e.charAt(++n)){const u=function(t){try{return JSON.parse(t)}catch(e){return!1}}(e.substr(n));if(!Xx.isPayloadValid(r.type,u))throw new Error("invalid payload");r.data=u}return r}static isPayloadValid(e,n){switch(e){case Nn.CONNECT:return"object"==typeof n;case Nn.DISCONNECT:return void 0===n;case Nn.CONNECT_ERROR:return"string"==typeof n||"object"==typeof n;case Nn.EVENT:case Nn.BINARY_EVENT:return Array.isArray(n)&&n.length>0;case Nn.ACK:case Nn.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}class Y5{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const n=W5(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function $a(t,e,n){return t.on(e,n),function(){t.off(e,n)}}const Q5=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Kx extends Of.Q{constructor(e,n,r){super(),this.connected=!1,this.disconnected=!0,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=n,r&&r.auth&&(this.auth=r.auth),this.io._autoConnect&&this.open()}subEvents(){if(this.subs)return;const e=this.io;this.subs=[$a(e,"open",this.onopen.bind(this)),$a(e,"packet",this.onpacket.bind(this)),$a(e,"error",this.onerror.bind(this)),$a(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...n){if(Q5.hasOwnProperty(e))throw new Error('"'+e+'" is a reserved event name');n.unshift(e);const r={type:Nn.EVENT,data:n,options:{}};return r.options.compress=!1!==this.flags.compress,"function"==typeof n[n.length-1]&&(this.acks[this.ids]=n.pop(),r.id=this.ids++),this.flags.volatile&&(!(this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable)||!this.connected)||(this.connected?this.packet(r):this.sendBuffer.push(r)),this.flags={},this}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth(e=>{this.packet({type:Nn.CONNECT,data:e})}):this.packet({type:Nn.CONNECT,data:this.auth})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e){this.connected=!1,this.disconnected=!0,delete this.id,this.emitReserved("disconnect",e)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case Nn.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Nn.EVENT:case Nn.BINARY_EVENT:this.onevent(e);break;case Nn.ACK:case Nn.BINARY_ACK:this.onack(e);break;case Nn.DISCONNECT:this.ondisconnect();break;case Nn.CONNECT_ERROR:const r=new Error(e.data.message);r.data=e.data.data,this.emitReserved("connect_error",r)}}onevent(e){const n=e.data||[];null!=e.id&&n.push(this.ack(e.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const r of n)r.apply(this,e)}super.emit.apply(this,e)}ack(e){const n=this;let r=!1;return function(...s){r||(r=!0,n.packet({type:Nn.ACK,id:e,data:s}))}}onack(e){const n=this.acks[e.id];"function"==typeof n&&(n.apply(this,e.data),delete this.acks[e.id])}onconnect(e){this.id=e,this.connected=!0,this.disconnected=!1,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>this.packet(e)),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Nn.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const n=this._anyListeners;for(let r=0;r<n.length;r++)if(e===n[r])return n.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}}var J5=fe(591);class By extends Of.Q{constructor(e,n){var r;super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(n=e,e=void 0),(n=n||{}).path=n.path||"/socket.io",this.opts=n,Oy(this,n),this.reconnection(!1!==n.reconnection),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(r=n.randomizationFactor)&&void 0!==r?r:.5),this.backoff=new J5({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==n.timeout?2e4:n.timeout),this._readyState="closed",this.uri=e;const s=n.parser||Be;this.encoder=new s.Encoder,this.decoder=new s.Decoder,this._autoConnect=!1!==n.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var n;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(n=this.backoff)||void 0===n||n.setMin(e),this)}randomizationFactor(e){var n;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(n=this.backoff)||void 0===n||n.setJitter(e),this)}reconnectionDelayMax(e){var n;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(n=this.backoff)||void 0===n||n.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new jS(this.uri,this.opts);const n=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const s=$a(n,"open",function(){r.onopen(),e&&e()}),u=$a(n,"error",m=>{r.cleanup(),r._readyState="closed",this.emitReserved("error",m),e?e(m):r.maybeReconnectOnOpen()});if(!1!==this._timeout){const m=this._timeout;0===m&&s();const v=this.setTimeoutFn(()=>{s(),n.close(),n.emit("error",new Error("timeout"))},m);this.opts.autoUnref&&v.unref(),this.subs.push(function(){clearTimeout(v)})}return this.subs.push(s),this.subs.push(u),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push($a(e,"ping",this.onping.bind(this)),$a(e,"data",this.ondata.bind(this)),$a(e,"error",this.onerror.bind(this)),$a(e,"close",this.onclose.bind(this)),$a(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){this.decoder.add(e)}ondecoded(e){this.emitReserved("packet",e)}onerror(e){this.emitReserved("error",e)}socket(e,n){let r=this.nsps[e];return r||(r=new Kx(this,e,n),this.nsps[e]=r),r}_destroy(e){const n=Object.keys(this.nsps);for(const r of n)if(this.nsps[r].active)return;this._close()}_packet(e){const n=this.encoder.encode(e);for(let r=0;r<n.length;r++)this.engine.write(n[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,"opening"===this._readyState&&this.cleanup(),this.backoff.reset(),this._readyState="closed",this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(s=>{s?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",s)):e.onreconnect()}))},n);this.opts.autoUnref&&r.unref(),this.subs.push(function(){clearTimeout(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const qm={};function Vu(t,e){"object"==typeof t&&(e=t,t=void 0);const n=function(t,e="",n){let r=t;n=n||"undefined"!=typeof location&&location,null==t&&(t=n.protocol+"//"+n.host),"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?n.protocol+t:n.host+t),/^(https?|wss?):\/\//.test(t)||(t=void 0!==n?n.protocol+"//"+t:"https://"+t),r=jx(t)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const u=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+u+":"+r.port+e,r.href=r.protocol+"://"+u+(n&&n.port===r.port?"":":"+r.port),r}(t,(e=e||{}).path||"/socket.io"),r=n.source,s=n.id;let E;return e.forceNew||e["force new connection"]||!1===e.multiplex||qm[s]&&n.path in qm[s].nsps?E=new By(r,e):(qm[s]||(qm[s]=new By(r,e)),E=qm[s]),n.query&&!e.query&&(e.query=n.queryKey),E.socket(n.path,e)}Object.assign(Vu,{Manager:By,Socket:Kx,io:Vu,connect:Vu});class Uy{constructor(e){this.config=e,this.subscribersCounter={},this.eventObservables$={},this.emptyConfig={url:"",options:{}},void 0===e&&(e=this.emptyConfig),this.ioSocket=(Vu||Ae)(e.url,e.options)}of(e){this.ioSocket.of(e)}on(e,n){this.ioSocket.on(e,n)}once(e,n){this.ioSocket.once(e,n)}connect(){return this.ioSocket.connect()}disconnect(e){return this.ioSocket.disconnect.apply(this.ioSocket,arguments)}emit(e,...n){return this.ioSocket.emit.apply(this.ioSocket,arguments)}removeListener(e,n){return this.ioSocket.removeListener.apply(this.ioSocket,arguments)}removeAllListeners(e){return this.ioSocket.removeAllListeners.apply(this.ioSocket,arguments)}fromEvent(e){return this.subscribersCounter[e]||(this.subscribersCounter[e]=0),this.subscribersCounter[e]++,this.eventObservables$[e]||(this.eventObservables$[e]=new Dt(n=>{const r=s=>{n.next(s)};return this.ioSocket.on(e,r),()=>{this.subscribersCounter[e]--,0===this.subscribersCounter[e]&&(this.ioSocket.removeListener(e,r),delete this.eventObservables$[e])}}).pipe(Ms())),this.eventObservables$[e]}fromOneTimeEvent(e){return new Promise(n=>this.once(e,n))}}function eN(t){return new Uy(t)}const GS=new un("__SOCKET_IO_CONFIG__");let tN=(()=>{class t{static forRoot(n){return{ngModule:t,providers:[{provide:GS,useValue:n},{provide:Uy,useFactory:eN,deps:[GS]}]}}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=dr({type:t}),t.\u0275inj=Qr({}),t})(),nN=(()=>{class t{constructor(n,r){this.httpClient=n,this.socket=r,this.cbAddress=new xi,this.mostrar="",this.mapbox=Sr,this.style="mapbox://styles/mapbox/streets-v11",this.lat=14.2917827,this.lng=-89.9047073,this.zoom=13,this.wayPoints=[],this.markerDriver=null,this.markerDriver2=null,this.markerDriver3=null,this.p1=null,this.p2=null,this.p3=null,this.p4=null,this.p5=null,this.p6=null,this.p7=null,this.p8=null,this.p9=null,this.p10=null,this.p11=null,this.p12=null,this.p13=null,this.p14=null,this.p15=null,this.p16=null,this.p17=null,this.p18=null,this.p19=null,this.p20=null,this.p21=null,this.rutaTunas=[[-89.90835489024862,14.297993146993027],[-89.90826484891257,14.297840307048851],[-89.90815748774295,14.297708594355683],[-89.9081095131179,14.297627136000498],[-89.9081023362888,14.29761477238406],[-89.90806688351893,14.297531025029944],[-89.9080465795554,14.29751719882686],[-89.90800580248239,14.29745287359769],[-89.90799252622605,14.297428981365016],[-89.90797545675363,14.29739773767231],[-89.9079346796806,14.29732054735406],[-89.9079025649589,14.29723153454783],[-89.90782475159118,14.297079635083328],[-89.90780219699334,14.297016252543354],[-89.9077412995765,14.29686872414693],[-89.9076792744302,14.296705896396768],[-89.90764455123087,14.296660688227888],[-89.90757524354241,14.296467941056566],[-89.9075350104084,14.29638736759121],[-89.90754171592893,14.296360076572004],[-89.90750550610845,14.296306794096962],[-89.90747197849765,14.29624051587898],[-89.90745320303589,14.296153444466277],[-89.90744247420028,14.296123554269643],[-89.90736334903717,14.295946812167157],[-89.90730568154476,14.295833749131297],[-89.90727215393157,14.295763572045523],[-89.90721716864596,14.295606323312498],[-89.90718632324449,14.295582930929998],[-89.90718498213789,14.29556603642884],[-89.90719168765573,14.29557383388915],[-89.90715547783661,14.295482863485953],[-89.90709512813807,14.295349006968616],[-89.90704416615412,14.295228146156882],[-89.9069958863953,14.29515017140795],[-89.9069301722602,14.295069597468563],[-89.90683495384698,14.294965631057343],[-89.9067343710009,14.294831774229076],[-89.90660294276853,14.294715461680317],[-89.90653789919688,14.294651132365471],[-89.90646749121525,14.294585503451861],[-89.90644066912394,14.29456016158815],[-89.90638367218065,14.294517275349728],[-89.9063206402733,14.294464642230775],[-89.90622743350454,14.294417857224088],[-89.90618183595454,14.294387966799157],[-89.9061556844185,14.294373021585193],[-89.90609466416775,14.294334722977279],[-89.90605711323722,14.294300283994673],[-89.90600279850852,14.294245701448034],[-89.90594848377985,14.294184620963474],[-89.90594404792172,14.294171625108792],[-89.90589979147612,14.294081953723868],[-89.90588570987978,14.293990332924093],[-89.90588101601436,14.293963041614807],[-89.90587498104449,14.293904560226649],[-89.90591520736018,14.29396758001954],[-89.9058615631837,14.293892204006804],[-89.90587899751387,14.293905199871396],[-89.9053693778374,14.29385321640262],[-89.90503141949613,14.293814228792545],[-89.90496570536955,14.293794734985035],[-89.90491742560039,14.29380383209519],[-89.90473637649512,14.293785637873988],[-89.90463311144478,14.293759646126903],[-89.90454057523147,14.293758346539244],[-89.90439573594928,14.29373755313947],[-89.90431661078226,14.293729755613956],[-89.90410337517076,14.29371286097447],[-89.90396658250363,14.293685569631151],[-89.90364337634041,14.293654379520868],[-89.90320468742173,14.293604752358853],[-89.90280101496191,14.293583958944305],[-89.90240807133307,14.293620347417308],[-89.90197141071256,14.293703521048988],[-89.90179482316933,14.293556940729353],[-89.9016809224502,14.293471700801586],[-89.90155236124245,14.293395203402989],[-89.9012963665569,14.293266250586479],[-89.90116548301953,14.29319955937062],[-89.90090836060408,14.29305202847152],[-89.90078882122079,14.292984273505445],[-89.90066928184599,14.29291433287517],[-89.90053395424812,14.292836742462637],[-89.90040313758061,14.292762430494559],[-89.90029560449253,14.292699842021573],[-89.90015689371576,14.292611323297043],[-89.90003380524752,14.292531974054485],[-89.8999187767985,14.29246094045985],[-89.89977921666387,14.292388772927195],[-89.89952773288587,14.29225216975118],[-89.89925575653606,14.292103125019484],[-89.89913064405856,14.2920492388343],[-89.89812294115315,14.291471870298324],[-89.89769110551408,14.29121844802869],[-89.89742154350613,14.291080690161495],[-89.89713454714683,14.290872753594101],[-89.89705408088211,14.290796076939623],[-89.89701116554096,14.290606334597475],[-89.89690253606318,14.290329518413625],[-89.89680061212789,14.290025410116089],[-89.89679390660584,14.29003710659668],[-89.89672819248553,14.289853861659925],[-89.89658201209006,14.289475674832369],[-89.89647197033902,14.289248832600393],[-89.89640357400732,14.289079882783572],[-89.89613140607892,14.28878347723312],[-89.89598339455733,14.288617514049456],[-89.89575227563381,14.288337711662091],[-89.8956610805338,14.288133671427751],[-89.89554440443298,14.288075188522466],[-89.89526009028896,14.288028402188344],[-89.8950495368708,14.28801540598174],[-89.89484568899096,14.288005009016695],[-89.89463476346849,14.287991002255454],[-89.89441884565818,14.287972807564346],[-89.89399103331017,14.287927320828224],[-89.89316017422401,14.287902405997134],[-89.89295230302288,14.287884211298618],[-89.89231393728056,14.287856919247307],[-89.89210070165467,14.287845222652992],[-89.89190087707816,14.287836125301483],[-89.89146735140699,14.287818580676602],[-89.89111071264034,14.287799953119686],[-89.89058915917853,14.287801289619027],[-89.89025535613912,14.287775558417753],[-89.88992913955494,14.287731447780535],[-89.88978310071688,14.28774063749665],[-89.88958964669602,14.287746151326564],[-89.88960481953498,14.287722258062766],[-89.88921601486922,14.287698364796553],[-89.8889580761604,14.287676309471607],[-89.8888025543005,14.287663443864291],[-89.88883669324846,14.287593601980442],[-89.88896750740687,14.287148717338724],[-89.88901712752893,14.287078774889325],[-89.88910057954095,14.286875504538855],[-89.88917726518508,14.28666567688231],[-89.88929454909386,14.2863531207474],[-89.88929453161221,14.286363346068224],[-89.8891377240489,14.286224090333764],[-89.88901903630844,14.28613051688613],[-89.88887687922494,14.286030445236463],[-89.88880311848229,14.285965463623807],[-89.88875416816686,14.285929723727111],[-89.88869381846634,14.285860843185114],[-89.88865884215184,14.285816048619509],[-89.88853552486805,14.28564699899552],[-89.8884838923482,14.285572919829363],[-89.88841087116325,14.285508326072463],[-89.88839075459705,14.285466087928368],[-89.88837533189634,14.28545764029861],[-89.88841162888832,14.285493556008685],[-89.88835932581625,14.285448718590981],[-89.88832177488953,14.285396083349134],[-89.88822359825984,14.28529028501779],[-89.88820616389827,14.28526559192492],[-89.88810423995893,14.285157722068137],[-89.88804308305843,14.285016373110683],[-89.88797938059888,14.284935795545069],[-89.88793914746653,14.284868864158147],[-89.88792774806295,14.284851319031693],[-89.88783990572398,14.284805831666457],[-89.8877713491695,14.284739452680855],[-89.8876888712424,14.28465692555386],[-89.88761645160417,14.284577647500015],[-89.88759834669462,14.28454385684562],[-89.88754723953404,14.284499194573339],[-89.8875140293778,14.284475006079402],[-89.88746777870146,14.284447959086089],[-89.88740159238353,14.28440159280346],[-89.88725087896117,14.284314269612274],[-89.88731387557206,14.284353680967724],[-89.88722057678913,14.284305769122295],[-89.88706667366864,14.28420453599618],[-89.88638814804243,14.28385641358159],[-89.88587667370211,14.283572492055223],[-89.88500132868289,14.283132461613029],[-89.88395043421663,14.282568098962964],[-89.88313912357181,14.282126095756247],[-89.88237465464871,14.281803861356375],[-89.88117143801043,14.281296611630562],[-89.88048469007555,14.281092267186027],[-89.87952578808961,14.280663540984225],[-89.8788482932226,14.280416984004887],[-89.87808414367097,14.280107416297566],[-89.87750223504653,14.27988009616379],[-89.88903787946518,14.287024785141096],[-89.88895654206885,14.287224157760821],[-89.88884649735617,14.287493078688996],[-89.88880369012811,14.287656482262133],[-89.88874079083033,14.287949033758123],[-89.88869489099986,14.28813193128565],[-89.8887096431484,14.288162472351846],[-89.88883436585867,14.288167021020914],[-89.88902841072574,14.288190267052851],[-89.88945013302228,14.288218699367759],[-89.88946930443046,14.288215420831776],[-89.88981366990114,14.288239750490932],[-89.88978015736198,14.288232442228683],[-89.89011960405958,14.288248834906833],[-89.89045110919747,14.288265899478178],[-89.89083673707788,14.288269942619605],[-89.89107343334052,14.288284601080305],[-89.89171676546006,14.288318051054649],[-89.89216486785125,14.288324075541015],[-89.892558234378,14.288356614208748],[-89.89278985369155,14.288359607582152],[-89.89309107919267,14.288377386247346],[-89.89353447785277,14.288420856042196],[-89.8936705144263,14.288451867717347],[-89.89394127982466,14.288486240389945],[-89.89388748822796,14.28845752157632],[-89.8939258310443,14.288468450017621],[-89.89395976051517,14.288639359849256],[-89.89388197645927,14.288926575021835],[-89.89383202190447,14.289263181784184],[-89.89371443220551,14.289774125989606],[-89.89369167290896,14.28986418438033],[-89.89386039702521,14.289959135363521],[-89.89413161197605,14.290076762545423],[-89.89412781875996,14.29008227631805],[-89.89441095301807,14.290203251514615],[-89.89469161832652,14.29033541964132],[-89.89509143495407,14.290486259829233],[-89.89548530897272,14.290669962927092],[-89.8954208242991,14.290649745812896],[-89.89586198651551,14.290811093954542],[-89.89623812713907,14.290979003722933],[-89.89667349388407,14.291195090473035],[-89.89700729691221,14.29136234068619],[-89.89753411676385,14.29167179979978],[-89.89819736127524,14.292069897438516],[-89.89852547446748,14.292244498626008],[-89.89891647726289,14.292439203715878],[-89.89930305620847,14.292672978289163],[-89.89943961199536,14.29274465649665],[-89.89950978649311,14.292786928248699],[-89.90015717708242,14.293178505160311],[-89.90078554834035,14.293496874348229],[-89.90139578185418,14.293849027005699],[-89.90152359429908,14.29395153098418],[-89.90177204995332,14.293819202679995],[-89.9018920472065,14.293742536447443],[-89.90202670637787,14.293705778558817],[-89.90222403757672,14.293802517697431],[-89.90233727199121,14.29383806369553],[-89.90273730489247,14.293939616732457],[-89.90329469585926,14.294075522798519],[-89.90397329538891,14.294234578856296],[-89.90462989961549,14.29429948748871],[-89.9050161682334,14.294322956842949],[-89.9051522235263,14.29432757076434],[-89.90563227364974,14.294338389086915],[-89.9059903089568,14.294345262179759],[-89.90607643090586,14.294340625756004],[-89.90613544038946,14.294366898822705],[-89.90625505420759,14.294424081369035],[-89.90628695122578,14.294468900111386],[-89.90634939165398,14.294480718558566]],this.rutaMetroPlaza=[[-89.91184392492988,14.292574965430545],[-89.9117983273799,14.29257756461904],[-89.91166939803651,14.292605387583867],[-89.9115656468864,14.292626151238979],[-89.91154647547825,14.292642543596925],[-89.91160499646601,14.292838721399484],[-89.91169310585644,14.293292880079228],[-89.91140212330116,14.293345677509642],[-89.91070610243307,14.293481272067433],[-89.9102528091419,14.293548850686266],[-89.90996213402168,14.293791316751395],[-89.90996213402168,14.293791316751395],[-89.90855812055858,14.294011130908116],[-89.90730001758821,14.294032469918216],[-89.90723794964971,14.294067681644636],[-89.90606347680664,14.29391195740124],[-89.90477739820749,14.293784378929798],[-89.9033835252191,14.293604525848819],[-89.90239777834135,14.293606974706654],[-89.90196228234468,14.293702682088279],[-89.90184086271196,14.293617876722777],[-89.90187841363549,14.29366791086404],[-89.9017637946443,14.293536344457648],[-89.90171216212444,14.293494107820907],[-89.90166254124121,14.293449271995605],[-89.90159347436398,14.293417432057847],[-89.90146003447501,14.293348553809743],[-89.90139566143957,14.29331736365068],[-89.90126691541604,14.293246535986375],[-89.90119650743442,14.293213396429344],[-89.90112542890058,14.293177657685918],[-89.90106767607361,14.293148055650592],[-89.90094362391552,14.293075928341596],[-89.90087676560901,14.293043176177717],[-89.90080805987361,14.292994554935417],[-89.90068379514486,14.29293425184852],[-89.90050118554134,14.292819332345845],[-89.90031703664756,14.292710506837093],[-89.90028082682845,14.29268386516932],[-89.9001949961427,14.292631881417549],[-89.90012291581166,14.292591983026902],[-89.89993442761154,14.292476803083016],[-89.8997310056631,14.292360509365981],[-89.89956336761163,14.292265638874813],[-89.8994916185256,14.29222989998077],[-89.89949570268817,14.292230881296604],[-89.8993622627992,14.29216330228174],[-89.89929453702642,14.292129512766683],[-89.8992314129237,14.292102200890671],[-89.89917374543398,14.292067761567859],[-89.89909230166033,14.292039398896376],[-89.8990212231265,14.292017305740323],[-89.89894746238384,14.291969220628477],[-89.89867835300358,14.2918197852806],[-89.89843476334684,14.291666789333648],[-89.89818291565197,14.291522419176728],[-89.89782404025023,14.291313609419],[-89.8976966067724,14.291231647133044],[-89.89741356088977,14.2910672063639],[-89.89720738980408,14.29096890180043],[-89.89706557928538,14.290795109052253],[-89.89701144825057,14.29062244140367],[-89.89697934265988,14.290468292829999],[-89.89686769740054,14.290225683465199],[-89.89680554376052,14.290031571250722],[-89.89672233088871,14.289833587582532],[-89.89656942811679,14.289462297659231],[-89.89648482272794,14.289273502243175],[-89.8964110618782,14.289082491217865],[-89.89612944788493,14.288789530919889],[-89.89588021957871,14.288486813331843],[-89.8957410975765,14.288322241796589],[-89.89572833876923,14.288249602534938],[-89.89573312332197,14.288235692886415],[-89.89572674391833,14.288197054969332],[-89.89567092413655,14.28815378049433],[-89.89554297356987,14.288067844089994],[-89.89540483980016,14.288038602631238],[-89.89526070633558,14.288035790954593],[-89.89505149404734,14.288018246077392],[-89.89491208748534,14.288007802931025],[-89.89462309649805,14.287987169942578],[-89.89482252624221,14.287993649615323],[-89.89442782076169,14.287967421299786],[-89.89403537073872,14.287939007287752],[-89.89361585520038,14.287917150353467],[-89.89365008091553,14.28793089526987],[-89.89365741992934,14.287703148887188],[-89.89366121314546,14.287306152713136],[-89.89367716165455,14.287173237701381],[-89.89366121314546,14.28703568603676],[-89.89383345704357,14.287072778628769],[-89.89396582966897,14.287099052544399],[-89.8939706142217,14.287061959956729],[-89.8939844401242,14.286896801473526],[-89.89399117334494,14.286711265327659],[-89.8940941192316,14.286250889286736],[-89.89422595706954,14.286008246838758],[-89.89435195029132,14.285900059583161],[-89.89470200507192,14.285789112875879],[-89.89486467986458,14.285719563864097],[-89.89475199463868,14.28565617060358],[-89.89460785242704,14.285395180082523],[-89.89463061172363,14.285340041201323],[-89.89478099550048,14.284847525273282],[-89.89494031057649,14.284524042856718],[-89.89506247239183,14.28428129355312],[-89.89547597114131,14.283519939729866],[-89.89576958157075,14.283014728167142],[-89.89601102266188,14.282438578886344],[-89.89628034100464,14.28201584156471],[-89.8971719150942,14.282384321000954],[-89.89786149250278,14.282736293651702],[-89.89828633270547,14.28292009199642],[-89.89927839042751,14.28360453912878],[-89.89963874595658,14.284038301307968],[-89.90001561372111,14.28432880869883],[-89.90016625671021,14.284472055401613],[-89.90012736468226,14.284634510476206],[-89.90006523875714,14.284811334186891],[-89.89988237877134,14.285242405710834],[-89.89947116699906,14.286116879454323],[-89.89909563852879,14.286627830829886],[-89.8981814734309,14.2872747891564],[-89.8980962247565,14.287394913693136],[-89.89796863668042,14.287728746273329],[-89.89789409672063,14.28806392916703],[-89.89778949053198,14.28827186832533],[-89.897533339578,14.288374538213167],[-89.89709345730614,14.288516196590797],[-89.89695440316315,14.288602567462474],[-89.89686520810187,14.288665351425673],[-89.89679264238556,14.288699352722277],[-89.89672565864738,14.288666896939263],[-89.89658067630384,14.288587076434608],[-89.89643279529821,14.288528021954692],[-89.89625821151816,14.288442139081711],[-89.89611429593377,14.288309077450636],[-89.89580648970843,14.288165344412405],[-89.89576980813756,14.288162253378315],[-89.8956806881271,14.288146179255476],[-89.89524365804212,14.288046195183972],[-89.89316679396319,14.287898989518434],[-89.89276407626508,14.287879738417267],[-89.89202712627365,14.287841172078645],[-89.89142561123933,14.287814570530886],[-89.89125336734124,14.28779293325764],[-89.89120045430849,14.288288639673514],[-89.89207215105586,14.288335963896264],[-89.8924616131278,14.288354756249221],[-89.89271027920752,14.288362132472026],[-89.89312392462674,14.288384914238508],[-89.89339552858014,14.288398788148093],[-89.8938671106817,14.28846565186458],[-89.893997976637,14.28851160029488],[-89.89391262927484,14.288842428715977],[-89.8938671106817,14.289086873847896],[-89.89375521080461,14.289539004758286],[-89.8937077956034,14.289847776556236],[-89.89370969221959,14.28986615582211],[-89.89457619562143,14.290250489750168],[-89.89486395897131,14.290398961062557],[-89.89519357216935,14.290528210501325],[-89.89633650292363,14.291022829082221],[-89.89687441161509,14.291276194379964],[-89.89720692881426,14.291484586398795],[-89.89750468716937,14.291623595432412],[-89.89771104237018,14.291744274703595],[-89.89811343793991,14.291996171506213],[-89.89815769439745,14.292027361847802],[-89.89832533246359,14.292117034054888],[-89.89878942633756,14.292371556862557],[-89.89938889941864,14.292724793356971],[-89.90014681145797,14.293157990491625],[-89.90082019826387,14.293519574870475],[-89.90130485012317,14.293807177757147],[-89.90145773602612,14.293905946357771],[-89.90152479125273,14.29395792981399],[-89.9016575605895,14.293879954624618],[-89.90175948452479,14.29381237610527],[-89.90181044649243,14.293764291377228],[-89.90194039688166,14.293724637245614],[-89.90211876376841,14.293660957443567]],this.mapbox.accessToken="pk.eyJ1Ijoicm9ic3RhcmsiLCJhIjoiY2t0a3E1MGN1MW84YzMycWZiNmZoZ2hzMiJ9.2iUEOBP3NT-bpemmGHdN4w"}buildMap(){return new Promise((n,r)=>{try{this.map=new Sr.Map({container:"map",style:this.style,zoom:this.zoom,center:[this.lng,this.lat]});const s=new(o5())({accessToken:Sr.accessToken,mapboxgl:Sr});s.on("result",u=>{const{result:m}=u;s.clear(),console.log("*********",m),this.cbAddress.emit(m)}),n({map:this.map,geocoder:s})}catch(s){r(s)}})}loadCoords(n,r){const m="TUNAS"===r?this.rutaTunas:this.rutaMetroPlaza;console.log("RUTA",m),console.log("RUTA T",this.rutaTunas),this.map.addSource("route",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:m}}}),this.map.addLayer({id:"route",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"red","line-width":8}}),this.wayPoints=m,this.map.fitBounds([m[0],m[m.length-1]],{padding:70}),this.socket.emit("find-driver",{points:m})}addMarkerCustom(n,r){const s=document.createElement("div");s.className=r,"marker"===r?this.markerDriver?this.markerDriver.setLngLat(n).addTo(this.map):this.markerDriver=new Sr.Marker(s):"bus"===r?this.markerDriver2?this.markerDriver2.setLngLat(n).addTo(this.map):this.markerDriver2=new Sr.Marker(s):"bus2"===r&&(this.markerDriver3?this.markerDriver3.setLngLat(n).addTo(this.map):this.markerDriver3=new Sr.Marker(s))}cargarParadasTunas(){console.log("Paradas");const n=document.createElement("div"),r=document.createElement("div"),s=document.createElement("div"),u=document.createElement("div"),m=document.createElement("div"),v=document.createElement("div"),E=document.createElement("div"),S=document.createElement("div"),P=document.createElement("div"),V=document.createElement("div"),j=document.createElement("div"),G=document.createElement("div"),se=document.createElement("div"),Re=document.createElement("div"),be=document.createElement("div"),qe=document.createElement("div"),Ue=document.createElement("div"),Tt=document.createElement("div");n.className="montana",r.className="sarita",s.className="veterinaria",u.className="radio",m.className="pmt",v.className="yes",E.className="upana",S.className="parada",P.className="itb",V.className="parada",j.className="parada",G.className="parada",se.className="liceo",Re.className="way",be.className="taxi",qe.className="mariano",Ue.className="wayo",Tt.className="ecco",this.p1=new Sr.Marker(n),this.p2=new Sr.Marker(r),this.p3=new Sr.Marker(s),this.p4=new Sr.Marker(u),this.p5=new Sr.Marker(m),this.p6=new Sr.Marker(v),this.p7=new Sr.Marker(E),this.p8=new Sr.Marker(S),this.p9=new Sr.Marker(P),this.p10=new Sr.Marker(V),this.p11=new Sr.Marker(j),this.p12=new Sr.Marker(G),this.p13=new Sr.Marker(se),this.p14=new Sr.Marker(Re),this.p15=new Sr.Marker(be),this.p16=new Sr.Marker(qe),this.p17=new Sr.Marker(Ue),this.p18=new Sr.Marker(Tt),console.log("Paradas pintar"),this.p1.setLngLat([-89.90816315542443,14.297704865118183]).addTo(this.map),this.p2.setLngLat([-89.90043707226602,14.29276336275319]).addTo(this.map),this.p3.setLngLat([-89.89946274337176,14.292197984266666]).addTo(this.map),this.p4.setLngLat([-89.89692886626648,14.290323487081066]).addTo(this.map),this.p5.setLngLat([-89.89566134632814,14.288105718765845]).addTo(this.map),this.p6.setLngLat([-89.8902802960199,14.288141489542763]).addTo(this.map),this.p7.setLngLat([-89.88990621315313,14.28825309987068]).addTo(this.map),this.p8.setLngLat([-89.88879829719023,14.287435862702772]).addTo(this.map),this.p9.setLngLat([-89.88905771664334,14.286826155360018]).addTo(this.map),this.p10.setLngLat([-89.88818506078351,14.285285560245086]).addTo(this.map),this.p11.setLngLat([-89.87813806759361,14.280216487459652]).addTo(this.map),this.p12.setLngLat([-89.89388902832849,14.288514273680995]).addTo(this.map),this.p13.setLngLat([-89.89463132668864,14.29038066962475]).addTo(this.map),this.p14.setLngLat([-889.8966075112047,14.291233892208709]).addTo(this.map),this.p15.setLngLat([-89.89802863395883,14.292003387603126]).addTo(this.map),this.p16.setLngLat([-89.89737229737446,14.282714713702497]).addTo(this.map),this.p17.setLngLat([-889.8966075112047,14.291233892208709]).addTo(this.map),this.p18.setLngLat([-89.90618084803087,14.293895284757424]).addTo(this.map)}}return t.\u0275fac=function(n){return new(n||t)(_t(TS),_t(Uy))},t.\u0275prov=kt({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const rN=["asGeoCoder"];let iN=(()=>{class t{constructor(n,r,s,u,m){this.router=n,this.mapCustomService=r,this.renderer2=s,this.socket=u,this._route=m,this.modeInput="start",this.wayPoints={start:null,end:null},this.ruta="",this.mostrarRuta={ruta:"",ico:""}}ngOnInit(){this.ruta="",this.ruta=this._route.snapshot.paramMap.get("ruta"),"TUNAS"===this.ruta?(this.mostrarRuta.ruta="UNI1",this.mostrarRuta.ico="marker"):"METRO"===this.ruta&&(this.mostrarRuta.ruta="UNI2",this.mostrarRuta.ico="bus"),this.mapCustomService.buildMap().then(({geocoder:n,map:r})=>{this.renderer2.appendChild(this.asGeoCoder.nativeElement,n.onAdd(r)),console.log("*** TODO BIEN *****")}).catch(n=>{console.log("******* ERROR ******",n)}),this.mapCustomService.cbAddress.subscribe(n=>{"start"===this.modeInput&&(this.wayPoints.start=n),"end"===this.modeInput&&(this.wayPoints.end=n)}),this.socket.fromEvent(this.mostrarRuta.ruta).subscribe(n=>{const r=n.split(","),s=[parseFloat(r[1]),parseFloat(r[0])];console.log("RUTA: ",this.mostrarRuta.ruta),this.mapCustomService.addMarkerCustom(s,this.mostrarRuta.ico)}),this.mapCustomService.cargarParadasTunas()}drawRoute(){console.log("***** PUNTOS de ORIGEN y DESTINO",this.wayPoints);const n=[[-89.8939141,14.2876664],[-89.8829917,14.2811682]];console.log(n),this.mapCustomService.loadCoords(n,this.ruta)}changeMode(n){this.modeInput=n}testMarker(){this.mapCustomService.addMarkerCustom([-8.628139488926513,41.159082702543635],"marker")}irUnidades(){this.router.navigate(["/unidades/"])}}return t.\u0275fac=function(n){return new(n||t)(ot(Zi),ot(nN),ot(Cl),ot(Uy),ot(Kh))},t.\u0275cmp=fs({type:t,selectors:[["app-mapa"]],viewQuery:function(n,r){if(1&n&&xC(rN,5),2&n){let s;D_(s=function(t,e){return t[19].queries[e].queryList}(tt(),nu()))&&(r.asGeoCoder=s.first)}},decls:43,vars:1,consts:[[1,"flex","items-center","bg-gray-800","p-3","flex-wrap"],["href","/unidades",1,"p-2","mr-4","inline-flex","items-center"],["src","./assets/image/logo1.png",1,"logo"],[1,"text-xl","text-white","font-bold","uppercase","tracking-wide"],["id","navigation",1,"hidden","top-navbar","w-full","lg:inline-flex","lg:flex-grow","lg:w-auto"],[1,"lg:inline-flex","lg:flex-row","lg:ml-auto","lg:w-auto","w-full","lg:items-center","items-start","flex","flex-col","lg:h-auto"],["href","#",1,"lg:inline-flex","lg:w-auto","w-full","px-3","py-2","rounded","text-gray-400","items-center","justify-center","hover:bg-gray-900","hover:text-white"],[1,"wrapper"],[1,"grid","grid-flow-col"],[1,"row-span-3"],[1,"bg-transparent","hover:bg-blue-500","text-blue-700","font-semibold","hover:text-white","py-2","px-4","border","border-blue-500","hover:border-transparent","rounded",3,"click"],[1,"row-span-1"],[1,"bg-white","hover:bg-gray-100","text-gray-800","font-semibold","py-2","px-4","border","border-gray-400","rounded","shadow",3,"click"],[1,"font-bold","text-xl","bg-dark","text-center","text-white"],["ng-init","drawRoute()",1,"wrapper"],["id","map",1,"map-container"],["asMap",""],["id","carouselExampleIndicators","data-ride","carousel",1,"carousel","slide"],[1,"carousel-indicators"],["data-target","#carouselExampleIndicators","data-slide-to","0",1,"active"],["data-target","#carouselExampleIndicators","data-slide-to","1"],["data-target","#carouselExampleIndicators","data-slide-to","2"],[1,"carousel-inner"],[1,"carousel-item","active"],["src","./assets/colera/esperas.jpg","alt","First slide",1,"d-block","w-100"],[1,"carousel-item"],["src","./assets/colera/entierro.jpg","alt","Second slide",1,"d-block","w-100"],["src","./assets/colera/trancito.jpg","alt","Third slide",1,"d-block","w-100"],["href","#carouselExampleIndicators","role","button","data-slide","prev",1,"carousel-control-prev"],["aria-hidden","true",1,"carousel-control-prev-icon"],[1,"sr-only"],["href","#carouselExampleIndicators","role","button","data-slide","next",1,"carousel-control-next"],["aria-hidden","true",1,"carousel-control-next-icon"]],template:function(n,r){1&n&&(at(0,"nav",0),at(1,"a",1),_n(2,"img",2),at(3,"span",3),bn(4,"Sistema de Monitoreo Para Buses en Jutiapa"),lt(),lt(),at(5,"div",4),at(6,"div",5),_n(7,"a",6),lt(),lt(),lt(),at(8,"div",7),at(9,"div",8),at(10,"div",9),at(11,"button",10),vi("click",function(){return r.irUnidades()}),bn(12," Seleccionar Ruta"),lt(),lt(),at(13,"div",11),at(14,"button",12),vi("click",function(){return r.drawRoute()}),bn(15),lt(),lt(),lt(),lt(),at(16,"p",13),bn(17,"para Ver la Ruta por donde se Desplaza la Unidad Preciona ver Ruta"),lt(),at(18,"div",14),_n(19,"div",15,16),lt(),at(21,"p",13),bn(22,"Este sistema surge de la necesidad de gestionar mejor el tiempo de las personas y limitar inconvenientes que se presenta en el d\xeda a d\xeda al utilizar los medios de trasporte Publico"),lt(),at(23,"div",17),at(24,"ol",18),_n(25,"li",19),_n(26,"li",20),_n(27,"li",21),lt(),at(28,"div",22),at(29,"div",23),_n(30,"img",24),lt(),at(31,"div",25),_n(32,"img",26),lt(),at(33,"div",25),_n(34,"img",27),lt(),lt(),at(35,"a",28),_n(36,"span",29),at(37,"span",30),bn(38,"Previous"),lt(),lt(),at(39,"a",31),_n(40,"span",32),at(41,"span",30),bn(42,"Next"),lt(),lt(),lt()),2&n&&(function(t){Da(xn(),tt(),ri()+t,zs())}(15),h_(" VER RUTA_",r.ruta," "))},styles:[".logo[_ngcontent-%COMP%]{width:40px;height:auto}"]}),t})();const oN=[{path:"login",component:r5},{path:"unidades",component:(()=>{class t{constructor(n){this.router=n}ngOnInit(){}mapaTunas(){this.router.navigate(["/mapa/TUNAS"])}mapaMetro(){this.router.navigate(["/mapa/METRO"])}}return t.\u0275fac=function(n){return new(n||t)(ot(Zi))},t.\u0275cmp=fs({type:t,selectors:[["app-unidades"]],decls:109,vars:0,consts:[[1,"flex","items-center","bg-gray-900","p-3","flex-wrap"],["href","/unidades",1,"p-2","mr-4","inline-flex","items-center"],["src","./assets/image/logo1.png",1,"logo"],[1,"text-xl","text-white","font-bold","uppercase","tracking-wide"],["id","navigation",1,"hidden","top-navbar","w-full","lg:inline-flex","lg:flex-grow","lg:w-auto"],[1,"lg:inline-flex","lg:flex-row","lg:ml-auto","lg:w-auto","w-full","lg:items-center","items-start","flex","flex-col","lg:h-auto"],["href","#",1,"lg:inline-flex","lg:w-auto","w-full","px-3","py-2","rounded","text-gray-400","items-center","justify-center","hover:bg-gray-900","hover:text-white"],["href","https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css","rel","stylesheet","integrity","sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3","crossorigin","anonymous"],["id","carouselExampleSlidesOnly","data-bs-ride","carousel",1,"carousel","slide"],[1,"carousel-inner"],[1,"carousel-item","active"],["src","./assets/img_chidas/nube.jpg","calt","primero",1,"d-block","w-100"],[1,"carousel-item"],["src","./assets/img_chidas/lices.jpg","alt","...",1,"d-block","w-100"],["src","./assets/img_chidas/noche.jpg","alt","...",1,"d-block","w-100"],[1,"font-bold","text-xl","bg-dark","text-center","text-white"],[1,"grid","lg:grid-cols-2","p-8","gap-8","sm:grid-cols-1"],[1,"rounded-xl","shadow-xl"],["src","./assets/image/metroplaca.jpg",1,"w-full","rounded-t-xl","h-36","object-cover"],[1,"p6"],[1,"flex","flex-row"],[1,"uppercase","text-xs","text-yellow-700","bg-yellow-200","px-2","py-1","rounded-xl"],[1,"text-center"],[1,"flex","flex-row","mt-4","items-center"],["src","./assets/img/pasaje.png",1,"rounded-full","mr-2"],[1,"font-bold","mr-2"],["src","./assets/image/castrol2.jpg",1,"rounded-full","mr-2"],["src","./assets/img/placa.png",1,"rounded-full","mr-2"],[1,"bg-transparent","hover:bg-blue-500","text-blue-700","font-semibold","hover:text-white","py-2","px-4","border","border-blue-500","hover:border-transparent","rounded",3,"click"],["src","./assets/image/tunas.jpg",1,"w-full","rounded-t-xl","h-36","object-cover"],["src","./assets/image/sazo_opt.jpg",1,"rounded-full","mr-2"],["src","./assets/img/villaH.jpg",1,"w-full","rounded-t-xl","h-36","object-cover"],["src","./assets/img/yo_opt.jpg",1,"rounded-full","mr-2"],["src","./assets/img/29.jpg",1,"w-full","rounded-t-xl","h-36","object-cover"],["src","./assets/img/ROLO_opt.jpg",1,"rounded-full","mr-2"]],template:function(n,r){1&n&&(at(0,"nav",0),at(1,"a",1),_n(2,"img",2),lt(),at(3,"div"),at(4,"span",3),bn(5,"Sistema de Geolocalizacion de Urbanas en Jutiapa"),lt(),lt(),at(6,"div",4),at(7,"div",5),_n(8,"a",6),lt(),lt(),lt(),_n(9,"link",7),at(10,"div",8),at(11,"div",9),at(12,"div",10),_n(13,"img",11),lt(),at(14,"div",12),_n(15,"img",13),lt(),at(16,"div",12),_n(17,"img",14),lt(),lt(),lt(),at(18,"p",15),bn(19,"Rutas En Funcionamiento"),lt(),at(20,"div",16),at(21,"div",17),_n(22,"img",18),at(23,"div",19),at(24,"div",20),at(25,"div",21),bn(26," Ruta Metro Plaza Jutiapa "),lt(),lt(),at(27,"h5",22),bn(28,"Ruta metro plaza es una l\xednea de transporte Urbano al servicio de la poblaci\xf3n Jutiapaneca que realiza su recorrido desde El Centro Comercial Metro Plaza Jutiapa, pasando Por la calle 15 de septiembre, seguido del Parque Departamental con Destino final hacia La Comunidad de Las Crucitas La cual se compone por 2 Colonias y Una aldea siendo estas Col.Santa B\xe1rbara Col.Maria Eugenia y Ald. Las crucitas"),lt(),at(29,"div",23),_n(30,"img",24),at(31,"div",25),bn(32,"Promedio de pasajeros 4200 Por Dia"),lt(),lt(),at(33,"div",23),_n(34,"img",26),at(35,"div",25),bn(36,"Piloto. Hector Castro"),lt(),_n(37,"img",27),at(38,"div",25),bn(39,"Unidad: P7B58V"),lt(),lt(),at(40,"div",22),at(41,"button",28),vi("click",function(){return r.mapaMetro()}),bn(42," Ver ruta"),lt(),lt(),lt(),lt(),at(43,"div",17),_n(44,"img",29),at(45,"div",19),at(46,"div",20),at(47,"div",21),bn(48," Ruta Las Tunas Jutiapa "),lt(),lt(),at(49,"h5",22),bn(50,"Ruta Tunas Jutiapa es una l\xednea de Transporte Urbano al servicio de la Poblaci\xf3n Jutiapaneca que realiza su recorrido desde la Comunidad de Aldea Las Tunas pasando por la calle 15 de septiembre seguido por el Parque Departamental Pasando por el Hospital nacional de Jutiapa y Finalizando en el Complejo deportivo"),lt(),at(51,"div",23),_n(52,"img",24),at(53,"div",25),bn(54,"Promedio de pasajeros 900 Por Dia"),lt(),lt(),at(55,"div",23),_n(56,"img",30),at(57,"div",25),bn(58,"Piloto. Mario Cordero"),lt(),_n(59,"img",27),at(60,"div",25),bn(61,"Unidad: PL596MB"),lt(),lt(),at(62,"div",22),at(63,"button",28),vi("click",function(){return r.mapaTunas()}),bn(64," Ver ruta"),lt(),lt(),lt(),lt(),at(65,"div",17),_n(66,"img",31),at(67,"div",19),at(68,"div",20),at(69,"div",21),bn(70," Ruta Colonia Villa Hermoza "),lt(),lt(),at(71,"h5",22),bn(72,"Ruta Colonia Villa Hermosa es una l\xednea de Transporte Urbano al servicio de la Poblaci\xf3n Jutiapaneca que realiza su recorrido desde la Colonia Villa Hermosa pasando por la Carretera Interamericana seguido por el Parque Departamental Pasando por el Hospital nacional de Jutiapa y Finalizando en el Cementerio Municipal."),lt(),at(73,"div",23),_n(74,"img",24),at(75,"div",25),bn(76,"Promedio de pasajeros 1000 Por Dia"),lt(),lt(),at(77,"div",23),_n(78,"img",32),at(79,"div",25),bn(80,"Piloto. Robert Baratheon"),lt(),_n(81,"img",27),at(82,"div",25),bn(83,"Unidad: PL596MB"),lt(),lt(),at(84,"div",22),at(85,"button",28),vi("click",function(){return r.mapaTunas()}),bn(86," Ver ruta"),lt(),lt(),lt(),lt(),at(87,"div",17),_n(88,"img",33),at(89,"div",19),at(90,"div",20),at(91,"div",21),bn(92," Ruta Colonia 29 de Diciembre "),lt(),lt(),at(93,"h5",22),bn(94,"Ruta Colonia 29 de diciembre es una l\xednea de Transporte Urbano al servicio de la Poblaci\xf3n Jutiapaneca que realiza su recorrido desde la Colonia 29 de diciembre pasando por el Mercado Municipal seguido por el Parque Departamental Pasando por el Hospital nacional de Jutiapa y Finalizando en el Complejo deportivo."),lt(),at(95,"div",23),_n(96,"img",24),at(97,"div",25),bn(98,"Promedio de pasajeros 1600 Por Dia"),lt(),lt(),at(99,"div",23),_n(100,"img",34),at(101,"div",25),bn(102,"Piloto. Aron Ortiz"),lt(),_n(103,"img",27),at(104,"div",25),bn(105,"Unidad: PM696MB"),lt(),lt(),at(106,"div",22),at(107,"button",28),vi("click",function(){return r.mapaTunas()}),bn(108," Ver ruta"),lt(),lt(),lt(),lt(),lt())},styles:[".logo[_ngcontent-%COMP%]{width:75px;height:auto}"]}),t})(),canActivate:[px]},{path:"mapa/:ruta",component:iN,canActivate:[px]},{path:"",redirectTo:"/login",pathMatch:"full"}];let sN=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=dr({type:t}),t.\u0275inj=Qr({imports:[[dD.forRoot(oN)],dD]}),t})(),aN=(()=>{class t{constructor(){this.title="gpsurbano"}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=fs({type:t,selectors:[["app-root"]],decls:1,vars:0,template:function(n,r){1&n&&_n(0,"router-outlet")},directives:[hx],styles:[""]}),t})();const lN={url:"http://34.238.250.67:3002/",options:{}};let cN=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=dr({type:t,bootstrap:[aN]}),t.\u0275inj=Qr({providers:[px],imports:[[v5,tN.forRoot(lN),bF,sN,n5]]}),t})();(function(){if(XC)throw new Error("Cannot enable prod mode after platform setup.");WC=!1})(),vF().bootstrapModule(cN).catch(t=>console.error(t))}},ut=>{ut(ut.s=780)}]);